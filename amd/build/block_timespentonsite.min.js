/**
 * Block service call and rendering defined in this file.
 *
 * @copyright   2021 wisdmlabs <support@wisdmlabs.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ define(["jquery","./chart/apexcharts","./common","./defaultconfig"],function(e,t,a,i){let o={PANEL:"#timespentonsiteblock",INSIGHT:"#timespentonsiteblock .insight",GRAPH:"#apex-chart-timespentonsite-block"},r={GET_TIMESPENTONSITE:function(t){return e.ajax({url:i.requestUrl,type:i.requestType,dataType:i.requestDataType,data:{action:"get_timespentonsite_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:t})}})}},l={date:"weekly",student:0},s=null,n={series:[],chart:{type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},stroke:{curve:"smooth",width:2},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},dataLabels:{enabled:!1},colors:[i.getColorTheme()[2]],noData:{text:M.util.get_string("nographdata","local_edwiserreports")}};return{init:function i(d){var h;e(o.PANEL).length&&(a.loader.show(o.PANEL),r.GET_TIMESPENTONSITE(l).done(function(i){let r=Object.assign({},n);var l,d,h="rtl"==e("html").attr("dir")?1:0;r.series=[{name:M.util.get_string("timespentonsite","local_edwiserreports"),data:i.timespent}],r.yaxis={labels:{formatter:a.timeFormatter}},r.xaxis.categories=i.labels,r.chart.toolbar.show=i.labels.length>30,r.chart.zoom.enabled=i.labels.length>30,r.tooltip.y.title.formatter=()=>M.util.get_string("time","local_edwiserreports")+": ",i.insight.insight.value=a.timeFormatter(i.insight.insight.value,{dataPointIndex:0,short:!0},h).replaceAll(","," "),i.insight.details.data[0].value=a.timeFormatter(i.insight.details.data[0].value,{dataPointIndex:0},h),a.insight(o.INSIGHT,i.insight),l=e(o.PANEL).find(o.GRAPH),d=r,null!==s&&s.destroy(),(s=new t(l.get(0),d)).render(),setTimeout(function(){a.loader.hide(o.PANEL)},1e3)}).fail(function(e){Notification.exception(e),a.loader.hide(o.PANEL)}),e(o.PANEL).find(".singleselect").select2())}}});
