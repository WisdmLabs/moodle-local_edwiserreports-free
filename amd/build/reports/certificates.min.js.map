{"version":3,"sources":["reports/certificates.js"],"names":["define","$","Notification","common","CFG","SELECTOR","PAGE","TABLE","COHORT","CERTIFICATE","SEARCH","LENGTH","dataTable","filter","cohort","certificateid","PROMISES","GET_CERTIFICATES","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","attr","JSON","stringify","loadData","destroy","loader","show","done","response","DataTable","dom","columnDefs","targets","className","columns","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","initComplete","settings","json","asPieProgress","drawCallback","stylePaginationButton","this","find","namespace","speed","classes","svg","element","number","content","responsive","search","val","console","log","page","len","draw","fail","exception","always","hide","_init","CONTEXTID","document","select2","on","value","handleSearchInput","init","ready"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Certificates Stats report page.\n *\n * @package     local_edwiserreports\n * @author      Yogesh Shirsath\n * @copyright   2022 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine('local_edwiserreports/reports/certificates', [\n    'jquery',\n    'core/notification',\n    'local_edwiserreports/common',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/select2',\n    'local_edwiserreports/jquery.dataTables',\n    'local_edwiserreports/dataTables.bootstrap4',\n    'local_edwiserreports/jquery-asPieProgress'\n], function($, Notification, common, CFG) {\n\n    /**\n     * Selectors\n     */\n    var SELECTOR = {\n        PAGE: \"#certificates\",\n        TABLE: \"#certificates .table\",\n        COHORT: \"#certificates .cohort-select\",\n        CERTIFICATE: \"#certificates .certificate-select\",\n        SEARCH: \"#certificates .table-search-input input\",\n        LENGTH: \"#certificates .length-select\",\n    };\n\n    /**\n     * DataTable object.\n     */\n    var dataTable = null;\n\n    /**\n     * Filters\n     */\n    var filter = {\n        cohort: 0,\n        certificateid: 0\n    };\n\n    /**\n     * Ajax Promises\n     */\n    var PROMISES = {\n        /**\n         * Get certificates using ajax.\n         * @returns {Promise}\n         */\n        GET_CERTIFICATES: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_certificates_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        }\n    };\n\n    /**\n     * Get certificate detail using certificate id and cohort id\n     */\n    function loadData() {\n        if (dataTable) {\n            dataTable.destroy();\n        }\n\n        // Show loader when data is being loaded.\n        common.loader.show(SELECTOR.PAGE);\n\n        // Fetch certificates list.\n        PROMISES.GET_CERTIFICATES().done(function(response) {\n                // Render data table.\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    data: response.data,\n                    dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n                    columnDefs: [{\n                            \"targets\": 0,\n                            \"className\": \"align-middle\"\n                        },\n                        {\n                            \"targets\": 1,\n                            \"className\": \"align-middle\"\n                        },\n                        {\n                            \"targets\": \"_all\",\n                            \"className\": \"align-middle text-center\"\n                        }\n                    ],\n                    columns: [\n                        { \"data\": \"username\" },\n                        { \"data\": \"email\" },\n                        { \"data\": \"issuedate\" },\n                        { \"data\": \"dateenrolled\" },\n                        { \"data\": \"grade\" },\n                        { \"data\": \"courseprogress\" }\n                    ],\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('nocertificatesawarded', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: \"&#9666\",\n                            next: \"&#9656\"\n                        }\n                    },\n                    // eslint-disable-next-line no-unused-vars\n                    initComplete: function(settings, json) {\n                        $('.pie-progress').asPieProgress();\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                        createPieProgress('');\n                    },\n                    responsive: true\n                });\n                dataTable.columns(0).search($(SELECTOR.SEARCH).val());\n                console.log($(SELECTOR.LENGTH).val());\n                dataTable.page.len($(SELECTOR.LENGTH).val()).draw();\n            }).fail(Notification.exception)\n            .always(function() {\n                common.loader.hide(SELECTOR.PAGE);\n            })\n    }\n\n    /**\n     * Create pie progress where div with .pie-progress class is present\n     */\n    function createPieProgress() {\n        $(SELECTOR.PAGE).find('.pie-progress').asPieProgress({\n            namespace: 'pie-progress',\n            speed: 30,\n            classes: {\n                svg: 'pie-progress-svg',\n                element: 'pie-progress',\n                number: 'pie-progress-number',\n                content: 'pie-progress-content'\n            }\n        });\n    }\n\n    /* eslint-disable no-unused-vars */\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        /* eslint-enable no-unused-vars */\n\n        // Initialize select2.\n        $(document).find('.singleselect').select2();\n\n        filter.certificateid = $(SELECTOR.CERTIFICATE).val();\n        loadData();\n\n        // Certificate change.\n        $(document).on(\"change\", SELECTOR.CERTIFICATE, function() {\n            filter.certificateid = $(this).val();\n            loadData();\n            $('.download-links input[name=\"filter\"]').val(filter.certificateid);\n        });\n\n        // Handle cohort change.\n        $(document).on(\"change\", SELECTOR.COHORT, function() {\n            filter.cohort = $(this).val();\n            loadData();\n            $('.download-links input[name=\"cohortid\"]').val(filter.cohort);\n        });\n\n        // Observer length change.\n        $(SELECTOR.LENGTH).on('change', function() {\n            dataTable.page.len(this.value).draw();\n        });\n\n        // Search in table.\n        $(SELECTOR.SEARCH).on('input', function() {\n            dataTable.search(this.value).draw();\n        });\n\n        common.handleSearchInput();\n    }\n\n    return {\n        init: function() {\n            $(document).ready(init);\n        }\n    };\n\n});"],"file":"certificates.min.js"}