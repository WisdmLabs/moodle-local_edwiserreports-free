"use strict";define("local_edwiserreports/reports/allcoursessummary",["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events","core/fragment","local_edwiserreports/defaultconfig","local_edwiserreports/common","local_edwiserreports/jquery","local_edwiserreports/jquery.dataTables","local_edwiserreports/dataTables.bootstrap4","local_edwiserreports/select2","local_edwiserreports/flatpickr"],function(e,t,a,r,o,l,s,n,i){var d={PAGE:"#allcoursessummary",TABLE:"#allcoursessummary table",FORMFILTER:'#allcoursessummary .download-links [name="filter"]',COHORT:"#allcoursessummary .cohort-select",EXCLUDE:"#allcoursessummary .exclude-select",GROUP:"#allcoursessummary .group-select",SEARCH:"#allcoursessummary .table-search-input input",LENGTH:"#allcoursessummary .length-select",MODALTRIGGER:"#allcoursessummary table a.modal-trigger",MODALSEARCH:".allcoursessummary-modal .table-search-input input",DATE:".edwiserreports-calendar",DATEMENU:".edwiserreports-calendar + .dropdown-menu",DATEITEM:".edwiserreports-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".edwiserreports-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".edwiserreports-calendar + .dropdown-menu .flatpickr"};let c=null;var u=null,m={cohort:0,coursegroup:0,exclude:[],enrolment:"all"},p={GET_DATA:function(){return e.ajax({url:s.requestUrl,type:s.requestType,dataType:s.requestDataType,data:{action:"get_allcoursessummary_data",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify(m)}})},GET_FILTER_DATA:function(e,a){return t.call([{methodname:"local_edwiserreports_get_filter_data",args:{types:e,cohort:a}}],!1)[0]}};function g(){e(d.FORMFILTER).val(JSON.stringify(m)),n.loader.show(d.PAGE),null!==u&&u.destroy(),p.GET_DATA(m).then(function(t){(u=e(d.TABLE).DataTable({data:t,dom:'<"edwiserreports-table"<"p-2"i><t><"table-pagination"p>>',columnDefs:[{className:"fixed-column",targets:0},{className:"text-left",targets:[0,1,2]},{className:"text-right",targets:"_all"}],columns:[{data:"coursename",width:"10rem"},{data:"category",width:"10rem"},{data:"enrolments"},{data:"completed"},{data:"notstarted"},{data:"inprogress"},{data:"atleastoneactivitystarted",width:"8rem"},{data:"totalactivities",width:"5rem"},{data:"avgprogress",width:"6rem"},{data:"avggrade",width:"4rem"},{data:"highestgrade",width:"4rem"},{data:"lowestgrade",width:"4rem"},{data:"totaltimespent",render:function(e){return n.timeFormatter(e)},width:"5rem"},{data:"avgtimespent",render:function(e){return n.timeFormatter(e)},width:"5rem"}],columnDefs:[{className:"fixed-column",targets:0},{className:"text-left",targets:[0,1]},{className:"text-right",targets:"_all"}],language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nocourses","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},drawCallback:function(){n.stylePaginationButton(this)},initComplete:function(){n.loader.hide(d.PAGE)}})).columns(0).search(e(d.SEARCH).val()),u.page.len(e(d.LENGTH).val()).draw()}).fail(function(e){a.exception(e),n.loader.hide(d.PAGE)})}var f=null;function E(){e(d.PAGE).find(".singleselect").not(d.EXCLUDE).select2(),e(d.EXCLUDE).select2({placeholder:M.util.get_string("exclude","local_edwiserreports"),allowClear:!0}),n.handleSearchInput(),g(),e("body").on("change",d.LENGTH,function(){u.page.len(this.value).draw()}),e("body").on("input",d.SEARCH,function(){u.column(0).search(this.value).draw()}),e("body").on("input",d.MODALSEARCH,function(){f.search(this.value).draw()}),e("body").on("change",d.COHORT,function(){m.cohort=e(this).val(),m.coursegroup=0,p.GET_FILTER_DATA(["coursegroup"],m.cohort).done(function(e){e=JSON.parse(e),n.refreshFilter("group",e,d.PAGE,function(){g()})})}),e("body").on("change",d.EXCLUDE,function(){m.exclude=e(this).val(),e(this).toggleClass("notselected",0==m.exclude.length),e(this).toggleClass("selected",0!=m.exclude.length),g()}),c=i(d.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d M Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(d.DATEPICKER).get(0),onOpen:function(){e(d.DATEMENU).addClass("withcalendar"),setTimeout(function(){e(d.DATEMENU).offset().left<e(d.PAGE).parent().offset().left&&e(d.DATEMENU).css("left",e(d.DATEMENU).closest(".filter-selector").css("padding-left"))},500)},onChange:function(){e(d.DATEMENU).offset().left<e(d.PAGE).parent().offset().left&&e(d.DATEMENU).css("left",e(d.DATEMENU).closest(".filter-selector").css("padding-left"))},onClose:function(){e(d.DATEMENU).removeClass("withcalendar"),function(){let t=e(d.DATEPICKERINPUT).val(),a=e(d.DATEPICKERINPUT).next().val().replace("to","-");e(d.DATEPICKERINPUT).next().val(a),t.includes(" to ")?(e(d.DATEITEM).removeClass("active"),e(d.DATEITEM+".custom").addClass("active"),e(d.DATE).html(a),m.enrolment=t,g()):c.clear()}()}}),e("body").on("click",d.DATEITEM+":not(.custom)",function(){e(d.DATEITEM).removeClass("active"),e(this).addClass("active"),e(d.DATE).html(e(this).text()),c.clear(),m.enrolment=e(this).data("value"),g()}),e("body").on("change",d.GROUP,function(){m.coursegroup=e(this).val(),g()}),e("body").on("click",d.MODALTRIGGER,function(){let t=e(this),a=null,s=0!=e(d.GROUP).length?e(d.GROUP).val():"0,0",i=0;i=0==s?0:(s=s.split(","))[1],r.create({body:l.loadFragment("local_edwiserreports","userslist",1,{page:"allcoursessummary",minval:t.data("minvalue"),maxval:t.data("maxvalue"),course:t.data("courseid"),cohortid:m.cohort,group:i})}).then(function(e){a=e.getRoot(),e.getBody().addClass("allcoursessummary-modal"),a.find(".modal-dialog").addClass("modal-lg"),e.setTitle(t.data("coursename")),e.show(),a.on(o.hidden,function(){e.destroy()}),a.on(o.bodyRendered,function(){var e=a.find(".modal-table");e.find("tbody").hasClass("empty")&&e.find("tbody").empty(),f=e.DataTable({language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nousers","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},dom:'<"edwiserreports-table"i<t><"table-pagination"p>>',drawCallback:function(){n.stylePaginationButton(this)},lengthChange:!1})})})})}return{init:function(){e(document).ready(function(){E()})}}});
//# sourceMappingURL=allcoursessummary.min.js.map
