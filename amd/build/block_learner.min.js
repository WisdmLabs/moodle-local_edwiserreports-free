"use strict";define(["jquery","./chart/apexcharts","./common","./defaultconfig","./select2"],function(e,t,r,a){var o=["courseprogress","timespentonlms"],n=null,s={courseprogress:null,timespentonlms:null},l={courseprogress:{course:0},timespentonlms:{date:"weekly"}},i={series:[],chart:{type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0},y:{title:{}}},stroke:{curve:"smooth",width:2},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},legend:{position:"top",floating:!0},dataLabels:{enabled:!1}},d={series:[],chart:{type:"bar",height:350,toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},marker:{show:!0},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0},y:{title:{}}},grid:{borderColor:"#e7e7e7"},dataLabels:{enabled:!1},xaxis:{categories:null,labels:{hideOverlappingLabels:!0,trim:!0,rotate:300}},noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},c={chart:{type:"pie",height:350},legend:{position:"bottom",offsetY:0},noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},f={PANEL:"#learnerblock",DATE:".learner-calendar",DATEMENU:".learner-calendar + .dropdown-menu",DATEITEM:".learner-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".learner-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".learner-calendar + .dropdown-menu .flatpickr",COURSE:".course-select",GRAPH:".graph",GRAPHS:".learner-graphs",FILTERS:".filters",TIMESPENTONLMS:".timespentonlms",COURSEPROGRESS:".courseprogress"},p={GET_COURSEPROGRESS:function(t){return e.ajax({url:a.requestUrl,type:a.requestType,dataType:a.requestDataType,data:{action:"get_learner_courseprogress_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({filter:t})}})},GET_TIMESPENTONLMS:function(t){return e.ajax({url:a.requestUrl,type:a.requestType,dataType:a.requestDataType,data:{action:"get_learner_timespentonlms_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({filter:t})}})}};function u(a){var o;r.loader.show("#learnerblock ."+a);var n=Object.keys(l[a]).map(function(e){return l[a][e]}).join("-")+"-"+a;function u(e,o){null!==s[a]&&s[a].destroy(),s[a]=new t(e.get(0),o),s[a].render(),setTimeout(function(){r.loader.hide("#learnerblock ."+a)},1e3)}switch(e(f.PANEL).find(".".concat(a)).find(f.FORMFILTER).val(n),a){case"courseprogress":p.GET_COURSEPROGRESS(l[a]).done(function(t){0==l[a].course?((o=Object.assign({},d)).yaxis={max:100,labels:{formatter:function(e){return e+"%"}}},o.xaxis.categories=t.labels,o.series=[{name:M.util.get_string("courseprogress","local_edwiserreports"),data:t.progress}],o.chart.toolbar.show=t.labels.length>30,o.chart.zoom.enabled=t.labels.length>30,o.tooltip.y.title.formatter=function(e){return M.util.get_string("progress","local_edwiserreports")+": "}):((o=Object.assign({},c)).colors=["rgb(0, 227, 150)","rgb(254, 176, 25)"],o.labels=t.labels,o.series=t.progress),u(e(f.PANEL).find(f.COURSEPROGRESS).find(f.GRAPH),o)}).fail(function(e){r.loader.hide("#learnerblock ."+a)});break;case"timespentonlms":p.GET_TIMESPENTONLMS(l[a]).done(function(t){l[a].date.includes("to")||-1!==["weekly","monthly","yearly"].indexOf(l[a].date)?((o=Object.assign({},i)).yaxis={labels:{formatter:r.timeFormatter}},o.xaxis.categories=t.labels,o.series=[{name:M.util.get_string("timespentonlms","local_edwiserreports"),data:t.timespent}],o.chart.toolbar.show=t.labels.length>30,o.chart.zoom.enabled=t.labels.length>30,o.tooltip.y.title.formatter=function(e){return M.util.get_string("time","local_edwiserreports")+": "}):((o=Object.assign({},c)).labels=t.labels,o.series=t.timespent,o.tooltip={y:{formatter:r.timeFormatter}},o.legend={show:!1}),u(e(f.PANEL).find(f.TIMESPENTONLMS).find(f.GRAPH),o),r.loader.hide("#learnerblock ."+a)}).fail(function(e){r.loader.hide("#learnerblock ."+a)});break;default:r.loader.hide("#learnerblock ."+a)}}function E(){e("body").on("click",f.DATEITEM+":not(.custom)",function(){var t=e(this).closest(f.FILTERS).data("id");e(f.PANEL).find("."+t).find(f.DATEITEM).removeClass("active"),e(this).addClass("active"),e(f.PANEL).find("."+t).find(f.DATE).html(e(this).text()),n.clear(),l[t].date=e(this).data("value"),u(t)}),e("body").on("change","".concat(f.PANEL," ").concat(f.COURSE),function(){var t=e(this).closest(f.FILTERS).data("id"),r=parseInt(e(this).val());l[t].course=r,u(t)});var t="timespentonlms";n=e(f.PANEL).find("."+t).find(f.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(f.PANEL).find("."+t).find(f.DATEPICKER).get(0),onOpen:function(){e(f.PANEL).find("."+t).find(f.DATEMENU).addClass("withcalendar")},onClose:function(){e(f.PANEL).find("."+t).find(f.DATEMENU).removeClass("withcalendar"),function(t){var r=e(f.PANEL).find("."+t).find(f.DATEPICKERINPUT).val(),a=e(f.PANEL).find("."+t).find(f.DATEPICKERINPUT).next().val();e(f.PANEL).find("."+t).find(f.DATEITEM).removeClass("active"),e(f.PANEL).find("."+t).find(f.DATEITEM+".custom").addClass("active"),e(f.PANEL).find("."+t).find(f.DATE).html(a),l[t].date=r,u(t)}(t)}})}return{init:function(t){0!=e(f.PANEL).length&&(e(f.PANEL).find(".singleselect").select2(),E(),o.forEach(function(e){u(e)}))}}});
//# sourceMappingURL=block_learner.min.js.map
