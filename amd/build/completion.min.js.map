{"version":3,"sources":["completion.js"],"names":["define","$","V","common","init","CONTEXTID","PageId","CompletionTable","find","Table","pageLength","cohortId","getCourseCompletion","courseId","loader","show","params","action","sesskey","data","JSON","stringify","courseid","cohortid","destroy","DataTable","dom","ajax","generateUrl","requestUrl","oLanguage","sEmptyTable","columns","drawCallback","stylePaginationButton","this","columnDefs","className","targets","initComplete","hide","document","ready","handleSearchInput","val","on","select2","page","len","value","draw","column","search"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,cAAe,WAAY,aAAc,SAAUC,EAAGC,EAAGC,GAyGzE,MAAO,CACLC,KAnGF,SAAcC,GAEZ,IAAIC,EAAS,6BACTC,EAAkBN,EAAEK,GAAQE,KAAK,UACjCC,EAAQ,KACRC,EAAa,GAIbC,EAAW,EA8Bf,SAASC,EAAoBC,EAAUF,GACrCR,EAAOW,OAAOC,KAAKT,GACnB,IAAIU,EAAS,CACXC,OAAQ,2BACRC,QAASjB,EAAEK,GAAQa,KAAK,WACxBA,KAAMC,KAAKC,UAAU,CACnBC,SAAUT,EACVU,SAAUZ,KAID,MAATF,GACFA,EAAMe,UAGRf,EAAQF,EAAgBkB,UAAU,CAChCC,IAAK,2EACLC,KAAMzB,EAAE0B,YAAY1B,EAAE2B,WAAYb,GAClCN,WAAYA,EACZoB,UAAW,CACTC,YAAa,oCAEfC,QAAS,CAAC,CACRb,KAAQ,YACP,CACDA,KAAQ,cACP,CACDA,KAAQ,cACP,CACDA,KAAQ,cACP,CACDA,KAAQ,cACP,CACDA,KAAQ,iBACP,CACDA,KAAQ,SACP,CACDA,KAAQ,eAEVc,aAAc,WACZ9B,EAAO+B,sBAAsBC,OAE/BC,WAAY,CAAC,CACXC,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,cACXC,QAAS,SAEXC,aAAc,WACZpC,EAAOW,OAAO0B,KAAKlC,MAlFzBL,EAAEwC,UAAUC,MAAM,WAChBvC,EAAOwC,oBAEP,IAAI9B,EAAWZ,EAAEK,GAAQE,KAAK,wCAAwCoC,MACtEhC,EAAoBC,EAAUF,GAE9BV,EAAEK,GAAQE,KAAK,kBAAkBqC,GAAG,SAAU,WAC5ClC,EAAWV,EAAEkC,MAAMS,MACnB3C,EAAEK,GAAQE,KAAK,0CAA0CoC,IAAIjC,GAC7DC,EAAoBC,EAAUF,KAGhCV,EAAEK,GAAQE,KAAK,iBAAiBsC,UAEhC7C,EAlBiB,yDAkBD4C,GAAG,SAAU,WAC3BpC,EAAMsC,KAAKC,IAAIb,KAAKc,OAAOC,OAC3BxC,EAAayB,KAAKc,QAGpBhD,EAtBgB,wDAsBD4C,GAAG,QAAS,WACzBpC,EAAM0C,OAAO,GAAGC,OAAOjB,KAAKc,OAAOC","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    './variables',\n    './common',\n    './select2'\n], function($, V, common) {\n    /* eslint-disable no-unused-vars */\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        /* eslint-enable no-unused-vars */\n        var PageId = \"#wdm-completion-individual\";\n        var CompletionTable = $(PageId).find(\".table\");\n        var Table = null;\n        var pageLength = 10;\n        var lengthSelect = \"#wdm-completion-individual .table-length-input select\";\n        var searchTable = \"#wdm-completion-individual .table-search-input input\";\n\n        // Varibales for cohort filter\n        var cohortId = 0;\n\n        $(document).ready(function() {\n\n            common.handleSearchInput();\n\n            // Get course id\n            var courseId = $(PageId).find('.download-links input[name=\"filter\"]').val();\n\n            getCourseCompletion(courseId, cohortId);\n\n            // Select cohort filter for active users block.\n            $(PageId).find('.cohort-select').on('change', function() {\n                cohortId = $(this).val();\n                $(PageId).find('.download-links input[name=\"cohortid\"]').val(cohortId);\n                getCourseCompletion(courseId, cohortId);\n            });\n\n            // Initialize select2.\n            $(PageId).find('.singleselect').select2();\n\n            // Observer length change.\n            $(lengthSelect).on('change', function() {\n                Table.page.len(this.value).draw();\n                pageLength = this.value;\n            });\n\n            // Search in table.\n            $(searchTable).on('input', function() {\n                Table.column(0).search(this.value).draw();\n            });\n        });\n\n        /**\n         * Get Course Completion\n         * @param  {Number} courseId Course Id\n         * @param  {number} cohortId Cohort Id\n         */\n        function getCourseCompletion(courseId, cohortId) {\n            common.loader.show(PageId);\n\n            var params = {\n                action: \"get_completion_data_ajax\",\n                sesskey: $(PageId).data(\"sesskey\"),\n                data: JSON.stringify({\n                    courseid: courseId,\n                    cohortid: cohortId\n                })\n            };\n\n            if (Table != null) {\n                Table.destroy();\n            }\n\n            Table = CompletionTable.DataTable({\n                dom: '<\"edwiserreports-table\"<\"table-filter d-flex\"i><t><\"table-pagination\"p>>',\n                ajax: V.generateUrl(V.requestUrl, params),\n                pageLength: pageLength,\n                oLanguage: {\n                    sEmptyTable: \"No users are enrolled as student\",\n                },\n                columns: [\n                    { \"data\": \"username\" },\n                    { \"data\": \"enrolledon\" },\n                    { \"data\": \"enrolltype\" },\n                    { \"data\": \"noofvisits\" },\n                    { \"data\": \"completion\" },\n                    { \"data\": \"compleiontime\" },\n                    { \"data\": \"grade\" },\n                    { \"data\": \"lastaccess\" }\n                ],\n                drawCallback: function() {\n                    common.stylePaginationButton(this);\n                },\n                columnDefs: [\n                    { className: \"text-left\", targets: 0 },\n                    { className: \"text-left\", targets: 1 },\n                    { className: \"text-center\", targets: \"_all\" }\n                ],\n                initComplete: function() {\n                    common.loader.hide(PageId);\n                }\n            });\n        }\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"file":"completion.min.js"}