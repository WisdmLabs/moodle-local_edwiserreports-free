{"version":3,"sources":["completion.js"],"names":["define","$","V","init","CONTEXTID","PageId","CompletionTable","find","loader","Table","cohortId","getCourseCompletion","courseId","destroy","hide","show","params","action","sesskey","data","JSON","stringify","courseid","cohortid","url","generateUrl","requestUrl","DataTable","ajax","oLanguage","sEmptyTable","sSearchPlaceholder","columns","drawCallback","addClass","columnDefs","className","targets","initComplete","bInfo","document","ready","val","cohortFilterItem","on","this","cohortFilterBtn","html","text"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,iCAAkC,+BAAgC,SAAUC,EAAGC,GAiG/F,MAAO,CACLC,KA3FF,SAAcC,GAEZ,IAAIC,EAASJ,EAAE,8BACXK,EAAkBD,EAAOE,KAAK,UAC9BC,EAASH,EAAOE,KAAK,WACrBE,EAAQ,KAERC,EAAW,EAqBf,SAASC,EAAoBC,EAAUF,GACjCD,IACFA,EAAMI,UACNP,EAAgBQ,OAChBN,EAAOO,QAGT,IAAIC,EAAS,CACXC,OAAQ,2BACRC,QAASb,EAAOc,KAAK,WACrBA,KAAMC,KAAKC,UAAU,CACnBC,SAAUV,EACVW,SAAUb,KAGVc,EAAMtB,EAAEuB,YAAYvB,EAAEwB,WAAYV,GACtCV,EAAgBS,OAChBN,EAAQH,EAAgBqB,UAAU,CAChCC,KAAMJ,EACNK,UAAW,CACTC,YAAa,mCACbC,mBAAoB,eAEtBC,QAAS,CAAC,CACRb,KAAQ,YACP,CACDA,KAAQ,cACP,CACDA,KAAQ,cACP,CACDA,KAAQ,cACP,CACDA,KAAQ,cACP,CACDA,KAAQ,iBACP,CACDA,KAAQ,SACP,CACDA,KAAQ,eAEVc,aAAc,WACZhC,EAAE,sCAAsCiC,SAAS,4BACjDjC,EAAE,sBAAsBiC,SAAS,6BAEnCC,WAAY,CAAC,CACXC,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,cACXC,QAAS,SAEXC,aAAc,WACZrC,EAAEO,GAAQM,QAEZyB,OAAO,IA7EXtC,EAAEuC,UAAUC,MAAM,WAEhB,IAAI7B,EAAWX,EAAEI,GAAQE,KAAK,wCAAwCmC,MACtE/B,EAAoBC,EAAUF,GAG9BT,EAAEC,EAAEyC,kBAAkBC,GAAG,QAAS,WAChClC,EAAWT,EAAE4C,MAAM1B,KAAK,YACxBlB,EAAEC,EAAE4C,iBAAiBC,KAAK9C,EAAE4C,MAAMG,QAElC/C,EAAEI,GAAQE,KAAK,0CAA0CmC,IAAIhC,GAC7DC,EAAoBC,EAAUF","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'local_edwiserreports/variables',\n    'local_edwiserreports/common'\n], function($, V) {\n    /* eslint-disable no-unused-vars */\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        /* eslint-enable no-unused-vars */\n        var PageId = $(\"#wdm-completion-individual\");\n        var CompletionTable = PageId.find(\".table\");\n        var loader = PageId.find(\".loader\");\n        var Table = null;\n\n        // Varibales for cohort filter\n        var cohortId = 0;\n\n        $(document).ready(function() {\n            // Get course id\n            var courseId = $(PageId).find('.download-links input[name=\"filter\"]').val();\n\n            getCourseCompletion(courseId, cohortId);\n\n            /* Select cohort filter for active users block */\n            $(V.cohortFilterItem).on('click', function() {\n                cohortId = $(this).data('cohortid');\n                $(V.cohortFilterBtn).html($(this).text());\n                // V.changeExportUrl(cohortId, V.exportUrlLink, V.cohortReplaceFlag);\n                $(PageId).find('.download-links input[name=\"cohortid\"]').val(cohortId);\n                getCourseCompletion(courseId, cohortId);\n            });\n        });\n\n        /**\n         * Get Course Completion\n         * @param  {Number} courseId Course Id\n         * @param  {number} cohortId Cohort Id\n         */\n        function getCourseCompletion(courseId, cohortId) {\n            if (Table) {\n                Table.destroy();\n                CompletionTable.hide();\n                loader.show();\n            }\n\n            var params = {\n                action: \"get_completion_data_ajax\",\n                sesskey: PageId.data(\"sesskey\"),\n                data: JSON.stringify({\n                    courseid: courseId,\n                    cohortid: cohortId\n                })\n            };\n            var url = V.generateUrl(V.requestUrl, params);\n\n            CompletionTable.show();\n            Table = CompletionTable.DataTable({\n                ajax: url,\n                oLanguage: {\n                    sEmptyTable: \"No users are enrolled as student\",\n                    sSearchPlaceholder: \"Search User\"\n                },\n                columns: [\n                    {\"data\": \"username\"},\n                    {\"data\": \"enrolledon\"},\n                    {\"data\": \"enrolltype\"},\n                    {\"data\": \"noofvisits\"},\n                    {\"data\": \"completion\"},\n                    {\"data\": \"compleiontime\"},\n                    {\"data\": \"grade\"},\n                    {\"data\": \"lastaccess\"}\n                ],\n                drawCallback: function() {\n                    $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\n                    $('.dataTables_filter').addClass('pagination-sm pull-right');\n                },\n                columnDefs: [\n                    {className: \"text-left\", targets: 0},\n                    {className: \"text-left\", targets: 1},\n                    {className: \"text-center\", targets: \"_all\"}\n                ],\n                initComplete: function() {\n                    $(loader).hide();\n                },\n                bInfo: false\n            });\n        }\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"file":"completion.min.js"}