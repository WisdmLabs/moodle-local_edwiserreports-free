{"version":3,"sources":["completion.js"],"names":["define","$","V","common","SELECTOR","PANEL","FORMFILTER","FORMRTL","FILTERS","rtl","attr","init","CONTEXTID","PageId","CompletionTable","find","Table","pageLength","cohortId","getCourseCompletion","courseId","loader","show","params","action","sesskey","data","JSON","stringify","courseid","cohortid","destroy","DataTable","dom","ajax","generateUrl","requestUrl","language","info","M","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","columns","render","width","tempdate","formatDate","Date","substring","drawCallback","stylePaginationButton","this","columnDefs","className","targets","initComplete","hide","document","ready","handleSearchInput","val","on","window","location","cfg","wwwroot","select2","page","len","value","draw","column","search"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    './variables',\n    './common',\n    './select2'\n], function($, V, common) {\n    /* eslint-disable no-unused-vars */\n\n    /**\n     * Selectors list.\n     */\n    var SELECTOR = {\n        PANEL: '#wdm-completion-individual',\n        FORMFILTER: '.download-links [name=\"filter\"]',\n        FORMRTL: '.download-links [name=\"rtl\"]',\n        FILTERS: '.filters'\n    };\n\n    /**\n     * rtl for rtl lang support.\n     */\n    let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n\n    /**\n     * Filter for ajax.\n     */\n    var filter = {\n        rtl: rtl\n    };\n\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        /* eslint-enable no-unused-vars */\n        var PageId = \"#wdm-completion-individual\";\n        var CompletionTable = $(PageId).find(\".table\");\n        var Table = null;\n        var pageLength = 10;\n        var lengthSelect = \"#wdm-completion-individual .table-length-input select\";\n        var searchTable = \"#wdm-completion-individual .table-search-input input\";\n\n        // Varibales for cohort filter\n        var cohortId = 0;\n\n        $(document).ready(function() {\n\n            common.handleSearchInput();\n\n            // Get course id\n            var courseId = $(PageId).find('.download-links input[name=\"filter\"]').val();\n            $(SELECTOR.PANEL).find(SELECTOR.FORMRTL).val(rtl);\n\n            getCourseCompletion(courseId, cohortId);\n\n            // Select cohort filter for active users block.\n            $(PageId).find('.cohort-select').on('change', function() {\n                cohortId = $(this).val();\n                $(PageId).find('.download-links input[name=\"cohortid\"]').val(cohortId);\n                getCourseCompletion(courseId, cohortId);\n            });\n\n            // Select course filter for completion table.\n            $(PageId).find('.course-select').on('change', function() {\n                window.location = M.cfg.wwwroot + '/local/edwiserreports/completion.php?courseid=' + $(this).val();\n            });\n\n            // Initialize select2.\n            $(PageId).find('.singleselect').select2();\n\n            // Observer length change.\n            $(lengthSelect).on('change', function() {\n                Table.page.len(this.value).draw();\n                pageLength = this.value;\n            });\n\n            // Search in table.\n            $(searchTable).on('input', function() {\n                Table.column(0).search(this.value).draw();\n            });\n        });\n\n        /**\n         * Get Course Completion\n         * @param  {Number} courseId Course Id\n         * @param  {number} cohortId Cohort Id\n         */\n        function getCourseCompletion(courseId, cohortId) {\n            common.loader.show(PageId);\n\n            var params = {\n                action: \"get_completion_data_ajax\",\n                sesskey: $(PageId).data(\"sesskey\"),\n                data: JSON.stringify({\n                    courseid: courseId,\n                    cohortid: cohortId\n                })\n            };\n\n            if (Table !== null) {\n                Table.destroy();\n            }\n\n            Table = CompletionTable.DataTable({\n                dom: '<\"edwiserreports-table\"<\"table-filter d-flex\"i><t><\"table-pagination\"p>>',\n                ajax: V.generateUrl(V.requestUrl, params),\n                pageLength: pageLength,\n                language: {\n                    info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                    infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                    emptyTable: M.util.get_string('nostudentsenrolled', 'local_edwiserreports'),\n                    zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                    paginate: {\n                        previous: \" \",\n                        next: \" \"\n                    }\n                },\n                columns: [{\n                    \"data\": \"username\"\n                }, {\n                    \"data\": \"enrolledon\",\n                    render: function(data) {\n                        let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n                        if(rtl){\n                            return '<label style=\"direction:ltr;\">' + data + '</label>';\n                        } else {\n                            return data;\n                        }\n                    },\n                    width: \"10rem\"\n                }, {\n                    \"data\": \"enrolltype\"\n                }, {\n                    \"data\": \"noofvisits\"\n                }, {\n                    \"data\": \"completion\"\n                }, {\n                    \"data\": \"compleiontime\",\n                    render: function(data) {\n                        let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n\n                        if(rtl){\n                            return '<label style=\"direction:ltr;\">' + data + '</label>';\n                        } else {\n                            return data;\n                        }\n                    },\n                    width: \"10rem\"\n                }, {\n                    \"data\": \"grade\"\n                }, {\n                    \"data\": \"lastaccess\",\n                    render: function(data) {\n                        // let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n                        // if(data != 0){\n                            // if(rtl){\n//                                 let datearr = data.split(\" \");\n//                                 return '<label style=\"direction:ltr;\">' + datearr[2] + ' ' + datearr[1] + ' ' + datearr[0] + '</label>';\n//                             } else {\n                        //         return '<label style=\"direction:ltr;\">' + data + '</label>';\n                        //     }\n                        // } else {\n                        //     return M.util.get_string('never', 'local_edwiserreports');\n                        // }\n\n                        let tempdate = common.formatDate(new Date(data * 1000), \"d MMM yyyy hh:mm TT\").substring(0,11) + '<br>' + common.formatDate(new Date(data * 1000), \"d MMM yyyy hh:mm TT\").substring(11,20);\n                        let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n\n                        if(rtl){\n                            tempdate = common.formatDate(new Date(data * 1000), \"TT mm:hh yyyy MMM d\").substring(8, 20) + '<br>' + common.formatDate(new Date(data * 1000), \"TT mm:hh yyyy MMM d\").substring(0,8);\n                        }\n\n                        return `<p class=\"erp-time-rtl\"><span class=\"d-none\">${data}</span>` +\n                            (data == 0 ? M.util.get_string('never', 'local_edwiserreports') : tempdate) + '</p>';\n\n                    },\n                    width: \"10rem\"\n                }],\n                drawCallback: function() {\n                    common.stylePaginationButton(this);\n                },\n                columnDefs: [{\n                    className: \"text-left\",\n                    targets: [0, 1]\n                }, {\n                    className: \"text-right\",\n                    targets: \"_all\"\n                }],\n                initComplete: function() {\n                    common.loader.hide(PageId);\n                }\n            });\n        }\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"file":"completion.min.js"}