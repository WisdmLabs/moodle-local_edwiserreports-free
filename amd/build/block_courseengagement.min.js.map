{"version":3,"sources":["block_courseengagement.js"],"names":["define","$","ModalFactory","ModalEvents","Fragment","CFG","common","SELECTOR","PANEL","COHORT","TABLE","SEARCH","USERS","MODALSEARCH","filter","cohort","dataTable","PROMISE","GET_COURSEENGAGEMENT","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","attr","JSON","stringify","init","invalidUser","length","find","select2","loader","show","done","response","destroy","DataTable","dom","columns","columnDefs","className","targets","info","language","infoEmpty","util","get_string","emptyTable","zeroRecords","paginate","previous","next","drawCallback","addClass","stylePaginationButton","this","fail","console","log","always","hide"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,qBAAsB,oBAAqB,gBAAiB,qCAAsC,+BAAgC,SAAUC,EAAGC,EAAcC,EAAaC,EAAUC,EAAKC,GAIzM,IAAIC,EAAW,CACbC,MAAO,yBACPC,OAAQ,iBACRC,MAAO,+BACPC,OAAQ,4BACRC,MAAO,+CACPC,YAAa,iDAMXC,EAAS,CACXC,OAAQ,GAMNC,EAAY,KAKZC,EAAU,CAMZC,qBAAsB,SAA8BJ,GAClD,OAAOb,EAAEkB,KAAK,CACZC,IAAKf,EAAIgB,WACTC,KAAMjB,EAAIkB,YACVC,SAAUnB,EAAIoB,gBACdC,KAAM,CACJC,OAAQ,iCACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAM9B,EAAE,QAAQ+B,KAAK,QACrBN,KAAMO,KAAKC,UAAU,CACnBpB,OAAQA,SAoFlB,MAAO,CACLqB,KAZF,SAAcC,GAEqB,IAA7BnC,EAAEM,EAASC,OAAO6B,SAItBpC,EAAEM,EAASC,OAAO8B,KAAK,iBAAiBC,UAnExCjC,EAAOkC,OAAOC,KAAKlC,EAASC,OAC5BS,EAAQC,qBAAqBJ,GAAQ4B,KAAK,SAAUC,GAChC,OAAd3B,GACFA,EAAU4B,UAEZ5B,EAAYf,EAAEM,EAASG,OAAOmC,UAAU,CACtCnB,KAAMiB,EAASjB,KACfoB,IAAK,mDACLC,QAAS,CAAC,CACRrB,KAAQ,cACP,CACDA,KAAQ,YACP,CACDA,KAAQ,aACP,CACDA,KAAQ,mBACP,CACDA,KAAQ,yBACP,CACDA,KAAQ,WACP,CACDA,KAAQ,iBACP,CACDA,KAAQ,aACP,CACDA,KAAQ,qBAEVsB,WAAY,CAAC,CACXC,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,cACXC,QAAS,SAEXC,MAAM,EACNC,SAAU,CACRC,UAAWxB,EAAEyB,KAAKC,WAAW,YAAa,wBAC1CC,WAAY3B,EAAEyB,KAAKC,WAAW,YAAa,wBAC3CE,YAAa5B,EAAEyB,KAAKC,WAAW,cAAe,wBAC9CG,SAAU,CACRC,SAAU9B,EAAEyB,KAAKC,WAAW,WAAY,UACxCK,KAAM/B,EAAEyB,KAAKC,WAAW,OAAQ,YAGpCM,aAAc,WACZ5D,EAAEM,EAASG,OAAO4B,KAAK,MAAMwB,SAAS,yBACtCxD,EAAOyD,sBAAsBC,WAGhCC,KAAK,SAAUvC,GAChBwC,QAAQC,IAAIzC,KACX0C,OAAO,WAER9D,EAAOkC,OAAO6B,KAAK9D,EAASC","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Course Engagement block.\n *\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console, no-unused-vars */\ndefine([\n    'jquery',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/fragment',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/common',\n], function(\n    $,\n    ModalFactory,\n    ModalEvents,\n    Fragment,\n    CFG,\n    common\n) {\n\n    /**\n     * Selectors.\n     */\n    var SELECTOR = {\n        PANEL: '#courseengagementblock',\n        COHORT: '.cohort-select',\n        TABLE: '#courseengagementblock table',\n        SEARCH: '.table-search-input input',\n        USERS: '#courseengagementblock table a.modal-trigger',\n        MODALSEARCH: '.courseengage-modal .table-search-input input'\n    };\n\n    /**\n     * Filter.\n     */\n    var filter = {\n        cohort: 0\n    };\n\n    /**\n     * Data table object.\n     */\n    var dataTable = null;\n\n    /**\n     * Promises list.\n     */\n    let PROMISE = {\n        /**\n         * Get timespent on site using filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_COURSEENGAGEMENT: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_courseengagement_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        }\n    };\n\n    /**\n     * Load data to dataTable using ajax.\n     */\n    function loadData() {\n        // Show loader.\n        common.loader.show(SELECTOR.PANEL);\n\n        PROMISE.GET_COURSEENGAGEMENT(filter).done(function(response) {\n                if (dataTable !== null) {\n                    dataTable.destroy();\n                }\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    data: response.data,\n                    dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                    columns: [{\n                        \"data\": \"coursename\"\n                    }, {\n                        \"data\": \"category\"\n                    }, {\n                        \"data\": \"enrolment\"\n                    }, {\n                        \"data\": \"coursecompleted\"\n                    }, {\n                        \"data\": \"completionspercentage\"\n                    }, {\n                        \"data\": \"visited\"\n                    }, {\n                        \"data\": \"averagevisits\"\n                    }, {\n                        \"data\": \"timespent\"\n                    }, {\n                        \"data\": \"averagetimespent\"\n                    }],\n                    columnDefs: [{\n                        className: \"text-left\",\n                        targets: 0\n                    }, {\n                        className: \"text-center\",\n                        targets: \"_all\"\n                    }],\n                    info: false,\n                    language: {\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('nocourses', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: M.util.get_string('previous', 'moodle'),\n                            next: M.util.get_string('next', 'moodle')\n                        }\n                    },\n                    drawCallback: function() {\n                        $(SELECTOR.TABLE).find('th').addClass('theme-3-bg text-white');\n                        common.stylePaginationButton(this);\n                    }\n                });\n            })\n            .fail(function(data) {\n                console.log(data);\n            })\n            .always(function() {\n                // Hide loader.\n                common.loader.hide(SELECTOR.PANEL);\n            });\n\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        // Block not present on page.\n        if ($(SELECTOR.PANEL).length === 0) {\n            return;\n        }\n        // Enable select2 on cohort filter.\n        $(SELECTOR.PANEL).find('.singleselect').select2();\n\n        loadData();\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});"],"file":"block_courseengagement.min.js"}