{"version":3,"sources":["lpdetailedreport.js"],"names":["define","$","str","v","filter","JSON","stringify","type","component","checkboxeSelector","reportForm","translation","get_strings","key","url","requestUrl","M","cfg","sesskey","then","dtConfig","columns","data","language","searchPlaceholder","util","get_string","emptyTable","DataTable","ajax","responsive","scrollY","scroller","loadingIndicator","scrollCollapse","scrollX","paging","bInfo","bSort","adjust","document","on","event","target","is","prop","length","show","hide","panel","find","addClass","removeClass","setTimeout","filters","each","idx","ele","push","val","join","submit"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,WAAY,kCAAmC,SAAUC,EAAGC,EAAKC,GAKjF,IAAIC,EAASC,KAAKC,UAAU,CAC1BC,KAAM,QAOJC,EAAY,uBAMZC,EAAoB,0CAYpBC,EAAaT,EAAE,8BAMfU,EAAcT,EAAIU,YAAY,CAAC,CACjCC,IAAK,YACLL,UAAWA,GACV,CACDK,IAAK,qBACLL,UAAWA,KAGTM,EAAMX,EAAEY,WAAa,mDAAqDC,EAAEC,IAAIC,QAAU,WAAad,EAG3GO,EAAYQ,KAAK,WAEf,IAAIC,EAAW,CACbC,QAAW,CAAC,CACVC,KAAQ,UACP,CACDA,KAAQ,YACP,CACDA,KAAQ,aACP,CACDA,KAAQ,aACP,CACDA,KAAQ,WACP,CACDA,KAAQ,aAEVC,SAAY,CACVC,kBAAqBR,EAAES,KAAKC,WAAW,YAAalB,GACpDmB,WAAcX,EAAES,KAAKC,WAAW,qBAAsBlB,KAI1DP,EAAE,qBAAqB2B,UAAU,CAC/BC,KAAMf,EACNO,QAASD,EAASC,QAClBE,SAAUH,EAASG,SACnBO,YAAY,EACZC,QAAS,QACTC,SAAU,CACRC,kBAAkB,GAEpBC,gBAAgB,EAChBC,SAAS,EACTC,QAAQ,EACRC,OAAO,EACPC,OAAO,IACNjB,QAAQkB,SAKXtC,EAAEuC,UAAUC,GAAG,SAAU,gCAAiC,SAAUC,GAE9DzC,EAAEyC,EAAMC,QAAQC,GAAG,YACrB3C,EAAEQ,GAAmBoC,KAAK,WAAW,GAErC5C,EAAEQ,GAAmBoC,KAAK,WAAW,KAOzC5C,EAAEuC,UAAUC,GAAG,SAAU,qCAAsC,WACxDxC,EAAEQ,EAAoB,YAAYqC,OAIrC7C,EAjFY,yBAiFG8C,QAHf9C,EAAE,iCAAiC4C,KAAK,WAAW,GACnD5C,EA/EY,yBA+EG+C,UASnB/C,EAAEuC,UAAUC,GAAG,QAxFC,wBAwFqB,WAEnC,IAAKxC,EAAEQ,EAAoB,YAAYqC,OAOrC,OALA7C,EAAEgD,OAAOC,KAAK,aAAaC,SAAS,QAAQC,YAAY,QACxDC,WAAW,WAETpD,EAAEgD,OAAOC,KAAK,aAAaC,SAAS,QAAQC,YAAY,SACvD,MACI,EAGT,IAAIE,EAAU,GAQd,OAPArD,EAAEQ,EAAoB,YAAY8C,KAAK,SAAUC,EAAKC,GACpDH,EAAQI,KAAKzD,EAAEwD,GAAKnC,KAAK,SAG3BZ,EAAWwC,KAAK,uBAAuBS,IAAIL,EAAQM,KAAK,MAExDlD,EAAWmD,UACJ","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/str',\n    'local_edwiserreports/variables'\n], function(\n    $,\n    str,\n    v\n) {\n    /**\n     * Learning Program filter\n     * @type {[type]}\n     */\n    var filter = JSON.stringify({\n        type: 'lps'\n    });\n\n    /**\n     * Plugin Component\n     * @type {String}\n     */\n    var component = 'local_edwiserreports';\n\n    /**\n     * Checkbox selector\n     * @type {String}\n     */\n    var checkboxeSelector = '.lp-table [name^=\"customReportSelect-\"]';\n\n    /**\n     * Download Learning program detailed reports btn selector\n     * @type {String}\n     */\n    var downloadBtn = '#wdm-lpdetailedreport';\n\n    /**\n     * Learning Program Detailed Report form\n     * @type {Object}\n     */\n    var reportForm = $('#wdm-lpdetailedreport-form');\n\n    /**\n     * Get translation to use strings\n     * @type {object}\n     */\n    var translation = str.get_strings([\n        {key: 'searchlps', component: component},\n        {key: 'nolearningprograms', component: component},\n    ]);\n\n    // Prepare url to get selector related data\n    var url = v.requestUrl + '?action=get_customreport_selectors_ajax&sesskey=' + M.cfg.sesskey + '&filter=' + filter;\n\n    // When translation is ready\n    // eslint-disable-next-line promise/catch-or-return\n    translation.then(function() {\n        // Datatable configurations\n        var dtConfig = {\n            \"columns\": [\n                {\"data\": \"select\"},\n                {\"data\": \"fullname\"},\n                {\"data\": \"shortname\"},\n                {\"data\": \"startdate\"},\n                {\"data\": \"enddate\"},\n                {\"data\": \"duration\"},\n            ],\n            \"language\": {\n                \"searchPlaceholder\": M.util.get_string('searchlps', component),\n                \"emptyTable\": M.util.get_string('nolearningprograms', component)\n            }\n        };\n\n        // Create Datatable for modal\n        $('#wdm-lplist-table').DataTable({\n            ajax: url,\n            columns: dtConfig.columns,\n            language: dtConfig.language,\n            responsive: true,\n            scrollY: \"250px\",\n            scroller: {\n                loadingIndicator: true\n            },\n            scrollCollapse: true,\n            scrollX: true,\n            paging: false,\n            bInfo: false,\n            bSort: false\n        }).columns.adjust();\n\n        /**\n         * Select all for learning program\n         */\n        $(document).on('change', 'input[name=\"selectAllCustom\"]', function(event) {\n            // Checked/unchecked checkboxes\n            if ($(event.target).is(':checked')) {\n                $(checkboxeSelector).prop(\"checked\", true);\n            } else {\n                $(checkboxeSelector).prop(\"checked\", false);\n            }\n        });\n\n        /**\n         * Operations on checkbox select\n         */\n        $(document).on('change', '.modal-body input[type=\"checkbox\"]', function() {\n            if (!$(checkboxeSelector + \":checked\").length) {\n                $('input[name=\"selectAllCustom\"]').prop(\"checked\", false);\n                $(downloadBtn).hide();\n            } else {\n                $(downloadBtn).show();\n            }\n        });\n\n        /**\n         * Download reports in csv format\n         */\n        $(document).on('click', downloadBtn, function() {\n            // If no data selected\n            if (!$(checkboxeSelector + \":checked\").length) {\n                // eslint-disable-next-line no-undef\n                $(panel).find('#errorMsg').addClass('show').removeClass('hide');\n                setTimeout(function() {\n                    // eslint-disable-next-line no-undef\n                    $(panel).find('#errorMsg').addClass('hide').removeClass('show');\n                }, 5000);\n                return false;\n            }\n\n            var filters = [];\n            $(checkboxeSelector + \":checked\").each(function(idx, ele) {\n                filters.push($(ele).data('id'));\n            });\n\n            // Set form value\n            reportForm.find('input[name=filters]').val(filters.join(\",\"));\n\n            // Submit form on download button\n            reportForm.submit();\n            return true;\n        });\n        return;\n    });\n});\n"],"file":"lpdetailedreport.min.js"}