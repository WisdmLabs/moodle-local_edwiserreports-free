"use strict";define(["jquery","local_edwiserreports/defaultconfig","core/templates","local_edwiserreports/select2"],function(e,t,s){e(document).ready(function(){var n='<span class="px-10 py-5 pull-right"><i class="fa fa-spinner fa-spin"></i></span>';e("#ed_rpm").select2({multiple:!0,closeOnSelect:!1,placeholder:"Reporting Managers"}),e("#ed_lps").select2({multiple:!0,closeOnSelect:!1,placeholder:"Learning Programs"}),e("#ed_courses").select2({multiple:!0,closeOnSelect:!1,placeholder:"Courses"}),e("#ed_cohorts").select2({multiple:!0,closeOnSelect:!1,placeholder:"Cohorts"}),e("#ed_users").select2({multiple:!0,closeOnSelect:!1,placeholder:"Users"}),e("#ed_activitytype").select2({maximumSelectionLength:1,multiple:!0,closeOnSelect:!0,placeholder:"Activity Type"});var o=["0"];e("#ed_lps").on("change",function(l){e("div[class^='lp']").show();var c=[];if(e(l.currentTarget).find("option:selected").each(function(t,s){c[t]=e(s).val()}),JSON.stringify(o)!==JSON.stringify(c)){e("#ed_courses").html("").siblings(".select2-container").find(".select2-selection").html(n);var i=o.indexOf("0"),a=c.indexOf("0");switch(!0){case-1==i&&a>-1:o=c=["0"],e("#ed_lps").select2("val",c);break;case i>-1&&a>-1:c.splice(a,1),o=c,e("#ed_lps").select2("val",c)}o=c,e.ajax({url:t.requestUrl,type:t.requestType,dataType:t.requestDataType,data:{action:"get_customqueryreport_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({lpids:c})}}).done(function(t){e("#ed_courses").html("");var n={courses:t};s.render("local_edwiserreports/customquery_options",n).then(function(t,n){s.replaceNodeContents(e("#ed_courses"),t,n)}).fail(function(e){console.log(e)})}).fail(function(e){}).always(function(){e("#ed_courses").select2({multiple:!0,closeOnSelect:!1,placeholder:"Courses"})}),c.length||e("div[class^='lp']").hide()}});var l=["0"];e("#ed_rpm").on("change",function(o){var c=[];e(o.currentTarget).find("option:selected").each(function(t,s){c[t]=e(s).val()});var i=[];if(e("#ed_cohorts").find("option:selected").each(function(t,s){i[t]=e(s).val()}),JSON.stringify(l)!==JSON.stringify(c)){e("div[class^='rpm']").show(),e("#ed_lps").html("").siblings(".select2-container").find(".select2-selection").html(n),e("#ed_courses").html("").siblings(".select2-container").find(".select2-selection").html(n),e("#ed_users").html("").siblings(".select2-container").find(".select2-selection").html(n);var a=l.indexOf("0"),r=c.indexOf("0");switch(!0){case-1==a&&r>-1:l=c=["0"],e("#ed_rpm").select2("val",c);break;case a>-1&&r>-1:c.splice(r,1),l=c,e("#ed_rpm").select2("val",c)}l=c,e.ajax({url:t.requestUrl,type:t.requestType,dataType:t.requestDataType,data:{action:"get_customqueryreport_rpm_data_ajax",sesskey:M.cfg.sesskey,data:JSON.stringify({rpmids:c,cohortids:i})}}).done(function(t){e("#ed_lps").html(""),e("#ed_courses").html("");var n="local_edwiserreports/customquery_lpoptions",o={lps:t.lps};t.lps.length>0&&s.render(n,o).then(function(t,n){s.appendNodeContents(e("#ed_lps"),t,n)}).fail(function(e){console.log(e)}),t.courses.length>0&&(n="local_edwiserreports/customquery_options",o={courses:t.courses},s.render(n,o).then(function(t,n){s.appendNodeContents(e("#ed_courses"),t,n)}).fail(function(e){console.log(e)})),t.users.length>0&&(n="local_edwiserreports/customquery_lpoptions",o={lps:t.users},t.users.length>0&&s.render(n,o).then(function(t,n){s.appendNodeContents(e("#ed_users"),t,n)}).fail(function(e){console.log(e)}))}).fail(function(e){console.log(e)}).always(function(){e("#ed_lps").select2({multiple:!0,closeOnSelect:!1,placeholder:"Learning Programs"}),e("#ed_courses").select2({multiple:!0,closeOnSelect:!1,placeholder:"Courses"}),e("#ed_users").select2({multiple:!0,closeOnSelect:!1,placeholder:"Users"})}),c.length||(e("div[class^='rpm']").hide(),e("div[class^='lp']").hide())}});var c=["0"];e("#ed_courses").on("change",function(t){var s=[];if(e(t.currentTarget).find("option:selected").each(function(t,n){s[t]=e(n).val()}),JSON.stringify(c)!==JSON.stringify(s)){var n=c.indexOf("0"),o=s.indexOf("0");switch(!0){case-1==n&&o>-1:c=s=["0"],e("#ed_courses").select2("val",s);break;case n>-1&&o>-1:s.splice(o,1),c=s,e("#ed_courses").select2("val",s)}c=s}});var i=["0"];e("#ed_cohorts").on("change",function(o){var l=[];e(o.currentTarget).find("option:selected").each(function(t,s){l[t]=e(s).val()});var c=[];if(e("#ed_rpm").find("option:selected").each(function(t,s){c[t]=e(s).val()}),JSON.stringify(i)!==JSON.stringify(l)){e("#ed_users").html("").siblings(".select2-container").find(".select2-selection").html(n);var a=i.indexOf("0"),r=l.indexOf("0");switch(!0){case-1==a&&r>-1:i=l=["0"],e("#ed_cohorts").select2("val",l);break;case a>-1&&r>-1:l.splice(r,1),i=l,e("#ed_cohorts").select2("val",l)}i=l,e.ajax({url:t.requestUrl,type:t.requestType,dataType:t.requestDataType,data:{action:"get_customqueryreport_cohort_users_ajax",sesskey:M.cfg.sesskey,data:JSON.stringify({cohortids:l,rpmids:c})}}).done(function(t){var n={lps:t.users};t.users.length>0&&s.render("local_edwiserreports/customquery_lpoptions",n).then(function(t,n){s.appendNodeContents(e("#ed_users"),t,n)}).fail(function(e){console.log(e)})}).fail(function(e){console.log(e)}).always(function(){e("#ed_users").select2({multiple:!0,closeOnSelect:!1,placeholder:"Users"})})}});var a=["-1"];e("#ed_users").on("change",function(t){var s=[];if(e(t.currentTarget).find("option:selected").each(function(t,n){s[t]=e(n).val()}),JSON.stringify(a)!==JSON.stringify(s)){var n=a.indexOf("0"),o=s.indexOf("0");switch(!0){case-1==n&&o>-1:a=s=["0"],e("#ed_users").select2("val",s);break;case n>-1&&o>-1:s.splice(o,1),a=s,e("#ed_users").select2("val",s)}a=s}});var r=t.getPanel("#customQueryReportBlock"),d=e(r).find("#customQueryReportsForm"),u=function(t,s,n,o){e(r).find(t).flatpickr({mode:s,altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:o,defaultDate:n,onClose:p,onReady:p})},p=function(t,s,n){var o=t[0].getTime()/1e3;switch(!0){case e(n.element).is("#customqueryenrollstart"):d.find("input[name=enrolstartdate]").val(o);break;case e(n.element).is("#customqueryenrollend"):d.find("input[name=enrolenddate]").val(o);break;case e(n.element).is("#customquerycompletionstart"):d.find("input[name=completionstartdate]").val(o);break;case e(n.element).is("#customquerycompletionend"):d.find("input[name=completionenddate]").val(o)}};function f(t){var s,n=e("#ed_courses > option:selected").length,o=d.serializeArray(),l={};e.each(o,function(e,t){l[t.name]=t.value}),n<1?(e(".coursealert").show(),setTimeout(function(){e(".coursealert").hide()},3e3),t.preventDefault()):l.enrolstartdate>l.enrolenddate||""==l.enrolstartdate&&""!==l.enrolenddate||""!==l.enrolstartdate&&""==l.enrolenddate?(e(".enroldatealert").show(),setTimeout(function(){e(".enroldatealert").hide()},3e3),t.preventDefault()):l.completionstartdate>l.completionenddate||""==l.completionstartdate&&""!==l.completionenddate||""!==l.completionstartdate&&""==l.completionenddate?(e(".completiondatealert").show(),setTimeout(function(){e(".completiondatealert").hide()},3e3),t.preventDefault()):(s=[],e(r).find("input[type=checkbox]:checked").each(function(e,t){s.push(t.id)}),d.find("input[name=reporttype]").val("queryReport"),d.find("input[name=checkedFields]").val(s),function(){var t,s,n,o,l,c;t=e(r).find("#ed_rpm").val(),d.find("input[name=reportingmanagers]").val(t),s=e(r).find("#ed_lps").val(),d.find("input[name=lps]").val(s),n=e(r).find("#ed_courses").val(),d.find("input[name=courses]").val(n),o=e(r).find("#ed_cohorts").val(),d.find("input[name=cohortids]").val(o),l=e(r).find("#ed_users").val(),d.find("input[name=userids]").val(l),c=e(r).find("#ed_activitytype").val(),d.find("input[name=activitytype]").val(c)}())}u("#customqueryenrollstart, #customquerycompletionstart","single",(new Date).setDate((new Date).getDate()-90),"today"),u("#customqueryenrollend, #customquerycompletionend","single","today","today"),e(document).on("click","#customqueryenrollstart ~ button.input-search-close",function(){e("#customqueryenrollstart ~ input.form-control").val(""),d.find("input[name=enrolstartdate]").val("")}),e(document).on("click","#customqueryenrollend ~ button.input-search-close",function(){e("#customqueryenrollend ~ input.form-control").val(""),d.find("input[name=enrolenddate]").val("")}),e(document).on("click","#customquerycompletionstart ~ button.input-search-close",function(){e("#customquerycompletionstart ~ input.form-control").val(""),d.find("input[name=completionenddate]").val("")}),e(document).on("click","#customquerycompletionend ~ button.input-search-close",function(){e("#customquerycompletionend ~ input.form-control").val(""),d.find("input[name=completionstartdate]").val("")}),e("#customQueryReportDownload").click(function(e){f(e)}),e("[data-hide]").on("click",function(){e(this).closest("."+e(this).attr("data-hide")).hide()}),e('.reportfields a[class^="unselect-"]').on("click",function(){e(this).closest(".reportfields").find('input[type="checkbox"]:not(:disabled)').prop("checked",!1),e(this).hide().siblings('a[class^="select-"]').show()}),e('.reportfields a[class^="select-"]').on("click",function(){e(this).closest(".reportfields").find('input[type="checkbox"]:not(:disabled)').prop("checked",!0),e(this).hide().siblings('a[class^="unselect-"]').show()}),e(r).find(".checkbox-custom").on("click",function(){e(this).closest(".reportfields").find('input[type="checkbox"]').length==e(this).closest(".reportfields").find('input[type="checkbox"]:checked').length?e(this).closest(".reportfields").find('a[class^="select-"]').hide().siblings('a[class^="unselect-"]').show():e(this).closest(".reportfields").find('a[class^="unselect-"]').hide().siblings('a[class^="select-"]').show()});e(r).find("#edw_custom_reporttype input[type='radio']").on("change",function(){"activities"==e(this).val()?(e(r).find("#ed_activitytype").closest(".activitytype.select").show(),e(r).find(".activityreportfields").show(),e(r).find('.activityfields input[type="checkbox"]').attr("checked",!0)):(e(r).find("#ed_activitytype").closest(".activitytype.select").hide(),e(r).find(".activityreportfields").hide(),e(r).find('.activityfields input[type="checkbox"]').removeAttr("checked")),e(d).find('input[name="reportlevel"]').val(e(this).val())})})});
//# sourceMappingURL=block_queryreport.min.js.map
