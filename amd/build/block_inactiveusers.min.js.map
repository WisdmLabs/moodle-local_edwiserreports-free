{"version":3,"sources":["block_inactiveusers.js"],"names":["define","$","Templates","cfg","V","common","init","invalidUser","panel","getPanel","panelBody","table","tableWrapper","loader","dropdown","dropdownToggle","inActiveUsersTable","exportUrlLink","getInactiveUsersData","filter","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","JSON","stringify","done","response","error","exception","errorcode","remove","destroy","hide","DataTable","dom","aaSorting","oLanguage","sEmptyTable","sSearchPlaceholder","columnDefs","targets","className","drawCallback","stylePaginationButton","this","responsive","lengthChange","bInfo","fail","always","length","on","find","val","html","changeExportUrl","filterReplaceFlag"],"mappings":"AAAA,aA0BAA,OAAO,CAAC,SAAU,iBAAkB,kBAAmB,cAAe,WAAY,sBAAuB,2BAA4B,SAAUC,EAAGC,EAAWC,EAAKC,EAAGC,GAwHnK,MAAO,CACLC,KApHF,SAAcC,GACZ,IACIC,EAAQL,EAAIM,SAAS,uBACrBC,EAAYP,EAAIM,SAAS,sBAAuB,QAEhDE,GADaR,EAAIM,SAAS,sBAAuB,SACzCC,EAAY,wBACpBE,EAAeF,EAAY,+BAC3BG,EAASH,EAAY,WACrBI,EAAWJ,EAAY,iCACvBK,EAAiBL,EAAY,0BAC7BM,EAAqB,KACrBC,EAAgBT,EAAQ,oEAoC5B,SAASU,EAAqBC,GAE5Bd,EAAOQ,OAAOO,KAAK,uBACnBnB,EAAEoB,KAAK,CACLC,IAAKnB,EAAIoB,WACTC,KAAMrB,EAAIsB,YACVC,SAAUvB,EAAIwB,gBACdC,KAAM,CACJC,OAAQ,8BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BF,KAAMK,KAAKC,UAAU,CACnBf,OAAQA,OAGXgB,KAAK,SAAUC,GAmBpB,IAAkCR,GAlBP,IAAnBQ,EAASC,OAAmD,qBAAjCD,EAASE,UAAUC,WAkBpBX,EAbLQ,EAASR,KAehCZ,IAEFf,EAAE,6BAA6BuC,SAC/BxB,EAAmByB,WAIrBxC,EAAEY,GAAQ6B,OACVzC,EAAEU,GAAOS,OAETJ,EAAqBf,EAAEU,GAAOgC,UAAU,CACtCf,KAAMA,EACNgB,IAAK,2EACLC,UAAW,CAAC,CAAC,EAAG,SAChBC,UAAW,CACTC,YAAa,mCACbC,mBAAoB,gBAEtBC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,gBAEfC,aAAc,WACZ/C,EAAOgD,sBAAsBC,OAE/BC,YAAY,EACZC,cAAc,EACdC,OAAO,KA9CLlD,EAAY,qBAAsB6B,KAKnCsB,KAAK,SAAUrB,MACfsB,OAAO,WAERtD,EAAOQ,OAAO6B,KAAK,yBA1DnBzC,EAAEO,GAAOoD,SAEX1C,EAAqBjB,EAAEa,GAAUc,KAAK,UAKtC3B,EAAEa,GAAU+C,GAAG,QAAS,WAEtB,IAAI1C,EAASlB,EAAEqD,MAAM1B,KAAK,SAC1B3B,EAAEO,GAAOsD,KAAK,wCAAwCC,IAAI5C,GAO1DlB,EAAEY,GAAQO,OACVnB,EAAEU,GAAO+B,OACTzC,EAAEW,GAAc8B,OAEhBzC,EAAEc,GAAgBiD,KAAK/D,EAAEqD,MAAMU,QAE/B7D,EAAI8D,gBAAgB9C,EAAQF,EAAeb,EAAE8D,mBAE7ChD,EAAqBjB,EAAEqD,MAAM1B,KAAK","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/templates',\n    './defaultconfig',\n    './variables',\n    './common',\n    './jquery.dataTables',\n    './dataTables.bootstrap4'\n], function(\n    $,\n    Templates,\n    cfg,\n    V,\n    common\n) {\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        var activeUsersTable;\n        var panel = cfg.getPanel(\"#inactiveusersblock\");\n        var panelBody = cfg.getPanel(\"#inactiveusersblock\", \"body\");\n        var panelTitle = cfg.getPanel(\"#inactiveusersblock\", \"title\");\n        var table = panelBody + \" #inactiveuserstable\";\n        var tableWrapper = panelBody + \" #inactiveuserstable_wrapper\";\n        var loader = panelBody + \" .loader\";\n        var dropdown = panelBody + \" .dropdown-menu .dropdown-item\";\n        var dropdownToggle = panelBody + \" button.dropdown-toggle\";\n        var inActiveUsersTable = null;\n        var exportUrlLink = panel + \" .dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item\";\n\n        if ($(panel).length) {\n            // Get inactive users data on load\n            getInactiveUsersData($(dropdown).data(\"value\"));\n\n            /**\n             * On click of dropdown get inactive user list based on filter\n             */\n            $(dropdown).on(\"click\", function() {\n                // Get filter\n                var filter = $(this).data(\"value\");\n                $(panel).find('.download-links input[name=\"filter\"]').val(filter);\n\n                // If table is already created then destroy the tablw\n                if (activeUsersTable) {\n                    activeUsersTable.destroy();\n                }\n\n                // Show load and remove table\n                $(loader).show();\n                $(table).hide();\n                $(tableWrapper).hide();\n\n                // Set dropdown button value\n                $(dropdownToggle).html($(this).html());\n\n                // Change export data url\n                cfg.changeExportUrl(filter, exportUrlLink, V.filterReplaceFlag);\n\n                // Get inactive users\n                getInactiveUsersData($(this).data(\"value\"));\n            });\n        }\n\n        /**\n         * Get inactive users list based on filter\n         * @param  {string} filter Filter\n         */\n        function getInactiveUsersData(filter) {\n\n            // Show loader.\n            common.loader.show('#inactiveusersblock');\n\n            $.ajax({\n                    url: cfg.requestUrl,\n                    type: cfg.requestType,\n                    dataType: cfg.requestDataType,\n                    data: {\n                        action: 'get_inactiveusers_data_ajax',\n                        secret: M.local_edwiserreports.secret,\n                        data: JSON.stringify({\n                            filter: filter\n                        })\n                    },\n                })\n                .done(function(response) {\n                    if (response.error === true && response.exception.errorcode === 'invalidsecretkey') {\n                        invalidUser('inactiveusersblock', response);\n                        return;\n                    }\n                    createInactiveUsersTable(response.data);\n                })\n                .fail(function(error) {\n                    // console.log(error);\n                }).always(function() {\n                    // Hide loader.\n                    common.loader.hide('#inactiveusersblock');\n                });\n        }\n\n        /**\n         * Create inactive users table\n         * @param  {String} data Table data\n         */\n        function createInactiveUsersTable(data) {\n            // If table is creted then destroy table\n            if (inActiveUsersTable) {\n                // Remove table data first\n                $(\"#inactiveuserstable tbody\").remove();\n                inActiveUsersTable.destroy();\n            }\n\n            // Display loader\n            $(loader).hide();\n            $(table).show();\n\n            // Create inactive users table\n            inActiveUsersTable = $(table).DataTable({\n                data: data,\n                dom: '<\"edwiserreports-table\"<\"table-filter d-flex\"f><t><\"table-pagination\"p>>',\n                aaSorting: [\n                    [2, 'desc']\n                ],\n                oLanguage: {\n                    sEmptyTable: \"No inactive users are available.\",\n                    sSearchPlaceholder: \"Search Users\"\n                },\n                columnDefs: [{\n                    \"targets\": 2,\n                    \"className\": \"text-center\"\n                }],\n                drawCallback: function() {\n                    common.stylePaginationButton(this);\n                },\n                responsive: true,\n                lengthChange: false,\n                bInfo: false\n            });\n        }\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});"],"file":"block_inactiveusers.min.js"}