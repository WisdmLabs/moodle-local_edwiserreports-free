{"version":3,"sources":["block_learnertimespentonsite.js"],"names":["define","$","ApexCharts","Common","CFG","chart","filter","date","lineChartDefault","series","type","height","dropShadow","enabled","color","top","left","blur","opacity","toolbar","show","tools","download","reset","zoom","markers","size","tooltip","enabledOnSeries","undefined","shared","followCursor","intersect","inverseOrder","fillSeriesColor","onDatasetHover","highlightDataSeries","items","display","fixed","position","offsetX","offsetY","y","title","stroke","curve","width","grid","borderColor","xaxis","categories","labels","hideOverlappingLabels","datetimeFormatter","year","month","day","hour","legend","horizontalAlign","itemMargin","horizontal","vertical","dataLabels","colors","getColorTheme","SELECTOR","PANEL","GRAPH","PROMISE","GET_TIMESPENTONSITE","ajax","url","requestUrl","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","loadGraph","loader","done","response","Object","assign","yaxis","formatter","timeFormatter","name","util","get_string","timespent","length","find","attr","graph","destroy","get","render","setTimeout","hide","renderGraph","fail","exception","init","invalidUser","DATEPICKERINPUT","flatpickr","mode","altInput","altFormat","dateFormat","maxDate","appendTo","DATEPICKER"],"mappings":"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","sourcesContent":["define([\n    'jquery',\n    './chart/apexcharts',\n    './common',\n    './defaultconfig',\n    './select2'\n], function(\n    $,\n    ApexCharts,\n    Common,\n    CFG\n) {\n    /**\n     * Date picker.\n     */\n    var flatpickr = null;\n\n    /**\n     * Charts list.\n     */\n    var chart = null;\n\n    /**\n     * Filter for ajax.\n     */\n    var filter = {\n        date: 'weekly'\n    };\n\n    /**\n     * Line chart default config.\n     */\n    const lineChartDefault = {\n        series: [],\n        chart: {\n            type: 'line',\n            height: 350,\n            dropShadow: {\n                enabled: true,\n                color: '#000',\n                top: 18,\n                left: 7,\n                blur: 10,\n                opacity: 0.2\n            },\n            toolbar: {\n                show: false,\n                tools: {\n                    download: false,\n                    reset: '<i class=\"fa fa-refresh\"></i>'\n                }\n            },\n            zoom: {\n                enabled: false\n            }\n        },\n        markers: {\n            size: 0\n        },\n        tooltip: {\n            enabled: true,\n            enabledOnSeries: undefined,\n            shared: true,\n            followCursor: false,\n            intersect: false,\n            inverseOrder: false,\n            fillSeriesColor: false,\n            onDatasetHover: {\n                highlightDataSeries: false,\n            },\n            items: {\n                display: 'flex'\n            },\n            fixed: {\n                enabled: false,\n                position: 'topRight',\n                offsetX: 0,\n                offsetY: 0,\n            },\n            y: {\n                title: {}\n            }\n        },\n        stroke: {\n            curve: 'smooth',\n            width: 2\n        },\n        grid: {\n            borderColor: '#e7e7e7'\n        },\n        xaxis: {\n            categories: null,\n            type: 'datetime',\n            labels: {\n                hideOverlappingLabels: true,\n                datetimeFormatter: {\n                    year: 'yyyy',\n                    month: 'MMM \\'yy',\n                    day: 'dd MMM',\n                    hour: ''\n                }\n            },\n            tooltip: {\n                enabled: false\n            }\n        },\n        legend: {\n            position: 'top',\n            horizontalAlign: 'left',\n            offsetY: '-20',\n            itemMargin: {\n                horizontal: 10,\n                vertical: 0\n            },\n        },\n        dataLabels: {\n            enabled: false\n        },\n        colors: [CFG.getColorTheme()[2]]\n    };\n\n    /**\n     * Selectors list.\n     */\n    var SELECTOR = {\n        PANEL: '#learnertimespentonsiteblock',\n        GRAPH: '#apex-chart-learnertimespentonsite-block'\n    };\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get timespent on site using filters.\n         * @returns {PROMISE}\n         */\n        GET_TIMESPENTONSITE: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_learnertimespentonsite_graph_data_ajax',\n                    secret: M.local_edwiserreports.secret\n                },\n            });\n        },\n    }\n\n    /**\n     * Load graph\n     */\n    function loadGraph() {\n        let data;\n        Common.loader.show(SELECTOR.PANEL);\n\n        /**\n         * Render graph.\n         * @param {DOM} graph Graph element\n         * @param {Object} data Graph data\n         */\n        function renderGraph(graph, data) {\n            if (chart !== null) {\n                chart.destroy();\n            }\n            chart = new ApexCharts(graph.get(0), data);\n            chart.render();\n            setTimeout(function() {\n                Common.loader.hide(SELECTOR.PANEL);\n            }, 1000);\n        }\n        PROMISE.GET_TIMESPENTONSITE(filter)\n            .done(function(response) {\n                data = Object.assign({}, lineChartDefault);\n                data.yaxis = {\n                    labels: {\n                        formatter: Common.timeFormatter\n                    }\n                };\n                data.xaxis.categories = response.labels;\n                data.series = [{\n                    name: M.util.get_string('timespentonlms', 'local_edwiserreports'),\n                    data: response.timespent,\n                }];\n                data.chart.toolbar.show = response.labels.length > 30;\n                data.chart.zoom.enabled = response.labels.length > 30;\n                data.tooltip.y.title.formatter = (title) => {\n                    return M.util.get_string('time', 'local_edwiserreports') + ': ';\n                }\n                $(SELECTOR.PANEL).find('.panel-body').attr('data-charttype', 'line');\n                renderGraph($(SELECTOR.PANEL).find(SELECTOR.GRAPH), data);\n                Common.loader.hide(SELECTOR.PANEL);\n            }).fail(function(exception) {\n                Common.loader.hide(SELECTOR.PANEL);\n            });\n    }\n\n    /**\n     * Initialize event listeners.\n     */\n    function initEvents() {\n\n        flatpickr = $(SELECTOR.PANEL).find(SELECTOR.DATEPICKERINPUT).flatpickr({\n            mode: 'range',\n            altInput: true,\n            altFormat: \"d/m/Y\",\n            dateFormat: \"Y-m-d\",\n            maxDate: \"today\",\n            appendTo: $(SELECTOR.PANEL).find(SELECTOR.DATEPICKER).get(0)\n        });\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        if ($(SELECTOR.PANEL).length == 0) {\n            return;\n        }\n\n        initEvents();\n\n        loadGraph();\n    }\n    return {\n        init: init\n    };\n});"],"file":"block_learnertimespentonsite.min.js"}