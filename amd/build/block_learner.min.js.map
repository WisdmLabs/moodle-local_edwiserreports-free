{"version":3,"sources":["block_learner.js"],"names":["define","$","ApexCharts","Common","CFG","allGraphs","flatpickr","charts","courseprogress","timespentonlms","filter","course","date","lineChartDefault","series","chart","type","height","dropShadow","enabled","color","top","left","blur","opacity","toolbar","show","tools","download","reset","zoom","markers","size","tooltip","enabledOnSeries","undefined","shared","followCursor","intersect","inverseOrder","fillSeriesColor","onDatasetHover","highlightDataSeries","items","display","fixed","position","offsetX","offsetY","y","title","stroke","curve","width","grid","borderColor","xaxis","categories","labels","hideOverlappingLabels","datetimeFormatter","year","month","day","hour","legend","floating","dataLabels","barChartDefault","marker","trim","rotate","noData","text","M","util","get_string","pieChartDefault","SELECTOR","PANEL","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","COURSE","GRAPH","GRAPHS","FILTERS","TIMESPENTONLMS","COURSEPROGRESS","PROMISE","GET_COURSEPROGRESS","ajax","url","requestUrl","requestType","dataType","requestDataType","data","action","secret","local_edwiserreports","lang","attr","JSON","stringify","GET_TIMESPENTONLMS","loadGraph","target","loader","exportFilter","Object","keys","map","key","join","renderGraph","graph","destroy","get","render","setTimeout","hide","find","concat","FORMFILTER","val","done","response","assign","yaxis","max","formatter","progress","name","length","colors","fail","exception","includes","indexOf","timeFormatter","timespent","initEvents","on","this","closest","removeClass","addClass","html","clear","courseid","parseInt","mode","altInput","altFormat","dateFormat","maxDate","appendTo","onOpen","onClose","dateAlternate","next","customDateSelected","init","invalidUser","select2","forEach"],"mappings":"AAAA,aAEAA,OAAO,CAAC,SAAU,qBAAsB,WAAY,kBAAmB,aAAc,SAAUC,EAAGC,EAAYC,EAAQC,GAIpH,IAAIC,EAAY,CAAC,iBAAkB,kBAK/BC,EAAY,KAKZC,EAAS,CACXC,eAAkB,KAClBC,eAAkB,MAMhBC,EAAS,CACXF,eAAkB,CAChBG,OAAQ,GAEVF,eAAkB,CAChBG,KAAM,WAONC,EAAmB,CACrBC,OAAQ,GACRC,MAAO,CACLC,KAAM,OACNC,OAAQ,IACRC,WAAY,CACVC,SAAS,EACTC,MAAO,OACPC,IAAK,GACLC,KAAM,EACNC,KAAM,GACNC,QAAS,IAEXC,QAAS,CACPC,MAAM,EACNC,MAAO,CACLC,UAAU,EACVC,MAAO,kCAGXC,KAAM,CACJX,SAAS,IAGbY,QAAS,CACPC,KAAM,GAERC,QAAS,CACPd,SAAS,EACTe,qBAAiBC,EACjBC,QAAQ,EACRC,cAAc,EACdC,WAAW,EACXC,cAAc,EACdC,iBAAiB,EACjBC,eAAgB,CACdC,qBAAqB,GAEvBC,MAAO,CACLC,QAAS,QAEXC,MAAO,CACL1B,SAAS,EACT2B,SAAU,WACVC,QAAS,EACTC,QAAS,GAEXC,EAAG,CACDC,MAAO,KAGXC,OAAQ,CACNC,MAAO,SACPC,MAAO,GAETC,KAAM,CACJC,YAAa,WAEfC,MAAO,CACLC,WAAY,KACZzC,KAAM,WACN0C,OAAQ,CACNC,uBAAuB,EACvBC,kBAAmB,CACjBC,KAAM,OACNC,MAAO,UACPC,IAAK,SACLC,KAAM,KAGV/B,QAAS,CACPd,SAAS,IAGb8C,OAAQ,CACNnB,SAAU,MACVoB,UAAU,GAEZC,WAAY,CACVhD,SAAS,IAOTiD,EAAkB,CACpBtD,OAAQ,GACRC,MAAO,CACLC,KAAM,MACNC,OAAQ,IACRQ,QAAS,CACPC,MAAM,EACNC,MAAO,CACLC,UAAU,EACVC,MAAO,kCAGXC,KAAM,CACJX,SAAS,IAGbc,QAAS,CACPd,SAAS,EACTe,qBAAiBC,EACjBC,QAAQ,EACRC,cAAc,EACdC,WAAW,EACXC,cAAc,EACdC,iBAAiB,EACjBC,eAAgB,CACdC,qBAAqB,GAEvB2B,OAAQ,CACN3C,MAAM,GAERiB,MAAO,CACLC,QAAS,QAEXC,MAAO,CACL1B,SAAS,EACT2B,SAAU,WACVC,QAAS,EACTC,QAAS,GAEXC,EAAG,CACDC,MAAO,KAGXI,KAAM,CACJC,YAAa,WAEfY,WAAY,CACVhD,SAAS,GAEXqC,MAAO,CACLC,WAAY,KACZC,OAAQ,CACNC,uBAAuB,EACvBW,MAAM,EACNC,OAAQ,MAGZC,OAAQ,CACNC,KAAMC,EAAEC,KAAKC,WAAW,cAAe,0BAOvCC,EAAkB,CACpB9D,MAAO,CACLC,KAAM,MACNC,OAAQ,KAEVgD,OAAQ,CACNnB,SAAU,SACVE,QAAS,GAEXwB,OAAQ,CACNC,KAAMC,EAAEC,KAAKC,WAAW,cAAe,0BAOvCE,EAAW,CACbC,MAAO,gBACPC,KAAM,oBACNC,SAAU,qCACVC,SAAU,oDACVC,WAAY,wDACZC,gBAAiB,gDACjBC,OAAQ,iBACRC,MAAO,SACPC,OAAQ,kBACRC,QAAS,WACTC,eAAgB,kBAChBC,eAAgB,mBAMdC,EAAU,CAMZC,mBAAoB,SAA4BlF,GAC9C,OAAOT,EAAE4F,KAAK,CACZC,IAAK1F,EAAI2F,WACT/E,KAAMZ,EAAI4F,YACVC,SAAU7F,EAAI8F,gBACdC,KAAM,CACJC,OAAQ,6CACRC,OAAQ3B,EAAE4B,qBAAqBD,OAC/BE,KAAMtG,EAAE,QAAQuG,KAAK,QACrBL,KAAMM,KAAKC,UAAU,CACnBhG,OAAQA,QAWhBiG,mBAAoB,SAA4BjG,GAC9C,OAAOT,EAAE4F,KAAK,CACZC,IAAK1F,EAAI2F,WACT/E,KAAMZ,EAAI4F,YACVC,SAAU7F,EAAI8F,gBACdC,KAAM,CACJC,OAAQ,6CACRC,OAAQ3B,EAAE4B,qBAAqBD,OAC/BE,KAAMtG,EAAE,QAAQuG,KAAK,QACrBL,KAAMM,KAAKC,UAAU,CACnBhG,OAAQA,SAWlB,SAASkG,EAAUC,GACjB,IAAIV,EACJhG,EAAO2G,OAAOpF,KAAK,kBAAoBmF,GAEvC,IAAIE,EAAeC,OAAOC,KAAKvG,EAAOmG,IAASK,IAAI,SAAUC,GAC3D,OAAOzG,EAAOmG,GAAQM,KACrBC,KAAK,KAAO,IAAMP,EAQrB,SAASQ,EAAYC,EAAOnB,GACH,OAAnB5F,EAAOsG,IACTtG,EAAOsG,GAAQU,UAGjBhH,EAAOsG,GAAU,IAAI3G,EAAWoH,EAAME,IAAI,GAAIrB,GAC9C5F,EAAOsG,GAAQY,SACfC,WAAW,WACTvH,EAAO2G,OAAOa,KAAK,kBAAoBd,IACtC,KAGL,OAnBA5G,EAAE6E,EAASC,OAAO6C,KAAK,IAAIC,OAAOhB,IAASe,KAAK9C,EAASgD,YAAYC,IAAIhB,GAmBjEF,GACN,IAAK,iBACHlB,EAAQC,mBAAmBlF,EAAOmG,IAASmB,KAAK,SAAUC,GAC3B,GAAzBvH,EAAOmG,GAAQlG,SACjBwF,EAAOa,OAAOkB,OAAO,GAAI9D,IACpB+D,MAAQ,CACXC,IAAK,IACL1E,OAAQ,CACN2E,UAAW,SAAmBC,GAC5B,OAAOA,EAAW,OAIxBnC,EAAK3C,MAAMC,WAAawE,EAASvE,OACjCyC,EAAKrF,OAAS,CAAC,CACbyH,KAAM7D,EAAEC,KAAKC,WAAW,iBAAkB,wBAC1CuB,KAAM8B,EAASK,WAEjBnC,EAAKpF,MAAMU,QAAQC,KAAOuG,EAASvE,OAAO8E,OAAS,GACnDrC,EAAKpF,MAAMe,KAAKX,QAAU8G,EAASvE,OAAO8E,OAAS,GAEnDrC,EAAKlE,QAAQgB,EAAEC,MAAMmF,UAAY,SAAUnF,GACzC,OAAOwB,EAAEC,KAAKC,WAAW,WAAY,wBAA0B,SAGjEuB,EAAOa,OAAOkB,OAAO,GAAIrD,IACpB4D,OAAS,CAAC,mBAAoB,qBACnCtC,EAAKzC,OAASuE,EAASvE,OACvByC,EAAKrF,OAASmH,EAASK,UAGzBjB,EAAYpH,EAAE6E,EAASC,OAAO6C,KAAK9C,EAASY,gBAAgBkC,KAAK9C,EAASQ,OAAQa,KACjFuC,KAAK,SAAUC,GAChBxI,EAAO2G,OAAOa,KAAK,kBAAoBd,KAEzC,MAEF,IAAK,iBACHlB,EAAQgB,mBAAmBjG,EAAOmG,IAASmB,KAAK,SAAUC,GACpDvH,EAAOmG,GAAQjG,KAAKgI,SAAS,QAA2E,IAAlE,CAAC,SAAU,UAAW,UAAUC,QAAQnI,EAAOmG,GAAQjG,QAC/FuF,EAAOa,OAAOkB,OAAO,GAAIrH,IACpBsH,MAAQ,CACXzE,OAAQ,CACN2E,UAAWlI,EAAO2I,gBAGtB3C,EAAK3C,MAAMC,WAAawE,EAASvE,OACjCyC,EAAKrF,OAAS,CAAC,CACbyH,KAAM7D,EAAEC,KAAKC,WAAW,iBAAkB,wBAC1CuB,KAAM8B,EAASc,YAEjB5C,EAAKpF,MAAMU,QAAQC,KAAOuG,EAASvE,OAAO8E,OAAS,GACnDrC,EAAKpF,MAAMe,KAAKX,QAAU8G,EAASvE,OAAO8E,OAAS,GAEnDrC,EAAKlE,QAAQgB,EAAEC,MAAMmF,UAAY,SAAUnF,GACzC,OAAOwB,EAAEC,KAAKC,WAAW,OAAQ,wBAA0B,SAG7DuB,EAAOa,OAAOkB,OAAO,GAAIrD,IACpBnB,OAASuE,EAASvE,OACvByC,EAAKrF,OAASmH,EAASc,UACvB5C,EAAKlE,QAAU,CACbgB,EAAG,CACDoF,UAAWlI,EAAO2I,gBAGtB3C,EAAKlC,OAAS,CACZvC,MAAM,IAIV2F,EAAYpH,EAAE6E,EAASC,OAAO6C,KAAK9C,EAASW,gBAAgBmC,KAAK9C,EAASQ,OAAQa,GAClFhG,EAAO2G,OAAOa,KAAK,kBAAoBd,KACtC6B,KAAK,SAAUC,GAChBxI,EAAO2G,OAAOa,KAAK,kBAAoBd,KAEzC,MAEF,QACE1G,EAAO2G,OAAOa,KAAK,kBAAoBd,IA4B7C,SAASmC,IAEP/I,EAAE,QAAQgJ,GAAG,QAASnE,EAASI,SAAW,gBAAiB,WACzD,IAAI2B,EAAS5G,EAAEiJ,MAAMC,QAAQrE,EAASU,SAASW,KAAK,MAEpDlG,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASI,UAAUkE,YAAY,UACzEnJ,EAAEiJ,MAAMG,SAAS,UAEjBpJ,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASE,MAAMsE,KAAKrJ,EAAEiJ,MAAMzE,QAEtEnE,EAAUiJ,QAEV7I,EAAOmG,GAAQjG,KAAOX,EAAEiJ,MAAM/C,KAAK,SAEnCS,EAAUC,KAGZ5G,EAAE,QAAQgJ,GAAG,SAAU,GAAGpB,OAAO/C,EAASC,MAAO,KAAK8C,OAAO/C,EAASO,QAAS,WAC7E,IAAIwB,EAAS5G,EAAEiJ,MAAMC,QAAQrE,EAASU,SAASW,KAAK,MAChDqD,EAAWC,SAASxJ,EAAEiJ,MAAMnB,OAChCrH,EAAOmG,GAAQlG,OAAS6I,EAExB5C,EAAUC,KAGZ,IAAIA,EAAS,iBACbvG,EAAYL,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASM,iBAAiB9E,UAAU,CACxFoJ,KAAM,QACNC,UAAU,EACVC,UAAW,QACXC,WAAY,QACZC,QAAS,QACTC,SAAU9J,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASK,YAAYqC,IAAI,GAC7EwC,OAAQ,WACN/J,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASG,UAAUoE,SAAS,iBAExEY,QAAS,WACPhK,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASG,UAAUmE,YAAY,gBAvD/E,SAA4BvC,GAC1B,IAAIjG,EAAOX,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASM,iBAAiB2C,MAE3EmC,EAAgBjK,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASM,iBAAiB+E,OAAOpC,MAG/F9H,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASI,UAAUkE,YAAY,UACzEnJ,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASI,SAAW,WAAWmE,SAAS,UAElFpJ,EAAE6E,EAASC,OAAO6C,KAAK,IAAMf,GAAQe,KAAK9C,EAASE,MAAMsE,KAAKY,GAC9DxJ,EAAOmG,GAAQjG,KAAOA,EACtBgG,EAAUC,GA6CNuD,CAAmBvD,MAsBzB,MAAO,CACLwD,KAbF,SAAcC,GACoB,GAA5BrK,EAAE6E,EAASC,OAAOyD,SAItBvI,EAAE6E,EAASC,OAAO6C,KAAK,iBAAiB2C,UACxCvB,IACA3I,EAAUmK,QAAQ,SAAU3D,GAC1BD,EAAUC","sourcesContent":["define([\n    'jquery',\n    './chart/apexcharts',\n    './common',\n    './defaultconfig',\n    './select2'\n], function(\n    $,\n    ApexCharts,\n    Common,\n    CFG\n) {\n    /**\n     * List of graphs in this block.\n     */\n    var allGraphs = ['courseprogress', 'timespentonlms'];\n\n    /**\n     * Date picker.\n     */\n    var flatpickr = null;\n\n    /**\n     * Charts list.\n     */\n    var charts = {\n        'courseprogress': null,\n        'timespentonlms': null\n    };\n\n    /**\n     * Filter for ajax.\n     */\n    var filter = {\n        'courseprogress': {\n            course: 0\n        },\n        'timespentonlms': {\n            date: 'weekly'\n        }\n    };\n\n    /**\n     * Line chart default config.\n     */\n    const lineChartDefault = {\n        series: [],\n        chart: {\n            type: 'line',\n            height: 350,\n            dropShadow: {\n                enabled: true,\n                color: '#000',\n                top: 18,\n                left: 7,\n                blur: 10,\n                opacity: 0.2\n            },\n            toolbar: {\n                show: false,\n                tools: {\n                    download: false,\n                    reset: '<i class=\"fa fa-refresh\"></i>'\n                }\n            },\n            zoom: {\n                enabled: false\n            }\n        },\n        markers: {\n            size: 0\n        },\n        tooltip: {\n            enabled: true,\n            enabledOnSeries: undefined,\n            shared: true,\n            followCursor: false,\n            intersect: false,\n            inverseOrder: false,\n            fillSeriesColor: false,\n            onDatasetHover: {\n                highlightDataSeries: false,\n            },\n            items: {\n                display: 'flex'\n            },\n            fixed: {\n                enabled: false,\n                position: 'topRight',\n                offsetX: 0,\n                offsetY: 0,\n            },\n            y: {\n                title: {}\n            }\n        },\n        stroke: {\n            curve: 'smooth',\n            width: 2\n        },\n        grid: {\n            borderColor: '#e7e7e7'\n        },\n        xaxis: {\n            categories: null,\n            type: 'datetime',\n            labels: {\n                hideOverlappingLabels: true,\n                datetimeFormatter: {\n                    year: 'yyyy',\n                    month: 'MMM \\'yy',\n                    day: 'dd MMM',\n                    hour: ''\n                }\n            },\n            tooltip: {\n                enabled: false\n            }\n        },\n        legend: {\n            position: 'top',\n            floating: true\n        },\n        dataLabels: {\n            enabled: false\n        }\n    };\n\n    /**\n     * Bar chart default config.\n     */\n    const barChartDefault = {\n        series: [],\n        chart: {\n            type: 'bar',\n            height: 350,\n            toolbar: {\n                show: false,\n                tools: {\n                    download: false,\n                    reset: '<i class=\"fa fa-refresh\"></i>'\n                }\n            },\n            zoom: {\n                enabled: false\n            }\n        },\n        tooltip: {\n            enabled: true,\n            enabledOnSeries: undefined,\n            shared: true,\n            followCursor: false,\n            intersect: false,\n            inverseOrder: false,\n            fillSeriesColor: false,\n            onDatasetHover: {\n                highlightDataSeries: false,\n            },\n            marker: {\n                show: true\n            },\n            items: {\n                display: 'flex'\n            },\n            fixed: {\n                enabled: false,\n                position: 'topRight',\n                offsetX: 0,\n                offsetY: 0,\n            },\n            y: {\n                title: {}\n            }\n        },\n        grid: {\n            borderColor: '#e7e7e7'\n        },\n        dataLabels: {\n            enabled: false\n        },\n        xaxis: {\n            categories: null,\n            labels: {\n                hideOverlappingLabels: true,\n                trim: true,\n                rotate: 300\n            }\n        },\n        noData: {\n            text: M.util.get_string('nographdata', 'local_edwiserreports')\n        }\n    };\n\n    /**\n     * Pie chart default config.\n     */\n    const pieChartDefault = {\n        chart: {\n            type: 'pie',\n            height: 350\n        },\n        legend: {\n            position: 'bottom',\n            offsetY: 0\n        },\n        noData: {\n            text: M.util.get_string('nographdata', 'local_edwiserreports')\n        }\n    };\n\n    /**\n     * Selectors list.\n     */\n    var SELECTOR = {\n        PANEL: '#learnerblock',\n        DATE: '.learner-calendar',\n        DATEMENU: '.learner-calendar + .dropdown-menu',\n        DATEITEM: '.learner-calendar + .dropdown-menu .dropdown-item',\n        DATEPICKER: '.learner-calendar + .dropdown-menu .dropdown-calendar',\n        DATEPICKERINPUT: '.learner-calendar + .dropdown-menu .flatpickr',\n        COURSE: '.course-select',\n        GRAPH: '.graph',\n        GRAPHS: '.learner-graphs',\n        FILTERS: '.filters',\n        TIMESPENTONLMS: '.timespentonlms',\n        COURSEPROGRESS: '.courseprogress'\n    };\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get course progress using filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_COURSEPROGRESS: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_learner_courseprogress_graph_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        },\n        /**\n         * Get timespent on lms using filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_TIMESPENTONLMS: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_learner_timespentonlms_graph_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        },\n    }\n\n    /**\n     * Load graph\n     * @param {String} target Graph name\n     */\n    function loadGraph(target) {\n        let data;\n        Common.loader.show('#learnerblock .' + target);\n\n        // Set export filter to download link.\n        let exportFilter = Object.keys(filter[target]).map(key => filter[target][key]).join(\"-\") + '-' + target;\n        $(SELECTOR.PANEL).find(`.${target}`).find(SELECTOR.FORMFILTER).val(exportFilter);\n\n        /**\n         * Render graph.\n         * @param {DOM} graph Graph element\n         * @param {Object} data Graph data\n         */\n        function renderGraph(graph, data) {\n            if (charts[target] !== null) {\n                charts[target].destroy();\n            }\n            charts[target] = new ApexCharts(graph.get(0), data);\n            charts[target].render();\n            setTimeout(function() {\n                Common.loader.hide('#learnerblock .' + target);\n            }, 1000);\n        }\n\n        switch (target) {\n            case 'courseprogress':\n                PROMISE.GET_COURSEPROGRESS(filter[target])\n                    .done(function(response) {\n                        if (filter[target].course == 0) {\n                            data = Object.assign({}, barChartDefault);\n                            data.yaxis = {\n                                max: 100,\n                                labels: {\n                                    formatter: (progress) => {\n                                        return progress + '%';\n                                    }\n                                }\n                            };\n                            data.xaxis.categories = response.labels;\n                            data.series = [{\n                                name: M.util.get_string('courseprogress', 'local_edwiserreports'),\n                                data: response.progress,\n                            }];\n                            data.chart.toolbar.show = response.labels.length > 30;\n                            data.chart.zoom.enabled = response.labels.length > 30;\n                            data.tooltip.y.title.formatter = (title) => {\n                                return M.util.get_string('progress', 'local_edwiserreports') + ': ';\n                            }\n                        } else {\n                            data = Object.assign({}, pieChartDefault);\n                            data.colors = ['rgb(0, 227, 150)', 'rgb(254, 176, 25)'];\n                            data.labels = response.labels;\n                            data.series = response.progress;\n                        }\n                        renderGraph($(SELECTOR.PANEL).find(SELECTOR.COURSEPROGRESS).find(SELECTOR.GRAPH), data);\n                    }).fail(function(exception) {\n                        Common.loader.hide('#learnerblock .' + target);\n                    });\n                break;\n            case 'timespentonlms':\n                PROMISE.GET_TIMESPENTONLMS(filter[target])\n                    .done(function(response) {\n                        if (filter[target].date.includes(\"to\") || ['weekly', 'monthly', 'yearly'].indexOf(filter[target].date) !== -1) {\n                            data = Object.assign({}, lineChartDefault);\n                            data.yaxis = {\n                                labels: {\n                                    formatter: Common.timeFormatter\n                                }\n                            };\n                            data.xaxis.categories = response.labels;\n                            data.series = [{\n                                name: M.util.get_string('timespentonlms', 'local_edwiserreports'),\n                                data: response.timespent,\n                            }];\n                            data.chart.toolbar.show = response.labels.length > 30;\n                            data.chart.zoom.enabled = response.labels.length > 30;\n                            data.tooltip.y.title.formatter = (title) => {\n                                return M.util.get_string('time', 'local_edwiserreports') + ': ';\n                            }\n                        } else {\n                            data = Object.assign({}, pieChartDefault);\n                            data.labels = response.labels;\n                            data.series = response.timespent;\n                            data.tooltip = {\n                                y: {\n                                    formatter: Common.timeFormatter\n                                }\n                            };\n                            data.legend = {\n                                show: false\n                            };\n                        }\n                        renderGraph($(SELECTOR.PANEL).find(SELECTOR.TIMESPENTONLMS).find(SELECTOR.GRAPH), data);\n                        Common.loader.hide('#learnerblock .' + target);\n                    }).fail(function(exception) {\n                        Common.loader.hide('#learnerblock .' + target);\n                    });\n                break;\n            default:\n                Common.loader.hide('#learnerblock .' + target);\n                break;\n        }\n    }\n\n    /**\n     * After Select Custom date get active users details.\n     * @param {String} target Targeted graph\n     */\n    function customDateSelected(target) {\n        let date = $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n        let dateAlternate = $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEPICKERINPUT).next().val(); // d/m/Y format\n\n        // Set active class to custom date selector item.\n        $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEITEM).removeClass('active');\n        $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n        // Show custom date to dropdown button.\n        $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATE).html(dateAlternate);\n        filter[target].date = date;\n        loadGraph(target);\n    }\n\n    /**\n     * Initialize event listeners.\n     */\n    function initEvents() {\n\n        /* Date selector listener */\n        $('body').on('click', SELECTOR.DATEITEM + \":not(.custom)\", function() {\n            let target = $(this).closest(SELECTOR.FILTERS).data('id');\n            // Set custom selected item as active.\n            $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEITEM).removeClass('active');\n            $(this).addClass('active');\n\n            // Show selected item on dropdown button.\n            $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATE).html($(this).text());\n\n            // Clear custom date.\n            flatpickr.clear();\n\n            // Set date.\n            filter[target].date = $(this).data('value');\n\n            // Load graph data.\n            loadGraph(target);\n        });\n\n        // Course selector listener.\n        $('body').on('change', `${SELECTOR.PANEL} ${SELECTOR.COURSE}`, function() {\n            let target = $(this).closest(SELECTOR.FILTERS).data('id');\n            let courseid = parseInt($(this).val());\n            filter[target].course = courseid;\n\n            // Load graph data.\n            loadGraph(target);\n        });\n\n        // Initialize date selector.\n        let target = 'timespentonlms';\n        flatpickr = $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEPICKERINPUT).flatpickr({\n            mode: 'range',\n            altInput: true,\n            altFormat: \"d/m/Y\",\n            dateFormat: \"Y-m-d\",\n            maxDate: \"today\",\n            appendTo: $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEPICKER).get(0),\n            onOpen: function() {\n                $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEMENU).addClass('withcalendar');\n            },\n            onClose: function() {\n                $(SELECTOR.PANEL).find('.' + target).find(SELECTOR.DATEMENU).removeClass('withcalendar');\n                customDateSelected(target);\n            }\n        });\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        if ($(SELECTOR.PANEL).length == 0) {\n            return;\n        }\n        $(SELECTOR.PANEL).find('.singleselect').select2();\n        initEvents();\n        allGraphs.forEach(function(target) {\n            loadGraph(target);\n        });\n    }\n    return {\n        init: init\n    };\n});\n"],"file":"block_learner.min.js"}