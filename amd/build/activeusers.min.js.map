{"version":3,"sources":["activeusers.js"],"names":["define","$","ModalFactory","ModalEvents","Notification","Fragment","Templates","V","common","filter","init","CONTEXTID","PageId","ActiveUsersTable","loader","ModalTrigger","dropdownToggle","dropdownMenu","dropdownItem","cohortFilter","cohortId","dropdownInput","sesskey","DataTable","modalTable","searchTable","lengthSelect","flatpickr","SELECTOR","DATESELECTED","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","createModalOfUsersList","document","on","title","action","this","data","modalFilter","ModalRoot","titleDate","formatDate","Date","eval","M","util","get_string","component","date","create","body","loadFragment","page","cohortid","then","modal","getRoot","find","addClass","setTitle","show","hidden","destroy","bodyRendered","ModalTable","hasClass","empty","dom","language","info","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","search","value","draw","fail","exception","createDropdownCalendar","mode","altInput","altFormat","dateFormat","maxDate","appendTo","get","onOpen","dropdown","onClose","removeClass","selectedCustomDate","val","dateAlternate","replace","includes","html","createActiveUsersTable","clear","day","month","year","months","hide","ajax","url","requestUrl","JSON","stringify","done","response","ActiveUsers","parse","each","dates","idx","getDate","getMonth","getFullYear","concat","activeusers","activeUsers","courseenrolment","enrolments","coursecompletion","completionRate","context","render","js","replaceNode","ex","always","responsive","order","columnDefs","targets","className","len","column","error","select2","ready","handleSearchInput","placeholder","attr","click","e","target","parents","length","text"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/notification',\n    'core/fragment',\n    'core/templates',\n    './variables',\n    './common',\n    './jquery.dataTables',\n    './dataTables.bootstrap4',\n    './flatpickr'\n], function($, ModalFactory, ModalEvents, Notification, Fragment, Templates, V, common) {\n\n    var filter = 'last7days';\n\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        var PageId = \"#wdm-activeusers-individual\";\n        var ActiveUsersTable = PageId + \" .table\";\n        var loader = PageId + \" .loader\";\n        var ModalTrigger = ActiveUsersTable + \" a\";\n        var dropdownToggle = \"#filter-dropdown.dropdown-toggle\";\n        var dropdownMenu = \".dropdown-menu[aria-labelledby='filter-dropdown']\";\n        var dropdownItem = dropdownMenu + \" .dropdown-item\";\n        var cohortFilter = '.cohort-select';\n        var cohortId = 0;\n        var dropdownInput = \"#userfilter input.form-control.input\";\n        var sesskey = null;\n        var DataTable = null;\n        var modalTable = null;\n        var searchTable = PageId + \" .table-search-input input\";\n        var lengthSelect = PageId + \" .table-length-input select\";\n        var flatpickr = null;\n\n        var SELECTOR = {\n            DATESELECTED: '.selected-period',\n            DATE: '.edwiserreports-calendar',\n            DATEMENU: '.edwiserreports-calendar + .dropdown-menu',\n            DATEITEM: '.edwiserreports-calendar + .dropdown-menu .dropdown-item',\n            DATEPICKER: '.edwiserreports-calendar + .dropdown-menu .dropdown-calendar',\n            DATEPICKERINPUT: '.edwiserreports-calendar + .dropdown-menu .flatpickr'\n        };\n\n        // Initialize select2.\n        $(PageId).find('.singleselect').select2();\n\n        $(PageId).find('.download-links input[name=\"cohortid\"]').val(cohortId);\n        $(PageId).find('.download-links input[name=\"filter\"]').val(filter);\n\n        $(document).ready(function() {\n\n            common.handleSearchInput();\n\n            /* Show custom dropdown */\n            $(dropdownToggle).on(\"click\", function() {\n                $(dropdownMenu).addClass(\"show\");\n            });\n\n            /* Added Custom Value in Dropdown */\n            $(dropdownInput).ready(function() {\n                var placeholder = $(dropdownInput).attr(\"placeholder\");\n                $(dropdownInput).val(placeholder);\n            });\n\n            /* Hide dropdown when click anywhere in the screen */\n            $(document).click(function(e) {\n                if (!($(e.target).hasClass(\"dropdown-menu\") ||\n                        $(e.target).parents(\".dropdown-menu\").length)) {\n                    $(dropdownMenu).removeClass('show');\n                }\n            });\n\n            /* Select filter for active users block */\n            $(dropdownItem + \":not(.custom)\").on('click', function() {\n                filter = $(this).data('value');\n\n                // Set custom selected item as active.\n                $(SELECTOR.DATEITEM).removeClass('active');\n                $(this).addClass('active');\n\n                // Show selected item on dropdown button.\n                $(SELECTOR.DATE).html($(this).text());\n\n                // Hide dropdown.\n                $(SELECTOR.DATEMENU).removeClass('show');\n\n                // Clear custom date.\n                flatpickr.clear();\n                createActiveUsersTable(cohortId);\n            });\n\n            // Cohort filter.w\n            $(PageId + \" \" + cohortFilter).on('change', function() {\n                cohortId = $(this).val();\n                $(PageId).find('.download-links input[name=\"cohortid\"]').val(cohortId);\n                createActiveUsersTable(cohortId);\n            });\n\n            createActiveUsersTable(cohortId);\n            createModalOfUsersList();\n            createDropdownCalendar();\n        });\n\n        /**\n         * Create modal of Users list\n         */\n        function createModalOfUsersList() {\n            $(document).on('click', ModalTrigger, function() {\n                var title = \"\";\n                var action = $(this).data(\"action\");\n                var modalFilter = $(this).data(\"filter\");\n                var ModalRoot = null;\n\n                // eslint-disable-next-line no-eval\n                var titleDate = V.formatDate(new Date(eval(modalFilter * 86400 * 1000)), \"d MMM yyyy\");\n\n                if (action == \"activeusers\") {\n                    title = M.util.get_string('activeusersmodaltitle', V.component, {\n                        \"date\": titleDate\n                    });\n                } else if (action == \"enrolments\") {\n                    title = M.util.get_string('enrolmentsmodaltitle', V.component, {\n                        \"date\": titleDate\n                    });\n                } else if (action == \"completions\") {\n                    title = M.util.get_string('completionsmodaltitle', V.component, {\n                        \"date\": titleDate\n                    });\n                }\n\n                ModalFactory.create({\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'userslist',\n                        CONTEXTID, {\n                            page: 'activeusers',\n                            filter: modalFilter,\n                            cohortid: cohortId,\n                            action: action\n                        }\n                    )\n                }).then(function(modal) {\n                    ModalRoot = modal.getRoot();\n                    ModalRoot.find('.modal-dialog').addClass('modal-lg');\n                    modal.setTitle(title);\n                    modal.show();\n                    ModalRoot.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n\n                    ModalRoot.on(ModalEvents.bodyRendered, function() {\n                        var ModalTable = ModalRoot.find(\".modal-table\");\n\n                        // If empty then remove colspan\n                        if (ModalTable.find(\"tbody\").hasClass(\"empty\")) {\n                            ModalTable.find(\"tbody\").empty();\n                        }\n\n                        // Create dataTable for userslist\n                        modalTable = ModalRoot.find(\".modal-table\").DataTable({\n                            dom: '<\"edwiserreports-table\"<\"p-2\"i><t><\"table-pagination\"p>>',\n                            language: {\n                                info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                                infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                                emptyTable: M.util.get_string('nousers', 'local_edwiserreports'),\n                                zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                                paginate: {\n                                    previous: M.util.get_string('previous', 'moodle'),\n                                    next: M.util.get_string('next', 'moodle')\n                                }\n                            },\n                            drawCallback: function() {\n                                common.stylePaginationButton(this);\n                            }\n                        });\n\n                        ModalRoot.find('.table-search-input input').on('input', function() {\n                            modalTable.search(this.value).draw();\n                        });\n                    });\n                    return;\n                }).fail(Notification.exception);\n            });\n        }\n\n        /**\n         * Create Calender in dropdown tp select range.\n         */\n        function createDropdownCalendar() {\n            flatpickr = $(SELECTOR.DATEPICKERINPUT).flatpickr({\n                mode: 'range',\n                altInput: true,\n                altFormat: \"d M Y\",\n                dateFormat: \"Y-m-d\",\n                maxDate: \"today\",\n                appendTo: $(SELECTOR.DATEPICKER).get(0),\n                onOpen: function() {\n                    $(SELECTOR.DATEMENU).addClass('withcalendar');\n                    $(SELECTOR.DATE).dropdown('update');\n                },\n                onClose: function() {\n                    $(SELECTOR.DATEMENU).removeClass('withcalendar');\n                    selectedCustomDate();\n                }\n            });\n        }\n\n        /**\n         * After Select Custom date get active users details.\n         */\n        function selectedCustomDate() {\n            let date = $(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n            let dateAlternate = $(SELECTOR.DATEPICKERINPUT).next().val().replace(\"to\", \"-\"); // Date d M Y format.\n            $(SELECTOR.DATEPICKERINPUT).next().val(dateAlternate);\n\n            /* If correct date is not selected then return false */\n            if (!date.includes(\" to \")) {\n                flatpickr.clear();\n                return;\n            }\n\n            // Set active class to custom date selector item.\n            $(SELECTOR.DATEITEM).removeClass('active');\n            $(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n            // Show custom date to dropdown button.\n            $(SELECTOR.DATE).html(dateAlternate);\n\n            filter = date;\n\n            // Hide dropdown.\n            $(SELECTOR.DATEMENU).removeClass('show');\n            createActiveUsersTable(cohortId);\n        }\n\n        /**\n         * Create Active Users Table.\n         * @param {integer} cohortId Integer string.\n         */\n        function createActiveUsersTable(cohortId) {\n            $(PageId).find('.download-links input[name=\"filter\"]').val(filter);\n            let date, day, month, year;\n            let months = [\n                M.util.get_string('january', 'local_edwiserreports'),\n                M.util.get_string('february', 'local_edwiserreports'),\n                M.util.get_string('march', 'local_edwiserreports'),\n                M.util.get_string('april', 'local_edwiserreports'),\n                M.util.get_string('may', 'local_edwiserreports'),\n                M.util.get_string('june', 'local_edwiserreports'),\n                M.util.get_string('july', 'local_edwiserreports'),\n                M.util.get_string('august', 'local_edwiserreports'),\n                M.util.get_string('september', 'local_edwiserreports'),\n                M.util.get_string('october', 'local_edwiserreports'),\n                M.util.get_string('november', 'local_edwiserreports'),\n                M.util.get_string('december', 'local_edwiserreports')\n            ];\n            sesskey = $(PageId).data(\"sesskey\");\n\n            /* If datatable is already created then destroy the table */\n            if (DataTable) {\n                DataTable.destroy();\n                $(ActiveUsersTable).hide();\n                $(loader).show();\n            }\n\n            // Show loader.\n            common.loader.show(\"#wdm-activeusers-individual\");\n\n            $.ajax({\n                url: V.requestUrl,\n                data: {\n                    action: 'get_activeusers_graph_data_ajax',\n                    sesskey: sesskey,\n                    data: JSON.stringify({\n                        filter: filter,\n                        cohortid: cohortId\n                    })\n                },\n            }).done(function(response) {\n                var ActiveUsers = [];\n                response = JSON.parse(response);\n\n                $.each(response.dates, function(idx, val) {\n                    date = new Date(val * 86400 * 1000);\n                    day = date.getDate();\n                    month = months[date.getMonth()];\n                    year = date.getFullYear();\n                    ActiveUsers[idx] = {\n                        date: `${(day < 10 ? '0' + day : day)} ${month} ${year}`,\n                        filter: response.dates[idx],\n                        activeusers: response.data.activeUsers[idx],\n                        courseenrolment: response.data.enrolments[idx],\n                        coursecompletion: response.data.completionRate[idx]\n                    };\n                });\n\n                var context = {\n                    activeusers: ActiveUsers,\n                    sesskey: sesskey\n                };\n\n                // eslint-disable-next-line promise/catch-or-return\n                Templates.render('local_edwiserreports/activeuserstable', context)\n                    .then(function(html, js) {\n                        Templates.replaceNode(ActiveUsersTable, html, js);\n                        return;\n                    }).fail(function(ex) {\n                        Notification.exception(ex);\n                    }).always(function() {\n                        DataTable = $(ActiveUsersTable).DataTable({\n                            responsive: true,\n                            dom: '<\"edwiserreports-table\"<\"p-2\"i><t><\"table-pagination\"p>>',\n                            order: [\n                                [0, 'desc']\n                            ],\n                            language: {\n                                info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                                infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                                emptyTable: M.util.get_string('noactiveusers', 'local_edwiserreports'),\n                                zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                                paginate: {\n                                    previous: M.util.get_string('previous', 'moodle'),\n                                    next: M.util.get_string('next', 'moodle')\n                                }\n                            },\n                            columnDefs: [{\n                                    \"targets\": 0,\n                                    \"className\": \"text-left\"\n                                },\n                                {\n                                    \"targets\": \"_all\",\n                                    \"className\": \"text-center\",\n                                }\n                            ],\n                            drawCallback: function() {\n                                common.stylePaginationButton(this);\n                            }\n                        });\n                        DataTable.page.len($(lengthSelect).val());\n                        DataTable.column(0).search($(searchTable).val()).draw();\n                        $(ActiveUsersTable).show();\n                        $(loader).hide();\n\n                        // Hide loader.\n                        common.loader.hide(\"#wdm-activeusers-individual\");\n                    });\n            }).fail(function(error) {\n                Notification.exception(error);\n                // Hide loader.\n                common.loader.hide(\"#wdm-activeusers-individual\");\n            });\n        }\n        // Observer length change.\n        $(lengthSelect).on('change', function() {\n            DataTable.page.len(this.value).draw();\n        });\n\n        // Search in table.\n        $(searchTable).on('input', function() {\n            DataTable.column(0).search(this.value).draw();\n        });\n    }\n    return {\n        init: init\n    };\n\n});"],"file":"activeusers.min.js"}