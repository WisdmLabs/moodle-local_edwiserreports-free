{"version":3,"sources":["courseengage.js"],"names":["define","$","ModalFactory","ModalEvents","Fragment","V","common","init","CONTEXTID","PageId","CourseEngageTable","loader","sesskey","data","url","requestUrl","CourseEngageUsers","datatable","modalTable","cohortId","createCourseEngageTable","show","hide","DataTable","ajax","dom","columns","columnDefs","className","targets","language","searchPlaceholder","emptyTable","drawCallback","find","addClass","stylePaginationButton","this","initComplete","page","len","val","draw","column","search","document","ready","on","value","destroy","action","courseid","coursename","ModalRoot","create","body","loadFragment","cohortid","then","modal","getRoot","getBody","setTitle","hidden","shown","window","resize","bodyRendered","ModalTable","hasClass","empty","lengthChange"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/fragment',\n    './variables',\n    './common',\n    './jquery.dataTables',\n    './dataTables.bootstrap4'\n], function($, ModalFactory, ModalEvents, Fragment, V, common) {\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        var PageId = \"#wdm-courseengage-individual\";\n        var CourseEngageTable = PageId + \" .table\";\n        var loader = PageId + \" .loader\";\n        var sesskey = $(PageId).data(\"sesskey\");\n        var url = V.requestUrl + '?action=get_courseengage_data_ajax&sesskey=' + sesskey;\n        var CourseEngageUsers = CourseEngageTable + \" a.modal-trigger\";\n        var datatable = null;\n        var modalTable = null;\n        var exportUrlLink = \".dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item\";\n\n        // Varibales for cohort filter\n        var cohortId = 0;\n\n        $(document).ready(function() {\n\n            // Observer length change.\n            $('body').on('change', '#wdm-courseengage-individual .table-length-input select', function() {\n                datatable.page.len(this.value).draw();\n            });\n\n            // Search in table.\n            $('body').on('input', '#wdm-courseengage-individual .table-search-input input', function() {\n                datatable.column(0).search(this.value).draw();\n            });\n\n            // Search in modal table.\n            $('body').on('input', '.courseengage-modal .table-search-input input', function() {\n                modalTable.search(this.value).draw();\n            });\n\n            createCourseEngageTable(cohortId);\n\n            /* Select cohort filter for active users block */\n            $(document).on('change', '#page-local-edwiserreports-coursereport .cohort-select', function() {\n                if (datatable) {\n                    datatable.destroy();\n                    $(CourseEngageTable).hide();\n                    $(loader).show();\n                }\n\n                cohortId = $(this).val();\n                createCourseEngageTable(cohortId);\n            });\n\n            $(document).on('click', CourseEngageUsers, function() {\n                var action = $(this).data(\"action\");\n                var courseid = $(this).data(\"courseid\");\n                var coursename = $(this).data(\"coursename\");\n                var ModalRoot = null;\n\n                // eslint-disable-next-line promise/catch-or-return\n                ModalFactory.create({\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'userslist',\n                        CONTEXTID, {\n                            page: 'courseengage',\n                            courseid: courseid,\n                            action: action,\n                            cohortid: cohortId\n                        }\n                    )\n                }).then(function(modal) {\n                    ModalRoot = modal.getRoot();\n                    modal.getBody().addClass('courseengage-modal');\n                    ModalRoot.find('.modal-dialog').addClass('modal-lg');\n                    modal.setTitle(coursename);\n                    modal.show();\n                    ModalRoot.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n\n                    ModalRoot.on(ModalEvents.shown, function() {\n                        $(window).resize();\n                    });\n\n                    ModalRoot.on(ModalEvents.bodyRendered, function() {\n                        var ModalTable = ModalRoot.find(\".modal-table\");\n\n                        // If empty then remove colspan\n                        if (ModalTable.find(\"tbody\").hasClass(\"empty\")) {\n                            ModalTable.find(\"tbody\").empty();\n                        }\n\n                        // Create dataTable for userslist\n                        modalTable = ModalTable.DataTable({\n                            language: {\n                                emptyTable: \"There are no users\"\n                            },\n                            dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n                            drawCallback: function() {\n                                ModalTable.find('th').addClass('theme-3-bg text-white');\n                                common.stylePaginationButton(this);\n                            },\n                            lengthChange: false\n                        });\n                    });\n                    return;\n                });\n            });\n        });\n\n        /**\n         * Create course engagement table\n         * @param  {int} cohortId Cohort ID\n         */\n        function createCourseEngageTable(cohortId) {\n            common.loader.show('#page-local-edwiserreports-coursereport #wdm-courseengage-individual');\n            $(CourseEngageTable).show();\n            $(loader).hide();\n\n            datatable = $(CourseEngageTable).DataTable({\n                ajax: url + \"&cohortid=\" + cohortId,\n                dom: '<\"edwiserreports-table\"<\"p-2\"i><t><\"table-pagination\"p>>',\n                columns: [\n                    { \"data\": \"coursename\" },\n                    { \"data\": \"enrolment\" },\n                    { \"data\": \"visited\" },\n                    { \"data\": \"activitystart\" },\n                    { \"data\": \"completedhalf\" },\n                    { \"data\": \"coursecompleted\" }\n                ],\n                columnDefs: [\n                    { className: \"text-left\", targets: 0 },\n                    { className: \"text-center modal-trigger\", targets: \"_all\" }\n                ],\n                language: {\n                    searchPlaceholder: \"Search Course\",\n                    emptyTable: \"There are no courses\"\n                },\n                drawCallback: function() {\n                    $(CourseEngageTable).find('th').addClass('theme-3-bg text-white');\n                    common.stylePaginationButton(this);\n                },\n                initComplete: function() {\n                    common.loader.hide('#page-local-edwiserreports-coursereport #wdm-courseengage-individual');\n                }\n            });\n\n            datatable.page.len($('#wdm-courseengage-individual .table-length-input select').val()).draw();\n            datatable.column(0).search($('#wdm-courseengage-individual .table-search-input input').val()).draw();\n        }\n    }\n\n    return {\n        init: init\n    };\n});\n"],"file":"courseengage.min.js"}