{"version":3,"sources":["block_grade.js"],"names":["define","$","Ajax","Templates","ApexCharts","common","CFG","chart","pieChartDefault","type","height","fill","legend","position","offsetY","colors","getColorPalette","noData","text","M","util","get_string","SELECTOR","PANEL","GRAPH","GRAPHLABEL","PROMISE","GET_GRAPH_DATA","ajax","url","requestUrl","requestType","dataType","requestDataType","data","action","secret","local_edwiserreports","loadGraph","loader","show","done","response","Object","assign","labels","series","grades","find","header","insight","value","average","title","graph","destroy","get","render","setTimeout","hide","renderGraph","init","invalidUser","length","select2"],"mappings":"AAAA,aAyBAA,OAAO,CAAC,SAAU,YAAa,iBAAkB,qBAAsB,WAAY,kBAAmB,aAAc,SAAUC,EAAGC,EAAMC,EAAWC,EAAYC,EAAQC,GAIpK,IAAIC,EAAQ,KAKRC,EAAkB,CACpBD,MAAO,CACLE,KAAM,MACNC,OAAQ,KAEVC,KAAM,CACJF,KAAM,SAERG,OAAQ,CACNC,SAAU,SACVC,QAAS,GAEXC,OAAQT,EAAIU,kBACZC,OAAQ,CACNC,KAAMC,EAAEC,KAAKC,WAAW,cAAe,0BAOvCC,EAAW,CACbC,MAAO,cACPC,MAAO,SACPC,WAAY,gBAMVC,EAAU,CAKZC,eAAgB,WACd,OAAO1B,EAAE2B,KAAK,CACZC,IAAKvB,EAAIwB,WACTrB,KAAMH,EAAIyB,YACVC,SAAU1B,EAAI2B,gBACdC,KAAM,CACJC,OAAQ,4BACRC,OAAQjB,EAAEkB,qBAAqBD,YASvC,SAASE,IACP,IAAIJ,EACJ7B,EAAOkC,OAAOC,KAAKlB,EAASC,OAmB5BG,EAAQC,iBAAiBc,KAAK,SAAUC,IACtCR,EAAOS,OAAOC,OAAO,GAAIpC,IACpBqC,OAASH,EAASG,OACvBX,EAAKY,OAASJ,EAASK,OACvB9C,EAAEqB,EAASC,OAAOyB,KAAK1B,EAASG,YAAYP,KAAKwB,EAASO,QAC1D5C,EAAO6C,QAAQ,uBAAwB,CACrCA,QAAW,CACTC,MAAST,EAASU,QAAU,IAC5BC,MAASlC,EAAEC,KAAKC,WAAW,eAAgB,2BApBjD,SAAqBiC,EAAOpB,GACZ,OAAV3B,GACFA,EAAMgD,WAGRhD,EAAQ,IAAIH,EAAWkD,EAAME,IAAI,GAAItB,IAC/BuB,SACNC,WAAW,WACTrD,EAAOkC,OAAOoB,KAAKrC,EAASC,QAC3B,KAcHqC,CAAY3D,EAAEqB,EAASC,OAAOyB,KAAK1B,EAASE,OAAQU,KAEtD7B,EAAOkC,OAAOoB,KAAKrC,EAASC,OAiB9B,MAAO,CACLsC,KAVF,SAAcC,GACoB,GAA5B7D,EAAEqB,EAASC,OAAOwC,SAItB9D,EAAEqB,EAASC,OAAOyB,KAAK,iBAAiBgB,UACxC1B","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Grade table js.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/templates',\n    './chart/apexcharts',\n    './common',\n    './defaultconfig',\n    './select2'\n], function(\n    $,\n    Ajax,\n    Templates,\n    ApexCharts,\n    common,\n    CFG\n) {\n\n    /**\n     * Chart.\n     */\n    var chart = null;\n\n    /**\n     * Pie chart default config.\n     */\n    const pieChartDefault = {\n        chart: {\n            type: 'pie',\n            height: 350\n        },\n        fill: {\n            type: 'solid',\n        },\n        legend: {\n            position: 'bottom',\n            offsetY: 0\n        },\n        colors: CFG.getColorPalette(),\n        noData: {\n            text: M.util.get_string('nographdata', 'local_edwiserreports')\n        }\n    };\n\n    /**\n     * Selectors list.\n     */\n    var SELECTOR = {\n        PANEL: '#gradeblock',\n        GRAPH: '.graph',\n        GRAPHLABEL: '.graph-label',\n    };\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get graph data using filters.\n         * @returns {PROMISE}\n         */\n        GET_GRAPH_DATA: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_grade_graph_data_ajax',\n                    secret: M.local_edwiserreports.secret\n                },\n            });\n        }\n    };\n\n    /**\n     * Load graph\n     */\n    function loadGraph() {\n        let data;\n        common.loader.show(SELECTOR.PANEL);\n\n        /**\n         * Render graph.\n         * @param {DOM} graph Graph element\n         * @param {Object} data Graph data\n         */\n        function renderGraph(graph, data) {\n            if (chart !== null) {\n                chart.destroy();\n            }\n            chart = new ApexCharts(graph.get(0), data);\n            chart.render();\n            setTimeout(function() {\n                common.loader.hide(SELECTOR.PANEL);\n            }, 1000);\n        }\n        PROMISE.GET_GRAPH_DATA()\n            .done(function(response) {\n                data = Object.assign({}, pieChartDefault);\n                data.labels = response.labels;\n                data.series = response.grades;\n                $(SELECTOR.PANEL).find(SELECTOR.GRAPHLABEL).text(response.header);\n                common.insight('#gradeblock .insight', {\n                    'insight': {\n                        'value': response.average + '%',\n                        'title': M.util.get_string('averagegrade', 'local_edwiserreports')\n                    }\n                });\n                renderGraph($(SELECTOR.PANEL).find(SELECTOR.GRAPH), data);\n            });\n        common.loader.hide(SELECTOR.PANEL);\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        if ($(SELECTOR.PANEL).length == 0) {\n            return;\n        }\n        $(SELECTOR.PANEL).find('.singleselect').select2();\n        loadGraph();\n    }\n    return {\n        init: init\n    };\n});"],"file":"block_grade.min.js"}