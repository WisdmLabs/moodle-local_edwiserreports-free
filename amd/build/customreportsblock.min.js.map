{"version":3,"sources":["customreportsblock.js"],"names":["define","$","ajax","modalFactory","modalEvents","templates","notif","str","common","cfCheckbox","cfSelect","cfCohort","cfCourse","cfSave","cfSaveForm","crDesktopEnableSwitch","crDeleteBtn","crHideBtn","cpHeader","cfPreviewTable","crListTable","customReportSaveTitle","M","util","get_string","selectedFields","courses","cohorts","reportsId","reportsDataLoaded","reportsData","downloadenable","cfPreviewLoader","selector","show","this","removeClass","addClass","hide","cfPreview","empty","crListLoader","crList","getCustomReportsData","val","each","push","length","prop","loader","call","methodname","args","params","JSON","stringify","fields","done","response","success","data","parse","reportsdata","clear","destroy","html","DataTable","columns","dom","language","info","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","bInfo","bFilter","searching","lengthChange","drawCallback","find","stylePaginationButton","always","saveCustomReportsData","create","title","type","types","SAVE_CANCEL","body","render","modal","root","getRoot","getFooter","on","hidden","save","e","preventDefault","serializeArray","reduce","obj","item","name","value","ret","reportname","reportshortname","test","validateCustomReprtsSaveData","querydata","selectedfield","saveCustomReportsDataService","click","addNotification","message","errormsg","animate","scrollTop","getCustomReportsList","orderable","order","customReportServiceInit","document","enabledesktop","is","reportsid","action","reportId","get_strings","key","component","s","confirm","proxy","currentTarget","checkboxId","attr","toggleClass","trigger","column","search","draw","handleSearchInput","init","ready","id","wrap","target","closest","current","concat"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/notification',\n    'core/str',\n    './common',\n    './jquery.dataTables',\n    './dataTables.bootstrap4'\n], function(\n    $,\n    ajax,\n    modalFactory,\n    modalEvents,\n    templates,\n    notif,\n    str,\n    common\n) {\n    'use strict';\n\n    // Field group checkbox\n    var cfCheckbox = '.field .custom-field-checkbox';\n    var cfSelect = '.reports-filter-body .custom-field-select';\n    var cfCohort = '#wdm-cohort-select';\n    var cfCourse = '#wdm-course-select';\n    var cfSave = '#wdm-custom-reports-save';\n    var cfSaveForm = '#wdm-customreports-save-form';\n    var crPageId = '#wdm_custom_reports_id';\n    var crPageFullname = '#wdm_custom_reports_fullname';\n    var crPageShortname = '#wdm_custom_reports_shortname';\n    var crPageDownloadEnable = '#wdm_custom_reports_downloadenable';\n    var crPageDesktopEnable = '#wdm_custom_reports_desktopenable';\n    var crDesktopEnableSwitch = '[id^=\"wdm-desktopenable-\"]';\n    var crDeleteBtn = '#cr-list-table a[data-action=\"delete\"]';\n    var crHideBtn = '#cr-list-table a[data-action=\"hide\"]';\n    var cpHeader = '.reports-preview-header .rp-header';\n    var cfPreviewTable = null;\n    var crListTable = null;\n    var customReportSaveTitle = M.util.get_string('savecustomreport', 'local_edwiserreports');\n\n    var selectedFields = [];\n    var courses = [];\n    var cohorts = [];\n    var reportsId = 0;\n    var reportsDataLoaded = true;\n    var reportsData = {\n        downloadenable: true\n    };\n\n    var cfPreviewLoader = {\n        selector: '.reports-preview-body .reports-preview-content.loader',\n\n        show: function() {\n            $(this.selector).removeClass('d-none').addClass('d-flex');\n        },\n\n        hide: function() {\n            $(this.selector).removeClass('d-flex').addClass('d-none');\n        }\n    };\n\n    var cfPreview = {\n        selector: '.reports-preview-body .reports-preview-content',\n\n        show: function() {\n            $(this.selector + ':not(.loader)').removeClass('d-none').addClass('d-flex');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.hide();\n        },\n\n        hide: function() {\n            $(this.selector + ':not(.loader)').removeClass('d-flex').addClass('d-none');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.show();\n        },\n\n        empty: function() {\n            $(this.selector + '.empty').removeClass('d-none').addClass('d-flex');\n            $(this.selector + ':not(.empty)').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.hide();\n        }\n    };\n\n    var crListLoader = {\n        selector: '.reports-list-body .reports-list-content.loader',\n\n        show: function() {\n            $(this.selector).removeClass('d-none').addClass('d-flex');\n        },\n\n        hide: function() {\n            $(this.selector).removeClass('d-flex').addClass('d-none');\n        }\n    };\n\n    var crList = {\n        selector: '.reports-list-body .reports-list-content',\n\n        show: function() {\n            $(this.selector + ':not(.loader)').removeClass('d-none').addClass('d-flex');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            crListLoader.hide();\n        },\n\n        hide: function() {\n            $(this.selector + ':not(.loader)').removeClass('d-flex').addClass('d-none');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            crListLoader.show();\n        },\n\n        empty: function() {\n            $(this.selector + '.empty').removeClass('d-none').addClass('d-flex');\n            $(this.selector + ':not(.empty)').removeClass('d-flex').addClass('d-none');\n            crListLoader.hide();\n        }\n    };\n\n    /**\n     * Get custum reports data.\n     */\n    function getCustomReportsData() {\n        if (reportsDataLoaded) {\n            reportsDataLoaded = false;\n            selectedFields = [];\n            cohorts = $(cfCohort).val();\n            courses = $(cfCourse).val();\n            $(cfCheckbox + \":checked\").each(function() {\n                selectedFields.push($(this).val());\n            });\n\n            if (selectedFields.length == 0) {\n                $(cfSave).prop('disabled', true);\n                reportsDataLoaded = true;\n            } else {\n                common.loader.show('#wdm-customreports-edit');\n                var getCustomReportsDataAjax = ajax.call([{\n                    methodname: 'local_edwiserreports_get_customreports_data',\n                    args: {\n                        params: JSON.stringify({\n                            fields: selectedFields,\n                            cohorts: cohorts,\n                            courses: courses\n                        })\n                    }\n                }]);\n                getCustomReportsDataAjax[0].done(function(response) {\n                    if (response.success) {\n                        var data = JSON.parse(response.data);\n                        if (data.reportsdata.length == 0) {\n                            cfPreview.empty();\n                            $(cfSave).prop('disabled', true);\n                        } else {\n                            if (cfPreviewTable) {\n                                cfPreviewTable.clear().destroy();\n                                $('#cr-preview-table').html('');\n                            }\n                            cfPreview.show();\n                            cfPreviewTable = $('#cr-preview-table').DataTable({\n                                columns: data.columns,\n                                dom: '<\"edwiserreports-table\"<\"table-filter d-flex\"f><t><\"table-pagination\"p>>',\n                                data: data.reportsdata,\n                                language: {\n                                    info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                                    infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                                    emptyTable: M.util.get_string('nodata', 'local_edwiserreports'),\n                                    zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                                    paginate: {\n                                        previous: M.util.get_string('previous', 'moodle'),\n                                        next: M.util.get_string('next', 'moodle')\n                                    }\n                                },\n                                bInfo: false,\n                                bFilter: false,\n                                searching: false,\n                                lengthChange: false,\n                                drawCallback: function() {\n                                    $('#cr-preview-table').find('th').addClass('theme-3-bg text-white');\n                                    common.stylePaginationButton(this);\n                                }\n                            });\n                            $(cfSave).prop('disabled', false);\n                        }\n                    }\n                }).always(function() {\n                    reportsDataLoaded = true;\n                    common.loader.hide('#wdm-customreports-edit');\n                });\n            }\n        }\n    }\n\n    /**\n     * Validate custom reports data to save.\n     * @param {Object} data Custom report data object\n     * @return {Boolean}\n     */\n    function validateCustomReprtsSaveData(data) {\n        var ret = true;\n        if (data.reportname == '') {\n            $('#id_error_crb_reportname')\n                .html(M.util.get_string('emptyfullname', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n\n        if (data.reportshortname == '') {\n            $('#id_error_crb_reportshortname')\n                .html(M.util.get_string('emptyshortname', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n\n        // eslint-disable-next-line no-useless-escape\n        var format = /[ `!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~]/;\n        if (format.test(data.reportshortname)) {\n            $('#id_error_crb_reportshortname')\n                .html(M.util.get_string('nospecialchar', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n        return ret;\n    }\n\n    /**\n     * Save custom reports data confirmation module.\n     */\n    function saveCustomReportsData() {\n        modalFactory.create({\n            title: customReportSaveTitle,\n            type: modalFactory.types.SAVE_CANCEL,\n            body: templates.render('local_edwiserreports/custom_reports_save_form', reportsData)\n        }).done(function(modal) {\n            var root = modal.getRoot();\n            root.find('.modal-dialog').addClass('modal-lg');\n            modal.getFooter().find('[data-action=\"save\"]').removeClass('btn-primary').addClass('theme-primary-bg text-white');\n            modal.show();\n\n            // Destroying modal on hide event.\n            root.on(modalEvents.hidden, function() {\n                modal.destroy();\n            });\n\n            // Saving modal data.\n            root.on(modalEvents.save, function(e) {\n                // Stop the default save button behaviour which is to close the modal.\n                e.preventDefault();\n\n                // Remove all error on type\n                root.find('input').on('input', function() {\n                    $('[id^=\"id_error_crb\"]').html('');\n                });\n\n                var data = $(cfSaveForm).serializeArray().reduce(function(obj, item) {\n                    obj[item.name] = item.value;\n                    return obj;\n                }, {});\n\n                if (validateCustomReprtsSaveData(data)) {\n                    // Prepare query data\n                    data.querydata = {\n                        'selectedfield': selectedFields,\n                        'cohorts': cohorts,\n                        'courses': courses\n                    };\n\n                    saveCustomReportsDataService(data, modal);\n                }\n            });\n        });\n    }\n\n    /**\n     * Save customo report data to database.\n     * @param {Object} data Custom report data\n     * @param {Moodle_Factory} modal Modal object\n     */\n    function saveCustomReportsDataService(data, modal) {\n        var saveCustomReportsData = ajax.call([{\n            methodname: 'local_edwiserreports_save_customreports_data',\n            args: {\n                params: JSON.stringify(data)\n            }\n        }]);\n\n        saveCustomReportsData[0].done(function(response) {\n            if (response.success) {\n                if (modal) {\n                    reportsData = JSON.parse(response.reportsdata);\n                    $(cpHeader).html(reportsData.reportname);\n                    $(cfSave).html(M.util.get_string('updatereports', 'local_edwiserreports'));\n                }\n                $('#user-notifications .close').click();\n                notif.addNotification({\n                    message: M.util.get_string('reportssavesuccess', 'local_edwiserreports'),\n                    type: \"success\"\n                });\n            } else {\n                $('#user-notifications .close').click();\n                notif.addNotification({\n                    message: response.errormsg,\n                    type: \"error\"\n                });\n            }\n            if (modal) {\n                $(\"html, body\").animate({\n                    scrollTop: 0\n                }, \"slow\");\n                getCustomReportsList();\n                modal.hide();\n            }\n        });\n    }\n\n    /**\n     * Get reports list of custom reports.\n     */\n    function getCustomReportsList() {\n        var getCustomReportsList = ajax.call([{\n            methodname: 'local_edwiserreports_get_customreports_list',\n            args: {\n                params: JSON.stringify({})\n            }\n        }]);\n        getCustomReportsList[0].done(function(response) {\n            var data = JSON.parse(response.data);\n            if (response.success) {\n                if (data.length == 0) {\n                    crList.empty();\n                } else {\n                    if (crListTable) {\n                        crListTable.clear().destroy();\n                    }\n\n                    crListTable = $('#cr-list-table').DataTable({\n                        columns: [{\n                            data: 'fullname',\n                            title: M.util.get_string('title', 'local_edwiserreports')\n                        }, {\n                            data: 'createdby',\n                            title: M.util.get_string('createdby', 'local_edwiserreports')\n                        }, {\n                            data: 'datecreated',\n                            title: M.util.get_string('datecreated', 'local_edwiserreports')\n                        }, {\n                            data: 'datemodified',\n                            title: M.util.get_string('datemodified', 'local_edwiserreports')\n                        }, {\n                            data: 'managehtml',\n                            title: M.util.get_string('manage', 'local_edwiserreports'),\n                            orderable: false\n                        }],\n                        dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                        language: {\n                            info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                            infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                            emptyTable: M.util.get_string('nodata', 'local_edwiserreports'),\n                            zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                            paginate: {\n                                previous: M.util.get_string('previous', 'moodle'),\n                                next: M.util.get_string('next', 'moodle')\n                            }\n                        },\n                        order: [\n                            [0, 'asc']\n                        ],\n                        data: data,\n                        bInfo: false,\n                        lengthChange: false,\n                        drawCallback: function() {\n                            $('#cr-list-table').find('th').addClass('theme-3-bg text-white');\n                            common.stylePaginationButton(this);\n                        }\n                    });\n                    crList.show();\n                }\n            }\n        });\n    }\n\n    /**\n     * Delete custom reports data.\n     * @param {Integer} reportsId Report id\n     */\n    function customReportDelete(reportsId) {\n        var deleteCustomReport = ajax.call([{\n            methodname: 'local_edwiserreports_delete_custom_report',\n            args: {\n                params: JSON.stringify({\n                    reportsid: reportsId\n                })\n            }\n        }]);\n        deleteCustomReport[0].done(function(response) {\n            if (response.success) {\n                notif.addNotification({\n                    message: response.message,\n                    type: \"success\"\n                });\n            } else {\n                notif.addNotification({\n                    message: response.message,\n                    type: \"error\"\n                });\n            }\n        }).always(function() {\n            $(\"html, body\").animate({\n                scrollTop: 0\n            }, \"slow\");\n            getCustomReportsList();\n        });\n    }\n\n    /**\n     * Initialise custom reports events.\n     */\n    function customReportServiceInit() {\n        $(cfCheckbox).on('change', function() {\n            getCustomReportsData();\n        });\n        $(cfSelect).on('change', function() {\n            getCustomReportsData();\n        });\n        $(cfSave).on('click', function() {\n            saveCustomReportsData();\n        });\n        getCustomReportsList();\n        $(document).on('change', crDesktopEnableSwitch, function() {\n            var enabledesktop = false;\n            if ($(this).is(\":checked\")) {\n                enabledesktop = true;\n            }\n            var updateData = {\n                reportsid: $(this).data('reportsid'),\n                enabledesktop: enabledesktop,\n                action: 'enabledesktop'\n            };\n\n            saveCustomReportsDataService(updateData, false);\n        });\n        $(document).on('click', crDeleteBtn, function(e) {\n            e.preventDefault();\n\n            var reportId = $(this).data('reportsid');\n            str.get_strings([{\n                    key: 'deletecustomreportstitle',\n                    component: 'local_edwiserreports'\n                },\n                {\n                    key: 'deletecustomreportsquestion',\n                    component: 'local_edwiserreports'\n                },\n                {\n                    key: 'yes',\n                    component: 'moodle'\n                },\n                {\n                    key: 'no',\n                    component: 'moodle'\n                }\n            ]).done(function(s) {\n                notif.confirm(s[0], s[1], s[2], s[3], $.proxy(function() {\n                    customReportDelete(reportId);\n                }, e.currentTarget));\n            });\n        });\n        $(document).on('click', crHideBtn, function(e) {\n            e.preventDefault();\n\n            var checkboxId = $(this).data('target');\n            if ($(this).data('value')) {\n                $(this).attr('title', $(this).data('titlehide'));\n                $(this).attr('data-original-title', $(this).data('titlehide'));\n                $(this).data('value', 0);\n                $(this).attr('data-value', 0);\n            } else {\n                $(this).attr('title', $(this).data('titleshow'));\n                $(this).attr('data-original-title', $(this).data('titleshow'));\n                $(this).data('value', 1);\n                $(this).attr('data-value', 1);\n            }\n            $(this).find('.icon').toggleClass('fa-eye');\n            $(this).find('.icon').toggleClass('fa-eye-slash');\n            $(checkboxId).trigger('click');\n        });\n\n\n        // Search in table.\n        $('body').on('input', '.customreports-block-section .table-search-input input', function() {\n            crListTable.column(0).search(this.value).draw();\n        });\n\n        common.handleSearchInput();\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n\n                $(document).on('click', '.field-group', function() {\n                    var id = this.id;\n                    $(this).toggleClass('open');\n                    $(\"[aria-control='\" + id + \"']\").toggleClass('show');\n                });\n\n                $(document).on('click', function(e) {\n                    let wrap = $(e.target).closest(\".field-group-wrap\");\n                    if (wrap.length === 0) {\n                        $('.field-group-wrap .field-group').removeClass('open');\n                        $('.field-group-wrap .field').removeClass('show');\n                        return;\n                    }\n                    let current = wrap.data('key') === 'user' ? 'course' : 'user';\n                    $(`.field-group-wrap[data-key='${current}'] .field-group`).removeClass('open');\n                    $(`.field-group-wrap[data-key='${current}'] .field`).removeClass('show');\n                });\n\n                customReportServiceInit();\n                reportsId = $(crPageId).val();\n                if (reportsId !== 0) {\n                    reportsData.reportsid = reportsId;\n                    reportsData.reportname = $(crPageFullname).val();\n                    reportsData.reportshortname = $(crPageShortname).val();\n\n                    if ($(crPageDownloadEnable).val() != 0) {\n                        reportsData.downloadenable = true;\n                    } else {\n                        reportsData.downloadenable = false;\n                    }\n\n                    if ($(crPageDesktopEnable).val() != 0) {\n                        reportsData.enabledesktop = true;\n                    } else {\n                        reportsData.enabledesktop = false;\n                    }\n\n                    getCustomReportsData();\n                }\n            });\n        }\n    };\n});"],"file":"customreportsblock.min.js"}