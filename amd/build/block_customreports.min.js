"use strict";define(["jquery","core/str","./defaultconfig","./variables","./flatpickr","./jquery.dataTables","./dataTables.bootstrap4"],function(e,t,a,r){var o=null,n=a.getPanel("#customReportBlock"),l=n+" .dropdown-menu .dropdown-item",s="courses",d=n+" #customReportDownload",i=e(n).find("#customReportDrodown"),c=e(n).find("#customReportsForm"),u=function(e){return n+" "+e+" input[name^=customReportSelect-]"};e(n).find(".custom-flatpicker").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",onClose:function(t,a,r){if(t[0])if(e("#wdmCustomReportEnrolStart").is(r.element)){var o=t[0].getTime();c.find("input[name=enrolstartdate]").val(o/1e3)}else if(e("#wdmCustomReportEnrolEnd").is(r.element)){var n=t[0].getTime();c.find("input[name=enrolenddate]").val(n/1e3)}}}),e(document).on("click",".custom-flatpicker ~ button.input-search-close",function(){e(".custom-flatpicker ~ input.form-control").val(""),c.find("input[name=enrolstartdate]").val(""),c.find("input[name=enrolenddate]").val("")}),e(document).on("change",n+' input[name="selectAllCustom"]',function(t){var a=".course-table";"lps"==s&&(a=".lp-table");var r=u(a);e(t.target).is(":checked")?e(r).prop("checked",!0):e(r).prop("checked",!1)}),e(document).on("click",l,function(t){s=e(t.target).data("val"),i.html(e(t.target).html()),i.data("val",s);var a=".course-table";"lps"==s&&(a=".lp-table"),e(n).find(".table").hide(),c.find("input[name=reporttype]").val(s),function(t,a){o&&o.destroy(),e(n+" .enrol-selector").show(),e(n+' input[name="selectAllCustom"]').prop("checked",!1);var l=e(n).find(".customReportSelectors"),s=e(n).find(".rootContainer"),d=JSON.stringify({type:t}),i=r.requestUrl+"?action=get_customreport_selectors_ajax&secret="+M.local_edwiserreports.secret+"&filter="+d;s.show();var c="lps"==t?{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"startdate"},{data:"enddate"},{data:"duration"}],language:{searchPlaceholder:"Search Learning Programs",emptyTable:"There are no learning programs"}}:{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"category"},{data:"startdate"},{data:"enddate"}],language:{searchPlaceholder:"Search Course",emptyTable:"There are no courses"}};o=l.find(a).show().DataTable({ajax:i,dom:'<"edwiserreports-table"<"table-filter d-flex"f><t><"table-pagination"p>>',columns:c.columns,language:c.language,responsive:!0,scrollY:"380px",scroller:{loadingIndicator:!0},scrollCollapse:!0,scrollX:!0,paging:!1,bInfo:!1,bSort:!1,drawCallback:function(){common.stylePaginationButton(this)}}).columns.adjust()}(s,a)}),e(document).on("click",d,function(){if(t=c.find('input[name="enrolstartdate"]').val(),(""!=(a=c.find('input[name="enrolenddate"]').val())||""!=t)&&a<t)return e(n).find("#errorMsg").html(M.util.get_string("customreportdatefailed","local_edwiserreports")).addClass("show").removeClass("hide"),setTimeout(function(){e(n).find("#errorMsg").addClass("hide").removeClass("show")},5e3),!1;var t,a,r=".course-table";"lps"==s&&(r=".lp-table");var o=u(r);if(!e(o+":checked").length)return e(n).find("#errorMsg").html(M.util.get_string("customreportselectfailed","local_edwiserreports")).addClass("show").removeClass("hide"),setTimeout(function(){e(n).find("#errorMsg").addClass("hide").removeClass("show")},5e3),!1;var l=[];return e(o+":checked").each(function(t,a){l.push(e(a).data("id"))}),c.find("input[name=filters]").val(l.join(",")),!0})});
//# sourceMappingURL=block_customreports.min.js.map
