"use strict";define(["jquery","./defaultconfig","./variables","./common","local_edwiserreports/jquery","./flatpickr","./jquery.dataTables","./dataTables.bootstrap4"],function(e,t,r,a,o){var n=null,l=t.getPanel("#customReportBlock"),s=l+" .dropdown-menu .dropdown-item",i="courses",d=l+" #customReportDownload",c=e(l).find("#customReportDrodown"),p=e(l).find("#customReportsForm");let u="rtl"==e("html").attr("dir")?1:0;e(l).find('.download-links [name="rtl"]').val(u);var m=function(e){return l+" "+e+" input[name^=customReportSelect-]"},f=function(t,o){n&&n.destroy(),e(l+" .enrol-selector").show(),e(l+' input[name="selectAllCustom"]').prop("checked",!1);var s=e(l).find(".customReportSelectors"),i=e(l).find(".rootContainer"),d=JSON.stringify({type:t}),c=r.requestUrl+"?action=get_customreport_selectors_ajax&secret="+M.local_edwiserreports.secret+"&filter="+d;i.show();var p="lps"==t?{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"startdate"},{data:"enddate"},{data:"duration"}],language:{searchPlaceholder:"Search Learning Programs",emptyTable:"There are no learning programs"}}:{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"category"},{data:"startdate"},{data:"enddate"}],language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nocourses","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}}};n=s.find(o).show().DataTable({ajax:c,dom:'<"edwiserreports-table"<"table-filter d-flex"f><t><"table-pagination"p>>',columns:p.columns,language:p.language,responsive:!0,scrollY:"380px",scroller:{loadingIndicator:!0},scrollCollapse:!0,scrollX:!0,paging:!1,bInfo:!1,bSort:!1,drawCallback:function(){a.stylePaginationButton(this),setTimeout(function(){e(".edwiserreports-table .page-item.next a").empty(),e(".edwiserreports-table .page-item.previous a").empty();var t=e("html").attr("dir");void 0!==t&&!1!==t&&"rtl"==t&&(e(".edwiserreports-table .page-item.next a:before").css({"border-left":"11px solid transparent","border-bottom":"6px solid transparent","border-top":"6px solid transparent","border-left-color":"#ccc","border-right-width":"0px"}),e(".edwiserreports-table .page-item.previous a:before").css({"border-bottom":"6px solid transparent","border-top":"6px solid transparent","border-right":" 10px solid transparent","border-right-color":"#ccc","border-left-width":"0px"}))},1e3),setTimeout(function(){},2e3)}}).columns.adjust(),setTimeout(function(){e(".edwiserreports-table .page-item.next a").empty(),e(".edwiserreports-table .page-item.previous a").empty()},3e3)};o(l).find(".custom-flatpicker").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",onClose:function(t,r,a){if(t[0])if(e("#wdmCustomReportEnrolStart").is(a.element)){var o=t[0].getTime();p.find("input[name=enrolstartdate]").val(o/1e3)}else if(e("#wdmCustomReportEnrolEnd").is(a.element)){var n=t[0].getTime();p.find("input[name=enrolenddate]").val(n/1e3)}}}),e(document).on("click",".custom-flatpicker ~ button.input-search-close",function(){e(".custom-flatpicker ~ input.form-control").val(""),p.find("input[name=enrolstartdate]").val(""),p.find("input[name=enrolenddate]").val("")}),e(document).on("change",l+' input[name="selectAllCustom"]',function(t){var r=".course-table";"lps"==i&&(r=".lp-table");var a=m(r);e(t.target).is(":checked")?e(a).prop("checked",!0):e(a).prop("checked",!1)}),e(document).on("click",s,function(t){i=e(t.target).data("val"),c.html(e(t.target).html()),c.data("val",i);var r=".course-table";"lps"==i&&(r=".lp-table"),e(l).find(".table").hide(),p.find("input[name=reporttype]").val(i),f(i,r)}),e(document).on("click",d,function(){if(t=p.find('input[name="enrolstartdate"]').val(),(""!=(r=p.find('input[name="enrolenddate"]').val())||""!=t)&&r<t)return e(l).find("#errorMsg").html(M.util.get_string("customreportdatefailed","local_edwiserreports")).addClass("show").removeClass("hide"),setTimeout(function(){e(l).find("#errorMsg").addClass("hide").removeClass("show")},5e3),!1;var t,r,a=".course-table";"lps"==i&&(a=".lp-table");var o=m(a);if(!e(o+":checked").length)return e(l).find("#errorMsg").html(M.util.get_string("customreportselectfailed","local_edwiserreports")).addClass("show").removeClass("hide"),setTimeout(function(){e(l).find("#errorMsg").addClass("hide").removeClass("show")},5e3),!1;var n=[];return e(o+":checked").each(function(t,r){n.push(e(r).data("id"))}),p.find("input[name=filters]").val(n.join(",")),!0})});
//# sourceMappingURL=block_customreports.min.js.map
