"use strict";define(["jquery","./defaultconfig","./variables","./common","./flatpickr","./jquery.dataTables","./dataTables.bootstrap4"],function(e,t,a,o){var r=null,n=t.getPanel("#customReportBlock"),l=n+" .dropdown-menu .dropdown-item",s="courses",i=n+" #customReportDownload",d=e(n).find("#customReportDrodown"),c=e(n).find("#customReportsForm"),u=function(e){return n+" "+e+" input[name^=customReportSelect-]"},m=function(t,l){r&&r.destroy(),e(n+" .enrol-selector").show(),e(n+' input[name="selectAllCustom"]').prop("checked",!1);var s=e(n).find(".customReportSelectors"),i=e(n).find(".rootContainer"),d=JSON.stringify({type:t}),c=a.requestUrl+"?action=get_customreport_selectors_ajax&secret="+M.local_edwiserreports.secret+"&filter="+d;i.show();var u="lps"==t?{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"startdate"},{data:"enddate"},{data:"duration"}],language:{searchPlaceholder:"Search Learning Programs",emptyTable:"There are no learning programs"}}:{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"category"},{data:"startdate"},{data:"enddate"}],language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nocourses","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:M.util.get_string("previous","moodle"),next:M.util.get_string("next","moodle")}}};r=s.find(l).show().DataTable({ajax:c,dom:'<"edwiserreports-table"<"table-filter d-flex"f><t><"table-pagination"p>>',columns:u.columns,language:u.language,responsive:!0,scrollY:"380px",scroller:{loadingIndicator:!0},scrollCollapse:!0,scrollX:!0,paging:!1,bInfo:!1,bSort:!1,drawCallback:function(){o.stylePaginationButton(this)}}).columns.adjust()};e(n).find(".custom-flatpicker").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",onClose:function(t,a,o){if(t[0])if(e("#wdmCustomReportEnrolStart").is(o.element)){var r=t[0].getTime();c.find("input[name=enrolstartdate]").val(r/1e3)}else if(e("#wdmCustomReportEnrolEnd").is(o.element)){var n=t[0].getTime();c.find("input[name=enrolenddate]").val(n/1e3)}}}),e(document).on("click",".custom-flatpicker ~ button.input-search-close",function(){e(".custom-flatpicker ~ input.form-control").val(""),c.find("input[name=enrolstartdate]").val(""),c.find("input[name=enrolenddate]").val("")}),e(document).on("change",n+' input[name="selectAllCustom"]',function(t){var a=".course-table";"lps"==s&&(a=".lp-table");var o=u(a);e(t.target).is(":checked")?e(o).prop("checked",!0):e(o).prop("checked",!1)}),e(document).on("click",l,function(t){s=e(t.target).data("val"),d.html(e(t.target).html()),d.data("val",s);var a=".course-table";"lps"==s&&(a=".lp-table"),e(n).find(".table").hide(),c.find("input[name=reporttype]").val(s),m(s,a)}),e(document).on("click",i,function(){if(t=c.find('input[name="enrolstartdate"]').val(),(""!=(a=c.find('input[name="enrolenddate"]').val())||""!=t)&&a<t)return e(n).find("#errorMsg").html(M.util.get_string("customreportdatefailed","local_edwiserreports")).addClass("show").removeClass("hide"),setTimeout(function(){e(n).find("#errorMsg").addClass("hide").removeClass("show")},5e3),!1;var t,a,o=".course-table";"lps"==s&&(o=".lp-table");var r=u(o);if(!e(r+":checked").length)return e(n).find("#errorMsg").html(M.util.get_string("customreportselectfailed","local_edwiserreports")).addClass("show").removeClass("hide"),setTimeout(function(){e(n).find("#errorMsg").addClass("hide").removeClass("show")},5e3),!1;var l=[];return e(r+":checked").each(function(t,a){l.push(e(a).data("id"))}),c.find("input[name=filters]").val(l.join(",")),!0})});
//# sourceMappingURL=block_customreports.min.js.map
