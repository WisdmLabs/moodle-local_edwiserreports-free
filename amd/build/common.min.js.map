{"version":3,"sources":["common.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","$","notif","Fragment","ModalFactory","ModalEvents","Templates","str","v","selector","tempSelector","jsPDF","SELECTOR","TABLE","FILTER","SEARCHTABLE","PAGINATION","PAGINATIONITEM","render","loader","show","id","$class","undefined","append","concat","M","util","get_string","hide","remove","switchCapabilitiesBlock","modal","find","on","event","permissions","currentTarget","current","filter","next","eq","index","length","prop","perStr","data","perClass","removeClass","addClass","html","document","ready","e","preventDefault","form","this","closest","ajax","url","attr","type","val","block","cohortid","region","done","response","JSON","parse","pdf","margins","top","bottom","left","width","setFontSize","fromHTML","elementHandlers","#bypassme","element","renderer","dispose","save","filename","always","blockSettingsBtn","contextid","blockname","action","create","title","body","loadFragment","root","getRoot","bodyRendered","formData","serializeArray","each","$k","$d","name","value","stringify","sesskey","requestUrl","fail","error","console","log","addNotification","message","location","reload","setBlockPreference","hidden","destroy","_this","cfg","success","capvalue","capabilities","js","css","callback","setBlockCapabilities","editing","editingtxt","editForm","wwwroot","setupBlockHiding","insight","replaceNodeContents","ex","Notification","exception","timeFormatter","seconds","opts","Number","h","Math","floor","m","s","dataPointIndex","time","_short","push","join","dateChange","detail","date","stylePaginationButton","pagination","datatableClasses","buttonSpacing","buttonSize","buttonActive","buttonInactive","handleSearchInput","toggleClass"],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/notification',\n    'core/fragment',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/str',\n    './variables',\n    './selectors',\n    './templateselector',\n    './jspdf',\n    './select2',\n    './jquery.dataTables',\n    './dataTables.bootstrap4'\n], function(\n    $,\n    notif,\n    Fragment,\n    ModalFactory,\n    ModalEvents,\n    Templates,\n    str,\n    v,\n    selector,\n    tempSelector,\n    jsPDF\n) {\n\n\n    /**\n     * Selectors list.\n     */\n    let SELECTOR = {\n        TABLE: '.edwiserreports-table',\n        FILTER: '.table-filter',\n        SEARCHTABLE: '.table-search-input input',\n        PAGINATION: '.table-pagination',\n        PAGINATIONITEM: '.paginate_button'\n    };\n\n    Templates.render('local_edwiserreports/insight-placeholder', {});\n    Templates.render('local_edwiserreports/insight', {});\n\n    // Loader functions.\n    var loader = {\n        show: function(id) {\n            var $class;\n            if (id == undefined) {\n                id = 'body';\n                $class = 'position-fixed';\n            } else {\n                $class = 'position-absolute';\n            }\n            $(id).append(`\n            <div class=\"edwiserreports-loader ${$class}\">\n                <div class=\"animation-wrapper\">\n                    <div class=\"fa-animation\">\n                        <i class=\"fa fa-cog fa-lg fa-spin\"></i>\n                        <i class=\"fa fa-cog fa-md fa-spin spin-reverse\"></i>\n                        <i class=\"fa fa-cog fa-sm fa-spin spin-reverse\"></i>\n                    </div>\n                    ${M.util.get_string('loading', 'moodle')}\n                </div>\n            </div>\n            `);\n        },\n        hide: function(id) {\n            if (id == undefined) {\n                id = 'body';\n            }\n            $(id + ' > .edwiserreports-loader').remove();\n        }\n    };\n\n    $(document).ready(function() {\n        var exportPdf = '.download-links button[value=\"pdf\"]';\n\n        // Export data in pdf\n        $(document).on(\"click\", exportPdf, function(e) {\n            e.preventDefault();\n\n            var _this = this;\n            var form = $(_this).closest(\"form\");\n            $.ajax({\n                url: form.attr('action'),\n                type: 'POST',\n                data: {\n                    'type': $(_this).val(),\n                    'block': form.find('input[name=\"block\"]').val(),\n                    'filter': form.find('input[name=\"filter\"]').val(),\n                    'cohortid': form.find('input[name=\"cohortid\"]').val(),\n                    'region': form.find('input[name=\"region\"]').val()\n                }\n            }).done(function(response) {\n                response = JSON.parse(response);\n                var pdf = jsPDF('p', 'pt', 'a4');\n                var margins = {\n                    top: 40,\n                    bottom: 30,\n                    left: 10,\n                    width: \"100%\"\n                };\n\n                pdf.setFontSize(10);\n\n                // ID selector for either ID or node name. (\"#iAmID\", \"div\", \"span\" etc.)\n                // There is no support for any other type of selectors\n                // (class, of compound) at this time.\n                var specialElementHandlers = {\n                    // Element with id of \"bypass\" - jQuery style selector\n                    // eslint-disable-next-line no-unused-vars\n                    '#bypassme': function(element, renderer) {\n                        // True = \"handled elsewhere, bypass text extraction\"\n                        return true;\n                    }\n                };\n                // All coords and widths are in jsPDF instance's declared units\n                // 'inches' in this case\n                pdf.fromHTML(\n                    response.data.html, // HTML string or DOM elem ref.\n                    margins.left, // X coord\n                    margins.top, { // Y coord\n                        'width': margins.width, // Max width of content on PDF\n                        'elementHandlers': specialElementHandlers\n                    },\n                    // eslint-disable-next-line no-unused-vars\n                    function(dispose) {\n                        // Dispose: object with X, Y of the last line add to the PDF\n                        //          this allow the insertion of new lines after html\n                        pdf.save(response.data.filename);\n                    }, margins);\n            }).always(function() {\n                $(document).find('#cover-spin').hide();\n            });\n        });\n\n        // Show reports page when document is ready\n        $('#wdm-edwiserreports').removeClass('d-none');\n\n        setupBlockEditing();\n\n        setupBlockHiding($('#wdm-edwiserreports').data(\"editing\"));\n    });\n\n    /**\n     * Setup block hiding\n     * @param {Boolean} editing True if editing is on\n     */\n    function setupBlockHiding(editing) {\n        var editForm = '<div id=\"editing-btn\" class=\"d-flex flex-wrap\">';\n        editForm += '<div class=\"ml-auto d-flex\">';\n        var editingtxt;\n\n        // Change editing option\n        if (editing) {\n            editing = 0;\n            editingtxt = \"Stop Customising this page\";\n\n            editForm += '<div class=\"singlebutton\">';\n            editForm += '<form method=\"post\" action=\"' + M.cfg.wwwroot + '/local/edwiserreports/index.php\">';\n            editForm += '<input type=\"hidden\" name=\"reset\" value=\"1\">';\n            editForm += '<input type=\"hidden\" name=\"sesskey\" value=\"' + M.cfg.sesskey + '\">';\n            editForm += '<button type=\"submit\" class=\"btn btn-secondary\" title=\"\">Reset Page to Default</button>';\n            editForm += '</form>';\n            editForm += '</div>';\n        } else {\n            editing = 1;\n            editingtxt = \"Customise this page\";\n        }\n\n        editForm += '<div class=\"singlebutton\">';\n        editForm += '<form method=\"post\" action=\"' + M.cfg.wwwroot + '/local/edwiserreports/index.php\">';\n        editForm += '<input type=\"hidden\" name=\"edit\" value=\"' + editing + '\">';\n        editForm += '<input type=\"hidden\" name=\"sesskey\" value=\"' + M.cfg.sesskey + '\">';\n        editForm += '<button type=\"submit\" class=\"btn btn-secondary\" title=\"\">' + editingtxt + '</button>';\n        editForm += '</form>';\n        editForm += '</div>';\n\n        editForm += '</div></div>';\n\n        $(\"#page-local-edwiserreports-index #page-header .card-body\").append(editForm);\n    }\n\n    /**\n     * Setup block setting button\n     */\n    function setupBlockEditing() {\n        $(document).on('click', selector.blockSettingsBtn, function(e) {\n            e.preventDefault();\n\n            var contextid = $(e.currentTarget).data('contextid');\n            var blockname = $(e.currentTarget).data('blockname');\n            var action = $(e.currentTarget).data('action');\n\n            if (action == 'edit') {\n                ModalFactory.create({\n                    title: 'Edit Block Setting',\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'get_blocksetting_form',\n                        contextid, {\n                            blockname: blockname\n                        }\n                    )\n                }).done(function(modal) {\n                    var root = modal.getRoot();\n                    modal.modal.addClass('modal-dialog-centered');\n\n                    root.on(ModalEvents.bodyRendered, function() {\n                        var form = modal.modal.find('.block-settings-form');\n                        modal.modal.find('.save-block-settings').on('click', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            // Set users preferences\n                            setBlockPreference(blockname, data);\n                        });\n                    });\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.show();\n                });\n            } else if (action == \"hide\") {\n                var hidden = $(this).data(\"hidden\");\n                var _this = $(this);\n                $.ajax({\n                    url: v.requestUrl,\n                    type: 'GET',\n                    data: {\n                        action: 'toggle_hide_block_ajax',\n                        sesskey: M.cfg.sesskey,\n                        data: JSON.stringify({\n                            'blockname': blockname,\n                            'hidden': hidden\n                        })\n                    }\n                }).done(function(response) {\n                    response = JSON.parse(response);\n                    if (response.success) {\n                        if (hidden) {\n                            _this.closest('.edwiserReport-block').removeClass('block-hidden');\n                            _this.data(\"hidden\", 0);\n                            _this.html(M.util.get_string('hide', 'local_edwiserreports'));\n                        } else {\n                            _this.closest('.edwiserReport-block').addClass('block-hidden');\n                            _this.data(\"hidden\", 1);\n                            _this.html(M.util.get_string('unhide', 'local_edwiserreports'));\n                        }\n                    }\n                });\n            } else if (action == \"editcap\") {\n                ModalFactory.create({\n                    title: 'Edit Block Capabilities',\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'get_blockscap_form',\n                        contextid, {\n                            blockname: blockname\n                        }\n                    )\n                }).done(function(modal) {\n                    var root = modal.getRoot();\n                    modal.modal.addClass('modal-dialog-centered modal-lg');\n\n                    root.on(ModalEvents.bodyRendered, function() {\n                        var form = modal.modal.find('.block-cap-form');\n                        modal.modal.find('#menucapabilities').on('change', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            Fragment.loadFragment(\n                                'local_edwiserreports',\n                                'block_overview_display',\n                                contextid, {\n                                    capvalue: data.capabilities\n                                }\n                                // eslint-disable-next-line no-unused-vars\n                            ).done(function(html, js, css) {\n                                modal.modal.find('.cap-overview').html(html);\n                                switchCapabilitiesBlock(modal);\n                            });\n                        });\n\n                        switchCapabilitiesBlock(modal);\n\n                        form = modal.modal.find('.block-cap-form');\n                        modal.modal.find('.save-block-caps').on('click', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            // Set block capabilities\n                            setBlockCapabilities(blockname, data, function() {\n                                modal.hide();\n                            });\n                        });\n                    });\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.show();\n                });\n            }\n        });\n    }\n\n    /**\n     * Switch capability block.\n     * @param {Object} modal Modal object\n     */\n    function switchCapabilitiesBlock(modal) {\n        modal.modal.find('.comparisontable .switch-capability').on('click', function(event) {\n            var permissions = $(event.currentTarget).find('input[type=radio]');\n            var current = permissions.filter(':checked');\n            var next = permissions.eq(permissions.index(current) + 1);\n            if (next.length === 0) {\n                next = permissions.eq(0);\n            }\n            next.prop('checked', true);\n\n            var perStr = next.data('strpermission');\n            var perClass = next.data('permissionclass');\n\n            $(event.currentTarget).removeClass('inherit allow prevent prohibit');\n            $(event.currentTarget).addClass(perClass);\n            $(event.currentTarget).find('label').html(perStr);\n        });\n    }\n\n    /**\n     * Set blocks capabilities\n     * @param {string} blockname\n     * @param {string} data\n     * @param {function} callback\n     */\n    function setBlockCapabilities(blockname, data, callback) {\n        data.blockname = blockname;\n        data = JSON.stringify(data);\n        var sesskey = $('#' + blockname).data('sesskey');\n\n        // Update users capability\n        $.ajax({\n            url: v.requestUrl,\n            type: 'GET',\n            data: {\n                action: 'set_block_capability_ajax',\n                sesskey: sesskey,\n                data: data\n            }\n        }).done(function(response) {\n            response = JSON.parse(response);\n            if (response.success) {\n                callback();\n                location.reload();\n            } else {\n                notif.addNotification({\n                    message: \"Error\",\n                    type: \"error\"\n                });\n            }\n        }).fail(function(error) {\n            console.log(error);\n            notif.addNotification({\n                message: error,\n                type: \"error\"\n            });\n        }).always(function() {\n            callback();\n            location.reload();\n        });\n    }\n\n    /**\n     * Set users preferences\n     * @param {string} blockname Block name\n     * @param {string} data Data for preference\n     */\n    function setBlockPreference(blockname, data) {\n        data.blockname = blockname;\n        data = JSON.stringify(data);\n        var sesskey = $('#' + blockname).data('sesskey');\n\n        // Set users preferences\n        $.ajax({\n            url: v.requestUrl,\n            type: 'GET',\n            data: {\n                action: 'set_block_preferences_ajax',\n                sesskey: sesskey,\n                data: data\n            }\n        }).fail(function(error) {\n            console.log(error);\n            notif.addNotification({\n                message: error,\n                type: \"error\"\n            });\n        }).always(function() {\n            location.reload();\n        });\n    }\n\n    /**\n     * Convert seconds to HH:MM:SS\n     * @param {Integer} seconds Seconds\n     * @returns {String}\n     */\n    function timeFormatter(seconds, opts) {\n        seconds = Number(seconds);\n        var h = Math.floor(seconds / 3600);\n        var m = Math.floor(seconds % 3600 / 60);\n        var s = Math.floor(seconds % 3600 % 60);\n\n        if (typeof opts == 'object' && opts.dataPointIndex !== undefined && opts.dataPointIndex !== -1) {\n            var time = [];\n            var short = opts.short !== undefined && opts.short;\n            if (h > 0) {\n                if (short) {\n                    time.push(h + \" \" + \"h.\");\n                } else {\n                    time.push(h + \" \" + (h == 1 ? \"hour\" : \"hours\"));\n                }\n            }\n            if (m > 0) {\n                if (short) {\n                    time.push(m + \" \" + \"min.\");\n                } else {\n                    time.push(m + \" \" + (m == 1 ? \"minute\" : \"minutes\"));\n                }\n            }\n            if (s > 0) {\n                if (short) {\n                    if (time.length === 0) {\n                        time.push(s + \" \" + \"sec.\");\n                    }\n                } else {\n                    time.push(s + \" \" + (s == 1 ? \"second\" : \"seconds\"));\n                }\n            }\n            if (time.length == 0) {\n                time.push(0);\n            }\n            return time.join(', ');\n        }\n        return [\n            h > 0 ? (h < 10 ? \"0\" + h : h) : \"00\",\n            m > 0 ? (m < 10 ? \"0\" + m : m) : \"00\",\n            s > 0 ? (s < 10 ? \"0\" + s : s) : \"00\",\n        ].join(':');\n    }\n\n    /**\n     * Render insight card.\n     * @param {String} selector DOM selector\n     * @param {Object} data     Insight data\n     */\n    function insight(selector, data) {\n        Templates.render('local_edwiserreports/insight-placeholder', {})\n            .done(function(html, js) {\n                Templates.replaceNodeContents(selector, html, js);\n                Templates.render('local_edwiserreports/insight', data)\n                    .done(function(html, js) {\n                        Templates.replaceNodeContents(selector, html, js);\n                    })\n                    .fail(function(ex) {\n                        Notification.exception(ex);\n                        $(selector).remove();\n                    });\n            });\n    }\n\n    /**\n     * Styling pagination button of data table.\n     * @param {DOM} element Table element\n     */\n    function stylePaginationButton(element) {\n        let pagination = $(element).closest(SELECTOR.TABLE).find(SELECTOR.PAGINATION);\n        pagination.find(SELECTOR.PAGINATIONITEM).addClass(v.datatableClasses.buttonSpacing);\n        pagination.find(SELECTOR.PAGINATIONITEM + ' a').addClass(v.datatableClasses.buttonSize);\n        pagination.find(SELECTOR.PAGINATIONITEM + '.active a').addClass(v.datatableClasses.buttonActive);\n        pagination.find(SELECTOR.PAGINATIONITEM + ':not(.active) a').addClass(v.datatableClasses.buttonInactive);\n    }\n\n    /**\n     * This function calls callback function when user change the date.\n     *\n     * @param {function} callback Callback function to handle date change\n     */\n    function dateChange(callback) {\n        $(document).on('edwiserreport:datechange', function(event) {\n            callback(event.detail.date);\n        });\n    }\n\n    /**\n     * Handling highlight of search input.\n     */\n    function handleSearchInput() {\n        /* Table search listener */\n        $('body').on('input', SELECTOR.SEARCHTABLE, function() {\n            $(this).toggleClass('empty', $(this).val() === '');\n        });\n    }\n\n    return {\n        loader: loader,\n        insight: insight,\n        timeFormatter: timeFormatter,\n        dateChange: dateChange,\n        stylePaginationButton: stylePaginationButton,\n        handleSearchInput: handleSearchInput\n    };\n});"],"file":"common.min.js"}