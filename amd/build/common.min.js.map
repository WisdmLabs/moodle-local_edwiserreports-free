{"version":3,"sources":["common.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","$","Notification","Fragment","ModalFactory","ModalEvents","Templates","str","v","selector","jsPDF","emailListTable","formRoot","dropdowns","dropdownSelector","durationSelector","durationInput","timesDropdown","timesDropdownBtn","timesDropdownLink","dailyDropdownBtn","weeklyDropdownBtn","monthlyDropdownBtn","timeInput","settingBtn","deleteBtn","emailListToggleSwitch","schedulerrormsg","M","util","get_string","schedulesuccessmsg","deletesuccessmsg","deleteerrormsg","emptyerrormsg","emailinvaliderrormsg","tabs","formTab","windowLoader","emailRegex","SELECTOR","TABLE","FILTER","SEARCHTABLE","PAGINATION","PAGINATIONITEM","render","loader","show","id","position","$class","undefined","append","concat","hide","remove","validateEmails","emails","duplicate","highlight","arguments","length","valid","domElement","get","duplicates","replaceAll","split","forEach","email","test","setCustomValidity","next","text","switchCapabilitiesBlock","modal","find","on","event","permissions","currentTarget","current","filter","eq","index","prop","perStr","data","perClass","removeClass","addClass","html","renderAllScheduledEmails","table","getRoot","document","window","resize","DataTable","ajax","url","requestUrl","sesskey","type","requestType","action","JSON","stringify","blockname","block","region","dom","language","info","infoEmpty","emptyTable","zeroRecords","sClass","paginate","previous","drawCallback","stylePaginationButton","this","order","columns","orderable","responsive","lengthChange","element","pagination","closest","datatableClasses","buttonSpacing","buttonSize","buttonActive","buttonInactive","prevNextSpacing","buttonsSpacing","ready","join","$this","create","title","types","body","loadFragment","warning","val","done","root","hidden","destroy","attr","click","name","recepient","subject","invalid","toggleClass","form","cohortid","response","parse","orientation","format","options","pdf","margins","top","bottom","left","width","setFontSize","fromHTML","elementHandlers","#bypassme","renderer","dispose","save","filename","Exception","always","getScheduledEmailFormContext","formData","serializeArray","each","$k","$d","value","modalTitle","includes","bodyRendered","_this","dropdownBtn","subDropdown","timeval","durationDropdownInit","error","console","log","esrDurationVal","esrTimeVal","idx","esrDuration","checkbox","trigger","subSelectedDropdpown","setEmailSheduleFormValues","fail","emailScheduleSettingInit","e","get_strings","key","component","s","confirm","proxy","errorBox","delay","fadeOut","emailScheduleDeleteInit","switchElement","errormsg","successmsg","changeScheduledEmailStatusInit","cfg","wwwroot","serialize","parseJSON","sendMailToUser","esrname","esrsubject","validateEmailScheduledForm","saveScheduleEmailInit","emailScheduleFormInit","search","draw","blockSettingsBtn","preventDefault","contextid","addNotification","message","location","reload","setBlockPreference","success","capvalue","capabilities","js","css","replaceNodeContents","callback","setBlockCapabilities","editing","editingtxt","editForm","setupBlockHiding","toPrecision","precision","insight","details","ex","exception","timeFormatter","seconds","opts","Number","h","Math","floor","m","dataPointIndex","time","_short","push","timePlainFormat","dateChange","detail","date","handleSearchInput"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/notification',\n    'core/fragment',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/str',\n    './variables',\n    './selectors',\n    './jspdf',\n    './select2',\n    './jquery.dataTables',\n    './dataTables.bootstrap4'\n], function(\n    $,\n    Notification,\n    Fragment,\n    ModalFactory,\n    ModalEvents,\n    Templates,\n    str,\n    v,\n    selector,\n    jsPDF\n) {\n    var emailListTable = null;\n    /**\n     * Email Shcedule Modal Related Psrametres start\n     */\n    // Form root\n    var formRoot = '#scheduletab';\n\n    // Dropdowns\n    var dropdowns = formRoot + ' .dropdown a.dropdown-item';\n    var dropdownSelector = 'button.dropdown-toggle';\n\n    // Duration dropdown selectors\n    var durationSelector = formRoot + ' .dropdown.duration-dropdown a.dropdown-item';\n    var durationInput = formRoot + ' input#esr-sendduration';\n\n    // Times dropdown selector\n    var timesDropdown = formRoot + ' .dropdown:not(.duration-dropdown)';\n    var timesDropdownBtn = timesDropdown + ' button.dropdown-toggle';\n    var timesDropdownLink = timesDropdown + ' a.dropdown-item';\n    var dailyDropdownBtn = formRoot + ' .dropdown.daily-dropdown button.dropdown-toggle';\n    var weeklyDropdownBtn = formRoot + ' .dropdown.weekly-dropdown button.dropdown-toggle';\n    var monthlyDropdownBtn = formRoot + ' .dropdown.monthly-dropdown button.dropdown-toggle';\n\n    var timeInput = formRoot + ' input#esr-sendtime';\n\n    // For email schedule setting\n    var settingBtn = \"#listemailstab .esr-email-sched-setting\";\n    var deleteBtn = \"#listemailstab .esr-email-sched-delete\";\n    var emailListToggleSwitch = \"#listemailstab .esr-switch\";\n\n    // Messaged for email schedule\n    var schedulerrormsg = M.util.get_string('scheduleerrormsg', 'local_edwiserreports');\n    var schedulesuccessmsg = M.util.get_string('schedulesuccessmsg', 'local_edwiserreports');\n    var deletesuccessmsg = M.util.get_string('deletesuccessmsg', 'local_edwiserreports');\n    var deleteerrormsg = M.util.get_string('deleteerrormsg', 'local_edwiserreports');\n    var emptyerrormsg = M.util.get_string('emptyerrormsg', 'local_edwiserreports');\n    var emailinvaliderrormsg = M.util.get_string('emailinvaliderrormsg', 'local_edwiserreports');\n\n    var tabs = '[data-plugin=\"tabs\"] .nav-link, [data-plugin=\"tabs\"] .tab-pane';\n    var formTab = '[aria-controls=\"scheduletab\"], #scheduletab';\n\n    var windowLoader = '<div id=\"cover-spin\"></div>';\n\n    // Regular expression for email validation.\n    var emailRegex = /^[a-zA-Z0-9]+[a-zA-Z0-9+_.-]+[a-zA-Z0-9]+@[a-zA-Z0-9]+[a-zA-Z0-9.-]*\\.[a-zA-Z]{2,}$/;\n\n    /**\n     * Selectors list.\n     */\n    let SELECTOR = {\n        TABLE: '.edwiserreports-table',\n        FILTER: '.table-filter',\n        SEARCHTABLE: '.table-search-input input',\n        PAGINATION: '.table-pagination',\n        PAGINATIONITEM: '.paginate_button'\n    };\n\n    Templates.render('local_edwiserreports/insight-placeholder', {});\n    Templates.render('local_edwiserreports/insight', {});\n\n    // Loader functions.\n    var loader = {\n        show: function(id, position) {\n            var $class;\n            if (id == undefined) {\n                id = 'body';\n                $class = 'position-fixed';\n            } else {\n                $class = 'position-absolute';\n            }\n            if (position != undefined) {\n                $class = position;\n            }\n            $(id).append(`\n            <div class=\"edwiserreports-loader ${$class}\">\n                <div class=\"animation-wrapper\">\n                    <div class=\"fa-animation\">\n                        <i class=\"fa fa-cog fa-lg fa-spin\"></i>\n                        <i class=\"fa fa-cog fa-md fa-spin spin-reverse\"></i>\n                        <i class=\"fa fa-cog fa-sm fa-spin spin-reverse\"></i>\n                    </div>\n                    ${M.util.get_string('loading', 'moodle')}\n                </div>\n            </div>\n            `);\n        },\n        hide: function(id) {\n            if (id == undefined) {\n                id = 'body';\n            }\n            $(id + ' > .edwiserreports-loader').remove();\n        }\n    };\n\n    /**\n     * Validate comma separated emails.\n     * @param {String} emails Comma separated emails\n     * @param {Boolean} highlight Highlight error if email is invalid\n     * @return {Boolean}\n     */\n    function validateEmails(emails, highlight = true) {\n        var valid = true;\n        var domElement = $('[name=\"esrrecepient\"]').get(0);\n        var duplicates = [],\n            duplicate;\n        emails.replaceAll(' ', '').replaceAll(';', ',').split(',')\n            .forEach(email => {\n                if (duplicates[email] != undefined) {\n                    duplicate = true;\n                }\n                duplicates[email] = true;\n                valid = valid && emailRegex.test(email);\n            });\n        if (duplicate) {\n            if (highlight) {\n                domElement.setCustomValidity('Invalid email');\n                $(domElement).next().text(M.util.get_string('duplicateemail', 'local_edwiserreports'));\n            }\n            return false;\n        }\n        if (!valid) {\n            if (highlight) {\n                domElement.setCustomValidity('Invalid email');\n                $(domElement).next().text(M.util.get_string('invalidemail', 'local_edwiserreports'));\n            }\n            return false;\n        }\n        if (highlight) {\n            domElement.setCustomValidity('');\n        }\n        return true;\n    }\n\n    /**\n     * Email Shcedule Modal Related Psrametres end\n     */\n\n    $(document).ready(function() {\n        var exportPdf = '.download-links button[value=\"pdf\"]';\n        var exportCsv = '.download-links button[value=\"csv\"][type=\"button\"]';\n        var exportExcel = '.download-links button[value=\"excel\"][type=\"button\"]';\n        var scheduledEmailDropdown = '.download-links button[value=\"email\"]';\n\n        // Show pro feature warning for Excel and CSV export.\n        $(document).on('click', [exportCsv, exportExcel].join(', '), function() {\n            var $this = $(this);\n            ModalFactory.create({\n                    title: '',\n                    type: ModalFactory.types.default,\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'export_data_warning',\n                        1, {\n                            warning: $this.val() == 'csv' ? 'csvprowarning' : 'excelprowarning'\n                        }\n                    ),\n                })\n                .done(function(modal) {\n                    var root = modal.getRoot();\n                    root.find('.modal-header').addClass('d-none');\n                    root.find('.modal-dialog').addClass('export-notice-modal');\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n\n                    root.on('click', '[data-action=\"download\"]', function() {\n                        // Following is my dirty hack to handle warning and downloading report using same button.\n\n                        // Change button to type submit to download report.\n                        $this.attr('type', 'submit');\n\n                        // Simulate click to start downloading report.\n                        $this.click();\n\n                        // Change button to type to button to show this warning again.\n                        $this.attr('type', 'button');\n                        modal.hide();\n                    });\n                    modal.show();\n                });\n        });\n\n        // Validating email field of schedule email form.\n        $(document).on('input', '[name=\"esrrecepient\"]', function() {\n            validateEmails($(this).val());\n        });\n\n        // Validating schedule email form fields.\n        $(document).on('input', '[name=\"esrname\"], [name=\"esrrecepient\"], [name=\"esrsubject\"]', function() {\n            var name = $('[name=\"esrname\"]').val() == \"\";\n            var recepient = !validateEmails($('[name=\"esrrecepient\"]').val(), false);\n            var subject = $('[name=\"esrsubject\"]').val() == \"\";\n            var invalid = name || recepient || subject;\n            $(this).closest('.fitem').addClass('was-validated');\n            $('.modal-footer.schedule-email').find(`[data-action=\"save\"], [data-action=\"send\"]`).prop('disabled', invalid);\n            $('#scheduletab .date-filters').toggleClass('disabled', invalid);\n        });\n\n        // Highlight invalid input.\n        $(document).on('blur', '[name=\"esrname\"], [name=\"esrrecepient\"], [name=\"esrsubject\"]', function() {\n            $(this).closest('.fitem').addClass('was-validated');\n        });\n\n        // Export data in pdf\n        $(document).on(\"click\", exportPdf, function() {\n            var _this = this;\n            var form = $(_this).closest(\"form\");\n            loader.show('body', 'position-fixed');\n            $.ajax({\n                url: form.attr('action'),\n                type: 'POST',\n                data: {\n                    'type': $(_this).val(),\n                    'block': form.find('input[name=\"block\"]').val(),\n                    'filter': form.find('input[name=\"filter\"]').val(),\n                    'cohortid': form.find('input[name=\"cohortid\"]').val(),\n                    'region': form.find('input[name=\"region\"]').val()\n                }\n            }).done(function(response) {\n                try {\n                    response = JSON.parse(response);\n                    var orientation = 'p';\n                    var format = 'a4';\n                    if (response.options != undefined) {\n                        if (response.options.orientation != undefined) {\n                            orientation = response.options.orientation;\n                        }\n                        if (response.options.format != undefined) {\n                            format = response.options.format;\n                        }\n                    }\n                    var pdf = jsPDF(orientation, 'pt', format);\n                    var margins = {\n                        top: 40,\n                        bottom: 30,\n                        left: 10,\n                        width: \"100%\"\n                    };\n\n                    pdf.setFontSize(10);\n\n                    // ID selector for either ID or node name. (\"#iAmID\", \"div\", \"span\" etc.)\n                    // There is no support for any other type of selectors\n                    // (class, of compound) at this time.\n                    var specialElementHandlers = {\n                        // Element with id of \"bypass\" - jQuery style selector\n                        // eslint-disable-next-line no-unused-vars\n                        '#bypassme': function(element, renderer) {\n                            // True = \"handled elsewhere, bypass text extraction\"\n                            return true;\n                        }\n                    };\n                    // All coords and widths are in jsPDF instance's declared units\n                    // 'inches' in this case\n                    pdf.fromHTML(\n                        response.data.html, // HTML string or DOM elem ref.\n                        margins.left, // X coord\n                        margins.top, { // Y coord\n                            'width': margins.width, // Max width of content on PDF\n                            'elementHandlers': specialElementHandlers\n                        },\n                        // eslint-disable-next-line no-unused-vars\n                        function(dispose) {\n                            // Dispose: object with X, Y of the last line add to the PDF\n                            //          this allow the insertion of new lines after html\n                            pdf.save(response.data.filename);\n                        }, margins);\n                } catch (Exception) {\n                    loader.hide('body');\n                }\n            }).always(function() {\n                loader.hide('body');\n            });\n        });\n\n        /**\n         * Schedule emails to send reports.\n         */\n        $(document).on(\"click\", scheduledEmailDropdown, function() {\n            var data = v.getScheduledEmailFormContext();\n            var form = $(this).closest('form');\n            var formData = form.serializeArray();\n            $(formData).each(function($k, $d) {\n                data[$d.name] = $d.value;\n            });\n\n            var modalTitle = M.util.get_string('scheduleemailfor', 'local_edwiserreports');\n            if (data.block.includes(\"customreportsblock\")) {\n                modalTitle += ' ' + $('#' + data.block).data('blockname');\n            } else {\n                modalTitle += ' ' + M.util.get_string(data.block + 'exportheader', 'local_edwiserreports');\n            }\n\n            ModalFactory.create({\n                    title: modalTitle,\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'email_schedule_tabs',\n                        1, {\n                            data: JSON.stringify(data)\n                        }\n                    )\n                })\n                .done(function(modal) {\n                    var root = modal.getRoot();\n                    root.find('.modal-header').addClass('border-bottom-0');\n                    root.find('.modal-title').addClass('h4 font-weight-600');\n                    modal.modal.addClass(\"modal-lg\");\n\n                    root.on(ModalEvents.bodyRendered, function() {\n                        root.find(\"#esr-blockname\").val(data.blockname);\n                        root.find(\"#esr-region\").val(data.region);\n                        root.find(\"#esr-sesskey\").val(data.sesskey);\n                        emailListTable = renderAllScheduledEmails(data, modal);\n                    });\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n\n                    emailScheduleFormInit(data, root, modal);\n                    modal.show();\n                });\n        });\n\n        // Search in table.\n        $(document).on('input', '#listemailstab .table-search-input input', function() {\n            emailListTable.search(this.value).draw();\n        });\n\n        // Show reports page when document is ready\n        $('#wdm-edwiserreports').removeClass('d-none');\n\n        setupBlockEditing();\n\n        setupBlockHiding($('#wdm-edwiserreports').data(\"editing\"));\n    });\n\n    /**\n     * Setup block hiding\n     * @param {Boolean} editing True if editing is on\n     */\n    function setupBlockHiding(editing) {\n        var editForm = '<div id=\"editing-btn\" class=\"d-flex flex-wrap\">';\n        editForm += '<div class=\"ml-auto d-flex\">';\n        var editingtxt;\n\n        // Change editing option\n        if (editing) {\n            editing = 0;\n            editingtxt = \"Stop Customising this page\";\n\n            editForm += '<div class=\"singlebutton\">';\n            editForm += '<form method=\"post\" action=\"' + M.cfg.wwwroot + '/local/edwiserreports/index.php\">';\n            editForm += '<input type=\"hidden\" name=\"reset\" value=\"1\">';\n            editForm += '<input type=\"hidden\" name=\"sesskey\" value=\"' + M.cfg.sesskey + '\">';\n            editForm += '<button type=\"submit\" class=\"btn btn-secondary\" title=\"\">Reset Page to Default</button>';\n            editForm += '</form>';\n            editForm += '</div>';\n        } else {\n            editing = 1;\n            editingtxt = \"Customise this page\";\n        }\n\n        editForm += '<div class=\"singlebutton\">';\n        editForm += '<form method=\"post\" action=\"' + M.cfg.wwwroot + '/local/edwiserreports/index.php\">';\n        editForm += '<input type=\"hidden\" name=\"edit\" value=\"' + editing + '\">';\n        editForm += '<input type=\"hidden\" name=\"sesskey\" value=\"' + M.cfg.sesskey + '\">';\n        editForm += '<button type=\"submit\" class=\"btn btn-secondary\" title=\"\">' + editingtxt + '</button>';\n        editForm += '</form>';\n        editForm += '</div>';\n\n        editForm += '</div></div>';\n\n        $(\"#page-local-edwiserreports-index #page-header .card-body\").append(editForm);\n    }\n\n    /**\n     * Setup block setting button\n     */\n    function setupBlockEditing() {\n        $(document).on('click', selector.blockSettingsBtn, function(e) {\n            e.preventDefault();\n\n            var contextid = $(e.currentTarget).data('contextid');\n            var blockname = $(e.currentTarget).data('blockname');\n            var action = $(e.currentTarget).data('action');\n\n            if (action == 'edit') {\n                ModalFactory.create({\n                    title: M.util.get_string('editblocksetting', 'local_edwiserreports'),\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'get_blocksetting_form',\n                        contextid, {\n                            blockname: blockname\n                        }\n                    )\n                }).done(function(modal) {\n                    var root = modal.getRoot();\n                    modal.modal.addClass('modal-dialog-centered');\n\n                    root.on(ModalEvents.bodyRendered, function() {\n                        var form = modal.modal.find('.block-settings-form');\n                        modal.modal.find('.save-block-settings').on('click', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            // Set users preferences\n                            setBlockPreference(blockname, data);\n                        });\n                    });\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.show();\n                });\n            } else if (action == \"hide\") {\n                var hidden = $(this).data(\"hidden\");\n                var _this = $(this);\n                $.ajax({\n                    url: v.requestUrl,\n                    type: 'GET',\n                    data: {\n                        action: 'toggle_hide_block_ajax',\n                        sesskey: M.cfg.sesskey,\n                        data: JSON.stringify({\n                            'blockname': blockname,\n                            'hidden': hidden\n                        })\n                    }\n                }).done(function(response) {\n                    response = JSON.parse(response);\n                    if (response.success) {\n                        if (hidden) {\n                            _this.closest('.edwiserReport-block').removeClass('block-hidden');\n                            _this.data(\"hidden\", 0);\n                            _this.html(M.util.get_string('hide', 'local_edwiserreports'));\n                        } else {\n                            _this.closest('.edwiserReport-block').addClass('block-hidden');\n                            _this.data(\"hidden\", 1);\n                            _this.html(M.util.get_string('unhide', 'local_edwiserreports'));\n                        }\n                    }\n                });\n            } else if (action == \"editcap\") {\n                ModalFactory.create({\n                    title: M.util.get_string('editblockcapabilities', 'local_edwiserreports'),\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'get_blockscap_form',\n                        contextid, {\n                            blockname: blockname\n                        }\n                    )\n                }).done(function(modal) {\n                    var root = modal.getRoot();\n                    modal.modal.addClass('modal-dialog-centered modal-lg');\n\n                    root.on(ModalEvents.bodyRendered, function() {\n                        var form = modal.modal.find('.block-cap-form');\n                        modal.modal.find('#menucapabilities').on('change', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            Fragment.loadFragment(\n                                'local_edwiserreports',\n                                'block_overview_display',\n                                contextid, {\n                                    capvalue: data.capabilities\n                                }\n                                // eslint-disable-next-line no-unused-vars\n                            ).done(function(html, js, css) {\n                                Templates.replaceNodeContents(modal.modal.find('.cap-overview'), html, js);\n                                switchCapabilitiesBlock(modal);\n                            });\n                        });\n\n                        switchCapabilitiesBlock(modal);\n\n                        form = modal.modal.find('.block-cap-form');\n                        modal.modal.find('.save-block-caps').on('click', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            // Set block capabilities\n                            setBlockCapabilities(blockname, data, function() {\n                                modal.hide();\n                            });\n                        });\n                    });\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.show();\n                });\n            }\n        });\n    }\n\n    /**\n     * Switch capability block.\n     * @param {Object} modal Modal object\n     */\n    function switchCapabilitiesBlock(modal) {\n        modal.modal.find('.comparisontable .switch-capability').on('click', function(event) {\n            var permissions = $(event.currentTarget).find('input[type=radio]');\n            var current = permissions.filter(':checked');\n            var next = permissions.eq(permissions.index(current) + 1);\n            if (next.length === 0) {\n                next = permissions.eq(0);\n            }\n            next.prop('checked', true);\n\n            var perStr = next.data('strpermission');\n            var perClass = next.data('permissionclass');\n\n            $(event.currentTarget).removeClass('inherit allow prevent prohibit');\n            $(event.currentTarget).addClass(perClass);\n            $(event.currentTarget).find('label').html(perStr);\n        });\n    }\n\n    /**\n     * Set blocks capabilities\n     * @param {string} blockname\n     * @param {string} data\n     * @param {function} callback\n     */\n    function setBlockCapabilities(blockname, data, callback) {\n        data.blockname = blockname;\n        data = JSON.stringify(data);\n        var sesskey = $('#' + blockname).data('sesskey');\n\n        // Update users capability\n        $.ajax({\n            url: v.requestUrl,\n            type: 'GET',\n            data: {\n                action: 'set_block_capability_ajax',\n                sesskey: sesskey,\n                data: data\n            }\n        }).done(function(response) {\n            response = JSON.parse(response);\n            if (response.success) {\n                callback();\n                location.reload();\n            } else {\n                Notification.addNotification({\n                    message: \"Error\",\n                    type: \"error\"\n                });\n            }\n        }).fail(function(error) {\n            console.log(error);\n            Notification.addNotification({\n                message: error,\n                type: \"error\"\n            });\n        }).always(function() {\n            callback();\n            location.reload();\n        });\n    }\n\n    /**\n     * Set users preferences\n     * @param {string} blockname Block name\n     * @param {string} data Data for preference\n     */\n    function setBlockPreference(blockname, data) {\n        data.blockname = blockname;\n        data = JSON.stringify(data);\n        var sesskey = $('#' + blockname).data('sesskey');\n\n        // Set users preferences\n        $.ajax({\n            url: v.requestUrl,\n            type: 'GET',\n            data: {\n                action: 'set_block_preferences_ajax',\n                sesskey: sesskey,\n                data: data\n            }\n        }).fail(function(error) {\n            console.log(error);\n            Notification.addNotification({\n                message: error,\n                type: \"error\"\n            });\n        }).always(function() {\n            location.reload();\n        });\n    }\n\n    /**\n     * Render all emails in modal\n     * @param {object} data Data for datatable\n     * @param {Object} modal Modal object\n     * @return {Object} Datatable object\n     */\n    function renderAllScheduledEmails(data, modal) {\n        var table = modal.getRoot().find(\"#esr-shceduled-emails\");\n\n        // Resize event to adjust datatable when click on the all list tab\n        // Not able to call resize when ajax completed\n        // So got the temporary solution\n        $(document).on('click', '[aria-controls=\"listemailstab\"]', function() {\n            $(window).resize();\n        });\n\n        // Create datatable\n        return table.DataTable({\n            ajax: {\n                url: v.requestUrl + '?sesskey=' + data.sesskey,\n                type: v.requestType,\n                data: {\n                    action: 'get_scheduled_emails_ajax',\n                    data: JSON.stringify({\n                        blockname: data.block,\n                        region: data.region\n                    })\n                }\n            },\n            dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n            language: {\n                info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                emptyTable: M.util.get_string('noscheduleemails', 'local_edwiserreports'),\n                zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                sClass: 'text-center',\n                paginate: {\n                    previous: M.util.get_string('previous', 'moodle'),\n                    next: M.util.get_string('next', 'moodle')\n                }\n            },\n            drawCallback: function() {\n                stylePaginationButton(this);\n            },\n            order: [\n                [2, \"asc\"]\n            ],\n            columns: [{\n                    \"data\": \"esrname\",\n                    \"orderable\": true\n                },\n                {\n                    \"data\": \"esrnextrun\",\n                    \"orderable\": true\n                },\n                {\n                    \"data\": \"esrfrequency\",\n                    \"orderable\": true\n                },\n                {\n                    \"data\": \"esrmanage\",\n                    \"orderable\": false\n                }\n            ],\n            responsive: true,\n            lengthChange: false,\n        });\n    }\n\n    /**\n     * Validate email shceduled form\n     * @param  {object} form Form object\n     * @param  {object} errorBox Box to show error\n     * @return {boolean} Return form validation status\n     */\n    function validateEmailScheduledForm(form, errorBox) {\n        var esrname = form.find('[name=\"esrname\"]').val();\n        var esrsubject = form.find('[name=\"esrsubject\"]').val();\n        var valid = true;\n        if (esrname == \"\" || esrsubject == \"\") {\n            errorBox.html(emptyerrormsg).show();\n            valid = false;\n        }\n        if (!validateEmails(form.find('[name=\"esrrecepient\"]').val())) {\n            valid = false;\n            errorBox.html(emailinvaliderrormsg).show();\n        }\n        return valid;\n    }\n\n    /**\n     * Save scheduled emails\n     * @param {Object} data Data for email\n     * @param {object} root Modal root object\n     * @param {Object} modal Modal object\n     */\n    function saveScheduleEmailInit(data, root, modal) {\n        // On save perform operation\n        root.on('click', '[data-action=\"save\"]', function() {\n            var errorBox = root.find(\".esr-form-error\");\n            errorBox.html(loader).show();\n\n            if (validateEmailScheduledForm(root.find(\"form\"), errorBox)) {\n                var filter = data.filter;\n                var cohortid = data.cohortid;\n                var block = data.block;\n                var url = M.cfg.wwwroot + \"/local/edwiserreports/download.php?type=emailscheduled&filter=\" +\n                    filter + \"&cohortid=\" + cohortid + \"&block=\" + block;\n\n                // Send ajax to save the scheduled email\n                $.ajax({\n                    url: url,\n                    type: \"POST\",\n                    data: root.find(\"form\").serialize()\n                }).done(function(response) {\n                    response = $.parseJSON(response);\n\n                    // If error then log the error\n                    if (response.error) {\n                        errorBox.html(schedulerrormsg);\n                        console.log(response.error);\n                    } else {\n                        if (emailListTable) {\n                            emailListTable.destroy();\n                        }\n                        emailListTable = renderAllScheduledEmails(data, modal);\n                        errorBox.html(schedulesuccessmsg);\n                    }\n                }).fail(function(error) {\n                    errorBox.html(schedulerrormsg);\n                    console.log(error);\n                }).always(function() {\n                    errorBox.delay(3000).fadeOut('slow');\n                });\n            }\n        });\n\n        // Reset scheduled form\n        root.on('click', '[data-action=\"cancel\"]', function() {\n            root.find('[name^=esr]:not(.d-none):not([id=\"esr-toggle-\"])').val(\"\")\n                .each(function(index, element) {\n                    $(element).trigger(\"input\");\n                });\n            root.find('#esr-id').val(-1);\n        });\n    }\n\n    /**\n     * Update dropdown button text\n     * @param  {object} _this click object\n     */\n    function updateDropdownBtnText(_this) {\n        var val = $(_this).data('value');\n        var text = $(_this).text();\n        var dropdownBtn = $(_this).closest(\".dropdown\").find(dropdownSelector);\n\n        // Set button values\n        dropdownBtn.text(text);\n        dropdownBtn.data(\"value\", val);\n    }\n\n    /**\n     * Duration dropdown init\n     * @param {object} _this click object\n     * @param {Object} root Modal root obuject\n     */\n    function durationDropdownInit(_this, root) {\n        var val = $(_this).data('value');\n\n        root.find(durationInput).val(val);\n        $(timesDropdownBtn).hide();\n\n        // Show only selected dropdown\n        var subDropdown = null;\n        switch (val) {\n            case 1: // Weekly\n                subDropdown = $(weeklyDropdownBtn);\n                break;\n            case 2: // Monthly\n                subDropdown = $(monthlyDropdownBtn);\n                break;\n            default: // Daily\n                subDropdown = $(dailyDropdownBtn);\n        }\n\n        // Show subdropdown\n        subDropdown.show();\n\n        // Set values to hidden input fieds\n        var timeval = subDropdown.data(\"value\");\n        $(timeInput).val(timeval);\n    }\n\n    /**\n     * Email schedle setting session initialization\n     * @param {object} _this click object\n     * @param {Object} root Modal root obuject\n     */\n    function emailScheduleSettingInit(_this, root) {\n        var id = $(_this).data(\"id\");\n        var blockname = $(_this).data(\"blockname\");\n        var region = $(_this).data(\"region\");\n\n        $.ajax({\n            url: v.requestUrl,\n            type: v.requestType,\n            sesskey: $(_this).data(\"sesskey\"),\n            data: {\n                action: 'get_scheduled_email_detail_ajax',\n                sesskey: $(_this).data(\"sesskey\"),\n                data: JSON.stringify({\n                    id: id,\n                    blockname: blockname,\n                    region: region\n                })\n            }\n        }).done(function(response) {\n            response = JSON.parse(response);\n            if (!response.error) {\n                setEmailSheduleFormValues(response, _this, root);\n\n                root.find(tabs).removeClass(\"active show\");\n                root.find(formTab).addClass(\"active show\");\n            } else {\n                console.log(response);\n            }\n        }).fail(function(error) {\n            console.log(error);\n        });\n    }\n\n    /**\n     * Set email shcedule values in form\n     * @param {Object} response Response object\n     * @param {object} _this click object\n     * @param {Object} root Modal root obuject\n     */\n    function setEmailSheduleFormValues(response, _this, root) {\n        var esrDurationVal = null;\n        var esrTimeVal = null;\n\n        $.each(response.data, function(idx, val) {\n            if (typeof val === 'object') {\n                // Set block value name\n                root.find(\"#esr-blockname\").val(val.blockname);\n                root.find(\"#esr-region\").val(val.region);\n            } else if (idx === \"esrduration\") {\n                var esrDuration = '[aria-labelledby=\"durationcount\"] .dropdown-item[data-value=\"' + val + '\"]';\n                esrDurationVal = val;\n                // Trigger click event\n                root.find(esrDuration).click();\n            } else if (idx === \"esrtime\") {\n                esrTimeVal = val;\n            } else if (idx === \"esremailenable\") {\n                var checkbox = $('input[name=\"' + idx + '\"]');\n                if (val) {\n                    checkbox.prop(\"checked\", true);\n                } else {\n                    checkbox.prop(\"checked\", false);\n                }\n            } else {\n                // Set values for input text.\n                $('[name=\"' + idx + '\"]').val(val);\n                if ($('input[name=\"' + idx + '\"].form-control').length) {\n                    $('input[name=\"' + idx + '\"].form-control').trigger('input');\n                }\n            }\n\n        });\n\n        // Subdropdown click event\n        var subSelectedDropdpown = '.dropdown-item[data-value=\"' + esrTimeVal + '\"]';\n\n        // Show only selected dropdown\n        var subDropdown = null;\n        switch (esrDurationVal) {\n            case \"1\": // Weekly\n                subDropdown = $(\".weekly-dropdown\");\n                break;\n            case \"2\": // Monthly\n                subDropdown = $(\".monthly-dropdown\");\n                break;\n            default: // Daily\n                subDropdown = $(\".daily-dropdown\");\n        }\n\n        // Trigger click event\n        subDropdown.find(subSelectedDropdpown).click();\n    }\n\n    /**\n     * Delete Scheduled email\n     * @param {Object} data Data for email\n     * @param {object} root Modal root object\n     * @param {Object} modal Modal object\n     */\n    function emailScheduleDeleteInit(data, root, modal) {\n        var id = data.id;\n        var blockname = data.block;\n        var region = data.region;\n        var errorBox = root.find(\".esr-form-error\");\n        errorBox.html(loader).show();\n\n        $.ajax({\n            url: v.requestUrl,\n            type: v.requestType,\n            sesskey: data.sesskey,\n            data: {\n                action: 'delete_scheduled_email_ajax',\n                sesskey: data.sesskey,\n                data: JSON.stringify({\n                    id: id,\n                    blockname: blockname,\n                    region: region\n                })\n            }\n        }).done(function(response) {\n            if (!response.error) {\n                if (emailListTable) {\n                    emailListTable.destroy();\n                }\n                emailListTable = renderAllScheduledEmails(data, modal);\n                errorBox.html(deletesuccessmsg);\n            } else {\n                errorBox.html(deleteerrormsg);\n            }\n        }).fail(function(error) {\n            errorBox.html(deleteerrormsg);\n            console.log(error);\n        }).always(function() {\n            errorBox.delay(3000).fadeOut('slow');\n        });\n    }\n\n    /* eslint-disable no-unused-vars */\n    /**\n     * Change scheduled email status\n     * @param {Object} data Data for email\n     * @param {object} root Modal root object\n     * @param {Object} modal Modal object\n     */\n    function changeScheduledEmailStatusInit(data, root, modal) {\n        /* eslint-enable no-unused-vars */\n        var id = data.id;\n        var blockname = data.block;\n        var region = data.region;\n        var sesskey = data.sesskey;\n\n        var errorBox = root.find(\".esr-form-error\");\n\n        $.ajax({\n            url: v.requestUrl,\n            type: v.requestType,\n            data: {\n                action: 'change_scheduled_email_status_ajax',\n                sesskey: sesskey,\n                data: JSON.stringify({\n                    id: id,\n                    blockname: blockname,\n                    region: region\n                })\n            }\n        }).done(function(response) {\n            let switchElement = root.find('.esr-manage-scheduled-emails .esr-switch[data-id=\"' + data.id + '\"]');\n            response = JSON.parse(response);\n            if (switchElement.attr('data-value') == \"0\") {\n                switchElement.attr('data-value', 'on');\n            } else {\n                switchElement.attr('data-value', '0');\n            }\n            if (!response.error) {\n                errorBox.html(response.successmsg);\n                errorBox.show();\n                errorBox.delay(3000).fadeOut('slow');\n            } else {\n                errorBox.html(response.errormsg);\n                errorBox.show();\n                errorBox.delay(3000).fadeOut('slow');\n            }\n        });\n    }\n\n    /**\n     * Manage schedule emails form initialization\n     * @param {Object} data Data for email\n     * @param {object} root Modal root object\n     * @param {Object} modal Modal object\n     */\n    function emailScheduleFormInit(data, root, modal) {\n        // If dropdown selected then update the button text\n        root.on('click', dropdowns, function() {\n            updateDropdownBtnText(this);\n        });\n\n        // Select duration for email schedule\n        root.on('click', durationSelector, function() {\n            durationDropdownInit(this, root);\n        });\n\n        // Select time for schedule\n        root.on('click', timesDropdownLink, function() {\n            root.find(timeInput).val($(this).data('value'));\n        });\n\n        // When setting button clicked then\n        root.on('click', settingBtn, function() {\n            emailScheduleSettingInit(this, root);\n        });\n\n        // When delete button clicked then\n        root.on('click', deleteBtn, function(e) {\n            data.id = $(this).data(\"id\");\n\n            str.get_strings([{\n                    key: 'confirmemailremovaltitle',\n                    component: 'local_edwiserreports'\n                },\n                {\n                    key: 'confirmemailremovalquestion',\n                    component: 'local_edwiserreports'\n                },\n                {\n                    key: 'yes',\n                    component: 'moodle'\n                },\n                {\n                    key: 'no',\n                    component: 'moodle'\n                }\n            ]).done(function(s) {\n                Notification.confirm(s[0], s[1], s[2], s[3], $.proxy(function() {\n                    emailScheduleDeleteInit(data, root, modal);\n                }, e.currentTarget));\n            });\n        });\n\n        // When toggle switch clicked then\n        root.on('click', emailListToggleSwitch, function() {\n            data.id = $(this).data(\"id\");\n            changeScheduledEmailStatusInit(data, root, modal);\n        });\n\n        // Send the notification immidiatly\n        root.on('click', '[data-action=\"send\"]', function() {\n            sendMailToUser(data, this, root);\n        });\n\n        // On save perform operation\n        saveScheduleEmailInit(data, root, modal);\n    }\n\n    /**\n     * Send mail to user\n     * @param {Object} data Data for email\n     * @param {object} _this anchor tag\n     * @param {object} root Modal root object\n     */\n    function sendMailToUser(data, _this, root) {\n        var filter = data.filter;\n        var cohortid = data.cohortid;\n        var block = data.block;\n        var errorBox = root.find(\".esr-form-error\");\n        errorBox.html('').show();\n        if ($(document).find('#cover-spin')) {\n            $(\"body\").append(windowLoader);\n        }\n        $(document).find('#cover-spin').show(0);\n\n        $.ajax({\n            url: M.cfg.wwwroot + \"/local/edwiserreports/download.php?type=email&filter=\" +\n                filter + \"&cohortid=\" + cohortid + \"&block=\" + block,\n            type: \"POST\",\n            data: root.find('form').serialize()\n        }).done(function(response) {\n            response = $.parseJSON(response);\n            if (response.error) {\n                errorBox.html('<div class=\"alert alert-danger\"><b>ERROR:</b>' + response.errormsg + '</div>');\n            } else {\n                errorBox.html('<div class=\"alert alert-success\"><b>Success:</b>' + response.errormsg + '</div>');\n            }\n        }).fail(function(response) {\n            errorBox.html('<div class=\"alert alert-danger\"><b>ERROR:</b>' + response.errormsg + '</div>');\n        }).always(function() {\n            errorBox.delay(3000).fadeOut('slow');\n            $(document).find('#cover-spin').hide();\n        });\n    }\n\n    /**\n     * Send plain formatted time.\n     * @param {Number} h Hours\n     * @param {Number} m Minutes\n     * @param {Number} s Seconds\n     * @returns {String}\n     */\n    function timePlainFormat(h, m, s) {\n        if (h > 0) {\n            h = h < 10 ? \"0\" + h : h;\n        } else {\n            h = \"00\";\n        }\n        if (m > 0) {\n            m = m < 10 ? \"0\" + m : m;\n        } else {\n            m = \"00\";\n        }\n        if (s > 0) {\n            s = s < 10 ? \"0\" + s : s;\n        } else {\n            s = \"00\";\n        }\n        return h + \":\" + m + \":\" + s;\n    }\n\n    /**\n     * Convert seconds to HH:MM:SS\n     * @param {Integer} seconds Seconds\n     * @param {Object} opts Options\n     * @returns {String}\n     */\n    function timeFormatter(seconds, opts) {\n        seconds = Number(seconds);\n        var h = Math.floor(seconds / 3600);\n        var m = Math.floor(seconds % 3600 / 60);\n        var s = Math.floor(seconds % 3600 % 60);\n\n        if (typeof opts == 'object' && opts.dataPointIndex !== undefined && opts.dataPointIndex !== -1) {\n            var time = [];\n            var short = opts.short !== undefined && opts.short;\n            if (h > 0) {\n                if (short) {\n                    time.push(h + \" \" + \"h.\");\n                } else {\n                    time.push(h + \" \" + (h == 1 ? M.util.get_string('hour', 'local_edwiserreports') :\n                        M.util.get_string('hours', 'local_edwiserreports')));\n                }\n            }\n            if (m > 0) {\n                if (short) {\n                    time.push(m + \" \" + \"min.\");\n                } else {\n                    time.push(m + \" \" + (m == 1 ? M.util.get_string('minute', 'local_edwiserreports') :\n                        M.util.get_string('minutes', 'local_edwiserreports')));\n                }\n            }\n            if (s > 0) {\n                if (short) {\n                    if (time.length === 0) {\n                        time.push(s + \" \" + \"sec.\");\n                    }\n                } else {\n                    time.push(s + \" \" + (s == 1 ? M.util.get_string('second', 'local_edwiserreports') :\n                        M.util.get_string('seconds', 'local_edwiserreports')));\n                }\n            }\n            if (time.length == 0) {\n                time.push(0);\n            }\n            return time.join(', ');\n        }\n        return timePlainFormat(h, m, s);\n    }\n\n    /**\n     * Render insight card.\n     * @param {String} selector DOM selector\n     * @param {Object} data     Insight data\n     */\n    function insight(selector, data) {\n        data.insight.title = M.util.get_string(data.insight.title, 'local_edwiserreports');\n        if (data.details !== undefined && data.details.data !== undefined) {\n            data.details.data.forEach(function(value, index) {\n                data.details.data[index].title = M.util.get_string(value.title, 'local_edwiserreports');\n            });\n        }\n        Templates.render('local_edwiserreports/insight-placeholder', {})\n            .done(function(html, js) {\n                Templates.replaceNodeContents(selector, html, js);\n                Templates.render('local_edwiserreports/insight', data)\n                    .done(function(html, js) {\n                        Templates.replaceNodeContents(selector, html, js);\n                    })\n                    .fail(function(ex) {\n                        Notification.exception(ex);\n                        $(selector).remove();\n                    });\n            });\n    }\n\n    /**\n     * Styling pagination button of data table.\n     * @param {DOM} element Table element\n     */\n    function stylePaginationButton(element) {\n        let pagination = $(element).closest(SELECTOR.TABLE).find(SELECTOR.PAGINATION);\n        if (pagination.find(SELECTOR.PAGINATIONITEM).length < 4) {\n            pagination.addClass('d-none');\n            return;\n        }\n        pagination.removeClass('d-none');\n        pagination.find(SELECTOR.PAGINATIONITEM).addClass(v.datatableClasses.buttonSpacing);\n        pagination.find(SELECTOR.PAGINATIONITEM + ' a').addClass(v.datatableClasses.buttonSize);\n        pagination.find(SELECTOR.PAGINATIONITEM + '.active a').addClass(v.datatableClasses.buttonActive);\n        pagination.find(SELECTOR.PAGINATIONITEM + ':not(.active) a').addClass(v.datatableClasses.buttonInactive);\n        pagination.find(SELECTOR.PAGINATIONITEM + '.previous a').addClass(v.datatableClasses.prevNextSpacing);\n        pagination.find(SELECTOR.PAGINATIONITEM + '.next a').addClass(v.datatableClasses.prevNextSpacing);\n        // Different margin.\n        pagination.find(SELECTOR.PAGINATIONITEM + '.previous').removeClass(v.datatableClasses.buttonsSpacing)\n            .addClass('mx-4');\n        pagination.find(SELECTOR.PAGINATIONITEM + '.next').removeClass(v.datatableClasses.buttonsSpacing)\n            .addClass('mx-4');\n\n    }\n\n    /**\n     * This function calls callback function when user change the date.\n     *\n     * @param {function} callback Callback function to handle date change\n     */\n    function dateChange(callback) {\n        $(document).on('edwiserreport:datechange', function(event) {\n            callback(event.detail.date);\n        });\n    }\n\n    /**\n     * Handling highlight of search input.\n     */\n    function handleSearchInput() {\n        /* Table search listener */\n        $('body').on('input', SELECTOR.SEARCHTABLE, function() {\n            $(this).toggleClass('empty', $(this).val() === '');\n        });\n    }\n    /**\n     * Apply precision to number. If number is whole then return as it is.\n     * @param {Number} value     Value to apply precision\n     * @param {Number} precision Precision to apply\n     * @returns {Number}\n     */\n    function toPrecision(value, precision) {\n        if (value % 1 === 0) {\n            return value;\n        }\n        return value.toPrecision(precision);\n    }\n\n    return {\n        loader: loader,\n        toPrecision: toPrecision,\n        insight: insight,\n        timeFormatter: timeFormatter,\n        dateChange: dateChange,\n        stylePaginationButton: stylePaginationButton,\n        handleSearchInput: handleSearchInput\n    };\n});"],"file":"common.min.js"}