"use strict";define(["jquery","core/ajax","core/templates","./chart/apexcharts","./common","./defaultconfig","./select2"],function(e,t,n,r,a,o){var s=null,i={course:0,student:0},c={chart:{type:"pie",height:350},fill:{type:"solid"},legend:{position:"bottom",offsetY:0},colors:o.getColorPalette(),noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},l={PANEL:"#gradeblock",COURSE:".course-select",STUDENT:".student-select",GRAPH:".graph",GRAPHLABEL:".graph-label",FORMFILTER:'.download-links [name="filter"]',FILTERS:".filters"},d={GET_STUDENTS:function(e){return t.call([{methodname:"local_edwiserreports_get_students_of_course",args:{courseid:e}}],!1)[0]},GET_GRAPH_DATA:function(){return e.ajax({url:o.requestUrl,type:o.requestType,dataType:o.requestDataType,data:{action:"get_grade_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({filter:i})}})}};function u(){var t;a.loader.show(l.PANEL);var n=Object.keys(i).map(function(e){return i[e]}).join("-");e(l.PANEL).find(l.FORMFILTER).val(n),d.GET_GRAPH_DATA().done(function(n){(t=Object.assign({},c)).labels=n.labels,t.series=n.grades,e(l.PANEL).find(l.GRAPHLABEL).text(n.header),a.insight("#gradeblock .insight",{insight:{value:0==n.average?0:n.average.toPrecision(2)+"%",title:M.util.get_string("averagegrade","local_edwiserreports")}}),function(e,t){null!==s&&s.destroy(),(s=new r(e.get(0),t)).render(),setTimeout(function(){a.loader.hide(l.PANEL)},1e3)}(e(l.PANEL).find(l.GRAPH),t)}),a.loader.hide(l.PANEL)}return{init:function(t){0!=e(l.PANEL).length&&(e(l.PANEL).find(".singleselect").select2(),e("body").on("change","".concat(l.PANEL," ").concat(l.COURSE),function(){courseid=parseInt(e(this).val()),i.course=courseid,i.student=0,d.GET_STUDENTS(courseid).done(function(t){e(l.PANEL).find(l.STUDENT).select2("destroy"),n.render("local_edwiserreports/studentengagement/students_filter",{students:t}).done(function(t,r){n.replaceNode(e(l.PANEL).find(l.STUDENT),t,r),e(l.PANEL).find(l.STUDENT).select2()})}),u()}),e("body").on("change","".concat(l.PANEL," ").concat(l.STUDENT),function(){i.student=parseInt(e(this).val()),u()}),u())}}});
//# sourceMappingURL=block_grade.min.js.map
