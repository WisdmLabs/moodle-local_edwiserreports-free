{"version":3,"sources":["block_courseprogress.js"],"names":["define","$","Chart","cfg","V","common","init","notifyListner","cpGraph","panel","getPanel","panelBody","selectedCourse","chart","loader","cpBlockData","form","getCourseProgressData","courseId","val","find","destroy","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","sesskey","JSON","stringify","courseid","done","response","graph","fail","error","console","log","always","labels","datasets","label","backgroundColor","ctx","options","hide","fadeIn","document","ready","getCourseProgressBlock","select2","on"],"mappings":"AAAA,aAGAA,OAAO,CAAC,SAAU,eAAgB,qCAAsC,iCAAkC,WAAY,gCAAiC,SAAUC,EAAGC,EAAOC,EAAKC,EAAGC,GAqGjL,MAAO,CACLC,KAjGF,SAAcC,GACZ,IAAIC,EAAU,KACVC,EAAQN,EAAIO,SAAS,wBACrBC,EAAYR,EAAIO,SAAS,uBAAwB,QACjDE,EAAiBD,EAAY,8BAC7BE,EAAQF,EAAY,aACpBG,EAASH,EAAY,WAErBI,GAAc,EACdC,EAAOf,EAAEQ,EAAQ,wBAyBrB,SAASQ,IACP,IAAIC,EAAWjB,EAAEW,GAAgBO,MACjCH,EAAKI,KAAK,wBAAwBD,IAAID,GAElCV,GACFA,EAAQa,UAIVhB,EAAOS,OAAOQ,KAAK,wBACnBrB,EAAEsB,KAAK,CACLC,IAAKrB,EAAIsB,WACTC,KAAMvB,EAAIwB,YACVC,SAAUzB,EAAI0B,gBACdC,KAAM,CACJC,OAAQ,qCACRC,QAAS/B,EAAEQ,GAAOqB,KAAK,WACvBA,KAAMG,KAAKC,UAAU,CACnBC,SAAUjB,OAGbkB,KAAK,SAAUC,GAChBtB,EAAYuB,MAAMR,KAAOO,EAASP,OACjCS,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WAiBZ,IAEMb,EAAAA,EAAO,CACTc,OAAQ7B,EAAYuB,MAAMM,OAC1BC,SAAU,CAAC,CACTC,MAAO/B,EAAYuB,MAAMQ,MACzBhB,KAAMf,EAAYuB,MAAMR,KACxBiB,gBAAiBhC,EAAYuB,MAAMS,mBAvBrCvC,EA2BK,IAAIN,EAAMa,EAAYiC,IAAK,CAChClB,KAAMA,EACNJ,KAAMX,EAAYuB,MAAMZ,KACxBuB,QAASlC,EAAYuB,MAAMW,UA7B3BhD,EAAEa,GAAQoC,OACVjD,EAAEY,GAAOsC,OAAO,QAGhB5C,EAAc,kBAEdF,EAAOS,OAAOoC,KAAK,0BArDvBjD,EAAEmD,UAAUC,MAAM,SAAUpD,IAC1Bc,EAAcZ,EAAImD,2BAGhBrC,IACAhB,EAAEU,EAAY,kBAAkB4C,UAChCtD,EAAEW,GAAgB4C,GAAG,SAAU,WAC7BvD,EAAEY,GAAOqC,OACTjD,EAAEa,GAAQQ,OACVL,OAIFV,EAAc","sourcesContent":["/* eslint-disable no-console */\r\ndefine([\r\n    'jquery',\r\n    'core/chartjs',\r\n    'local_edwiserreports/defaultconfig',\r\n    'local_edwiserreports/variables',\r\n    './common',\r\n    'local_edwiserreports/select2'\r\n], function($, Chart, cfg, V, common) {\r\n\r\n    /**\r\n     * Initialize\r\n     * @param {function} notifyListner Callback function\r\n     */\r\n    function init(notifyListner) {\r\n        var cpGraph = null;\r\n        var panel = cfg.getPanel(\"#courseprogressblock\");\r\n        var panelBody = cfg.getPanel(\"#courseprogressblock\", \"body\");\r\n        var selectedCourse = panelBody + \" #wdm-courseprogress-select\";\r\n        var chart = panelBody + \" .ct-chart\";\r\n        var loader = panelBody + \" .loader\";\r\n        var exportUrlLink = panel + \" .dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item\";\r\n        var cpBlockData = false;\r\n        var form = $(panel + ' form.download-links');\r\n\r\n        /**\r\n         * On document ready generate course progress block\r\n         */\r\n        $(document).ready(function($) {\r\n            cpBlockData = cfg.getCourseProgressBlock();\r\n\r\n            // If course progress block is there\r\n            if (cpBlockData) {\r\n                getCourseProgressData();\r\n                $(panelBody + ' .singleselect').select2();\r\n\r\n                $(selectedCourse).on(\"change\", function() {\r\n                    $(chart).hide();\r\n                    $(loader).show();\r\n\r\n                    getCourseProgressData();\r\n                });\r\n            } else {\r\n                /* Notify that this event is completed */\r\n                notifyListner(\"courseProgress\");\r\n            }\r\n        });\r\n\r\n        /**\r\n         * Get progress data through ajax\r\n         */\r\n        function getCourseProgressData() {\r\n            var courseId = $(selectedCourse).val();\r\n            form.find('input[name=\"filter\"]').val(courseId);\r\n\r\n            // If progress graph already exist then destroy\r\n            if (cpGraph) {\r\n                cpGraph.destroy();\r\n            }\r\n\r\n            // Show loader.\r\n            common.loader.show('#courseprogressblock');\r\n\r\n            $.ajax({\r\n                url: cfg.requestUrl,\r\n                type: cfg.requestType,\r\n                dataType: cfg.requestDataType,\r\n                data: {\r\n                    action: 'get_courseprogress_graph_data_ajax',\r\n                    sesskey: $(panel).data(\"sesskey\"),\r\n                    data: JSON.stringify({\r\n                        courseid: courseId\r\n                    })\r\n                },\r\n            })\r\n                .done(function(response) {\r\n                    cpBlockData.graph.data = response.data;\r\n                })\r\n                .fail(function(error) {\r\n                    console.log(error);\r\n                })\r\n                .always(function() {\r\n                    cpGraph = generateCourseProgressGraph();\r\n                    $(loader).hide();\r\n                    $(chart).fadeIn(\"slow\");\r\n\r\n                    /* Notify that this event is completed */\r\n                    notifyListner(\"courseProgress\");\r\n\r\n                    // Hide loader.\r\n                    common.loader.hide('#courseprogressblock');\r\n                });\r\n        }\r\n\r\n        /**\r\n         * Generate course progress graph.\r\n         * @returns {Object} chart object\r\n         */\r\n        function generateCourseProgressGraph() {\r\n            // Create configuration data for course progress block\r\n            var data = {\r\n                labels: cpBlockData.graph.labels,\r\n                datasets: [{\r\n                    label: cpBlockData.graph.label,\r\n                    data: cpBlockData.graph.data,\r\n                    backgroundColor: cpBlockData.graph.backgroundColor\r\n                }]\r\n            };\r\n\r\n            // Return chart object\r\n            return new Chart(cpBlockData.ctx, {\r\n                data: data,\r\n                type: cpBlockData.graph.type,\r\n                options: cpBlockData.graph.options\r\n            });\r\n        }\r\n    }\r\n\r\n    // Must return the init function\r\n    return {\r\n        init: init\r\n    };\r\n});\r\n"],"file":"block_courseprogress.min.js"}