{"version":3,"sources":["block_courseprogress.js"],"names":["define","$","ApexCharts","CFG","v","common","init","invalidUser","cpGraph","panel","getPanel","panelBody","selectedCourse","chart","loader","pieChart","type","data","options","responsive","legend","position","maintainAspectRatio","aspectRatio","tooltips","callbacks","title","tooltipItem","M","util","get_string","component","per","labels","index","val","datasets","label","backgroundColor","form","getCourseProgressData","courseId","find","destroy","show","ajax","url","requestUrl","requestType","dataType","requestDataType","action","secret","local_edwiserreports","JSON","stringify","courseid","done","response","error","exception","errorcode","average","toPrecision","fail","always","insight","value","pro","series","height","colors","getColorPalette","fill","offsetY","get","render","generateCourseProgressGraph","hide","fadeIn","length","select2","on"],"mappings":"AAAA,aA0BAA,OAAO,CAAC,SAAU,wCAAyC,qCAAsC,iCAAkC,WAAY,gCAAiC,SAAUC,EAAGC,EAAYC,EAAKC,EAAGC,GAuI/M,MAAO,CACLC,KAnIF,SAAcC,GACZ,IAAIC,EAAU,KACVC,EAAQN,EAAIO,SAAS,wBACrBC,EAAYR,EAAIO,SAAS,uBAAwB,QACjDE,EAAiBD,EAAY,8BAC7BE,EAAQF,EAAY,aACpBG,EAASH,EAAY,WACrBI,EAAW,CACbC,KAAM,MACNC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GACtBC,QAAS,CACPC,YAAY,EACZC,OAAQ,CACNC,SAAU,UAEZC,qBAAqB,EACrBC,YAAa,EACbC,SAAU,CACRC,UAAW,CACTC,MAAO,SAAeC,EAAaV,GACjC,MAAO,CAACW,EAAEC,KAAKC,WAAW,kBAAmB1B,EAAE2B,UAAW,CACxDC,IAAOf,EAAKgB,OAAON,EAAY,GAAGO,SAChCN,EAAEC,KAAKC,WAAW,kBAAmB1B,EAAE2B,UAAW,CACpDI,IAAOlB,EAAKmB,SAAS,GAAGnB,KAAKU,EAAY,GAAGO,WAGhDG,MAAO,WACL,MAAO,OAKfJ,OAAQ,CAAC,WAAY,YAAa,YAAa,YAAa,cAC5DK,gBAAiB,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,YAEvEC,EAAOtC,EAAEQ,EAAQ,wBAiBrB,SAAS+B,IACP,IAAIC,EAAWxC,EAAEW,GAAgBuB,MACjCI,EAAKG,KAAK,wBAAwBP,IAAIM,GAElCjC,GACFA,EAAQmC,UAIVtC,EAAOS,OAAO8B,KAAK,wBACnB3C,EAAE4C,KAAK,CACLC,IAAK3C,EAAI4C,WACT/B,KAAMb,EAAI6C,YACVC,SAAU9C,EAAI+C,gBACdjC,KAAM,CACJkC,OAAQ,qCACRC,OAAQxB,EAAEyB,qBAAqBD,OAC/BnC,KAAMqC,KAAKC,UAAU,CACnBC,SAAUf,OAGbgB,KAAK,SAAUC,IACO,IAAnBA,EAASC,OAAmD,qBAAjCD,EAASE,UAAUC,WAKlD9C,EAASE,KAAOyC,EAASzC,KACzBF,EAAS+C,QAA8B,GAApBJ,EAASI,QAAe,EAAIJ,EAASI,QAAQC,YAAY,IAL1ExD,EAAY,sBAAuBmD,KAMpCM,KAAK,SAAUL,GAEhB5C,EAAS+C,QAAU,MAClBG,OAAO,WACR5D,EAAO6D,QAAQ,gCAAiC,CAC9CA,QAAW,CACTC,MAAS,KACTzC,MAASE,EAAEC,KAAKC,WAAW,wBAAyB,yBAEtDsC,KAAO,IAET5D,EAaJ,WACE,IAAIU,EAAU,CACZmD,OAAQtD,EAASE,KACjBJ,MAAO,CACLG,KAAM,MACNsD,OAAQ,KAEVC,OAAQpE,EAAIqE,kBACZC,KAAM,CACJzD,KAAM,SAERiB,OAAQlB,EAASkB,OACjBb,OAAQ,CACNC,SAAU,SACVqD,QAAS,IAGT7D,EAAQ,IAAIX,EAAWD,EAAE,+BAA+B0E,IAAI,GAAIzD,GAGpE,OAFAL,EAAM+D,SAEC/D,EAjCKgE,GACV5E,EAAEa,GAAQgE,OACV7E,EAAEY,GAAOkE,OAAO,QAEhB1E,EAAOS,OAAOgE,KAAK,0BA3DS,GAA5B7E,EAAEW,GAAgBoE,SAItBxC,IACAvC,EAAEU,EAAY,kBAAkBsE,UAChChF,EAAEW,GAAgBsE,GAAG,SAAU,WAC7BjF,EAAEY,GAAOiE,OACT7E,EAAEa,GAAQ8B,OACVJ","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'local_edwiserreports/chart/apexcharts',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/variables',\n    './common',\n    'local_edwiserreports/select2'\n], function($, ApexCharts, CFG, v, common) {\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        var cpGraph = null;\n        var panel = CFG.getPanel(\"#courseprogressblock\");\n        var panelBody = CFG.getPanel(\"#courseprogressblock\", \"body\");\n        var selectedCourse = panelBody + \" #wdm-courseprogress-select\";\n        var chart = panelBody + \" .ct-chart\";\n        var loader = panelBody + \" .loader\";\n        var pieChart = {\n            type: \"pie\",\n            data: [0, 0, 0, 0, 0, 0],\n            options: {\n                responsive: true,\n                legend: { position: 'bottom' },\n                maintainAspectRatio: false,\n                aspectRatio: 1,\n                tooltips: {\n                    callbacks: {\n                        title: function(tooltipItem, data) {\n                            return [\n                                M.util.get_string('cpblocktooltip1',\n                                    v.component, {\n                                        \"per\": data.labels[tooltipItem[0].index],\n                                    }),\n                                M.util.get_string('cpblocktooltip2',\n                                    v.component, {\n                                        \"val\": data.datasets[0].data[tooltipItem[0].index]\n                                    })\n                            ];\n                        },\n                        label: function() {\n                            return '';\n                        }\n                    }\n                }\n            },\n            labels: [\n                '0% - 20%',\n                '21% - 40%',\n                '41% - 60%',\n                '61% - 80%',\n                '81% - 100%'\n            ],\n            backgroundColor: [\"#fe6384\", \"#36a2eb\", \"#fdce56\", \"#c70fbe\", \"#4ac0c0\", \"#ff851b\"]\n        };\n\n        var form = $(panel + ' form.download-links');\n\n        if ($(selectedCourse).length == 0) {\n            return;\n        }\n\n        getCourseProgressData();\n        $(panelBody + ' .singleselect').select2();\n\n        $(selectedCourse).on(\"change\", function() {\n            $(chart).hide();\n            $(loader).show();\n\n            getCourseProgressData();\n        });\n\n        /**\n         * Get progress data through ajax\n         */\n        function getCourseProgressData() {\n            var courseId = $(selectedCourse).val();\n            form.find('input[name=\"filter\"]').val(courseId);\n\n            // If progress graph already exist then destroy\n            if (cpGraph) {\n                cpGraph.destroy();\n            }\n\n            // Show loader.\n            common.loader.show('#courseprogressblock');\n\n            $.ajax({\n                    url: CFG.requestUrl,\n                    type: CFG.requestType,\n                    dataType: CFG.requestDataType,\n                    data: {\n                        action: 'get_courseprogress_graph_data_ajax',\n                        secret: M.local_edwiserreports.secret,\n                        data: JSON.stringify({\n                            courseid: courseId\n                        })\n                    },\n                })\n                .done(function(response) {\n                    if (response.error === true && response.exception.errorcode === 'invalidsecretkey') {\n                        invalidUser('courseprogressblock', response);\n                        return;\n                    }\n                    pieChart.data = response.data;\n                    pieChart.average = response.average == 0 ? 0 : response.average.toPrecision(2);\n                })\n                .fail(function(error) {\n                    // console.log(error);\n                    pieChart.average = '0';\n                })\n                .always(function() {\n                    common.insight('#courseprogressblock .insight', {\n                        'insight': {\n                            'value': '??',\n                            'title': M.util.get_string('averagecourseprogress', 'local_edwiserreports')\n                        },\n                        'pro': true\n                    });\n                    cpGraph = generateCourseProgressGraph();\n                    $(loader).hide();\n                    $(chart).fadeIn(\"slow\");\n\n                    // Hide loader.\n                    common.loader.hide('#courseprogressblock');\n                });\n        }\n\n        /**\n         * Generate course progress graph.\n         * @returns {Object} chart object\n         */\n        function generateCourseProgressGraph() {\n\n            var options = {\n                series: pieChart.data,\n                chart: {\n                    type: 'pie',\n                    height: 350\n                },\n                colors: CFG.getColorPalette(),\n                fill: {\n                    type: 'solid',\n                },\n                labels: pieChart.labels,\n                legend: {\n                    position: 'bottom',\n                    offsetY: 0\n                }\n            };\n\n            var chart = new ApexCharts($('#apex-chart-course-progress').get(0), options);\n            chart.render();\n\n            // Return chart object\n            return chart;\n        }\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});"],"file":"block_courseprogress.min.js"}