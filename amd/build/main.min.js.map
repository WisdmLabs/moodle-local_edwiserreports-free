{"version":3,"sources":["main.js"],"names":["define","$","ModalFactory","common","insights","siteAccess","activeCourses","activeUsers","courseProgress","inactiveUsers","realTimeUsers","todaysActivity","grade","visitsonsite","timespentonsite","timespentoncourse","courseactivitystatus","learnercourseprogress","learnertimespentonsite","SELECTOR","ROOT","DATESELECTED","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","blocks","flatpickr","validateUser","blockid","response","concat","html","exception","message","throwDateEvent","date","label","dateChangeEvent","CustomEvent","detail","document","dispatchEvent","init","ready","handleSearchInput","forEach","block","mode","altInput","altFormat","dateFormat","maxDate","appendTo","get","onOpen","addClass","dropdown","onClose","dateAlternate","removeClass","val","next","replace","includes","clear","on","this","text","data"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,qBAAsB,WAAY,aAAc,qBAAsB,wBAAyB,sBAAuB,yBAA0B,wBAAyB,wBAAyB,yBAA0B,gBAAiB,uBAAwB,0BAA2B,4BAA6B,+BAAgC,gCAAiC,kCAAmC,SAAUC,EAAGC,EAAcC,EAAQC,EAAUC,EAAYC,EAAeC,EAAaC,EAAgBC,EAAeC,EAAeC,EAAgBC,EAAOC,EAAcC,EAAiBC,EAAmBC,EAAsBC,EAAuBC,GAI1qB,IAAIC,EAAW,CACbC,KAAM,sBACNC,aAAc,mBACdC,KAAM,2BACNC,SAAU,4CACVC,SAAU,2DACVC,WAAY,+DACZC,gBAAiB,wDAMfC,EAAS,CAACtB,EAAYC,EAAeC,EAAaC,EAAgBC,EAAeC,EAAeC,EAAgBC,EAAOC,EAAcC,EAAiBC,EAAmBC,EAAsBC,EAAuBC,GAKtNU,EAAY,KAOhB,SAASC,EAAaC,EAASC,GAC7B9B,EAAE,IAAI+B,OAAOF,EAAS,iBAAiBG,KAAKF,EAASG,UAAUC,SASjE,SAASC,EAAeC,EAAMC,GAC5B,IAAIC,EAAkB,IAAIC,YAAY,2BAA4B,CAChEC,OAAQ,CACNJ,KAAMA,KAGVK,SAASC,cAAcJ,GACvBtC,EAAEkB,EAASE,cAAcY,KAAKK,GAyEhC,MAAO,CACLM,KAzCS,WACT3C,EAAEyC,UAAUG,MAAM,WAChBzC,EAASwC,OACTzC,EAAO2C,oBACPnB,EAAOoB,QAAQ,SAAUC,GACvBA,EAAMJ,KAAKf,KAEbD,EAAY3B,EAAEkB,EAASO,iBAAiBE,UAAU,CAChDqB,KAAM,QACNC,UAAU,EACVC,UAAW,QACXC,WAAY,QACZC,QAAS,QACTC,SAAUrD,EAAEkB,EAASM,YAAY8B,IAAI,GACrCC,OAAQ,WACNvD,EAAEkB,EAASI,UAAUkC,SAAS,gBAC9BxD,EAAEkB,EAASG,MAAMoC,SAAS,WAE5BC,QAAS,WA5Cf,IACMtB,EAEAuB,EA0CE3D,EAAEkB,EAASI,UAAUsC,YAAY,gBA5CnCxB,EAAOpC,EAAEkB,EAASO,iBAAiBoC,MAEnCF,EAAgB3D,EAAEkB,EAASO,iBAAiBqC,OAAOD,MAAME,QAAQ,KAAM,KAE3E/D,EAAEkB,EAASO,iBAAiBqC,OAAOD,IAAIF,GAGlCvB,EAAK4B,SAAS,OAMnBhE,EAAEkB,EAASK,UAAUqC,YAAY,UACjC5D,EAAEkB,EAASK,SAAW,WAAWiC,SAAS,UAE1CxD,EAAEkB,EAASG,MAAMW,KAAK2B,GAEtBxB,EAAeC,EAAMuB,IAVnBhC,EAAUsC,WA0CVjE,EAAE,QAAQkE,GAAG,QAAShD,EAASK,SAAW,gBAAiB,WAEzDvB,EAAEkB,EAASK,UAAUqC,YAAY,UACjC5D,EAAEmE,MAAMX,SAAS,UAEjBxD,EAAEkB,EAASG,MAAMW,KAAKhC,EAAEmE,MAAMC,QAE9BzC,EAAUsC,QAEV9B,EAAenC,EAAEmE,MAAME,KAAK,SAAUrE,EAAEmE,MAAMC","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/modal_factory',\n    './common',\n    './insights',\n    './block_siteaccess',\n    './block_activecourses',\n    './block_activeusers',\n    './block_courseprogress',\n    './block_inactiveusers',\n    './block_realtimeusers',\n    './block_todaysactivity',\n    './block_grade',\n    './block_visitsonsite',\n    './block_timespentonsite',\n    './block_timespentoncourse',\n    './block_courseactivitystatus',\n    './block_learnercourseprogress',\n    './block_learnertimespentonsite'\n], function(\n    $,\n    ModalFactory,\n    common,\n    insights,\n    siteAccess,\n    activeCourses,\n    activeUsers,\n    courseProgress,\n    inactiveUsers,\n    realTimeUsers,\n    todaysActivity,\n    grade,\n    visitsonsite,\n    timespentonsite,\n    timespentoncourse,\n    courseactivitystatus,\n    learnercourseprogress,\n    learnertimespentonsite\n) {\n\n    /**\n     * Selector list.\n     */\n    var SELECTOR = {\n        ROOT: '#wdm-edwiserreports',\n        DATESELECTED: '.selected-period',\n        DATE: '.edwiserreports-calendar',\n        DATEMENU: '.edwiserreports-calendar + .dropdown-menu',\n        DATEITEM: '.edwiserreports-calendar + .dropdown-menu .dropdown-item',\n        DATEPICKER: '.edwiserreports-calendar + .dropdown-menu .dropdown-calendar',\n        DATEPICKERINPUT: '.edwiserreports-calendar + .dropdown-menu .flatpickr'\n    };\n\n    /**\n     * Blocks list.\n     */\n    var blocks = [\n        siteAccess,\n        activeCourses,\n        activeUsers,\n        courseProgress,\n        inactiveUsers,\n        realTimeUsers,\n        todaysActivity,\n        grade,\n        visitsonsite,\n        timespentonsite,\n        timespentoncourse,\n        courseactivitystatus,\n        learnercourseprogress,\n        learnertimespentonsite\n    ];\n\n    /**\n     * Flat picker custom date.\n     */\n    let flatpickr = null;\n\n    /**\n     * This function will show validation error in block card.\n     * @param {String} blockid Block id\n     * @param {Object} response User validation response\n     */\n    function validateUser(blockid, response) {\n        $(`#${blockid} .panel-body`).html(response.exception.message);\n    }\n\n    /**\n     * Throw an event with date change data.\n     * @param {String} date  Date\n     * @param {String} label Date label\n     */\n    function throwDateEvent(date, label) {\n        let dateChangeEvent = new CustomEvent('edwiserreport:datechange', {\n            detail: {\n                date: date\n            }\n        });\n        document.dispatchEvent(dateChangeEvent);\n        $(SELECTOR.DATESELECTED).html(label);\n    }\n\n    /**\n     * After Select Custom date get active users details.\n     */\n    function customDateSelected() {\n        let date = $(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n        let dateAlternate = $(SELECTOR.DATEPICKERINPUT).next().val().replace(\"to\", \"-\"); // d M Y format\n        $(SELECTOR.DATEPICKERINPUT).next().val(dateAlternate);\n\n        /* If correct date is not selected then return false */\n        if (!date.includes(\"to\")) {\n            flatpickr.clear();\n            return;\n        }\n\n        // Set active class to custom date selector item.\n        $(SELECTOR.DATEITEM).removeClass('active');\n        $(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n        // Show custom date to dropdown button.\n        $(SELECTOR.DATE).html(dateAlternate);\n\n        // Throw date change event.\n        throwDateEvent(date, dateAlternate);\n    }\n\n    /**\n     * Init main.js\n     */\n    var init = function() {\n        $(document).ready(function() {\n\n            insights.init();\n\n            common.handleSearchInput();\n\n            blocks.forEach(block => {\n                block.init(validateUser);\n            });\n\n            flatpickr = $(SELECTOR.DATEPICKERINPUT).flatpickr({\n                mode: 'range',\n                altInput: true,\n                altFormat: \"d M Y\",\n                dateFormat: \"Y-m-d\",\n                maxDate: \"today\",\n                appendTo: $(SELECTOR.DATEPICKER).get(0),\n                onOpen: function() {\n                    $(SELECTOR.DATEMENU).addClass('withcalendar');\n                    $(SELECTOR.DATE).dropdown('update');\n                },\n                onClose: function() {\n                    $(SELECTOR.DATEMENU).removeClass('withcalendar');\n                    customDateSelected();\n                }\n            });\n\n            /* Date selector listener */\n            $('body').on('click', SELECTOR.DATEITEM + \":not(.custom)\", function() {\n                // Set custom selected item as active.\n                $(SELECTOR.DATEITEM).removeClass('active');\n                $(this).addClass('active');\n\n                // Show selected item on dropdown button.\n                $(SELECTOR.DATE).html($(this).text());\n\n                // Clear custom date.\n                flatpickr.clear();\n\n                // Throw date change event.\n                throwDateEvent($(this).data('value'), $(this).text());\n            });\n        });\n    };\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});"],"file":"main.min.js"}