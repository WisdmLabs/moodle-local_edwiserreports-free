{"version":3,"sources":["main.js"],"names":["define","$","ModalFactory","insights","Migration","siteAccess","activeCourses","activeUsers","courseProgress","inactiveUsers","realTimeUsers","todaysActivity","grade","visitsonsite","timespentonsite","timespentoncourse","courseactivitystatus","learnercourseprogress","learnertimespentonsite","SELECTOR","ROOT","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","blocks","flatpickr","validateUser","blockid","response","concat","html","exception","message","throwDateEvent","date","dateChangeEvent","CustomEvent","detail","document","dispatchEvent","init","ready","forEach","block","mode","altInput","altFormat","dateFormat","maxDate","appendTo","get","onOpen","addClass","dropdown","onClose","dateAlternate","removeClass","val","next","includes","clear","on","this","text","data","initMigration","create","type","TYPE"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,qBAAsB,aAAc,oBAAqB,qBAAsB,wBAAyB,sBAAuB,yBAA0B,wBAAyB,wBAAyB,yBAA0B,gBAAiB,uBAAwB,0BAA2B,4BAA6B,+BAAgC,gCAAiC,kCAAmC,SAAUC,EAAGC,EAAcC,EAAUC,EAAWC,EAAYC,EAAeC,EAAaC,EAAgBC,EAAeC,EAAeC,EAAgBC,EAAOC,EAAcC,EAAiBC,EAAmBC,EAAsBC,EAAuBC,GAItrB,IAAIC,EAAW,CACbC,KAAM,sBACNC,KAAM,2BACNC,SAAU,4CACVC,SAAU,2DACVC,WAAY,+DACZC,gBAAiB,wDAMfC,EAAS,CAACrB,EAAYC,EAAeC,EAAaC,EAAgBC,EAAeC,EAAeC,EAAgBC,EAAOC,EAAcC,EAAiBC,EAAmBC,EAAsBC,EAAuBC,GAKtNS,EAAY,KAOhB,SAASC,EAAaC,EAASC,GAC7B7B,EAAE,IAAI8B,OAAOF,EAAS,iBAAiBG,KAAKF,EAASG,UAAUC,SAQjE,SAASC,EAAeC,GACtB,IAAIC,EAAkB,IAAIC,YAAY,2BAA4B,CAChEC,OAAQ,CACNH,KAAMA,KAGVI,SAASC,cAAcJ,GA6EzB,MAAO,CACLK,KA9CS,WACTzC,EAAEuC,UAAUG,MAAM,WAChBxC,EAASuC,OACThB,EAAOkB,QAAQ,SAAUC,GACvBA,EAAMH,KAAKd,KAEbD,EAAY1B,EAAEkB,EAASM,iBAAiBE,UAAU,CAChDmB,KAAM,QACNC,UAAU,EACVC,UAAW,QACXC,WAAY,QACZC,QAAS,QACTC,SAAUlD,EAAEkB,EAASK,YAAY4B,IAAI,GACrCC,OAAQ,WACNpD,EAAEkB,EAASG,UAAUgC,SAAS,gBAC9BrD,EAAEkB,EAASE,MAAMkC,SAAS,WAE5BC,QAAS,WA1Cf,IACMpB,EAEAqB,EAwCExD,EAAEkB,EAASG,UAAUoC,YAAY,gBA1CnCtB,EAAOnC,EAAEkB,EAASM,iBAAiBkC,OAEnCF,EAAgBxD,EAAEkB,EAASM,iBAAiBmC,OAAOD,OAIpCE,SAAS,OAM5B5D,EAAEkB,EAASI,UAAUmC,YAAY,UACjCzD,EAAEkB,EAASI,SAAW,WAAW+B,SAAS,UAE1CrD,EAAEkB,EAASE,MAAMW,KAAKyB,GAEtBtB,EAAeC,IAVbT,EAAUmC,WAyCV7D,EAAE,QAAQ8D,GAAG,QAAS5C,EAASI,SAAW,gBAAiB,WAEzDtB,EAAEkB,EAASI,UAAUmC,YAAY,UACjCzD,EAAE+D,MAAMV,SAAS,UAEjBrD,EAAEkB,EAASE,MAAMW,KAAK/B,EAAE+D,MAAMC,QAE9BtC,EAAUmC,QAEV3B,EAAelC,EAAE+D,MAAME,KAAK,eAchCC,cATF,WACEjE,EAAakE,OAAO,CAClBC,KAAMjE,EAAUkE,MACfrE,EAAE","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/modal_factory',\n    './insights',\n    './modal-migration',\n    './block_siteaccess',\n    './block_activecourses',\n    './block_activeusers',\n    './block_courseprogress',\n    './block_inactiveusers',\n    './block_realtimeusers',\n    './block_todaysactivity',\n    './block_grade',\n    './block_visitsonsite',\n    './block_timespentonsite',\n    './block_timespentoncourse',\n    './block_courseactivitystatus',\n    './block_learnercourseprogress',\n    './block_learnertimespentonsite'\n], function(\n    $,\n    ModalFactory,\n    insights,\n    Migration,\n    siteAccess,\n    activeCourses,\n    activeUsers,\n    courseProgress,\n    inactiveUsers,\n    realTimeUsers,\n    todaysActivity,\n    grade,\n    visitsonsite,\n    timespentonsite,\n    timespentoncourse,\n    courseactivitystatus,\n    learnercourseprogress,\n    learnertimespentonsite\n) {\n\n    /**\n     * Selector list.\n     */\n    var SELECTOR = {\n        ROOT: '#wdm-edwiserreports',\n        DATE: '.edwiserreports-calendar',\n        DATEMENU: '.edwiserreports-calendar + .dropdown-menu',\n        DATEITEM: '.edwiserreports-calendar + .dropdown-menu .dropdown-item',\n        DATEPICKER: '.edwiserreports-calendar + .dropdown-menu .dropdown-calendar',\n        DATEPICKERINPUT: '.edwiserreports-calendar + .dropdown-menu .flatpickr'\n    };\n\n    /**\n     * Blocks list.\n     */\n    var blocks = [\n        siteAccess,\n        activeCourses,\n        activeUsers,\n        courseProgress,\n        inactiveUsers,\n        realTimeUsers,\n        todaysActivity,\n        grade,\n        visitsonsite,\n        timespentonsite,\n        timespentoncourse,\n        courseactivitystatus,\n        learnercourseprogress,\n        learnertimespentonsite\n    ];\n\n    /**\n     * Flat picker custom date.\n     */\n    let flatpickr = null;\n\n    /**\n     * This function will show validation error in block card.\n     * @param {String} blockid Block id\n     * @param {Object} response User validation response\n     */\n    function validateUser(blockid, response) {\n        $(`#${blockid} .panel-body`).html(response.exception.message);\n    }\n\n    /**\n     * Throw an event with date change data.\n     * @param {String} date Date\n     */\n    function throwDateEvent(date) {\n        let dateChangeEvent = new CustomEvent('edwiserreport:datechange', {\n            detail: {\n                date: date\n            }\n        });\n        document.dispatchEvent(dateChangeEvent);\n    }\n\n    /**\n     * After Select Custom date get active users details.\n     */\n    function customDateSelected() {\n        let date = $(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n        let dateAlternate = $(SELECTOR.DATEPICKERINPUT).next().val(); // d/m/Y format\n\n        /* If correct date is not selected then return false */\n        if (!dateAlternate.includes(\"to\")) {\n            flatpickr.clear();\n            return;\n        }\n\n        // Set active class to custom date selector item.\n        $(SELECTOR.DATEITEM).removeClass('active');\n        $(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n        // Show custom date to dropdown button.\n        $(SELECTOR.DATE).html(dateAlternate);\n\n        // Throw date change event.\n        throwDateEvent(date);\n    }\n\n    /**\n     * Init main.js\n     */\n    var init = function() {\n        $(document).ready(function() {\n\n            insights.init();\n\n            blocks.forEach(block => {\n                block.init(validateUser);\n            });\n\n            flatpickr = $(SELECTOR.DATEPICKERINPUT).flatpickr({\n                mode: 'range',\n                altInput: true,\n                altFormat: \"d/m/Y\",\n                dateFormat: \"Y-m-d\",\n                maxDate: \"today\",\n                appendTo: $(SELECTOR.DATEPICKER).get(0),\n                onOpen: function() {\n                    $(SELECTOR.DATEMENU).addClass('withcalendar');\n                    $(SELECTOR.DATE).dropdown('update');\n                },\n                onClose: function() {\n                    $(SELECTOR.DATEMENU).removeClass('withcalendar');\n                    customDateSelected();\n                }\n            });\n\n            /* Date selector listener */\n            $('body').on('click', SELECTOR.DATEITEM + \":not(.custom)\", function() {\n                // Set custom selected item as active.\n                $(SELECTOR.DATEITEM).removeClass('active');\n                $(this).addClass('active');\n\n                // Show selected item on dropdown button.\n                $(SELECTOR.DATE).html($(this).text());\n\n                // Clear custom date.\n                flatpickr.clear();\n\n                // Throw date change event.\n                throwDateEvent($(this).data('value'));\n            });\n        });\n    };\n\n    function initMigration() {\n        ModalFactory.create({\n            type: Migration.TYPE\n        }, $('#create'));\n    }\n\n    // Must return the init function\n    return {\n        init: init,\n        initMigration: initMigration\n    };\n});"],"file":"main.min.js"}