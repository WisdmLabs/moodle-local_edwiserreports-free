"use strict";define(["jquery","./chart/apexcharts","core/notification","./defaultconfig","./common","./flatpickr"],function(e,a,t,r,s){var o=null,i=null,n=r.getPanel("#activeusersblock","body"),l=r.getPanel("#activeusersblock","footer"),c=n+" .ct-chart",d=n+" .loader",p=n+" .refresh",h="last7days",f=null,g={series:[],chart:{type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0},custom:function(e){e.series,e.seriesIndex;for(var a=e.dataPointIndex,t=e.w,r='\n                <div class="apexcharts-tooltip-title" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;">\n                    '.concat(s.formatDate(new Date(t.config.xaxis.categories[a]),"d MMM yyyy"),"\n                </div>"),o=0;o<t.config.series.length;o++){0!=t.config.series[o].data.length&&(r+='<div class="apexcharts-tooltip-series-group apexcharts-active" style="order: '.concat(o,'; display: flex;">\n                        <span class="apexcharts-tooltip-marker" style="background-color: ').concat(t.config.colors[o],';"></span>\n                        <div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;">\n                            <div class="apexcharts-tooltip-y-group">\n                                <span class="apexcharts-tooltip-text-y-label">').concat(t.config.series[o].name,': </span>\n                                <span class="apexcharts-tooltip-text-y-value">').concat(t.config.series[o].data[a],"</span>\n                            </div>\n                        </div>\n                    </div>"))}return r+'\n                    <span style="color: black; font-size: 0.871rem; order: 4; padding: 0px 15px;">'.concat(M.util.get_string("clickondatapoint","local_edwiserreports"),"</span>\n                ")}},stroke:{curve:"smooth",width:2,lineCap:"round"},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},yaxis:{labels:{formatter:function(e,a){return void 0===e?e:e.toFixed(0)}}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},colors:r.getColorTheme(),dataLabels:{enabled:!1}};return{init:function(u){function m(){e(c).hide(),e(d).show(),s.loader.show("#activeusersblock"),e.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_activeusers_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({precalculated:-1!==["weekly","monthly","yearly"].indexOf(h),filter:h,graphajax:!0})}}).done(function(e){!0!==e.error||"invalidsecretkey"!==e.exception.errorcode?(o.graph.data=e.data,o.graph.labels=e.dates.map(function(e){return 864e5*e}),s.insight("#activeusersblock .insight",e.insight)):u("activeusersblock",e)}).fail(function(e){t.exception(e)}).always(function(){i&&i.destroy(),(i=new a(e("#apex-chart-active-users").get(0),function(){var e=Object.assign({},g);try{e.series=[{name:o.graph.labelName.activeUsers,data:o.graph.data.activeUsers},{name:o.graph.labelName.enrolments,data:o.graph.data.enrolments},{name:o.graph.labelName.completionRate,data:o.graph.data.completionRate}],e.xaxis.categories=o.graph.labels,e.chart.toolbar.show=o.graph.labels.length>30,e.chart.zoom.enabled=o.graph.labels.length>30}catch(a){e.series=[],e.xaxis.categories=[],e.chart.toolbar.show=!1,e.chart.zoom.enabled=!1}return e}())).render(),i=i,e(l).find('.download-links input[name="filter"]').val(h),e(n+" #updated-time > span.minute").html(0),clearInterval(f),f=setInterval(y,6e4),e(p).removeClass("refresh-spin"),e(d).hide(),e(c).fadeIn("slow"),s.loader.hide("#activeusersblock")})}function y(){e(n+" #updated-time > span.minute").html(parseInt(e(n+" #updated-time > span.minute").text())+1)}(o=r.getActiveUsersBlock())&&(e(p).on("click",function(){e(this).addClass("refresh-spin"),m()}),s.dateChange(function(a){h=a,e("#activeusersblock").find('.download-links [name="filter"]').val(h),m()}),m())}}});
//# sourceMappingURL=block_activeusers.min.js.map
