"use strict";define(["jquery","./chart/apexcharts","core/notification","./defaultconfig","./common","./flatpickr"],function(e,a,t,s,r){var i=null,o=null,l=s.getPanel("#activeusersblock","body"),n=s.getPanel("#activeusersblock","footer"),c=l+" .ct-chart",d=l+" .loader",p=l+" .refresh",h="last7days",f=null;const g={series:[],chart:{type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0},custom:function(e){let{series:a,seriesIndex:t,dataPointIndex:s,w:i}=e,o=`\n                <div class="apexcharts-tooltip-title" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;">\n                    ${r.formatDate(new Date(i.config.xaxis.categories[s]),"d MMM yyyy")}\n                </div>`;for(let e=0;e<i.config.series.length;e++){0!=i.config.series[e].data.length&&(o+=`<div class="apexcharts-tooltip-series-group apexcharts-active" style="order: ${e}; display: flex;">\n                        <span class="apexcharts-tooltip-marker" style="background-color: ${i.config.colors[e]};"></span>\n                        <div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;">\n                            <div class="apexcharts-tooltip-y-group">\n                                <span class="apexcharts-tooltip-text-y-label">${i.config.series[e].name}: </span>\n                                <span class="apexcharts-tooltip-text-y-value">${i.config.series[e].data[s]}</span>\n                            </div>\n                        </div>\n                    </div>`)}return o+`\n                    <span style="color: black; font-size: 0.871rem; order: 4; padding: 0px 15px;">${M.util.get_string("clickondatapoint","local_edwiserreports")}</span>\n                `}},stroke:{curve:"smooth",width:2,lineCap:"round"},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},yaxis:{labels:{formatter:function(e,a){return void 0===e?e:e.toFixed(0)}}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},colors:s.getColorTheme(),dataLabels:{enabled:!1}};return{init:function(u){function m(){e(c).hide(),e(d).show(),r.loader.show("#activeusersblock"),e.ajax({url:s.requestUrl,type:s.requestType,dataType:s.requestDataType,data:{action:"get_activeusers_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({precalculated:-1!==["weekly","monthly","yearly"].indexOf(h),filter:h,graphajax:!0})}}).done(function(e){!0!==e.error||"invalidsecretkey"!==e.exception.errorcode?(i.graph.data=e.data,i.graph.labels=e.dates.map(e=>864e5*e),r.insight("#activeusersblock .insight",e.insight)):u("activeusersblock",e)}).fail(function(e){t.exception(e)}).always(function(){o&&o.destroy(),(o=new a(e("#apex-chart-active-users").get(0),function(){let e=Object.assign({},g);try{e.series=[{name:i.graph.labelName.activeUsers,data:i.graph.data.activeUsers},{name:i.graph.labelName.enrolments,data:i.graph.data.enrolments},{name:i.graph.labelName.completionRate,data:i.graph.data.completionRate}],e.xaxis.categories=i.graph.labels,e.chart.toolbar.show=i.graph.labels.length>30,e.chart.zoom.enabled=i.graph.labels.length>30}catch(a){e.series=[],e.xaxis.categories=[],e.chart.toolbar.show=!1,e.chart.zoom.enabled=!1}return e}())).render(),o=o,e(n).find('.download-links input[name="filter"]').val(h),e(l+" #updated-time > span.minute").html(0),clearInterval(f),f=setInterval(y,6e4),e(p).removeClass("refresh-spin"),e(d).hide(),e(c).fadeIn("slow"),r.loader.hide("#activeusersblock")})}function y(){e(l+" #updated-time > span.minute").html(parseInt(e(l+" #updated-time > span.minute").text())+1)}(i=s.getActiveUsersBlock())&&(e(p).on("click",function(){e(this).addClass("refresh-spin"),m()}),r.dateChange(function(a){h=a,e("#activeusersblock").find('.download-links [name="filter"]').val(h),m()}),m())}}});
//# sourceMappingURL=block_activeusers.min.js.map
