"use strict";define(["jquery","./chart/apexcharts","core/notification","./defaultconfig","./common","./flatpickr"],function(e,a,t,r,o){var i=null,l=null,s=r.getPanel("#activeusersblock","body"),n=r.getPanel("#activeusersblock","footer"),d=s+" .ct-chart",c=s+" .loader",h=s+" .refresh",p="last7days",u=null,f={series:[],chart:{type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},stroke:{curve:"smooth",width:2,lineCap:"round"},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},yaxis:{labels:{formatter:function(e,a){return void 0===e?e:e.toFixed(0)}}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},colors:r.getColorTheme(),dataLabels:{enabled:!1}};return{init:function(g){function m(){e(d).hide(),e(c).show(),o.loader.show("#activeusersblock"),e.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_activeusers_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({precalculated:-1!==["weekly","monthly","yearly"].indexOf(p),filter:p,graphajax:!0})}}).done(function(e){!0!==e.error||"invalidsecretkey"!==e.exception.errorcode?(i.graph.data=e.data,i.graph.labels=e.dates.map(function(e){return 864e5*e}),o.insight("#activeusersblock .insight",e.insight)):g("activeusersblock",e)}).fail(function(e){t.exception(e)}).always(function(){l&&l.destroy(),(l=new a(e("#apex-chart-active-users").get(0),function(){var e=Object.assign({},f);try{e.series=[{name:i.graph.labelName.activeUsers,data:i.graph.data.activeUsers},{name:i.graph.labelName.enrolments,data:i.graph.data.enrolments},{name:i.graph.labelName.completionRate,data:i.graph.data.completionRate}],e.xaxis.categories=i.graph.labels,e.chart.toolbar.show=i.graph.labels.length>30,e.chart.zoom.enabled=i.graph.labels.length>30}catch(a){e.series=[],e.xaxis.categories=[],e.chart.toolbar.show=!1,e.chart.zoom.enabled=!1}return e}())).render(),l=l,e(n).find('.download-links input[name="filter"]').val(p),e(s+" #updated-time > span.minute").html(0),clearInterval(u),u=setInterval(b,6e4),e(h).removeClass("refresh-spin"),e(c).hide(),e(d).fadeIn("slow"),o.loader.hide("#activeusersblock")})}function b(){e(s+" #updated-time > span.minute").html(parseInt(e(s+" #updated-time > span.minute").text())+1)}(i=r.getActiveUsersBlock())&&(e(h).on("click",function(){e(this).addClass("refresh-spin"),m()}),o.dateChange(function(a){p=a,e("#activeusersblock").find('.download-links [name="filter"]').val(p),m()}),m())}}});
//# sourceMappingURL=block_activeusers.min.js.map
