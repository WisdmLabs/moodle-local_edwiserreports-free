{"version":3,"sources":["block_timespentoncourse.js"],"names":["define","$","Notification","ApexCharts","common","CFG","SELECTOR","PANEL","INSIGHT","GRAPH","PROMISE","GET_TIMESPENTONCOURSE","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","attr","chart","barChartDefault","series","height","toolbar","show","tools","download","selection","zoom","zoomin","zoomout","pan","reset","tooltip","enabled","enabledOnSeries","undefined","shared","followCursor","intersect","inverseOrder","fillSeriesColor","onDatasetHover","highlightDataSeries","y","formatter","title","marker","items","display","fixed","position","offsetX","offsetY","plotOptions","bar","columnWidth","grid","borderColor","dataLabels","xaxis","categories","labels","hideOverlappingLabels","trim","tickPlacement","legend","horizontalAlign","itemMargin","horizontal","vertical","colors","getColorTheme","noData","text","util","get_string","loadGraph","invalidUser","loader","done","response","Object","assign","name","timespent","yaxis","timeFormatter","length","insight","value","dataPointIndex","short","replaceAll","details","graph","destroy","get","render","setTimeout","hide","renderGraph","find","fail","exception","init","select2"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Block service call and rendering defined in this file.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\n/* eslint-disable no-unused-vars */\ndefine([\n    'jquery',\n    'core/notification',\n    './chart/apexcharts',\n    './common',\n    './defaultconfig'\n], function(\n    $,\n    Notification,\n    ApexCharts,\n    common,\n    CFG\n) {\n\n    /**\n     * DOM element selectors list.\n     */\n    let SELECTOR = {\n        PANEL: '#timespentoncourseblock',\n        INSIGHT: '#timespentoncourseblock .insight',\n        GRAPH: '#apex-chart-timespentoncourse-block',\n    };\n\n    let PROMISE = {\n        /**\n         * Get timespent on course\n         * @returns {PROMISE}\n         */\n        GET_TIMESPENTONCOURSE: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_timespentoncourse_graph_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang')\n                },\n            });\n        }\n    };\n\n    /**\n     * Chart object.\n     */\n    let chart = null;\n\n    /**\n     * Bar chart default config.\n     */\n    const barChartDefault = {\n        series: [],\n        chart: {\n            type: 'bar',\n            height: 350,\n            toolbar: {\n                show: true,\n                tools: {\n                    download: false,\n                    selection: true,\n                    zoom: true,\n                    zoomin: true,\n                    zoomout: true,\n                    pan: true,\n                    reset: '<i class=\"fa fa-refresh\"></i>'\n                }\n            },\n        },\n        tooltip: {\n            enabled: true,\n            enabledOnSeries: undefined,\n            shared: true,\n            followCursor: false,\n            intersect: false,\n            inverseOrder: false,\n            fillSeriesColor: false,\n            onDatasetHover: {\n                highlightDataSeries: false,\n            },\n            y: {\n                formatter: undefined,\n                title: {},\n            },\n            marker: {\n                show: true\n            },\n            items: {\n                display: 'flex'\n            },\n            fixed: {\n                enabled: false,\n                position: 'topRight',\n                offsetX: 0,\n                offsetY: 0,\n            },\n        },\n        plotOptions: {\n            bar: {\n                columnWidth: '50%'\n            }\n        },\n        grid: {\n            borderColor: '#e7e7e7'\n        },\n        dataLabels: {\n            enabled: false\n        },\n        xaxis: {\n            categories: null,\n            labels: {\n                hideOverlappingLabels: true,\n                trim: true\n            },\n            tickPlacement: 'on'\n        },\n        legend: {\n            position: 'top',\n            horizontalAlign: 'left',\n            offsetY: '-20',\n            itemMargin: {\n                horizontal: 10,\n                vertical: 0\n            },\n        },\n        colors: [CFG.getColorTheme()[2]],\n        noData: {\n            text: M.util.get_string('nographdata', 'local_edwiserreports')\n        }\n    };\n\n    /**\n     * Load graph\n     * @param {function} invalidUser Function to be called when user is invalid\n     */\n    function loadGraph(invalidUser) {\n        common.loader.show(SELECTOR.PANEL);\n\n        /**\n         * Render graph.\n         * @param {DOM} graph Graph element\n         * @param {Object} data Graph data\n         */\n        function renderGraph(graph, data) {\n            if (chart !== null) {\n                chart.destroy();\n            }\n            chart = new ApexCharts(graph.get(0), data);\n            chart.render();\n            setTimeout(function() {\n                common.loader.hide(SELECTOR.PANEL);\n            }, 1000);\n        }\n\n        PROMISE.GET_TIMESPENTONCOURSE()\n            .done(function(response) {\n                let data = Object.assign({}, barChartDefault);\n\n                data.series = [{\n                    name: M.util.get_string('timespentoncourse', 'local_edwiserreports'),\n                    data: response.timespent,\n                }];\n                data.xaxis.categories = response.labels;\n                data.yaxis = {\n                    labels: {\n                        formatter: common.timeFormatter\n                    }\n                };\n                data.chart.toolbar.show = response.labels.length > 30;\n                data.chart.zoom = {\n                    enabled: response.labels.length > 30\n                };\n                data.tooltip.y.title.formatter = () => {\n                    return M.util.get_string('time', 'local_edwiserreports') + ': ';\n                };\n                response.insight.insight.value = common.timeFormatter(response.insight.insight.value, {\n                    dataPointIndex: 0,\n                    'short': true\n                }).replaceAll(',', ' ');\n                response.insight.details.data[0].value = common.timeFormatter(response.insight.details.data[0].value, {\n                    dataPointIndex: 0\n                });\n                common.insight(SELECTOR.INSIGHT, response.insight);\n                renderGraph($(SELECTOR.PANEL).find(SELECTOR.GRAPH), data);\n            }).fail(function(exception) {\n                Notification.exception(exception);\n                common.loader.hide(SELECTOR.PANEL);\n            });\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n\n        if (!$(SELECTOR.PANEL).length) {\n            return;\n        }\n\n        $(SELECTOR.PANEL).find('.singleselect').select2();\n\n        loadGraph(invalidUser);\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"block_timespentoncourse.min.js"}