{"version":3,"sources":["block_lpstats.js"],"names":["define","$","Chart","cfg","V","init","lpChart","panel","getPanel","panelBody","selectedLp","exportUrlLink","chart","loader","lpStatsBlock","getLpStatsData","lpId","ajax","url","requestUrl","type","requestType","dataType","requestDataType","sesskey","data","action","JSON","stringify","lpid","done","response","responsedata","graph","labels","datasets","backgroundColor","ctx","options","generateLpChart","fail","error","console","log","always","addClass","removeClass","document","ready","val","getLpStatsBlock","select2","on","this","changeExportUrl","filterReplaceFlag","destroy"],"mappings":"AAAA,aA0BAA,OAAO,CAAC,SAAU,eAAgB,qCAAsC,iCAAkC,gCAAiC,SAAUC,EAAGC,EAAOC,EAAKC,GAqFlK,MAAO,CACLC,KAjFF,WACE,IAAIC,EAAU,KACVC,EAAQJ,EAAIK,SAAS,iBACrBC,EAAYN,EAAIK,SAAS,gBAAiB,QAC1CE,EAAaD,EAAY,uBACzBE,EAAgBJ,EAAQ,oEACxBK,EAAQH,EAAY,aACpBI,EAASJ,EAAY,WACrBK,GAAe,EAuBnB,SAASC,EAAeC,GACtBf,EAAEgB,KAAK,CACLC,IAAKf,EAAIgB,WACTC,KAAMjB,EAAIkB,YACVC,SAAUnB,EAAIoB,gBACdC,QAASvB,EAAEM,GAAOkB,KAAK,WACvBA,KAAM,CACJC,OAAQ,wBACRF,QAASvB,EAAEM,GAAOkB,KAAK,WACvBA,KAAME,KAAKC,UAAU,CACnBC,KAAMb,OAGTc,KAAK,SAAUC,IAepB,SAAyBC,GACvB,GAAIlB,EAAc,CAChBA,EAAamB,MAAMC,OAASF,EAAaE,OACzCpB,EAAamB,MAAMR,KAAOO,EAAaP,KACvC,IAAIA,EAAO,CACTS,OAAQpB,EAAamB,MAAMC,OAC3BC,SAAU,CAAC,CACTV,KAAMX,EAAamB,MAAMR,KACzBW,gBAAiBtB,EAAamB,MAAMG,mBAGxC9B,EAAU,IAAIJ,EAAMY,EAAauB,IAAK,CACpCZ,KAAMA,EACNL,KAAMN,EAAamB,MAAMb,KACzBkB,QAASxB,EAAamB,MAAMK,WA5B9BC,CAAgBR,EAASN,QACxBe,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WACR3C,EAAEY,GAAQgC,SAAS,UACnB5C,EAAEW,GAAOkC,YAAY,YAzCzB7C,EAAE8C,UAAUC,MAAM,WAChB,IAAIhC,EAAOf,EAAES,GAAYuC,OACzBnC,EAAeX,EAAI+C,qBAGjBnC,EAAeC,GACff,EAAEQ,EAAY,kBAAkB0C,UAChClD,EAAES,GAAY0C,GAAG,SAAU,WACzBpC,EAAOf,EAAEoD,MAAMJ,MACfhD,EAAEW,GAAOiC,SAAS,UAClB5C,EAAEY,GAAQiC,YAAY,UACtB3C,EAAImD,gBAAgBtC,EAAML,EAAeP,EAAEmD,mBAC3CjD,EAAQkD,UACRzC,EAAeC","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/chartjs',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/variables',\n    'local_edwiserreports/select2'\n], function($, Chart, cfg, V) {\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init() {\n        var lpChart = null;\n        var panel = cfg.getPanel(\"#lpstatsblock\");\n        var panelBody = cfg.getPanel(\"#lpstatsblock\", \"body\");\n        var selectedLp = panelBody + \" #wdm-lpstats-select\";\n        var exportUrlLink = panel + \" .dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item\";\n        var chart = panelBody + \" .ct-chart\";\n        var loader = panelBody + \" .loader\";\n        var lpStatsBlock = false;\n\n        $(document).ready(function() {\n            var lpId = $(selectedLp).val();\n            lpStatsBlock = cfg.getLpStatsBlock();\n\n            if (lpStatsBlock) {\n                getLpStatsData(lpId);\n                $(panelBody + ' .singleselect').select2();\n\n                $(selectedLp).on(\"change\", function() {\n                    lpId = $(this).val();\n                    $(chart).addClass(\"d-none\");\n                    $(loader).removeClass(\"d-none\");\n                    cfg.changeExportUrl(lpId, exportUrlLink, V.filterReplaceFlag);\n                    lpChart.destroy();\n                    getLpStatsData(lpId);\n                });\n            }\n        });\n\n        /**\n         * Get learning plan stats\n         * @param {Integer} lpId Learning plan id\n         */\n        function getLpStatsData(lpId) {\n            $.ajax({\n                url: cfg.requestUrl,\n                type: cfg.requestType,\n                dataType: cfg.requestDataType,\n                sesskey: $(panel).data(\"sesskey\"),\n                data: {\n                    action: 'get_lpstats_data_ajax',\n                    sesskey: $(panel).data(\"sesskey\"),\n                    data: JSON.stringify({\n                        lpid: lpId\n                    })\n                },\n            })\n            .done(function(response) {\n                generateLpChart(response.data);\n            })\n            .fail(function(error) {\n                console.log(error);\n            })\n            .always(function() {\n                $(loader).addClass(\"d-none\");\n                $(chart).removeClass(\"d-none\");\n            });\n        }\n\n        /**\n         * Generate learning plan chart.\n         * @param {Object} responsedata Generate chart response data.\n         */\n        function generateLpChart(responsedata) {\n            if (lpStatsBlock) {\n                lpStatsBlock.graph.labels = responsedata.labels;\n                lpStatsBlock.graph.data = responsedata.data;\n\n                var data = {\n                    labels: lpStatsBlock.graph.labels,\n                    datasets: [{\n                        data: lpStatsBlock.graph.data,\n                        backgroundColor: lpStatsBlock.graph.backgroundColor,\n                    }]\n                };\n\n                lpChart = new Chart(lpStatsBlock.ctx, {\n                    data: data,\n                    type: lpStatsBlock.graph.type,\n                    options: lpStatsBlock.graph.options\n                });\n            }\n        }\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"block_lpstats.min.js"}