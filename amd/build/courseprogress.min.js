/**
 * Plugin administration pages are defined here.
 *
 * @copyright   2021 wisdmlabs <support@wisdmlabs.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/ define(["jquery","core/modal_factory","core/modal_events","core/fragment","./variables","./common","./jquery.dataTables","./dataTables.bootstrap4","./select2"],function(e,t,a,r,o,s){var l={PANEL:"#wdm-courseprogress-individual",COHORT:".cohort-select",COURSE:".course-select",GROUP:".group-select",STUDENT:".student-select",GRAPH:".graph",GRAPHLABEL:".graph-label",FORMFILTER:'.download-links [name="filter"]',FILTERS:".filters"};let i="rtl"==e("html").attr("dir")?1:0;return{init:function n(d){var c="#wdm-courseprogress-individual",u=c+" .table",p=c+" .loader",g=u+" a.modal-trigger",m=null,h=null;e(l.PANEL).find(l.FORMFILTER).val(i);var f=0,w=e(c).data("sesskey"),b=o.requestUrl+"?action=get_courseprogress_graph_data_ajax&sesskey="+w;function v(t){s.loader.show("#page-local-edwiserreports-coursereport #wdm-courseprogress-individual"),e(u).show(),e(p).hide();var a=JSON.stringify({courseid:"all",cohortid:t,rtl:i});(m=e(u).DataTable({ajax:b+"&cohortid="+t+"&data="+a,dom:'<"edwiserreports-table"<"p-2"i><t><"table-pagination"p>>',columns:[{data:"coursename"},{data:"enrolments"},{data:"completed"},{data:"completed81to100"},{data:"completed61to80"},{data:"completed41to60"},{data:"completed21to40"},{data:"completed0to20"}],columnDefs:[{className:"text-left",targets:0},{className:"text-right modal-trigger",targets:"_all"}],language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nocourses","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},drawCallback:function(){e(u).find("th").addClass("theme-3-bg text-white"),s.stylePaginationButton(this)},initComplete:function(){s.loader.hide("#page-local-edwiserreports-coursereport #wdm-courseprogress-individual")}})).page.len(e("#wdm-courseprogress-individual .table-length-input select").val()).draw(),m.column(0).search(e("#wdm-courseprogress-individual .table-search-input input").val()).draw()}e("#page-local-edwiserreports-coursereport").find(".singleselect").select2(),e(document).ready(function(){s.handleSearchInput(),e("body").on("change","#wdm-courseprogress-individual .table-length-input select",function(){m.page.len(this.value).draw()}),e("body").on("input","#wdm-courseprogress-individual .table-search-input input",function(){m.column(0).search(this.value).draw()}),e("body").on("input",".courseprogress-modal .table-search-input input",function(){h.search(this.value).draw()}),v(f),e(document).on("change","#page-local-edwiserreports-coursereport .cohort-select",function(){m&&(m.destroy(),e(u).hide(),e(p).show()),f=e(this).val(),e("#page-local-edwiserreports-coursereport").find('.download-links input[name="cohortid"]').val(f),v(f)}),e(document).on("click",g,function(){var o=e(this).data("minvalue"),l=e(this).data("maxvalue"),i=e(this).data("courseid"),n=e(this).data("coursename"),c=null;t.create({body:r.loadFragment("local_edwiserreports","userslist",d,{page:"courseprogress",courseid:i,minval:o,maxval:l,cohortid:f})}).then(function(e){c=e.getRoot(),e.getBody().addClass("courseprogress-modal"),c.find(".modal-dialog").addClass("modal-lg"),e.setTitle(n),e.show(),c.on(a.hidden,function(){e.destroy()}),c.on(a.bodyRendered,function(){var e=c.find(".modal-table");e.find("tbody").hasClass("empty")&&e.find("tbody").empty(),h=e.DataTable({language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nousers","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},dom:'<"edwiserreports-table"i<t><"table-pagination"p>>',drawCallback:function(){e.find("th").addClass("theme-3-bg text-white"),s.stylePaginationButton(this)},lengthChange:!1})})})})})}}});
