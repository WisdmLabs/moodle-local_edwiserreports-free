{ "version": 3, "sources": ["courseprogress.js"], "names": ["define", "$", "ModalFactory", "ModalEvents", "Fragment", "V", "common", "init", "CONTEXTID", "PageId", "CourseProgressTable", "loader", "ModalTrigger", "datatable", "cohortId", "sesskey", "data", "url", "requestUrl", "generateCourseProgressTable", "show", "hide", "JSON", "stringify", "courseid", "cohortid", "DataTable", "ajax", "dom", "columns", "columnDefs", "className", "targets", "language", "searchPlaceholder", "emptyTable", "drawCallback", "find", "addClass", "stylePaginationButton", "this", "initComplete", "select2", "document", "ready", "on", "destroy", "val", "minval", "maxval", "coursename", "ModalRoot", "create", "body", "loadFragment", "page", "then", "modal", "getRoot", "setTitle", "hidden", "bodyRendered", "ModalTable", "hasClass", "empty", "lengthChange", "bInfo"], "mappings": "AAAA,aAwBAA,OAAO,CAAC,SAAU,qBAAsB,oBAAqB,gBAAiB,cAAe,WAAY,sBAAuB,0BAA2B,aAAc,SAAUC,EAAGC,EAAcC,EAAaC,EAAUC,EAAGC,GAwI5N,MAAO,CACLC,KApIF,SAAcC,GACZ,IAAIC,EAAS,iCACTC,EAAsBD,EAAS,UAC/BE,EAASF,EAAS,WAClBG,EAAeF,EAAsB,mBACrCG,EAAY,KAEZC,EAAW,EACXC,EAAUd,EAAEQ,GAAQO,KAAK,WACzBC,EAAMZ,EAAEa,WAAa,sDAAwDH,EAwEjF,SAASI,EAA4BL,GACnCR,EAAOK,OAAOS,KAAK,0EACnBnB,EAAES,GAAqBU,OACvBnB,EAAEU,GAAQU,OACV,IAAIL,EAAOM,KAAKC,UAAU,CACxBC,SAAU,MACVC,SAAUX,IAEZD,EAAYZ,EAAES,GAAqBgB,UAAU,CAC3CC,KAAMV,EAAM,aAAeH,EAAW,SAAWE,EACjDY,IAAK,oFACLC,QAAS,CAAC,CACRb,KAAQ,cACP,CACDA,KAAQ,cACP,CACDA,KAAQ,aACP,CACDA,KAAQ,oBACP,CACDA,KAAQ,mBACP,CACDA,KAAQ,mBACP,CACDA,KAAQ,mBACP,CACDA,KAAQ,mBAEVc,WAAY,CAAC,CACXC,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,4BACXC,QAAS,SAEXC,SAAU,CACRC,kBAAmB,gBACnBC,WAAY,wBAEdC,aAAc,WACZnC,EAAES,GAAqB2B,KAAK,MAAMC,SAAS,2BAC3ChC,EAAOiC,sBAAsBC,OAE/BC,aAAc,WACZnC,EAAOK,OAAOU,KAAK,6EAlHzBpB,EAAE,2CAA2CoC,KAAK,iBAAiBK,UACnEzC,EAAE0C,UAAUC,MAAM,WAChBzB,EAA4BL,GAG5Bb,EAAE0C,UAAUE,GAAG,SAAU,yDAA0D,WAC7EhC,IACFA,EAAUiC,UACV7C,EAAES,GAAqBW,OACvBpB,EAAEU,GAAQS,QAGZN,EAAWb,EAAEuC,MAAMO,MACnB9C,EAAE,2CAA2CoC,KAAK,0CAA0CU,IAAIjC,GAChGK,EAA4BL,KAE9Bb,EAAE0C,UAAUE,GAAG,QAASjC,EAAc,WACpC,IAAIoC,EAAS/C,EAAEuC,MAAMxB,KAAK,YACtBiC,EAAShD,EAAEuC,MAAMxB,KAAK,YACtBQ,EAAWvB,EAAEuC,MAAMxB,KAAK,YACxBkC,EAAajD,EAAEuC,MAAMxB,KAAK,cAC1BmC,EAAY,KAEhBjD,EAAakD,OAAO,CAClBC,KAAMjD,EAASkD,aAAa,uBAAwB,YAAa9C,EAAW,CAC1E+C,KAAM,iBACN/B,SAAUA,EACVwB,OAAQA,EACRC,OAAQA,EACRxB,SAAUX,MAEX0C,KAAK,SAAUC,IAChBN,EAAYM,EAAMC,WACRrB,KAAK,iBAAiBC,SAAS,YACzCmB,EAAME,SAAST,GACfO,EAAMrC,OACN+B,EAAUN,GAAG1C,EAAYyD,OAAQ,WAC/BH,EAAMX,YAERK,EAAUN,GAAG1C,EAAY0D,aAAc,WACrC,IAAIC,EAAaX,EAAUd,KAAK,gBAE5ByB,EAAWzB,KAAK,SAAS0B,SAAS,UACpCD,EAAWzB,KAAK,SAAS2B,QAI3BF,EAAWpC,UAAU,CACnBO,SAAU,CACRC,kBAAmB,cACnBC,WAAY,sBAEdP,IAAK,2EACLQ,aAAc,WACZ0B,EAAWzB,KAAK,MAAMC,SAAS,2BAC/BhC,EAAOiC,sBAAsBC,OAE/ByB,cAAc,EACdC,OAAO", "sourcesContent": ["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/fragment',\n    './variables',\n    './common',\n    './jquery.dataTables',\n    './dataTables.bootstrap4',\n    './select2'\n], function($, ModalFactory, ModalEvents, Fragment, V, common) {\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        var PageId = \"#wdm-courseprogress-individual\";\n        var CourseProgressTable = PageId + \" .table\";\n        var loader = PageId + \" .loader\";\n        var ModalTrigger = CourseProgressTable + \" a.modal-trigger\";\n        var datatable = null;\n\n        // Cohort variable.\n        var cohortId = 0;\n\n        var sesskey = $(PageId).data(\"sesskey\");\n        var url = V.requestUrl + '?action=get_courseprogress_graph_data_ajax&sesskey=' + sesskey;\n\n        // Initialize select2.\n        $('#page-local-edwiserreports-coursereport').find('.singleselect').select2();\n\n        $(document).ready(function() {\n            generateCourseProgressTable(cohortId);\n\n            /* Select cohort filter for active users block */\n            $(document).on('change', '#page-local-edwiserreports-coursereport .cohort-select', function() {\n                if (datatable) {\n                    datatable.destroy();\n                    $(CourseProgressTable).hide();\n                    $(loader).show();\n                }\n                cohortId = $(this).val();\n                $(\"#page-local-edwiserreports-coursereport\").find('.download-links input[name=\"cohortid\"]').val(cohortId);\n                generateCourseProgressTable(cohortId);\n            });\n\n            $(document).on('click', ModalTrigger, function() {\n                var minval = $(this).data(\"minvalue\");\n                var maxval = $(this).data(\"maxvalue\");\n                var courseid = $(this).data(\"courseid\");\n                var coursename = $(this).data(\"coursename\");\n                var ModalRoot = null;\n\n                // eslint-disable-next-line promise/catch-or-return\n                ModalFactory.create({\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'userslist',\n                        CONTEXTID, {\n                            page: 'courseprogress',\n                            courseid: courseid,\n                            minval: minval,\n                            maxval: maxval,\n                            cohortid: cohortId\n                        }\n                    )\n                }).then(function(modal) {\n                    ModalRoot = modal.getRoot();\n                    ModalRoot.find('.modal-dialog').addClass('modal-lg');\n                    modal.setTitle(coursename);\n                    modal.show();\n                    ModalRoot.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n\n                    ModalRoot.on(ModalEvents.bodyRendered, function() {\n                        var ModalTable = ModalRoot.find(\".modal-table\");\n\n                        // If empty then remove colspan\n                        if (ModalTable.find(\"tbody\").hasClass(\"empty\")) {\n                            ModalTable.find(\"tbody\").empty();\n                        }\n\n                        // Create dataTable for userslist\n                        ModalTable.DataTable({\n                            language: {\n                                searchPlaceholder: \"Search User\",\n                                emptyTable: \"There are no users\"\n                            },\n                            dom: '<\"edwiserreports-table\"<\"table-filter d-flex\"f><t><\"table-pagination\"p>>',\n                            drawCallback: function() {\n                                ModalTable.find('th').addClass('theme-3-bg text-white');\n                                common.stylePaginationButton(this);\n                            },\n                            lengthChange: false,\n                            bInfo: false\n                        });\n                    });\n                    return;\n                });\n            });\n        });\n\n        /**\n         * Generate course progress table\n         * @param {Number} cohortId Cohort id\n         */\n        function generateCourseProgressTable(cohortId) {\n            common.loader.show('#page-local-edwiserreports-coursereport #wdm-courseprogress-individual');\n            $(CourseProgressTable).show();\n            $(loader).hide();\n\n            var data = JSON.stringify({\n                courseid: \"all\",\n                cohortid: cohortId\n            });\n\n            datatable = $(CourseProgressTable).DataTable({\n                ajax: url + \"&cohortid=\" + cohortId + \"&data=\" + data,\n                dom: '<\"edwiserreports-table\"<\"table-filter d-flex\"fl><\"p-2\"i><t><\"table-pagination\"p>>',\n                columns: [\n                    { \"data\": \"coursename\" },\n                    { \"data\": \"enrolments\" },\n                    { \"data\": \"completed\" },\n                    { \"data\": \"completed81to100\" },\n                    { \"data\": \"completed61to80\" },\n                    { \"data\": \"completed41to60\" },\n                    { \"data\": \"completed21to40\" },\n                    { \"data\": \"completed0to20\" },\n                ],\n                columnDefs: [\n                    { className: \"text-left\", targets: 0 },\n                    { className: \"text-center modal-trigger\", targets: \"_all\" }\n                ],\n                language: {\n                    searchPlaceholder: \"Search Course\",\n                    emptyTable: \"There are no courses\"\n                },\n                drawCallback: function() {\n                    $(CourseProgressTable).find('th').addClass('theme-3-bg text-white');\n                    common.stylePaginationButton(this);\n                },\n                initComplete: function() {\n                    common.loader.hide('#page-local-edwiserreports-coursereport #wdm-courseprogress-individual');\n                }\n            });\n        }\n    }\n\n    return {\n        init: init\n    };\n\n});"], "file": "courseprogress.min.js" }