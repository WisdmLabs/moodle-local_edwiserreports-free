{"version":3,"sources":["courseprogress.js"],"names":["define","$","ModalFactory","ModalEvents","Fragment","V","common","SELECTOR","PANEL","COHORT","COURSE","GROUP","STUDENT","GRAPH","GRAPHLABEL","FORMFILTER","FILTERS","rtl","attr","init","CONTEXTID","PageId","CourseProgressTable","loader","ModalTrigger","datatable","modalTable","find","val","cohortId","sesskey","data","url","requestUrl","generateCourseProgressTable","show","hide","JSON","stringify","courseid","cohortid","DataTable","ajax","dom","columns","columnDefs","className","targets","language","info","M","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","addClass","stylePaginationButton","this","initComplete","page","len","draw","column","search","select2","document","ready","handleSearchInput","on","value","destroy","minval","maxval","coursename","ModalRoot","create","body","loadFragment","then","modal","getRoot","getBody","setTitle","hidden","bodyRendered","ModalTable","hasClass","empty","lengthChange"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/fragment',\n    './variables',\n    './common',\n    './jquery.dataTables',\n    './dataTables.bootstrap4',\n    './select2'\n], function($, ModalFactory, ModalEvents, Fragment, V, common) {\n\n    /**\n     * Selectors list.\n     */\n    var SELECTOR = {\n        PANEL: '#wdm-courseprogress-individual',\n        COHORT: '.cohort-select',\n        COURSE: '.course-select',\n        GROUP: '.group-select',\n        STUDENT: '.student-select',\n        GRAPH: '.graph',\n        GRAPHLABEL: '.graph-label',\n        FORMFILTER: '.download-links [name=\"filter\"]',\n        FILTERS: '.filters'\n    };\n\n    /**\n     * rtl for rtl lang support.\n     */\n    let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n\n    /**\n     * Filter for ajax.\n     */\n    var filter = {\n        rtl: rtl\n    };\n\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        var PageId = \"#wdm-courseprogress-individual\";\n        var CourseProgressTable = PageId + \" .table\";\n        var loader = PageId + \" .loader\";\n        var ModalTrigger = CourseProgressTable + \" a.modal-trigger\";\n        var datatable = null;\n        var modalTable = null;\n        $(SELECTOR.PANEL).find(SELECTOR.FORMFILTER).val(rtl);\n\n        // Cohort variable.\n        var cohortId = 0;\n\n        var sesskey = $(PageId).data(\"sesskey\");\n        var url = V.requestUrl + '?action=get_courseprogress_graph_data_ajax&sesskey=' + sesskey;\n\n        // Initialize select2.\n        $('#page-local-edwiserreports-coursereport').find('.singleselect').select2();\n\n        $(document).ready(function() {\n\n            common.handleSearchInput();\n\n            // Observer length change.\n            $('body').on('change', '#wdm-courseprogress-individual .table-length-input select', function() {\n                datatable.page.len(this.value).draw();\n            });\n\n            // Search in table.\n            $('body').on('input', '#wdm-courseprogress-individual .table-search-input input', function() {\n                datatable.column(0).search(this.value).draw();\n            });\n\n            // Search in modal table.\n            $('body').on('input', '.courseprogress-modal .table-search-input input', function() {\n                modalTable.search(this.value).draw();\n            });\n\n            generateCourseProgressTable(cohortId);\n\n            /* Select cohort filter for active users block */\n            $(document).on('change', '#page-local-edwiserreports-coursereport .cohort-select', function() {\n                if (datatable) {\n                    datatable.destroy();\n                    $(CourseProgressTable).hide();\n                    $(loader).show();\n                }\n                cohortId = $(this).val();\n                $(\"#page-local-edwiserreports-coursereport\").find('.download-links input[name=\"cohortid\"]').val(cohortId);\n                generateCourseProgressTable(cohortId);\n            });\n\n            $(document).on('click', ModalTrigger, function() {\n                var minval = $(this).data(\"minvalue\");\n                var maxval = $(this).data(\"maxvalue\");\n                var courseid = $(this).data(\"courseid\");\n                var coursename = $(this).data(\"coursename\");\n                var ModalRoot = null;\n\n                // eslint-disable-next-line promise/catch-or-return\n                ModalFactory.create({\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'userslist',\n                        CONTEXTID, {\n                            page: 'courseprogress',\n                            courseid: courseid,\n                            minval: minval,\n                            maxval: maxval,\n                            cohortid: cohortId\n                        }\n                    )\n                }).then(function(modal) {\n                    ModalRoot = modal.getRoot();\n                    modal.getBody().addClass('courseprogress-modal');\n                    ModalRoot.find('.modal-dialog').addClass('modal-lg');\n                    modal.setTitle(coursename);\n                    modal.show();\n                    ModalRoot.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n\n                    ModalRoot.on(ModalEvents.bodyRendered, function() {\n                        var ModalTable = ModalRoot.find(\".modal-table\");\n\n                        // If empty then remove colspan\n                        if (ModalTable.find(\"tbody\").hasClass(\"empty\")) {\n                            ModalTable.find(\"tbody\").empty();\n                        }\n\n                        // Create dataTable for userslist\n                        modalTable = ModalTable.DataTable({\n                            language: {\n                                info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                                infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                                emptyTable: M.util.get_string('nousers', 'local_edwiserreports'),\n                                zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                                paginate: {\n                                    previous: \" \",\n                                    next: \" \"\n                                }\n                            },\n                            dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n                            drawCallback: function() {\n                                ModalTable.find('th').addClass('theme-3-bg text-white');\n                                common.stylePaginationButton(this);\n                            },\n                            lengthChange: false\n                        });\n                    });\n                    return;\n                });\n            });\n        });\n\n        /**\n         * Generate course progress table\n         * @param {Number} cohortId Cohort id\n         */\n        function generateCourseProgressTable(cohortId) {\n            common.loader.show('#page-local-edwiserreports-coursereport #wdm-courseprogress-individual');\n            $(CourseProgressTable).show();\n            $(loader).hide();\n\n            var data = JSON.stringify({\n                courseid: \"all\",\n                cohortid: cohortId,\n                rtl: rtl,\n            });\n\n            datatable = $(CourseProgressTable).DataTable({\n                ajax: url + \"&cohortid=\" + cohortId + \"&data=\" + data,\n                dom: '<\"edwiserreports-table\"<\"p-2\"i><t><\"table-pagination\"p>>',\n                columns: [{\n                    \"data\": \"coursename\"\n                }, {\n                    \"data\": \"enrolments\"\n                }, {\n                    \"data\": \"completed\"\n                }, {\n                    \"data\": \"completed81to100\"\n                }, {\n                    \"data\": \"completed61to80\"\n                }, {\n                    \"data\": \"completed41to60\"\n                }, {\n                    \"data\": \"completed21to40\"\n                }, {\n                    \"data\": \"completed0to20\"\n                }],\n                columnDefs: [{\n                    className: \"text-left\",\n                    targets: 0\n                }, {\n                    // className: rtl ? \"text-left modal-trigger\" : \"text-right modal-trigger\",\n                    className: \"text-right modal-trigger\",\n                    targets: \"_all\"\n                }],\n                language: {\n                    info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                    infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                    emptyTable: M.util.get_string('nocourses', 'local_edwiserreports'),\n                    zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                    paginate: {\n                        previous: \" \",\n                        next: \" \"\n                    }\n                },\n                drawCallback: function() {\n                    $(CourseProgressTable).find('th').addClass('theme-3-bg text-white');\n                    common.stylePaginationButton(this);\n                },\n                initComplete: function() {\n                    common.loader.hide('#page-local-edwiserreports-coursereport #wdm-courseprogress-individual');\n                }\n            });\n\n            datatable.page.len($('#wdm-courseprogress-individual .table-length-input select').val()).draw();\n            datatable.column(0).search($('#wdm-courseprogress-individual .table-search-input input').val()).draw();\n        }\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"file":"courseprogress.min.js"}