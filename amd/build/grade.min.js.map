{"version":3,"sources":["grade.js"],"names":["define","$","Notification","common","CFG","SELECTOR","PAGE","TABLE","COURSE","FORMFILTER","COHORT","SEARCHTABLE","LENGTH","dataTable","PROMISE","GET_DATA","filter","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","attr","JSON","stringify","initializeDatatable","DataTable","paging","processing","serverSide","rowId","deferRendering","scrollX","scrollCollapse","autoWidth","columns","sortable","dom","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","callback","settings","loader","show","val","search","value","order","column","dir","join","cohort","course","start","length","ordering","done","response","hide","fail","exception","init","document","ready","find","select2","on","reload","draw","page","len","handleSearchInput"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,oBAAqB,WAAY,kBAAmB,aAAc,SAAUC,EAAGC,EAAcC,EAAQC,GAIrH,IAAIC,EAAW,CACbC,KAAM,SACNC,MAAO,eACPC,OAAQ,wBACRC,WAAY,yCACZC,OAAQ,wBACRC,YAAa,mCACbC,OAAQ,qCAMNC,EAAY,KAKZC,EAAU,CAMZC,SAAU,SAAkBC,GAC1B,OAAOf,EAAEgB,KAAK,CACZC,IAAKd,EAAIe,WACTC,KAAMhB,EAAIiB,YACVC,SAAUlB,EAAImB,gBACdC,KAAM,CACJC,OAAQ,4BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAM5B,EAAE,QAAQ6B,KAAK,QACrBN,KAAMO,KAAKC,UAAU,CACnBhB,OAAQA,SAUlB,SAASiB,IACPpB,EAAYZ,EAAEI,EAASE,OAAO2B,UAAU,CACtCC,QAAQ,EACRC,YAAY,EACZC,YAAY,EACZC,MAAO,WACPC,gBAAgB,EAChBC,SAAS,EACTC,gBAAgB,EAChBC,WAAW,EACXC,QAAS,CAAC,CACRnB,KAAM,WACL,CACDA,KAAM,UACL,CACDA,KAAM,WACNoB,UAAU,GACT,CACDpB,KAAM,UAERqB,IAAK,oDACLC,SAAU,CACRC,KAAMpB,EAAEqB,KAAKC,WAAW,YAAa,wBACrCC,UAAWvB,EAAEqB,KAAKC,WAAW,YAAa,wBAC1CE,WAAYxB,EAAEqB,KAAKC,WAAW,aAAc,wBAC5CG,YAAazB,EAAEqB,KAAKC,WAAW,cAAe,wBAC9CI,SAAU,CACRC,SAAU3B,EAAEqB,KAAKC,WAAW,WAAY,UACxCM,KAAM5B,EAAEqB,KAAKC,WAAW,OAAQ,YAGpCO,aAAc,WACZrD,EAAOsD,sBAAsBC,OAG/BzC,KAAM,SAAcO,EAAMmC,EAAUC,GAClCzD,EAAO0D,OAAOC,KAAKzD,EAASC,MAE5BL,EAAEI,EAASI,YAAYsD,IAAI,CAAC9D,EAAEI,EAASG,QAAQuD,MAC/C9D,EAAEI,EAASK,QAAQqD,MACnBvC,EAAKwC,OAAOC,MACZzC,EAAK0C,MAAM,GAAGC,OACd3C,EAAK0C,MAAM,GAAGE,KACZC,KAAK,MACPvD,EAAQC,SAAS,CACfuD,OAAUrE,EAAEI,EAASK,QAAQqD,MAC7BQ,OAAUtE,EAAEI,EAASG,QAAQuD,MAC7BC,OAAUxC,EAAKwC,OAAOC,MACtBO,MAAShD,EAAKgD,MACdC,OAAUjD,EAAKiD,OACfC,SAAYlD,EAAK0C,MAAM,KACtBS,KAAK,SAAUC,GAChBzE,EAAO0D,OAAOgB,KAAKxE,EAASC,MAC5BqD,EAASiB,KACRE,KAAK,SAAUC,GAChB7E,EAAa6E,UAAUA,GACvB5E,EAAO0D,OAAOgB,KAAKxE,EAASC,WAiDpC,MAAO,CACL0E,KAAM,WACJ/E,EAAEgF,UAAUC,MAAM,WAvCpBjF,EAAEI,EAASC,MAAM6E,KAAK,iBAAiBC,UAEvCnF,EAAEI,EAASG,QAAQ6E,GAAG,SAAU,WACZ,OAAdxE,EAKJA,EAAUI,KAAKqE,SAJbrD,MAOJhC,EAAEI,EAASK,QAAQ2E,GAAG,SAAU,WACZ,OAAdxE,EAKJA,EAAUI,KAAKqE,SAJbrD,MAOJhC,EAAE,QAAQoF,GAAG,QAAShF,EAASM,YAAa,WAC1CE,EAAUmD,OAAON,KAAKO,OAAOsB,SAG/BtF,EAAEI,EAASO,QAAQyE,GAAG,SAAU,WACZ,OAAdxE,GAKJA,EAAU2E,KAAKC,IAAI/B,KAAKO,OACxBpD,EAAUI,KAAKqE,UALbrD,MAOJA,IACA9B,EAAOuF","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Grade table js.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/notification',\n    './common',\n    './defaultconfig',\n    './select2'\n], function(\n    $,\n    Notification,\n    common,\n    CFG\n) {\n\n    /**\n     * Selector\n     */\n    var SELECTOR = {\n        PAGE: '#grade',\n        TABLE: '#grade table',\n        COURSE: '#grade .course-select',\n        FORMFILTER: '#grade .download-links [name=\"filter\"]',\n        COHORT: '#grade .cohort-select',\n        SEARCHTABLE: '#grade .table-search-input input',\n        LENGTH: '#grade .table-length-input select'\n    };\n\n    /**\n     * Datatable object.\n     */\n    var dataTable = null;\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get grade table data based on filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_DATA: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_grade_table_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        },\n    };\n\n    /**\n     * Initialize datable.\n     */\n    function initializeDatatable() {\n        dataTable = $(SELECTOR.TABLE).DataTable({\n            paging: true,\n            processing: true,\n            serverSide: true,\n            rowId: 'DT_RowId',\n            deferRendering: true,\n            scrollX: true,\n            scrollCollapse: true,\n            autoWidth: true,\n            columns: [{\n                data: \"student\"\n            }, {\n                data: \"course\"\n            }, {\n                data: \"activity\",\n                sortable: false\n            }, {\n                data: \"grade\"\n            }],\n            dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n            language: {\n                info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                emptyTable: M.util.get_string('emptytable', 'local_edwiserreports'),\n                zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                paginate: {\n                    previous: M.util.get_string('previous', 'moodle'),\n                    next: M.util.get_string('next', 'moodle')\n                }\n            },\n            drawCallback: function() {\n                common.stylePaginationButton(this);\n            },\n            // eslint-disable-next-line no-unused-vars\n            ajax: function(data, callback, settings) {\n                common.loader.show(SELECTOR.PAGE);\n                // Filter: course-cohort-search-column-dir.\n                $(SELECTOR.FORMFILTER).val([\n                    $(SELECTOR.COURSE).val(), // Course id.\n                    $(SELECTOR.COHORT).val(), // Cohort id.\n                    data.search.value, // Search value.\n                    data.order[0].column, // Order column.\n                    data.order[0].dir // Order by column and direction.\n                ].join('-'));\n                PROMISE.GET_DATA({\n                    'cohort': $(SELECTOR.COHORT).val(),\n                    'course': $(SELECTOR.COURSE).val(),\n                    'search': data.search.value,\n                    'start': data.start,\n                    'length': data.length,\n                    'ordering': data.order[0]\n                }).done(function(response) {\n                    common.loader.hide(SELECTOR.PAGE);\n                    callback(response);\n                }).fail(function(exception) {\n                    Notification.exception(exception);\n                    common.loader.hide(SELECTOR.PAGE);\n                });\n            }\n        });\n    }\n\n    /**\n     * Initialize\n     */\n    function init() {\n        // Initialize select2.\n        $(SELECTOR.PAGE).find('.singleselect').select2();\n\n        // Observer course change event.\n        $(SELECTOR.COURSE).on('change', function() {\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.ajax.reload();\n        });\n\n        // Observer cohort change.\n        $(SELECTOR.COHORT).on('change', function() {\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.ajax.reload();\n        });\n\n        // Search in table.\n        $('body').on('input', SELECTOR.SEARCHTABLE, function() {\n            dataTable.search(this.value).draw();\n        });\n\n        // Observer length change.\n        $(SELECTOR.LENGTH).on('change', function() {\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.page.len(this.value);\n            dataTable.ajax.reload();\n        });\n\n        initializeDatatable();\n        common.handleSearchInput();\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n                init();\n            });\n        }\n    };\n\n});"],"file":"grade.min.js"}