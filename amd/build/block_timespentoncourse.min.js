"use strict";define(["jquery","./chart/apexcharts","./common","./defaultconfig"],function(e,t,o,a){var i={PANEL:"#timespentoncourseblock",INSIGHT:"#timespentoncourseblock .insight",FORMFILTER:'.download-links [name="filter"]',GRAPH:"#apex-chart-timespentoncourse-block",STUDENT:"#timespentoncourse-student-select",COURSE:"#timespentoncourse-course-select"},r={GET_TIMESPENTONCOURSE:function(t){return e.ajax({url:a.requestUrl,type:a.requestType,dataType:a.requestDataType,data:{action:"get_timespentoncourse_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({filter:t})}})}},n={date:"weekly",course:0,student:0},s=null,l={series:[],chart:{type:"area",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},stroke:{curve:"smooth"},grid:{borderColor:"#e7e7e7"},markers:{size:1},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},legend:{position:"top",floating:!0},dataLabels:{enabled:!1},colors:[a.getColorPalette()[2]],noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},d={series:[],chart:{type:"bar",height:350,toolbar:{show:!0,tools:{download:!1,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:'<i class="fa fa-refresh"></i>'}}},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},marker:{show:!0},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},plotOptions:{bar:{columnWidth:"50%"}},grid:{borderColor:"#e7e7e7"},dataLabels:{enabled:!1},xaxis:{categories:null,labels:{hideOverlappingLabels:!0,trim:!0},tickPlacement:"on"},colors:[a.getColorPalette()[2]],noData:{text:M.util.get_string("nographdata","local_edwiserreports")}};function c(a){o.loader.show(i.PANEL);var c=Object.keys(n).map(function(e){return n[e]}).join("-");e(i.PANEL).find(i.FORMFILTER).val(c),r.GET_TIMESPENTONCOURSE(n).done(function(a){var r;(r=0==n.course?Object.assign({},d):Object.assign({},l)).series=[{name:M.util.get_string("timespentoncourse","local_edwiserreports"),data:a.timespent}],r.xaxis.categories=a.labels,r.yaxis={labels:{formatter:o.timeFormatter}},r.chart.toolbar.show=a.labels.length>30,r.chart.zoom={enabled:a.labels.length>30},r.tooltip.y.title.formatter=function(){return M.util.get_string("time","local_edwiserreports")+": "},a.insight.insight.value=o.timeFormatter(a.insight.insight.value,{dataPointIndex:0,short:!0}).replaceAll(",","<br>"),a.insight.details.data[0].value=o.timeFormatter(a.insight.details.data[0].value,{dataPointIndex:0}),o.insight(i.INSIGHT,a.insight),function(e,a){null!==s&&s.destroy(),(s=new t(e.get(0),a)).render(),setTimeout(function(){o.loader.hide(i.PANEL)},1e3)}(e(i.PANEL).find(i.GRAPH),r)}).fail(function(e){o.loader.hide(i.PANEL)})}return{init:function(t){e(i.PANEL).length&&(c(),o.dateChange(function(e){n.date=e,c()}),e("body").on("change","".concat(i.PANEL," ").concat(i.STUDENT),function(){n.student=parseInt(e(this).val()),c()}),e("body").on("change","".concat(i.PANEL," ").concat(i.COURSE),function(){n.course=parseInt(e(this).val()),c()}),flatpickr=e(i.PANEL).find(i.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(i.PANEL).find(i.DATEPICKER).get(0),onOpen:function(){e(i.PANEL).find(i.DATEMENU).addClass("withcalendar")},onClose:function(){e(i.PANEL).find(i.DATEMENU).removeClass("withcalendar"),customDateSelected()}}),e(i.PANEL).find(".singleselect").select2())}}});
//# sourceMappingURL=block_timespentoncourse.min.js.map
