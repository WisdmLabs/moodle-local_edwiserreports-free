"use strict";define(["jquery","core/notification","core/fragment","core/modal_factory","core/modal_events","core/templates","./variables","./defaultconfig","./selectors","./select2","./jquery.dataTables","./dataTables.bootstrap4"],function(e,t,a,r,o,n,i,s,l){var d=e("html").attr("dir");let c={TABLE:".edwiserreports-table",FILTER:".table-filter",TAB:".edwiserreports-tabs .dropdown",DATESELECTED:".selected-period span",SEARCHTABLE:".table-search-input input",PAGINATION:".table-pagination",PAGINATIONITEM:".paginate_button"};var u={GET_TIMEPERIOD_LABEL:function(t){return e.ajax({url:s.requestUrl,type:s.requestType,dataType:s.requestDataType,data:{action:"get_timeperiod_label_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:t}})}};n.render("local_edwiserreports/insight-placeholder",{}),n.render("local_edwiserreports/insight",{});var p={show:function(t,a){var r;null==t?(t="body",r="position-fixed"):r="position-absolute",null!=a&&(r=a),e(t).append(`\n            <div class="edwiserreports-loader ${r}">\n                <div class="animation-wrapper">\n                    <div class="fa-animation">\n                        <i class="fa fa-cog fa-lg fa-spin"></i>\n                        <i class="fa fa-cog fa-md fa-spin spin-reverse"></i>\n                        <i class="fa fa-cog fa-sm fa-spin spin-reverse"></i>\n                    </div>\n                    ${M.util.get_string("loading","moodle")}\n                </div>\n            </div>\n            `)},hide:function(t){null==t&&(t="body"),e(t+" > .edwiserreports-loader").remove()}};function g(t){t.modal.find(".comparisontable .switch-capability").on("click",function(t){var a=e(t.currentTarget).find("input[type=radio]"),r=a.filter(":checked"),o=a.eq(a.index(r)+1);0===o.length&&(o=a.eq(0)),o.prop("checked",!0);var n=o.data("strpermission"),i=o.data("permissionclass");e(t.currentTarget).removeClass("inherit allow prevent prohibit"),e(t.currentTarget).addClass(i),e(t.currentTarget).find("label").html(n)})}function f(a,r,o){r.blockname=a,r=JSON.stringify(r);var n=e("#"+a).data("sesskey");e.ajax({url:i.requestUrl,type:"GET",data:{action:"set_block_capability_ajax",sesskey:n,data:r}}).done(function(e){(e=JSON.parse(e)).success?(o(),location.reload()):t.addNotification({message:"Error",type:"error"})}).fail(function(e){console.log(e),t.addNotification({message:e,type:"error"})}).always(function(){o(),location.reload()})}function m(e,t,a){return(e=e>0?e<10?"0"+e:e:"00")+":"+(t=t>0?t<10?"0"+t:t:"00")+":"+(a=a>0?a<10?"0"+a:a:"00")}return e(document).ready(function(){e("#wdm-edwiserreports").removeClass("d-none"),e(document).on("click",l.blockSettingsBtn,function(s){s.preventDefault();var l=e(s.currentTarget).data("contextid"),d=e(s.currentTarget).data("blockname"),c=e(s.currentTarget).data("action");if("edit"==c)r.create({title:M.util.get_string("editblocksetting","local_edwiserreports"),body:a.loadFragment("local_edwiserreports","get_blocksetting_form",l,{blockname:d})}).done(function(a){var r=a.getRoot();a.modal.addClass("modal-dialog-centered"),r.on(o.bodyRendered,function(){var r=a.modal.find(".block-settings-form");a.modal.find(".save-block-settings").on("click",function(a){a.preventDefault();var o=r.serializeArray(),n={};e(o).each(function(e,t){n[t.name]=t.value}),function(a,r){r.blockname=a,r=JSON.stringify(r);var o=e("#"+a).data("sesskey");e.ajax({url:i.requestUrl,type:"GET",data:{action:"set_block_preferences_ajax",sesskey:o,data:r}}).fail(function(e){console.log(e),t.addNotification({message:e,type:"error"})}).always(function(){location.reload()})}(d,n)})}),r.on(o.hidden,function(){a.destroy()}),a.show()});else if("hide"==c){var u=e(this).data("hidden"),p=e(this);e.ajax({url:i.requestUrl,type:"GET",data:{action:"toggle_hide_block_ajax",sesskey:M.cfg.sesskey,data:JSON.stringify({blockname:d,hidden:u})}}).done(function(e){(e=JSON.parse(e)).success&&(u?(p.closest(".edwiserReport-block").removeClass("block-hidden"),p.data("hidden",0),p.html(M.util.get_string("hide","local_edwiserreports"))):(p.closest(".edwiserReport-block").addClass("block-hidden"),p.data("hidden",1),p.html(M.util.get_string("unhide","local_edwiserreports"))))})}else"editcap"==c&&r.create({title:M.util.get_string("editblockcapabilities","local_edwiserreports"),body:a.loadFragment("local_edwiserreports","get_blockscap_form",l,{blockname:d})}).done(function(t){var r=t.getRoot();t.modal.addClass("modal-dialog-centered modal-lg"),r.on(o.bodyRendered,function(){var r=t.modal.find(".block-cap-form");t.modal.find("#menucapabilities").on("change",function(o){o.preventDefault();var i=r.serializeArray(),s={};e(i).each(function(e,t){s[t.name]=t.value}),a.loadFragment("local_edwiserreports","block_overview_display",l,{capvalue:s.capabilities}).done(function(e,a,r){n.replaceNodeContents(t.modal.find(".cap-overview"),e,a),g(t)})}),g(t),r=t.modal.find(".block-cap-form"),t.modal.find(".save-block-caps").on("click",function(a){a.preventDefault();var o=r.serializeArray(),n={};e(o).each(function(e,t){n[t.name]=t.value}),f(d,n,function(){t.hide()})})}),r.on(o.hidden,function(){t.destroy()}),t.show()})}),setTimeout(function(){var t=e("html").attr("dir");void 0!==t&&!1!==t&&"rtl"==t&&(e(".insight-wrapper .fa-arrow-left").removeClass("fa-arrow-left").addClass("fa-arrow-right rtl-support"),e(".insight-wrapper .fa-arrow-right:not(.rtl-support)").removeClass("fa-arrow-right").addClass("fa-arrow-left rtl-support"))},1e3),setTimeout(function(){e(".edwiserreports-table .page-item.next a").empty(),e(".edwiserreports-table .page-item.previous a").empty()},2e3),function(t){var a,r='<div id="editing-btn" class="d-flex flex-wrap">';r+='<div class="ml-auto d-flex">',t?(t=0,a="Stop Customising this page",r+='<div class="singlebutton">',r+='<form method="post" action="'+M.cfg.wwwroot+'/local/edwiserreports/index.php">',r+='<input type="hidden" name="reset" value="1">',r+='<input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'">',r+='<button type="submit" class="btn btn-secondary" title="">Reset Page to Default</button>',r+="</form>",r+="</div>"):(t=1,a="Customise this page");r+='<div class="singlebutton">',r+='<form method="post" action="'+M.cfg.wwwroot+'/local/edwiserreports/index.php">',r+='<input type="hidden" name="edit" value="'+t+'">',r+='<input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'">',r+='<button type="submit" class="btn btn-secondary" title="">'+a+"</button>",r+="</form>",r+="</div>",r+="</div></div>",e("#page-local-edwiserreports-index #page-header .card-body").append(r)}(e("#wdm-edwiserreports").data("editing"))}),{loader:p,toPrecision:function(e,t){return e%1==0?e:e.toPrecision(t)},insight:function(a,r){r.insight.title=M.util.get_string(r.insight.title,"local_edwiserreports"),void 0!==r.details&&void 0!==r.details.data&&r.details.data.forEach(function(e,t){r.details.data[t].title=M.util.get_string(e.title,"local_edwiserreports")}),n.render("local_edwiserreports/insight-placeholder",{}).done(function(o,i){n.replaceNodeContents(a,o,i),n.render("local_edwiserreports/insight",r).done(function(e,t){n.replaceNodeContents(a,e,t)}).fail(function(r){t.exception(r),e(a).remove()})})},timeFormatter:function(t,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Number(t);var o=Math.floor(t/3600),n=Math.floor(t%3600/60),i=Math.floor(t%3600%60);if(r="rtl"==e("html").attr("dir")?1:0,"object"==typeof a&&void 0!==a.dataPointIndex&&-1!==a.dataPointIndex){var s=[],l=void 0!==a.short&&a.short;return o>0&&(l?1==r?s.push(o+" "+M.util.get_string("minuteshort","local_edwiserreports")):s.push(o+" "+M.util.get_string("hourshort","local_edwiserreports")):1==r?n>0&&s.push(n+" "+M.util.get_string(1==o?"hour":"hours","local_edwiserreports")):s.push(o+" "+M.util.get_string(1==o?"hour":"hours","local_edwiserreports"))),n>0&&(l?1==r?s.push(n+" "+M.util.get_string("hourshort","local_edwiserreports")):s.push(n+" "+M.util.get_string("minuteshort","local_edwiserreports")):1==r?o>0&&(longmin=M.util.get_string(1==n?"minute":"minutes","local_edwiserreports")+" "+o):s.push(n+" "+M.util.get_string(1==n?"minute":"minutes","local_edwiserreports"))),i>0&&(l?1==r?s.push(M.util.get_string("secondshort","local_edwiserreports")+" "+i):s.push(i+" "+M.util.get_string("secondshort","local_edwiserreports")):1==r?longsec=M.util.get_string(1==i?"second":"seconds","local_edwiserreports")+" "+i:s.push(i+" "+M.util.get_string(1==i?"second":"seconds","local_edwiserreports"))),!l&&r&&(s.push(longsec),s.push(longmin)),0==s.length&&s.push(0),s.join(" ")}return r?m(i,n,o):m(o,n,i)},dateChange:function(t){e(document).on("edwiserreport:datechange",function(e){t(e.detail.date)})},stylePaginationButton:function(t){let a=e(t).closest(c.TABLE).find(c.PAGINATION);a.find(c.PAGINATIONITEM).length<4?a.addClass("d-none"):(a.removeClass("d-none"),a.find(c.PAGINATIONITEM).addClass(i.datatableClasses.buttonSpacing),a.find(c.PAGINATIONITEM+" a").addClass(i.datatableClasses.buttonSize),a.find(c.PAGINATIONITEM+".active a").addClass(i.datatableClasses.buttonActive),a.find(c.PAGINATIONITEM+":not(.active) a").addClass(i.datatableClasses.buttonInactive),a.find(c.PAGINATIONITEM+".previous a").addClass(i.datatableClasses.prevNextSpacing),a.find(c.PAGINATIONITEM+".next a").addClass(i.datatableClasses.prevNextSpacing),a.find(c.PAGINATIONITEM+".previous").removeClass(i.datatableClasses.buttonsSpacing).addClass("mx-4"),a.find(c.PAGINATIONITEM+".next").removeClass(i.datatableClasses.buttonsSpacing).addClass("mx-4"))},handleSearchInput:function(){e("body").on("input",c.SEARCHTABLE,function(){e(this).toggleClass("empty",""===e(this).val())})},headerNavigation:function(){e("body").on("click",function(t){let a=e(t.target).closest(c.TAB);e(`${c.TAB}.show`).not(a).closest(c.TAB).removeClass("show"),a.length&&a.closest(c.TAB).toggleClass("show")})},handleFilterSize:function(t){let a=["col-md-3","col-md-4","col-md-6","col-md-12"],r=[];switch(e(t).find(".filter-selector:not(.d-none)").length){case 1:r=a.splice(a.indexOf("col-md-12"),1);break;case 2:r=a.splice(a.indexOf("col-md-6"),1);break;case 3:r=a.splice(a.indexOf("col-md-4"),1);break;case 4:r=a.splice(a.indexOf("col-md-3"),1)}e(t).find(".filter-selector").addClass(r.join(" ")).removeClass(a.join(" "))},formatDate:function(e,t,a){var r=["\0","January","February","March","April","May","June","July","August","September","October","November","December"],o=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=["","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=["","Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function s(e,t){var a=e+"";for(t=t||2;a.length<t;)a="0"+a;return a}var l=a?e.getUTCFullYear():e.getFullYear();t=(t=(t=t.replace(/(^|[^\\])yyyy+/g,"$1"+l)).replace(/(^|[^\\])yy/g,"$1"+l.toString().substr(2,2))).replace(/(^|[^\\])y/g,"$1"+l);var d=(a?e.getUTCMonth():e.getMonth())+1;t=(t=(t=(t=t.replace(/(^|[^\\])MMMM+/g,"$1"+r[0])).replace(/(^|[^\\])MMM/g,"$1"+o[0])).replace(/(^|[^\\])MM/g,"$1"+s(d))).replace(/(^|[^\\])M/g,"$1"+d);var c=a?e.getUTCDate():e.getDate();t=(t=(t=(t=t.replace(/(^|[^\\])dddd+/g,"$1"+n[0])).replace(/(^|[^\\])ddd/g,"$1"+i[0])).replace(/(^|[^\\])dd/g,"$1"+s(c))).replace(/(^|[^\\])d/g,"$1"+c);var u=a?e.getUTCHours():e.getHours(),p=u>12?u-12:0==u?12:u;t=(t=(t=(t=t.replace(/(^|[^\\])HH+/g,"$1"+s(u))).replace(/(^|[^\\])H/g,"$1"+u)).replace(/(^|[^\\])hh+/g,"$1"+s(p))).replace(/(^|[^\\])h/g,"$1"+p);var g=a?e.getUTCMinutes():e.getMinutes();t=(t=t.replace(/(^|[^\\])mm+/g,"$1"+s(g))).replace(/(^|[^\\])m/g,"$1"+g);var f=a?e.getUTCSeconds():e.getSeconds();t=(t=t.replace(/(^|[^\\])ss+/g,"$1"+s(f))).replace(/(^|[^\\])s/g,"$1"+f);var m=a?e.getUTCMilliseconds():e.getMilliseconds();t=t.replace(/(^|[^\\])fff+/g,"$1"+s(m,3)),m=Math.round(m/10),t=t.replace(/(^|[^\\])ff/g,"$1"+s(m)),m=Math.round(m/10);var h=u<12?"AM":"PM";t=(t=(t=t.replace(/(^|[^\\])f/g,"$1"+m)).replace(/(^|[^\\])TT+/g,"$1"+h)).replace(/(^|[^\\])T/g,"$1"+h.charAt(0));var v=h.toLowerCase();t=(t=t.replace(/(^|[^\\])tt+/g,"$1"+v)).replace(/(^|[^\\])t/g,"$1"+v.charAt(0));var b=-e.getTimezoneOffset(),y=a||!b?"Z":b>0?"+":"-";if(!a){var w=(b=Math.abs(b))%60;y+=s(Math.floor(b/60))+":"+s(w)}t=t.replace(/(^|[^\\])K/g,"$1"+y);var T=(a?e.getUTCDay():e.getDay())+1;return t=(t=(t=(t=(t=t.replace(new RegExp(n[0],"g"),n[T])).replace(new RegExp(i[0],"g"),i[T])).replace(new RegExp(r[0],"g"),r[d])).replace(new RegExp(o[0],"g"),o[d])).replace(/\\(.)/g,"$1")},handleReportCapability:function(){let t=e(c.CAPEDIT).data("contextid"),i=e(c.CAPEDIT).data("reportname");e(c.CAPEDIT).click(function(){r.create({title:M.util.get_string("editreportcapabilities","local_edwiserreports"),body:a.loadFragment("local_edwiserreports","get_reportscap_form",t,{name:i})}).done(function(r){var s=r.getRoot();r.modal.addClass("modal-dialog-centered modal-lg"),s.on(o.bodyRendered,function(){var o=r.modal.find(".block-cap-form");r.modal.find("#menucapabilities").on("change",function(i){i.preventDefault();var s=o.serializeArray(),l={};e(s).each(function(e,t){l[t.name]=t.value}),a.loadFragment("local_edwiserreports","block_overview_display",t,{capvalue:l.capabilities}).done(function(e,t,a){n.replaceNodeContents(r.modal.find(".cap-overview"),e,t),g(r)})}),g(r),o=r.modal.find(".block-cap-form"),r.modal.find(".save-block-caps").on("click",function(t){t.preventDefault();var a=o.serializeArray(),n={};e(a).each(function(e,t){n[t.name]=t.value}),f(i,n,function(){r.hide()})})}),s.on(o.hidden,function(){r.destroy()}),r.show()})})},updateTimeLabel:function(a){"all"!=a?u.GET_TIMEPERIOD_LABEL(a).done(function(t){let a=new Date(864e5*t.startdate),r=new Date(864e5*t.enddate),o=a.getDate();o=o<10?"0"+o:o;let n=r.getDate();n=n<10?"0"+n:n;var i=`${o} ${a.toLocaleString("default",{month:"long"})} ${a.getFullYear()} -\n            ${n} ${r.toLocaleString("default",{month:"long"})} ${r.getFullYear()}</span>`;"rtl"==d&&(a=a.getFullYear()+" "+a.toLocaleString("default",{month:"long"})+" "+o,i=(r=r.getFullYear()+" "+r.toLocaleString("default",{month:"long"})+" "+n)+"-"+a,e(c.DATESELECTED).css({direction:"ltr","text-align":"right"})),e(c.DATESELECTED).html(i)}).fail(function(e){t.exception(e)}):e(c.DATESELECTED).html(M.util.get_string("alltime","local_edwiserreports"))}}});
//# sourceMappingURL=common.min.js.map
