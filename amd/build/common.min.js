"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["jquery","core/notification","core/fragment","core/modal_factory","core/modal_events","core/templates","core/str","./variables","./selectors","./templateselector","./jspdf","./select2","./jquery.dataTables","./dataTables.bootstrap4"],function(e,t,a,n,o,i,s,r,d,l,c){var u={TABLE:".edwiserreports-table",FILTER:".table-filter",SEARCHTABLE:".table-search-input input",PAGINATION:".table-pagination",PAGINATIONITEM:".paginate_button"};i.render("local_edwiserreports/insight-placeholder",{}),i.render("local_edwiserreports/insight",{});var f={show:function(t){var a;null==t?(t="body",a="position-fixed"):a="position-absolute",e(t).append('\n            <div class="edwiserreports-loader '.concat(a,'">\n                <div class="animation-wrapper">\n                    <div class="fa-animation">\n                        <i class="fa fa-cog fa-lg fa-spin"></i>\n                        <i class="fa fa-cog fa-md fa-spin spin-reverse"></i>\n                        <i class="fa fa-cog fa-sm fa-spin spin-reverse"></i>\n                    </div>\n                    ').concat(M.util.get_string("loading","moodle"),"\n                </div>\n            </div>\n            "))},hide:function(t){null==t&&(t="body"),e(t+" > .edwiserreports-loader").remove()}};function p(t){t.modal.find(".comparisontable .switch-capability").on("click",function(t){var a=e(t.currentTarget).find("input[type=radio]"),n=a.filter(":checked"),o=a.eq(a.index(n)+1);0===o.length&&(o=a.eq(0)),o.prop("checked",!0);var i=o.data("strpermission"),s=o.data("permissionclass");e(t.currentTarget).removeClass("inherit allow prevent prohibit"),e(t.currentTarget).addClass(s),e(t.currentTarget).find("label").html(i)})}return e(document).ready(function(){e(document).on("click",'.download-links button[value="pdf"]',function(t){t.preventDefault();var a=e(this).closest("form");e.ajax({url:a.attr("action"),type:"POST",data:{type:e(this).val(),block:a.find('input[name="block"]').val(),filter:a.find('input[name="filter"]').val(),cohortid:a.find('input[name="cohortid"]').val(),region:a.find('input[name="region"]').val()}}).done(function(e){e=JSON.parse(e);var t=c("p","pt","a4"),a={top:40,bottom:30,left:10,width:"100%"};t.setFontSize(10);t.fromHTML(e.data.html,a.left,a.top,{width:a.width,elementHandlers:{"#bypassme":function(e,t){return!0}}},function(a){t.save(e.data.filename)},a)}).always(function(){e(document).find("#cover-spin").hide()})}),e("#wdm-edwiserreports").removeClass("d-none"),e(document).on("click",d.blockSettingsBtn,function(i){i.preventDefault();var s=e(i.currentTarget).data("contextid"),d=e(i.currentTarget).data("blockname"),l=e(i.currentTarget).data("action");if("edit"==l)n.create({title:"Edit Block Setting",body:a.loadFragment("local_edwiserreports","get_blocksetting_form",s,{blockname:d})}).done(function(a){var n=a.getRoot();a.modal.addClass("modal-dialog-centered"),n.on(o.bodyRendered,function(){var n=a.modal.find(".block-settings-form");a.modal.find(".save-block-settings").on("click",function(a){a.preventDefault();var o=n.serializeArray(),i={};e(o).each(function(e,t){i[t.name]=t.value}),function(a,n){n.blockname=a,n=JSON.stringify(n);var o=e("#"+a).data("sesskey");e.ajax({url:r.requestUrl,type:"GET",data:{action:"set_block_preferences_ajax",sesskey:o,data:n}}).fail(function(e){console.log(e),t.addNotification({message:e,type:"error"})}).always(function(){location.reload()})}(d,i)})}),n.on(o.hidden,function(){a.destroy()}),a.show()});else if("hide"==l){var c=e(this).data("hidden"),u=e(this);e.ajax({url:r.requestUrl,type:"GET",data:{action:"toggle_hide_block_ajax",sesskey:M.cfg.sesskey,data:JSON.stringify({blockname:d,hidden:c})}}).done(function(e){(e=JSON.parse(e)).success&&(c?(u.closest(".edwiserReport-block").removeClass("block-hidden"),u.data("hidden",0),u.html(M.util.get_string("hide","local_edwiserreports"))):(u.closest(".edwiserReport-block").addClass("block-hidden"),u.data("hidden",1),u.html(M.util.get_string("unhide","local_edwiserreports"))))})}else"editcap"==l&&n.create({title:"Edit Block Capabilities",body:a.loadFragment("local_edwiserreports","get_blockscap_form",s,{blockname:d})}).done(function(n){var i=n.getRoot();n.modal.addClass("modal-dialog-centered modal-lg"),i.on(o.bodyRendered,function(){var o=n.modal.find(".block-cap-form");n.modal.find("#menucapabilities").on("change",function(t){t.preventDefault();var i=o.serializeArray(),r={};e(i).each(function(e,t){r[t.name]=t.value}),a.loadFragment("local_edwiserreports","block_overview_display",s,{capvalue:r.capabilities}).done(function(e,t,a){n.modal.find(".cap-overview").html(e),p(n)})}),p(n),o=n.modal.find(".block-cap-form"),n.modal.find(".save-block-caps").on("click",function(a){a.preventDefault();var i=o.serializeArray(),s={};e(i).each(function(e,t){s[t.name]=t.value}),function(a,n,o){n.blockname=a,n=JSON.stringify(n);var i=e("#"+a).data("sesskey");e.ajax({url:r.requestUrl,type:"GET",data:{action:"set_block_capability_ajax",sesskey:i,data:n}}).done(function(e){(e=JSON.parse(e)).success?(o(),location.reload()):t.addNotification({message:"Error",type:"error"})}).fail(function(e){console.log(e),t.addNotification({message:e,type:"error"})}).always(function(){o(),location.reload()})}(d,s,function(){n.hide()})})}),i.on(o.hidden,function(){n.destroy()}),n.show()})}),function(t){var a,n='<div id="editing-btn" class="d-flex flex-wrap">';n+='<div class="ml-auto d-flex">',t?(t=0,a="Stop Customising this page",n+='<div class="singlebutton">',n+='<form method="post" action="'+M.cfg.wwwroot+'/local/edwiserreports/index.php">',n+='<input type="hidden" name="reset" value="1">',n+='<input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'">',n+='<button type="submit" class="btn btn-secondary" title="">Reset Page to Default</button>',n+="</form>",n+="</div>"):(t=1,a="Customise this page");n+='<div class="singlebutton">',n+='<form method="post" action="'+M.cfg.wwwroot+'/local/edwiserreports/index.php">',n+='<input type="hidden" name="edit" value="'+t+'">',n+='<input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'">',n+='<button type="submit" class="btn btn-secondary" title="">'+a+"</button>",n+="</form>",n+="</div>",n+="</div></div>",e("#page-local-edwiserreports-index #page-header .card-body").append(n)}(e("#wdm-edwiserreports").data("editing"))}),{loader:f,insight:function(t,a){i.render("local_edwiserreports/insight-placeholder",{}).done(function(n,o){i.replaceNodeContents(t,n,o),i.render("local_edwiserreports/insight",a).done(function(e,a){i.replaceNodeContents(t,e,a)}).fail(function(a){Notification.exception(a),e(t).remove()})})},timeFormatter:function(e,t){e=Number(e);var a=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%3600%60);if("object"==_typeof(t)&&void 0!==t.dataPointIndex&&-1!==t.dataPointIndex){var i=[],s=void 0!==t.short&&t.short;return a>0&&(s?i.push(a+" h."):i.push(a+" "+(1==a?"hour":"hours"))),n>0&&(s?i.push(n+" min."):i.push(n+" "+(1==n?"minute":"minutes"))),o>0&&(s?0===i.length&&i.push(o+" sec."):i.push(o+" "+(1==o?"second":"seconds"))),0==i.length&&i.push(0),i.join(", ")}return[a>0?a<10?"0"+a:a:"00",n>0?n<10?"0"+n:n:"00",o>0?o<10?"0"+o:o:"00"].join(":")},dateChange:function(t){e(document).on("edwiserreport:datechange",function(e){t(e.detail.date)})},stylePaginationButton:function(t){var a=e(t).closest(u.TABLE).find(u.PAGINATION);a.find(u.PAGINATIONITEM).addClass(r.datatableClasses.buttonSpacing),a.find(u.PAGINATIONITEM+" a").addClass(r.datatableClasses.buttonSize),a.find(u.PAGINATIONITEM+".active a").addClass(r.datatableClasses.buttonActive),a.find(u.PAGINATIONITEM+":not(.active) a").addClass(r.datatableClasses.buttonInactive)},handleSearchInput:function(){e("body").on("input",u.SEARCHTABLE,function(){e(this).toggleClass("empty",""===e(this).val())})}}});
//# sourceMappingURL=common.min.js.map
