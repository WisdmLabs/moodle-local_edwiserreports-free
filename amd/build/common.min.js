"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["jquery","core/notification","core/fragment","core/modal_factory","core/modal_events","core/templates","./variables","./selectors","./select2","./jquery.dataTables","./dataTables.bootstrap4"],function(e,t,a,o,n,i,s,r){var l={TABLE:".edwiserreports-table",FILTER:".table-filter",SEARCHTABLE:".table-search-input input",PAGINATION:".table-pagination",PAGINATIONITEM:".paginate_button"};i.render("local_edwiserreports/insight-placeholder",{}),i.render("local_edwiserreports/insight",{});var d={show:function(t,a){var o;null==t?(t="body",o="position-fixed"):o="position-absolute",null!=a&&(o=a),e(t).append('\n            <div class="edwiserreports-loader '.concat(o,'">\n                <div class="animation-wrapper">\n                    <div class="fa-animation">\n                        <i class="fa fa-cog fa-lg fa-spin"></i>\n                        <i class="fa fa-cog fa-md fa-spin spin-reverse"></i>\n                        <i class="fa fa-cog fa-sm fa-spin spin-reverse"></i>\n                    </div>\n                    ').concat(M.util.get_string("loading","moodle"),"\n                </div>\n            </div>\n            "))},hide:function(t){null==t&&(t="body"),e(t+" > .edwiserreports-loader").remove()}};function c(t){t.modal.find(".comparisontable .switch-capability").on("click",function(t){var a=e(t.currentTarget).find("input[type=radio]"),o=a.filter(":checked"),n=a.eq(a.index(o)+1);0===n.length&&(n=a.eq(0)),n.prop("checked",!0);var i=n.data("strpermission"),s=n.data("permissionclass");e(t.currentTarget).removeClass("inherit allow prevent prohibit"),e(t.currentTarget).addClass(s),e(t.currentTarget).find("label").html(i)})}return e(document).ready(function(){e("#wdm-edwiserreports").removeClass("d-none"),e(document).on("click",r.blockSettingsBtn,function(r){r.preventDefault();var l=e(r.currentTarget).data("contextid"),d=e(r.currentTarget).data("blockname"),u=e(r.currentTarget).data("action");if("edit"==u)o.create({title:M.util.get_string("editblocksetting","local_edwiserreports"),body:a.loadFragment("local_edwiserreports","get_blocksetting_form",l,{blockname:d})}).done(function(a){var o=a.getRoot();a.modal.addClass("modal-dialog-centered"),o.on(n.bodyRendered,function(){var o=a.modal.find(".block-settings-form");a.modal.find(".save-block-settings").on("click",function(a){a.preventDefault();var n=o.serializeArray(),i={};e(n).each(function(e,t){i[t.name]=t.value}),function(a,o){o.blockname=a,o=JSON.stringify(o);var n=e("#"+a).data("sesskey");e.ajax({url:s.requestUrl,type:"GET",data:{action:"set_block_preferences_ajax",sesskey:n,data:o}}).fail(function(e){console.log(e),t.addNotification({message:e,type:"error"})}).always(function(){location.reload()})}(d,i)})}),o.on(n.hidden,function(){a.destroy()}),a.show()});else if("hide"==u){var p=e(this).data("hidden"),f=e(this);e.ajax({url:s.requestUrl,type:"GET",data:{action:"toggle_hide_block_ajax",sesskey:M.cfg.sesskey,data:JSON.stringify({blockname:d,hidden:p})}}).done(function(e){(e=JSON.parse(e)).success&&(p?(f.closest(".edwiserReport-block").removeClass("block-hidden"),f.data("hidden",0),f.html(M.util.get_string("hide","local_edwiserreports"))):(f.closest(".edwiserReport-block").addClass("block-hidden"),f.data("hidden",1),f.html(M.util.get_string("unhide","local_edwiserreports"))))})}else"editcap"==u&&o.create({title:M.util.get_string("editblockcapabilities","local_edwiserreports"),body:a.loadFragment("local_edwiserreports","get_blockscap_form",l,{blockname:d})}).done(function(o){var r=o.getRoot();o.modal.addClass("modal-dialog-centered modal-lg"),r.on(n.bodyRendered,function(){var n=o.modal.find(".block-cap-form");o.modal.find("#menucapabilities").on("change",function(t){t.preventDefault();var s=n.serializeArray(),r={};e(s).each(function(e,t){r[t.name]=t.value}),a.loadFragment("local_edwiserreports","block_overview_display",l,{capvalue:r.capabilities}).done(function(e,t,a){i.replaceNodeContents(o.modal.find(".cap-overview"),e,t),c(o)})}),c(o),n=o.modal.find(".block-cap-form"),o.modal.find(".save-block-caps").on("click",function(a){a.preventDefault();var i=n.serializeArray(),r={};e(i).each(function(e,t){r[t.name]=t.value}),function(a,o,n){o.blockname=a,o=JSON.stringify(o);var i=e("#"+a).data("sesskey");e.ajax({url:s.requestUrl,type:"GET",data:{action:"set_block_capability_ajax",sesskey:i,data:o}}).done(function(e){(e=JSON.parse(e)).success?(n(),location.reload()):t.addNotification({message:"Error",type:"error"})}).fail(function(e){console.log(e),t.addNotification({message:e,type:"error"})}).always(function(){n(),location.reload()})}(d,r,function(){o.hide()})})}),r.on(n.hidden,function(){o.destroy()}),o.show()})}),function(t){var a,o='<div id="editing-btn" class="d-flex flex-wrap">';o+='<div class="ml-auto d-flex">',t?(t=0,a="Stop Customising this page",o+='<div class="singlebutton">',o+='<form method="post" action="'+M.cfg.wwwroot+'/local/edwiserreports/index.php">',o+='<input type="hidden" name="reset" value="1">',o+='<input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'">',o+='<button type="submit" class="btn btn-secondary" title="">Reset Page to Default</button>',o+="</form>",o+="</div>"):(t=1,a="Customise this page");o+='<div class="singlebutton">',o+='<form method="post" action="'+M.cfg.wwwroot+'/local/edwiserreports/index.php">',o+='<input type="hidden" name="edit" value="'+t+'">',o+='<input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'">',o+='<button type="submit" class="btn btn-secondary" title="">'+a+"</button>",o+="</form>",o+="</div>",o+="</div></div>",e("#page-local-edwiserreports-index #page-header .card-body").append(o)}(e("#wdm-edwiserreports").data("editing"))}),{loader:d,toPrecision:function(e,t){return e%1==0?e:e.toPrecision(t)},insight:function(a,o){o.insight.title=M.util.get_string(o.insight.title,"local_edwiserreports"),void 0!==o.details&&void 0!==o.details.data&&o.details.data.forEach(function(e,t){o.details.data[t].title=M.util.get_string(e.title,"local_edwiserreports")}),i.render("local_edwiserreports/insight-placeholder",{}).done(function(n,s){i.replaceNodeContents(a,n,s),i.render("local_edwiserreports/insight",o).done(function(e,t){i.replaceNodeContents(a,e,t)}).fail(function(o){t.exception(o),e(a).remove()})})},timeFormatter:function(e,t){e=Number(e);var a=Math.floor(e/3600),o=Math.floor(e%3600/60),n=Math.floor(e%3600%60);if("object"==_typeof(t)&&void 0!==t.dataPointIndex&&-1!==t.dataPointIndex){var i=[],s=void 0!==t.short&&t.short;return a>0&&(s?i.push(a+" h."):i.push(a+" "+(1==a?M.util.get_string("hour","local_edwiserreports"):M.util.get_string("hours","local_edwiserreports")))),o>0&&(s?i.push(o+" min."):i.push(o+" "+(1==o?M.util.get_string("minute","local_edwiserreports"):M.util.get_string("minutes","local_edwiserreports")))),n>0&&(s?i.push(n+" sec."):i.push(n+" "+(1==n?M.util.get_string("second","local_edwiserreports"):M.util.get_string("seconds","local_edwiserreports")))),0==i.length&&i.push(0),i.join(", ")}return function(e,t,a){return(e=e>0?e<10?"0"+e:e:"00")+":"+(t=t>0?t<10?"0"+t:t:"00")+":"+(a=a>0?a<10?"0"+a:a:"00")}(a,o,n)},dateChange:function(t){e(document).on("edwiserreport:datechange",function(e){t(e.detail.date)})},stylePaginationButton:function(t){var a=e(t).closest(l.TABLE).find(l.PAGINATION);a.find(l.PAGINATIONITEM).length<4?a.addClass("d-none"):(a.removeClass("d-none"),a.find(l.PAGINATIONITEM).addClass(s.datatableClasses.buttonSpacing),a.find(l.PAGINATIONITEM+" a").addClass(s.datatableClasses.buttonSize),a.find(l.PAGINATIONITEM+".active a").addClass(s.datatableClasses.buttonActive),a.find(l.PAGINATIONITEM+":not(.active) a").addClass(s.datatableClasses.buttonInactive),a.find(l.PAGINATIONITEM+".previous a").addClass(s.datatableClasses.prevNextSpacing),a.find(l.PAGINATIONITEM+".next a").addClass(s.datatableClasses.prevNextSpacing),a.find(l.PAGINATIONITEM+".previous").removeClass(s.datatableClasses.buttonsSpacing).addClass("mx-4"),a.find(l.PAGINATIONITEM+".next").removeClass(s.datatableClasses.buttonsSpacing).addClass("mx-4"))},handleSearchInput:function(){e("body").on("input",l.SEARCHTABLE,function(){e(this).toggleClass("empty",""===e(this).val())})},handleFilterSize:function(t){var a=["col-md-3","col-md-4","col-md-6","col-md-12"],o=[];switch(e(t).find(".filter-selector:not(.d-none)").length){case 1:o=a.splice(a.indexOf("col-md-12"),1);break;case 2:o=a.splice(a.indexOf("col-md-6"),1);break;case 3:o=a.splice(a.indexOf("col-md-4"),1);break;case 4:o=a.splice(a.indexOf("col-md-3"),1)}e(t).find(".filter-selector").addClass(o.join(" ")).removeClass(a.join(" "))}}});
//# sourceMappingURL=common.min.js.map
