"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["jquery","core/notification","core/fragment","core/modal_factory","core/modal_events","core/templates","./variables","./defaultconfig","./selectors","./select2","./jquery.dataTables","./dataTables.bootstrap4"],function(e,t,a,o,n,r,i,l,s){var d={TABLE:".edwiserreports-table",FILTER:".table-filter",TAB:".edwiserreports-tabs .dropdown",DATESELECTED:".selected-period span",SEARCHTABLE:".table-search-input input",PAGINATION:".table-pagination",PAGINATIONITEM:".paginate_button"},c={GET_TIMEPERIOD_LABEL:function(t){return e.ajax({url:l.requestUrl,type:l.requestType,dataType:l.requestDataType,data:{action:"get_timeperiod_label_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:t}})}};r.render("local_edwiserreports/insight-placeholder",{}),r.render("local_edwiserreports/insight",{});var p={show:function(t,a){var o;null==t?(t="body",o="position-fixed"):o="position-absolute",null!=a&&(o=a),e(t).append('\n            <div class="edwiserreports-loader '.concat(o,'">\n                <div class="animation-wrapper">\n                    <div class="fa-animation">\n                        <i class="fa fa-cog fa-lg fa-spin"></i>\n                        <i class="fa fa-cog fa-md fa-spin spin-reverse"></i>\n                        <i class="fa fa-cog fa-sm fa-spin spin-reverse"></i>\n                    </div>\n                    ').concat(M.util.get_string("loading","moodle"),"\n                </div>\n            </div>\n            "))},hide:function(t){null==t&&(t="body"),e(t+" > .edwiserreports-loader").remove()}};function u(t){t.modal.find(".comparisontable .switch-capability").on("click",function(t){var a=e(t.currentTarget).find("input[type=radio]"),o=a.filter(":checked"),n=a.eq(a.index(o)+1);0===n.length&&(n=a.eq(0)),n.prop("checked",!0);var r=n.data("strpermission"),i=n.data("permissionclass");e(t.currentTarget).removeClass("inherit allow prevent prohibit"),e(t.currentTarget).addClass(i),e(t.currentTarget).find("label").html(r)})}function f(a,o,n){o.blockname=a,o=JSON.stringify(o);var r=e("#"+a).data("sesskey");e.ajax({url:i.requestUrl,type:"GET",data:{action:"set_block_capability_ajax",sesskey:r,data:o}}).done(function(e){(e=JSON.parse(e)).success?(n(),location.reload()):t.addNotification({message:"Error",type:"error"})}).fail(function(e){console.log(e),t.addNotification({message:e,type:"error"})}).always(function(){n(),location.reload()})}return e(document).ready(function(){e("#wdm-edwiserreports").removeClass("d-none"),e(document).on("click",s.blockSettingsBtn,function(l){l.preventDefault();var s=e(l.currentTarget).data("contextid"),d=e(l.currentTarget).data("blockname"),c=e(l.currentTarget).data("action");if("edit"==c)o.create({title:M.util.get_string("editblocksetting","local_edwiserreports"),body:a.loadFragment("local_edwiserreports","get_blocksetting_form",s,{blockname:d})}).done(function(a){var o=a.getRoot();a.modal.addClass("modal-dialog-centered"),o.on(n.bodyRendered,function(){var o=a.modal.find(".block-settings-form");a.modal.find(".save-block-settings").on("click",function(a){a.preventDefault();var n=o.serializeArray(),r={};e(n).each(function(e,t){r[t.name]=t.value}),function(a,o){o.blockname=a,o=JSON.stringify(o);var n=e("#"+a).data("sesskey");e.ajax({url:i.requestUrl,type:"GET",data:{action:"set_block_preferences_ajax",sesskey:n,data:o}}).fail(function(e){console.log(e),t.addNotification({message:e,type:"error"})}).always(function(){location.reload()})}(d,r)})}),o.on(n.hidden,function(){a.destroy()}),a.show()});else if("hide"==c){var p=e(this).data("hidden"),g=e(this);e.ajax({url:i.requestUrl,type:"GET",data:{action:"toggle_hide_block_ajax",sesskey:M.cfg.sesskey,data:JSON.stringify({blockname:d,hidden:p})}}).done(function(e){(e=JSON.parse(e)).success&&(p?(g.closest(".edwiserReport-block").removeClass("block-hidden"),g.data("hidden",0),g.html(M.util.get_string("hide","local_edwiserreports"))):(g.closest(".edwiserReport-block").addClass("block-hidden"),g.data("hidden",1),g.html(M.util.get_string("unhide","local_edwiserreports"))))})}else"editcap"==c&&o.create({title:M.util.get_string("editblockcapabilities","local_edwiserreports"),body:a.loadFragment("local_edwiserreports","get_blockscap_form",s,{blockname:d})}).done(function(t){var o=t.getRoot();t.modal.addClass("modal-dialog-centered modal-lg"),o.on(n.bodyRendered,function(){var o=t.modal.find(".block-cap-form");t.modal.find("#menucapabilities").on("change",function(n){n.preventDefault();var i=o.serializeArray(),l={};e(i).each(function(e,t){l[t.name]=t.value}),a.loadFragment("local_edwiserreports","block_overview_display",s,{capvalue:l.capabilities}).done(function(e,a,o){r.replaceNodeContents(t.modal.find(".cap-overview"),e,a),u(t)})}),u(t),o=t.modal.find(".block-cap-form"),t.modal.find(".save-block-caps").on("click",function(a){a.preventDefault();var n=o.serializeArray(),r={};e(n).each(function(e,t){r[t.name]=t.value}),f(d,r,function(){t.hide()})})}),o.on(n.hidden,function(){t.destroy()}),t.show()})}),function(t){var a,o='<div id="editing-btn" class="d-flex flex-wrap">';o+='<div class="ml-auto d-flex">',t?(t=0,a="Stop Customising this page",o+='<div class="singlebutton">',o+='<form method="post" action="'+M.cfg.wwwroot+'/local/edwiserreports/index.php">',o+='<input type="hidden" name="reset" value="1">',o+='<input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'">',o+='<button type="submit" class="btn btn-secondary" title="">Reset Page to Default</button>',o+="</form>",o+="</div>"):(t=1,a="Customise this page");o+='<div class="singlebutton">',o+='<form method="post" action="'+M.cfg.wwwroot+'/local/edwiserreports/index.php">',o+='<input type="hidden" name="edit" value="'+t+'">',o+='<input type="hidden" name="sesskey" value="'+M.cfg.sesskey+'">',o+='<button type="submit" class="btn btn-secondary" title="">'+a+"</button>",o+="</form>",o+="</div>",o+="</div></div>",e("#page-local-edwiserreports-index #page-header .card-body").append(o)}(e("#wdm-edwiserreports").data("editing"))}),{loader:p,toPrecision:function(e,t){return e%1==0?e:e.toPrecision(t)},insight:function(a,o){o.insight.title=M.util.get_string(o.insight.title,"local_edwiserreports"),void 0!==o.details&&void 0!==o.details.data&&o.details.data.forEach(function(e,t){o.details.data[t].title=M.util.get_string(e.title,"local_edwiserreports")}),r.render("local_edwiserreports/insight-placeholder",{}).done(function(n,i){r.replaceNodeContents(a,n,i),r.render("local_edwiserreports/insight",o).done(function(e,t){r.replaceNodeContents(a,e,t)}).fail(function(o){t.exception(o),e(a).remove()})})},timeFormatter:function(e,t){e=Number(e);var a=Math.floor(e/3600),o=Math.floor(e%3600/60),n=Math.floor(e%3600%60);if("object"==_typeof(t)&&void 0!==t.dataPointIndex&&-1!==t.dataPointIndex){var r=[],i=void 0!==t.short&&t.short;return a>0&&(i?r.push(a+" h."):r.push(a+" "+(1==a?M.util.get_string("hour","local_edwiserreports"):M.util.get_string("hours","local_edwiserreports")))),o>0&&(i?r.push(o+" min."):r.push(o+" "+(1==o?M.util.get_string("minute","local_edwiserreports"):M.util.get_string("minutes","local_edwiserreports")))),n>0&&(i?r.push(n+" sec."):r.push(n+" "+(1==n?M.util.get_string("second","local_edwiserreports"):M.util.get_string("seconds","local_edwiserreports")))),0==r.length&&r.push(0),r.join(", ")}return function(e,t,a){return(e=e>0?e<10?"0"+e:e:"00")+":"+(t=t>0?t<10?"0"+t:t:"00")+":"+(a=a>0?a<10?"0"+a:a:"00")}(a,o,n)},dateChange:function(t){e(document).on("edwiserreport:datechange",function(e){t(e.detail.date)})},stylePaginationButton:function(t){var a=e(t).closest(d.TABLE).find(d.PAGINATION);a.find(d.PAGINATIONITEM).length<4?a.addClass("d-none"):(a.removeClass("d-none"),a.find(d.PAGINATIONITEM).addClass(i.datatableClasses.buttonSpacing),a.find(d.PAGINATIONITEM+" a").addClass(i.datatableClasses.buttonSize),a.find(d.PAGINATIONITEM+".active a").addClass(i.datatableClasses.buttonActive),a.find(d.PAGINATIONITEM+":not(.active) a").addClass(i.datatableClasses.buttonInactive),a.find(d.PAGINATIONITEM+".previous a").addClass(i.datatableClasses.prevNextSpacing),a.find(d.PAGINATIONITEM+".next a").addClass(i.datatableClasses.prevNextSpacing),a.find(d.PAGINATIONITEM+".previous").removeClass(i.datatableClasses.buttonsSpacing).addClass("mx-4"),a.find(d.PAGINATIONITEM+".next").removeClass(i.datatableClasses.buttonsSpacing).addClass("mx-4"))},handleSearchInput:function(){e("body").on("input",d.SEARCHTABLE,function(){e(this).toggleClass("empty",""===e(this).val())})},headerNavigation:function(){e("body").on("click",function(t){var a=e(t.target).closest(d.TAB);e("".concat(d.TAB,".show")).not(a).closest(d.TAB).removeClass("show"),a.length&&a.closest(d.TAB).toggleClass("show")})},handleFilterSize:function(t){var a=["col-md-3","col-md-4","col-md-6","col-md-12"],o=[];switch(e(t).find(".filter-selector:not(.d-none)").length){case 1:o=a.splice(a.indexOf("col-md-12"),1);break;case 2:o=a.splice(a.indexOf("col-md-6"),1);break;case 3:o=a.splice(a.indexOf("col-md-4"),1);break;case 4:o=a.splice(a.indexOf("col-md-3"),1)}e(t).find(".filter-selector").addClass(o.join(" ")).removeClass(a.join(" "))},formatDate:function(e,t,a){var o=["\0","January","February","March","April","May","June","July","August","September","October","November","December"],n=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=["","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=["","Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function l(e,t){var a=e+"";for(t=t||2;a.length<t;)a="0"+a;return a}var s=a?e.getUTCFullYear():e.getFullYear();t=(t=(t=t.replace(/(^|[^\\])yyyy+/g,"$1"+s)).replace(/(^|[^\\])yy/g,"$1"+s.toString().substr(2,2))).replace(/(^|[^\\])y/g,"$1"+s);var d=(a?e.getUTCMonth():e.getMonth())+1;t=(t=(t=(t=t.replace(/(^|[^\\])MMMM+/g,"$1"+o[0])).replace(/(^|[^\\])MMM/g,"$1"+n[0])).replace(/(^|[^\\])MM/g,"$1"+l(d))).replace(/(^|[^\\])M/g,"$1"+d);var c=a?e.getUTCDate():e.getDate();t=(t=(t=(t=t.replace(/(^|[^\\])dddd+/g,"$1"+r[0])).replace(/(^|[^\\])ddd/g,"$1"+i[0])).replace(/(^|[^\\])dd/g,"$1"+l(c))).replace(/(^|[^\\])d/g,"$1"+c);var p=a?e.getUTCHours():e.getHours(),u=p>12?p-12:0==p?12:p;t=(t=(t=(t=t.replace(/(^|[^\\])HH+/g,"$1"+l(p))).replace(/(^|[^\\])H/g,"$1"+p)).replace(/(^|[^\\])hh+/g,"$1"+l(u))).replace(/(^|[^\\])h/g,"$1"+u);var f=a?e.getUTCMinutes():e.getMinutes();t=(t=t.replace(/(^|[^\\])mm+/g,"$1"+l(f))).replace(/(^|[^\\])m/g,"$1"+f);var g=a?e.getUTCSeconds():e.getSeconds();t=(t=t.replace(/(^|[^\\])ss+/g,"$1"+l(g))).replace(/(^|[^\\])s/g,"$1"+g);var m=a?e.getUTCMilliseconds():e.getMilliseconds();t=t.replace(/(^|[^\\])fff+/g,"$1"+l(m,3)),m=Math.round(m/10),t=t.replace(/(^|[^\\])ff/g,"$1"+l(m)),m=Math.round(m/10);var v=p<12?"AM":"PM";t=(t=(t=t.replace(/(^|[^\\])f/g,"$1"+m)).replace(/(^|[^\\])TT+/g,"$1"+v)).replace(/(^|[^\\])T/g,"$1"+v.charAt(0));var h=v.toLowerCase();t=(t=t.replace(/(^|[^\\])tt+/g,"$1"+h)).replace(/(^|[^\\])t/g,"$1"+h.charAt(0));var b=-e.getTimezoneOffset(),y=a||!b?"Z":b>0?"+":"-";if(!a){var T=(b=Math.abs(b))%60;y+=l(Math.floor(b/60))+":"+l(T)}t=t.replace(/(^|[^\\])K/g,"$1"+y);var _=(a?e.getUTCDay():e.getDay())+1;return t=(t=(t=(t=(t=t.replace(new RegExp(r[0],"g"),r[_])).replace(new RegExp(i[0],"g"),i[_])).replace(new RegExp(o[0],"g"),o[d])).replace(new RegExp(n[0],"g"),n[d])).replace(/\\(.)/g,"$1")},handleReportCapability:function(){var t=e(d.CAPEDIT).data("contextid"),i=e(d.CAPEDIT).data("reportname");e(d.CAPEDIT).click(function(){o.create({title:M.util.get_string("editreportcapabilities","local_edwiserreports"),body:a.loadFragment("local_edwiserreports","get_reportscap_form",t,{name:i})}).done(function(o){var l=o.getRoot();o.modal.addClass("modal-dialog-centered modal-lg"),l.on(n.bodyRendered,function(){var n=o.modal.find(".block-cap-form");o.modal.find("#menucapabilities").on("change",function(i){i.preventDefault();var l=n.serializeArray(),s={};e(l).each(function(e,t){s[t.name]=t.value}),a.loadFragment("local_edwiserreports","block_overview_display",t,{capvalue:s.capabilities}).done(function(e,t,a){r.replaceNodeContents(o.modal.find(".cap-overview"),e,t),u(o)})}),u(o),n=o.modal.find(".block-cap-form"),o.modal.find(".save-block-caps").on("click",function(t){t.preventDefault();var a=n.serializeArray(),r={};e(a).each(function(e,t){r[t.name]=t.value}),f(i,r,function(){o.hide()})})}),l.on(n.hidden,function(){o.destroy()}),o.show()})})},updateTimeLabel:function(a){"all"!=a?c.GET_TIMEPERIOD_LABEL(a).done(function(t){var a=new Date(864e5*t.startdate),o=new Date(864e5*t.enddate),n=a.getDate();n=n<10?"0"+n:n;var r=o.getDate();r=r<10?"0"+r:r,e(d.DATESELECTED).html("".concat(n," ").concat(a.toLocaleString("default",{month:"long"})," ").concat(a.getFullYear()," -\n            ").concat(r," ").concat(o.toLocaleString("default",{month:"long"})," ").concat(o.getFullYear(),"</span>"))}).fail(function(e){t.exception(e)}):e(d.DATESELECTED).html(M.util.get_string("alltime","local_edwiserreports"))}}});
//# sourceMappingURL=common.min.js.map
