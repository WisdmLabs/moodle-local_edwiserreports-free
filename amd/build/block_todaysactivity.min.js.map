{"version":3,"sources":["block_todaysactivity.js"],"names":["define","$","Notification","ApexCharts","CFG","common","Oldjquery","rtl","attr","init","invalidUser","todaysVisits","panel","getPanel","panelBody","flatpickrCalender","getTodaysActivity","date","loader","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","JSON","stringify","done","response","error","exception","errorcode","each","indx","el","find","html","todaysActivityBlock","graph","labels","datasets","label","labelName","backgroundColor","options","series","chart","height","toolbar","plotOptions","bar","borderRadius","horizontal","colors","ranges","from","to","grid","dataLabels","enabled","yaxis","tooltip","theme","custom","_ref","seriesIndex","dataPointIndex","w","config","xaxis","categories","getColorTheme","destroy","get","render","generateTodaysVisitsGraph","visitshour","fail","always","hide","document","ready","getTodaysActivityBlock","flatpickr","dateFormat","maxDate","defaultDate","onChange","selectedDates","dateStr","instance"],"mappings":"AAAA,aAuBAA,OAAO,CAAC,SAAU,oBAAqB,qBAAsB,kBAAmB,WAAY,8BAA+B,eAAgB,SAAUC,EAAGC,EAAcC,EAAYC,EAAKC,EAAQC,GAI7L,IAAIC,EAA+B,OAAzBN,EAAE,QAAQO,KAAK,OAAkB,EAAI,EAoK/C,MAAO,CACLC,KA/JF,SAAcC,GAEZ,IAAIC,EACAC,EAAQR,EAAIS,SAAS,wBACrBC,EAAYV,EAAIS,SAAS,uBAAwB,QACjDE,EAAoBH,EAAQ,qCAgChC,SAASI,EAAkBC,GAEzBZ,EAAOa,OAAOC,KAAK,wBAGnBlB,EAAEmB,KAAK,CACLC,IAAKjB,EAAIkB,WACTC,KAAMnB,EAAIoB,YACVC,SAAUrB,EAAIsB,gBACdC,KAAM,CACJC,OAAQ,+BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAM/B,EAAE,QAAQO,KAAK,QACrBmB,KAAMM,KAAKC,UAAU,CACnBjB,KAAMA,OAGTkB,KAAK,SAAUC,IACO,IAAnBA,EAASC,OAAmD,qBAAjCD,EAASE,UAAUC,WAQlDtC,EAAEuC,KAAKJ,EAAST,KAAM,SAAUc,EAAMC,GACtBzC,EAAEa,EAAY,YAAc2B,GAClCE,KAAK,SAASC,KAAKF,KAiBjC,SAAmCf,GAEjCvB,EAAIyC,oBAAoBC,MAAMnB,KAAOA,EACrCA,EAAO,CACLoB,OAAQ3C,EAAIyC,oBAAoBC,MAAMC,OACtCC,SAAU,CAAC,CACTC,MAAO7C,EAAIyC,oBAAoBC,MAAMI,UACrCvB,KAAMvB,EAAIyC,oBAAoBC,MAAMnB,KACpCwB,gBAAiB/C,EAAIyC,oBAAoBC,MAAMK,mBAGnD,IAAIC,EAAU,CACZC,OAAQ,CAAC,CACP1B,KAAMvB,EAAIyC,oBAAoBC,MAAMnB,OAEtC2B,MAAO,CACL/B,KAAM,MACNgC,OAAQ,IACRC,QAAS,CACPrC,MAAM,IAGVsC,YAAa,CACXC,IAAK,CACHC,aAAc,EACdC,YAAY,EACZC,OAAQ,CACNC,OAAQ,CAAC,CACPC,KAAM,EACNC,GAAI,SAKZC,KAAM,CACJ9C,MAAM,GAER+C,WAAY,CACVC,SAAS,GAEXC,MAAO,CACLjD,MAAM,GAERkD,QAAS,CACPC,MAAO,OACPC,OAAQ,SAAUC,GAChB,IAAInB,OACFA,EAAMoB,YACNA,EAAWC,eACXA,EAAcC,EACdA,GACEH,EACJ,MAAO,gCAAkCG,EAAEC,OAAOC,MAAMC,WAAWJ,GAAkB,OAASrB,EAAOoB,GAAaC,GAAkB,WAGxIG,MAAO,CACLC,WAAY1E,EAAIyC,oBAAoBC,MAAMC,QAE5Cc,OAAQ,CAACzD,EAAI2E,gBAAgB,KAO3BpE,GACFA,EAAaqE,WAIfrE,EAAe,IAAIR,EAAWF,EAAE,+BAA+BgF,IAAI,GAAI7B,IAC1D8B,SApFXC,CAA0B/C,EAAST,KAAKyD,aAbtC1E,EAAY,sBAAuB0B,KAcpCiD,KAAK,SAAUhD,GAChBnC,EAAaoC,UAAUD,KACtBiD,OAAO,WAERjF,EAAOa,OAAOqE,KAAK,0BAhEvBtF,EAAEuF,UAAUC,MAAM,WAChBrF,EAAIyC,oBAAsBzC,EAAIsF,yBAG1BtF,EAAIyC,sBACN7B,IAKAV,EAAUS,GAAmB4E,UAAU,CACrCC,WAAYrF,EAAM,QAAU,QAC5BsF,QAAS,QACTC,YAAa,CAAC,SAEdC,SAAU,SAAUC,EAAeC,EAASC,GAE1ClF,EAAkBiF","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/notification',\n    './chart/apexcharts',\n    './defaultconfig',\n    './common',\n    'local_edwiserreports/jquery',\n    './flatpickr'\n], function($, Notification, ApexCharts, CFG, common, Oldjquery) {\n\n\t/**\n\t*\n\t*/\n\tvar rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n\n\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        // Global data got todays activity block\n        var todaysVisits;\n        var panel = CFG.getPanel(\"#todaysactivityblock\");\n        var panelBody = CFG.getPanel(\"#todaysactivityblock\", \"body\");\n        var flatpickrCalender = panel + \" #flatpickrCalender-todaysactivity\";\n\n        /**\n         * On document ready do the bellow stuff\n         */\n        $(document).ready(function() {\n            CFG.todaysActivityBlock = CFG.getTodaysActivityBlock();\n\n            // If course progress block is there\n            if (CFG.todaysActivityBlock) {\n                getTodaysActivity();\n                /**\n                 * Generate flatpicker for\n                 * date filter in todays activity block\n                 */\n                Oldjquery(flatpickrCalender).flatpickr({\n                    dateFormat: rtl ? \"Y M d\" : \"d M Y\",\n                    maxDate: \"today\",\n                    defaultDate: [\"today\"],\n                    // eslint-disable-next-line no-unused-vars\n                    onChange: function(selectedDates, dateStr, instance) {\n                        // $(panelBody).find(\"loader\").show();\n                        getTodaysActivity(dateStr);\n                    }\n                });\n            }\n        });\n\n        /**\n         * Get Todays activity information\n         * @param  {number} date Unix Date\n         */\n        function getTodaysActivity(date) {\n\n            // Show loader.\n            common.loader.show('#todaysactivityblock');\n\n            // Send Ajax call to get todays activity information\n            $.ajax({\n                    url: CFG.requestUrl,\n                    type: CFG.requestType,\n                    dataType: CFG.requestDataType,\n                    data: {\n                        action: 'get_todaysactivity_data_ajax',\n                        secret: M.local_edwiserreports.secret,\n                        lang: $('html').attr('lang'),\n                        data: JSON.stringify({\n                            date: date\n                        })\n                    }\n                }).done(function(response) {\n                    if (response.error === true && response.exception.errorcode === 'invalidsecretkey') {\n                        invalidUser('todaysactivityblock', response);\n                        return;\n                    }\n                    /**\n                     * After getting todays activity information\n                     * update the value in todays activity block\n                     */\n                    $.each(response.data, function(indx, el) {\n                        var section = $(panelBody + \" #todays-\" + indx);\n                        section.find(\".data\").html(el);\n                    });\n\n                    /* Generate Todays Activity Graph */\n                    generateTodaysVisitsGraph(response.data.visitshour);\n                })\n                .fail(function(error) {\n                    Notification.exception(error);\n                }).always(function() {\n                    // Hide loader.\n                    common.loader.hide('#todaysactivityblock');\n                });\n        }\n\n        /**\n         * Generate Todays Activity Graph\n         * @param  {object} data Todays activity object\n         */\n        function generateTodaysVisitsGraph(data) {\n            // Prepare data for generating graph\n            CFG.todaysActivityBlock.graph.data = data;\n            data = {\n                labels: CFG.todaysActivityBlock.graph.labels,\n                datasets: [{\n                    label: CFG.todaysActivityBlock.graph.labelName,\n                    data: CFG.todaysActivityBlock.graph.data,\n                    backgroundColor: CFG.todaysActivityBlock.graph.backgroundColor\n                }]\n            };\n\n            var options = {\n                series: [{\n                    data: CFG.todaysActivityBlock.graph.data\n                }],\n                chart: {\n                    type: 'bar',\n                    height: 150,\n                    toolbar: {\n                        show: false\n                    }\n                },\n                plotOptions: {\n                    bar: {\n                        borderRadius: 4,\n                        horizontal: false,\n                        colors: {\n                            ranges: [{\n                                from: 0,\n                                to: 100\n                            }]\n                        }\n                    }\n                },\n                grid: {\n                    show: false\n                },\n                dataLabels: {\n                    enabled: false\n                },\n                yaxis: {\n                    show: false\n                },\n                tooltip: {\n                    theme: 'dark',\n                    custom: function({\n                        series,\n                        seriesIndex,\n                        dataPointIndex,\n                        w\n                    }) {\n                        return '<div class=\"text-center p-1\">' +\n                            w.config.xaxis.categories[dataPointIndex] +\n                            '<br>' +\n                            series[seriesIndex][dataPointIndex] +\n                            '</div>';\n                    }\n                },\n                xaxis: {\n                    categories: CFG.todaysActivityBlock.graph.labels,\n                },\n                colors: [CFG.getColorTheme()[2]]\n            };\n\n            /**\n             * If Todays Activity graph is already\n             * created then destroy\n             */\n            if (todaysVisits) {\n                todaysVisits.destroy();\n            }\n\n            // Generate Todays Activity Graph\n            todaysVisits = new ApexCharts($('#apex-chart-todays-activity').get(0), options);\n            todaysVisits.render();\n        }\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"block_todaysactivity.min.js"}