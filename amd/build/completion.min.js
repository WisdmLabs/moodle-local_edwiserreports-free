/**
 * Plugin administration pages are defined here.
 *
 * @copyright   2021 wisdmlabs <support@wisdmlabs.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/ define(["jquery","./variables","./common","./select2"],function(t,e,n){var a={PANEL:"#wdm-completion-individual",FORMFILTER:'.download-links [name="filter"]',FORMRTL:'.download-links [name="rtl"]',FILTERS:".filters"};let l="rtl"==t("html").attr("dir")?1:0;return{init:function i(r){var o="#wdm-completion-individual",s=t(o).find(".table"),d=null,c=10,u=0;function m(a,l){n.loader.show(o);var i={action:"get_completion_data_ajax",sesskey:t(o).data("sesskey"),data:JSON.stringify({courseid:a,cohortid:l})};null!==d&&d.destroy(),d=s.DataTable({dom:'<"edwiserreports-table"<"table-filter d-flex"i><t><"table-pagination"p>>',ajax:e.generateUrl(e.requestUrl,i),pageLength:c,language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nostudentsenrolled","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},columns:[{data:"username"},{data:"enrolledon",render:function(e){return("rtl"==t("html").attr("dir")?1:0)?'<label style="direction:ltr;">'+e+"</label>":e},width:"10rem"},{data:"enrolltype"},{data:"noofvisits"},{data:"completion"},{data:"compleiontime",render:function(e){return("rtl"==t("html").attr("dir")?1:0)?'<label style="direction:ltr;">'+e+"</label>":e},width:"10rem"},{data:"grade"},{data:"lastaccess",render:function(e){let a=n.formatDate(new Date(1e3*e),"d MMM yyyy hh:mm TT").substring(0,11)+"<br>"+n.formatDate(new Date(1e3*e),"d MMM yyyy hh:mm TT").substring(11,20);return("rtl"==t("html").attr("dir")?1:0)&&(a=n.formatDate(new Date(1e3*e),"TT mm:hh yyyy MMM d").substring(8,20)+"<br>"+n.formatDate(new Date(1e3*e),"TT mm:hh yyyy MMM d").substring(0,8)),`<p class="erp-time-rtl"><span class="d-none">${e}</span>`+(0==e?M.util.get_string("never","local_edwiserreports"):a)+"</p>"},width:"10rem"}],drawCallback:function(){n.stylePaginationButton(this)},columnDefs:[{className:"text-left",targets:[0,1]},{className:"text-right",targets:"_all"}],initComplete:function(){n.loader.hide(o)}})}t(document).ready(function(){n.handleSearchInput();var e=t(o).find('.download-links input[name="filter"]').val();t(a.PANEL).find(a.FORMRTL).val(l),m(e,u),t(o).find(".cohort-select").on("change",function(){u=t(this).val(),t(o).find('.download-links input[name="cohortid"]').val(u),m(e,u)}),t(o).find(".course-select").on("change",function(){window.location=M.cfg.wwwroot+"/local/edwiserreports/completion.php?courseid="+t(this).val()}),t(o).find(".singleselect").select2(),t("#wdm-completion-individual .table-length-input select").on("change",function(){d.page.len(this.value).draw(),c=this.value}),t("#wdm-completion-individual .table-search-input input").on("input",function(){d.column(0).search(this.value).draw()})})}}});
