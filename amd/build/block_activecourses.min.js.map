{"version":3,"sources":["block_activecourses.js"],"names":["define","$","CFG","common","SELECTOR","PANEL","TABLE","SEARCH","USERS","dataTable","PROMISE","GET_ACTIVECOURSES","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","attr","init","invalidUser","length","find","select2","selectionTitleAttribute","loader","show","done","response","destroy","DataTable","responsive","dom","aaSorting","aoColumns","orderSequence","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","columnDefs","targets","className","orderable","lengthChange","bInfo","on","column","order","nodes","each","cell","i","img","image_url","innerHTML","addClass","draw","fail","console","log","always","hide","concat","columns","search","val"],"mappings":"AAAA,aA4BAA,OAAO,CAAC,SAAU,kBAAmB,YAAa,SAAUC,EAAGC,EAAKC,GAIlE,IAAIC,EAAW,CACbC,MAAO,sBACPC,MAAO,4BACPC,OAAQ,4BACRC,MAAO,6CAMLC,EAAY,KAKZC,EAAU,CAKZC,kBAAmB,WACjB,OAAOV,EAAEW,KAAK,CACZC,IAAKX,EAAIY,WACTC,KAAMb,EAAIc,YACVC,SAAUf,EAAIgB,gBACdC,KAAM,CACJC,OAAQ,8BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAMvB,EAAE,QAAQwB,KAAK,aAwG7B,MAAO,CACLC,KAnBF,SAAcC,GAEqB,IAA7B1B,EAAEG,EAASC,OAAOuB,SAKtB3B,EAAEG,EAASC,OAAOwB,KAAK,iBAAiBC,QAAQ,CAC9CC,yBAAyB,IAnF3B5B,EAAO6B,OAAOC,KAAK7B,EAASC,OAC5BK,EAAQC,oBAAoBuB,KAAK,SAAUC,GACvB,OAAd1B,GACFA,EAAU2B,WAGZ3B,EAAYR,EAAEG,EAASE,OAAO+B,UAAU,CACtCC,YAAY,EACZnB,KAAMgB,EAAShB,KACfoB,IAAK,mDACLC,UAAW,CAAC,CAAC,EAAG,SAChBC,UAAW,CAAC,KAAM,KAAM,CACtBC,cAAiB,CAAC,SACjB,CACDA,cAAiB,CAAC,SACjB,CACDA,cAAiB,CAAC,UAEpBC,SAAU,CACRC,KAAMtB,EAAEuB,KAAKC,WAAW,YAAa,wBACrCC,UAAWzB,EAAEuB,KAAKC,WAAW,YAAa,wBAC1CE,WAAY1B,EAAEuB,KAAKC,WAAW,YAAa,wBAC3CG,YAAa3B,EAAEuB,KAAKC,WAAW,cAAe,wBAC9CI,SAAU,CACRC,SAAU7B,EAAEuB,KAAKC,WAAW,WAAY,UACxCM,KAAM9B,EAAEuB,KAAKC,WAAW,OAAQ,YAGpCO,aAAc,WACZlD,EAAOmD,sBAAsBC,OAE/BC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,iBACbC,WAAa,GACZ,CACDF,QAAW,EACXC,UAAa,YACbC,WAAa,GACZ,CACDF,QAAW,OACXC,UAAa,gBAEfE,cAAc,EACdC,OAAO,KAICC,GAAG,WAAY,WACvBrD,EAAUsD,OAAO,EAAG,CAClBC,MAAO,YACNC,QAAQC,KAAK,SAAUC,EAAMC,GAC9B,IAAIC,EAAM,GAEND,GAAK,GAAKA,GAAK,IACjBC,EAAM,0BAA4B/C,EAAEuB,KAAKyB,UAAU,UAAY,CAAC,OAAQ,SAAU,UAAUF,GAAI,wBAA0B,YAG5HD,EAAKI,UAAYH,EAAI,EAAIC,IAE3BpE,EAAEG,EAASE,MAAQ,0BAA0BkE,SAAS,cACrDC,SACFC,KAAK,SAAUvD,GAChBwD,QAAQC,IAAIzD,KACX0D,OAAO,WAER1E,EAAO6B,OAAO8C,KAAK1E,EAASC,SAqB9BJ,EAAE,QAAQ6D,GAAG,QAAS,GAAGiB,OAAO3E,EAASC,MAAO,KAAK0E,OAAO3E,EAASG,QAAS,WAC5EE,EAAUuE,QAAQ,GAAGC,OAAOhF,EAAEsD,MAAM2B,OAAOT","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Active Courses / Popular Courses block.\n *\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    './defaultconfig',\n    './common',\n], function(\n    $,\n    CFG,\n    common\n) {\n\n    /**\n     * Selectors.\n     */\n    var SELECTOR = {\n        PANEL: '#activecoursesblock',\n        TABLE: '#activecoursesblock table',\n        SEARCH: '.table-search-input input',\n        USERS: '#activecoursesblock table a.modal-trigger'\n    };\n\n    /**\n     * Data table object.\n     */\n    var dataTable = null;\n\n    /**\n     * Promises list.\n     */\n    let PROMISE = {\n        /**\n         * Get active courses.\n         * @returns {PROMISE}\n         */\n        GET_ACTIVECOURSES: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_activecourses_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang')\n                },\n            });\n        }\n    };\n\n    /**\n     * Load data to dataTable using ajax.\n     */\n    function loadData() {\n        // Show loader.\n        common.loader.show(SELECTOR.PANEL);\n\n        PROMISE.GET_ACTIVECOURSES().done(function(response) {\n                if (dataTable !== null) {\n                    dataTable.destroy();\n                }\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    responsive: true,\n                    data: response.data,\n                    dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                    aaSorting: [\n                        [2, 'desc']\n                    ],\n                    aoColumns: [null, null, {\n                        \"orderSequence\": [\"desc\"]\n                    }, {\n                        \"orderSequence\": [\"desc\"]\n                    }, {\n                        \"orderSequence\": [\"desc\"]\n                    }],\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('nocourses', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: M.util.get_string('previous', 'moodle'),\n                            next: M.util.get_string('next', 'moodle')\n                        }\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                    },\n                    columnDefs: [{\n                            \"targets\": 0,\n                            \"className\": \"text-left pl-5\",\n                            \"orderable\": false\n                        },\n                        {\n                            \"targets\": 1,\n                            \"className\": \"text-left\",\n                            \"orderable\": false\n                        },\n                        {\n                            \"targets\": \"_all\",\n                            \"className\": \"text-center\",\n                        }\n                    ],\n                    lengthChange: false,\n                    bInfo: false\n                });\n                /* Added fixed column rank in datatable */\n                dataTable.on('order.dt', function() {\n                    dataTable.column(0, {\n                        order: 'applied'\n                    }).nodes().each(function(cell, i) {\n                        let img = '';\n                        if (i >= 0 && i <= 2) {\n                            img = \"<img class='ml-1' src='\" + M.util.image_url(\n                                'trophy/' + ['gold', 'silver', 'bronze'][i],\n                                'local_edwiserreports'\n                            ) + \"'></img>\";\n                        }\n                        cell.innerHTML = (i + 1) + img;\n                    });\n                    $(SELECTOR.TABLE + \" td:not(.bg-secondary)\").addClass(\"bg-white\");\n                }).draw();\n            })\n            .fail(function(data) {\n                console.log(data);\n            })\n            .always(function() {\n                // Hide loader.\n                common.loader.hide(SELECTOR.PANEL);\n            });\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n\n        // Block not present on page.\n        if ($(SELECTOR.PANEL).length === 0) {\n            return;\n        }\n\n        // Enable select2 on cohort filter.\n        $(SELECTOR.PANEL).find('.singleselect').select2({\n            selectionTitleAttribute: false\n        });\n\n        loadData();\n\n        // Search in table.\n        $('body').on('input', `${SELECTOR.PANEL} ${SELECTOR.SEARCH}`, function() {\n            dataTable.columns(1).search($(this).val()).draw();\n        });\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});"],"file":"block_activecourses.min.js"}