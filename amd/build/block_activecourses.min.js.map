{"version":3,"sources":["block_activecourses.js"],"names":["define","$","cfg","V","common","init","invalidUser","activeCourseTable","panel","getPanel","panelBody","loader","table","searchTable","length","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","done","response","error","exception","errorcode","destroy","DataTable","responsive","dom","aaSorting","aoColumns","orderSequence","language","searchPlaceholder","initComplete","hide","fadeIn","drawCallback","stylePaginationButton","this","columnDefs","targets","className","orderable","lengthChange","bInfo","on","column","order","nodes","each","cell","i","img","util","image_url","innerHTML","addClass","draw","search","value","fail","always"],"mappings":"AAAA,aA0BAA,OAAO,CAAC,SAAU,kBAAmB,cAAe,WAAY,sBAAuB,2BAA4B,SAAUC,EAAGC,EAAKC,EAAGC,GAqHtI,MAAO,CACLC,KAjHF,SAAcC,GACZ,IAAIC,EACAC,EAAQN,EAAIO,SAAS,uBACrBC,EAAYR,EAAIO,SAAS,sBAAuB,QAChDE,EAASD,EAAY,WACrBE,EAAQF,EAAY,UACpBG,EAAcL,EAAQ,6BAEtBP,EAAEO,GAAOM,SAEXV,EAAOO,OAAOI,KAAK,uBAGnBd,EAAEe,KAAK,CACLC,IAAKf,EAAIgB,WACTC,KAAMjB,EAAIkB,YACVC,SAAUnB,EAAIoB,gBACdC,KAAM,CACJC,OAAQ,8BACRC,OAAQC,EAAEC,qBAAqBF,UAEhCG,KAAK,SAAUC,GAyCpB,IAAiCN,GAxCN,IAAnBM,EAASC,OAAmD,qBAAjCD,EAASE,UAAUC,WAwCrBT,EAjCLM,EAASN,KAmC/BhB,GACFA,EAAkB0B,WAKpB1B,EAAoBN,EAAEW,GAAOsB,UAAU,CACrCC,YAAY,EACZZ,KAAMA,EACNa,IAAK,mDACLC,UAAW,CAAC,CAAC,EAAG,SAChBC,UAAW,CAAC,KAAM,KAAM,CACtBC,cAAiB,CAAC,SACjB,CACDA,cAAiB,CAAC,SACjB,CACDA,cAAiB,CAAC,UAEpBC,SAAU,CACRC,kBAAmB,iBAErBC,aAAc,WAEZzC,EAAEU,GAAQgC,OACV1C,EAAEW,GAAOgC,OAAO,SAElBC,aAAc,WACZzC,EAAO0C,sBAAsBC,OAE/BC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,iBACbC,WAAa,GACZ,CACDF,QAAW,EACXC,UAAa,YACbC,WAAa,GACZ,CACDF,QAAW,OACXC,UAAa,gBAEfE,cAAc,EACdC,OAAO,KA1EWC,GAAG,WAAY,WAC/B/C,EAAkBgD,OAAO,EAAG,CAC1BC,MAAO,YACNC,QAAQC,KAAK,SAAUC,EAAMC,GAC9B,IAAIC,EAAM,GAEND,GAAK,GAAKA,GAAK,IACjBC,EAAM,0BAA4BnC,EAAEoC,KAAKC,UAAU,UAAY,CAAC,OAAQ,SAAU,UAAUH,GAAI,wBAA0B,YAG5HD,EAAKK,UAAYJ,EAAI,EAAIC,IAE3B5D,EAAEW,EAAQ,0BAA0BqD,SAAS,cAC5CC,OAEHjE,EAAE,QAAQqD,GAAG,QAASzC,EAAa,WACjCN,EAAkBgD,OAAO,GAAGY,OAAOpB,KAAKqB,OAAOF,UAzB/C5D,EAAY,qBAAsBuB,KA2BnCwC,KAAK,SAAUvC,MACfwC,OAAO,WAERlE,EAAOO,OAAOgC,KAAK","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    './defaultconfig',\n    './variables',\n    './common',\n    './jquery.dataTables',\n    './dataTables.bootstrap4'\n], function(\n    $,\n    cfg,\n    V,\n    common\n) {\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        var activeCourseTable;\n\n        var panel = cfg.getPanel(\"#activecoursesblock\");\n        var panelBody = cfg.getPanel(\"#activecoursesblock\", \"body\");\n        var loader = panelBody + \" .loader\";\n        var table = panelBody + \" .table\";\n        var searchTable = panel + ' .table-search-input input';\n\n        if ($(panel).length) {\n            // Show loader.\n            common.loader.show('#activecoursesblock');\n\n            /* Ajax request to get data for active courses table */\n            $.ajax({\n                    url: cfg.requestUrl,\n                    type: cfg.requestType,\n                    dataType: cfg.requestDataType,\n                    data: {\n                        action: 'get_activecourses_data_ajax',\n                        secret: M.local_edwiserreports.secret\n                    },\n                }).done(function(response) {\n                    if (response.error === true && response.exception.errorcode === 'invalidsecretkey') {\n                        invalidUser('activecoursesblock', response);\n                        return;\n                    }\n                    /* Create active course table */\n                    createActiveCourseTable(response.data);\n                    /* Added fixed column rank in datatable */\n                    activeCourseTable.on('order.dt', function() {\n                        activeCourseTable.column(0, { order: 'applied' }).nodes().each(function(cell, i) {\n                            let img = '';\n                            if (i >= 0 && i <= 2) {\n                                img = \"<img class='ml-1' src='\" + M.util.image_url('trophy/' + ['gold', 'silver', 'bronze'][i], 'local_edwiserreports') + \"'></img>\";\n                            }\n                            cell.innerHTML = (i + 1) + img;\n                        });\n                        $(table + \" td:not(.bg-secondary)\").addClass(\"bg-white\");\n                    }).draw();\n\n                    // Search in table.\n                    $('body').on('input', searchTable, function() {\n                        activeCourseTable.column(1).search(this.value).draw();\n                    });\n                })\n                .fail(function(error) {\n                    // console.log(error);\n                })\n                .always(function() {\n                    // Hide loader.\n                    common.loader.hide('#activecoursesblock');\n                });\n        }\n\n        /**\n         * Create active course table.\n         * @param {object} data Table data object\n         */\n        function createActiveCourseTable(data) {\n            /* If datable already created the destroy the table*/\n            if (activeCourseTable) {\n                activeCourseTable.destroy();\n            }\n\n            /* Create datatable for active courses */\n            activeCourseTable = $(table).DataTable({\n                responsive: true,\n                data: data,\n                dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                aaSorting: [\n                    [2, 'desc']\n                ],\n                aoColumns: [\n                    null,\n                    null,\n                    { \"orderSequence\": [\"desc\"] },\n                    { \"orderSequence\": [\"desc\"] },\n                    { \"orderSequence\": [\"desc\"] }\n                ],\n                language: {\n                    searchPlaceholder: \"Search Course\"\n                },\n                initComplete: function() {\n                    /* Remove laoder and display table after table is created */\n                    $(loader).hide();\n                    $(table).fadeIn(\"slow\");\n                },\n                drawCallback: function() {\n                    common.stylePaginationButton(this);\n                },\n                columnDefs: [{\n                        \"targets\": 0,\n                        \"className\": \"text-left pl-5\",\n                        \"orderable\": false\n                    },\n                    {\n                        \"targets\": 1,\n                        \"className\": \"text-left\",\n                        \"orderable\": false\n                    },\n                    {\n                        \"targets\": \"_all\",\n                        \"className\": \"text-center\",\n                    }\n                ],\n                lengthChange: false,\n                bInfo: false\n            });\n        }\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"block_activecourses.min.js"}