{"version":3,"sources":["courseanalytics.js"],"names":["define","$","V","init","CONTEXTID","PageId","RecentVisits","find","RecentEnroled","RecentCompletion","loader","RecentVisitsTable","RecentEnroledTable","RecentCompletionTable","cohortId","getCourseAnalyticsData","courseId","sesskey","data","ajax","url","requestUrl","type","requestType","dataType","requestDataType","action","JSON","stringify","courseid","cohortid","done","response","generateDataTable","recentvisits","recentenrolments","recentcompletions","fail","error","console","log","always","window","resize","fadeIn","tableId","table","emptyStr","M","util","get_string","destroy","hide","DataTable","responsive","language","info","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","columnDefs","className","targets","drawCallback","addClass","order","bInfo","lengthChange","document","ready","getUrlParameter","cohortFilterBtn","on","this","html","text"],"mappings":"AAAA,aAyBAA,OAAO,CAAC,SAAU,iCAAkC,yCAA0C,6CAA8C,+BAAgC,SAAUC,EAAGC,GA+HvL,MAAO,CACLC,KAzHF,SAAcC,GAEZ,IAAIC,EAASJ,EAAE,mCACXK,EAAeD,EAAOE,KAAK,yBAC3BC,EAAgBH,EAAOE,KAAK,4BAC5BE,EAAmBJ,EAAOE,KAAK,6BAC/BG,EAAST,EAAE,WACXU,EAAoB,KACpBC,EAAqB,KACrBC,EAAwB,KAExBC,EAAW,EAqBf,SAASC,EAAuBC,EAAUF,GACxC,IAAIG,EAAUZ,EAAOa,KAAK,WAC1BjB,EAAEkB,KAAK,CACLC,IAAKlB,EAAEmB,WACPC,KAAMpB,EAAEqB,YACRC,SAAUtB,EAAEuB,gBACZP,KAAM,CACJQ,OAAQ,gCACRT,QAASA,EACTC,KAAMS,KAAKC,UAAU,CACnBC,SAAUb,EACVc,SAAUhB,OAGbiB,KAAK,SAAUC,GAEhBrB,EAAoBsB,EAAkB3B,EAAcK,EAAmBqB,EAASd,KAAKgB,cAGrFtB,EAAqBqB,EAAkBzB,EAAeI,EAAoBoB,EAASd,KAAKiB,kBAGxFtB,EAAwBoB,EAAkBxB,EAAkBI,EAAuBmB,EAASd,KAAKkB,qBAChGC,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WACRxC,EAAEyC,QAAQC,SACVtC,EAAOuC,OAAO,UAYlB,SAASX,EAAkBY,EAASC,EAAO5B,GACzC,IAAI6B,EAAWC,EAAEC,KAAKC,WAAW,kBAAmB,wBA4CpD,OA1CIL,GAAWpC,EACbsC,EAAWC,EAAEC,KAAKC,WAAW,mBAAoB,wBACxCL,GAAWvC,IACpByC,EAAWC,EAAEC,KAAKC,WAAW,iBAAkB,yBAGnC,OAAVJ,GACFA,EAAMK,UAGRzC,EAAO0C,OACPP,EAAQD,OAAO,QACfvC,EAAOuC,OAAO,QACdE,EAAQD,EAAQQ,UAAU,CACxBnC,KAAMA,EACNoC,YAAY,EACZC,SAAU,CACRC,KAAMR,EAAEC,KAAKC,WAAW,YAAa,wBACrCO,UAAWT,EAAEC,KAAKC,WAAW,YAAa,wBAC1CQ,WAAYX,EACZY,YAAaX,EAAEC,KAAKC,WAAW,cAAe,wBAC9CU,SAAU,CACRC,SAAUb,EAAEC,KAAKC,WAAW,WAAY,UACxCY,KAAMd,EAAEC,KAAKC,WAAW,OAAQ,YAGpCa,WAAY,CAAC,CACXC,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,cACXC,QAAS,SAEXC,aAAc,WACZjE,EAAE,sCAAsCkE,SAAS,4BACjDlE,EAAE,sBAAsBkE,SAAS,6BAEnCC,MAAO,CAAC,CAAC,EAAG,SACZC,OAAO,EACPC,cAAc,IAnGlBrE,EAAEsE,UAAUC,MAAM,WAChB,IAAIxD,EAAWd,EAAEuE,gBAAgB,YAGjCxE,EALqByE,iDAKDC,GAAG,QAAS,WAC9B7D,EAAWb,EAAE2E,MAAM1D,KAAK,YACxBjB,EARkB,iBAQC4E,KAAK5E,EAAE2E,MAAME,QAChC/D,EAAuBC,EAAUF,KAGnCC,EAAuBC,EAAUF","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'local_edwiserreports/variables',\n    'local_edwiserreports/jquery.dataTables',\n    'local_edwiserreports/dataTables.bootstrap4',\n    'local_edwiserreports/common'\n], function($, V) {\n    /* eslint-disable no-unused-vars */\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        /* eslint-enable no-unused-vars */\n        var PageId = $(\"#wdm-courseanalytics-individual\");\n        var RecentVisits = PageId.find(\".recent-visits .table\");\n        var RecentEnroled = PageId.find(\".recent-enrolment .table\");\n        var RecentCompletion = PageId.find(\".recent-completion .table\");\n        var loader = $(\".loader\");\n        var RecentVisitsTable = null;\n        var RecentEnroledTable = null;\n        var RecentCompletionTable = null;\n\n        // Varibales for cohort filter\n        var cohortId = 0;\n        var cohortFilterBtn = \"#cohortfilter\";\n        var cohortFilterItem = cohortFilterBtn + \" ~ .dropdown-menu .dropdown-item\";\n\n        $(document).ready(function() {\n            var courseId = V.getUrlParameter(\"courseid\");\n\n            /* Select cohort filter for active users block */\n            $(cohortFilterItem).on('click', function() {\n                cohortId = $(this).data('cohortid');\n                $(cohortFilterBtn).html($(this).text());\n                getCourseAnalyticsData(courseId, cohortId);\n            });\n\n            // Get Course Analytics Data\n            getCourseAnalyticsData(courseId, cohortId);\n        });\n\n        /**\n         * Get Course Analytics Data\n         * @param  {int} courseId Course Id\n         * @param  {int} cohortId Cohort Id\n         */\n        function getCourseAnalyticsData(courseId, cohortId) {\n            var sesskey = PageId.data(\"sesskey\");\n            $.ajax({\n                    url: V.requestUrl,\n                    type: V.requestType,\n                    dataType: V.requestDataType,\n                    data: {\n                        action: 'get_courseanalytics_data_ajax',\n                        sesskey: sesskey,\n                        data: JSON.stringify({\n                            courseid: courseId,\n                            cohortid: cohortId\n                        })\n                    },\n                })\n                .done(function(response) {\n                    /* Generate Recent Visit Table */\n                    RecentVisitsTable = generateDataTable(RecentVisits, RecentVisitsTable, response.data.recentvisits);\n\n                    /* Generate Recent Enrolment Table */\n                    RecentEnroledTable = generateDataTable(RecentEnroled, RecentEnroledTable, response.data.recentenrolments);\n\n                    /* Generate Recent Completion Table */\n                    RecentCompletionTable = generateDataTable(\n                        RecentCompletion,\n                        RecentCompletionTable,\n                        response.data.recentcompletions\n                    );\n                })\n                .fail(function(error) {\n                    console.log(error);\n                }).always(function() {\n                    $(window).resize();\n                    PageId.fadeIn(\"slow\");\n                });\n        }\n\n        /**\n         * Generate Data Table for specific blocks\n         * @param  {string} tableId Table Id\n         * @param  {object} table Table Object\n         * @param  {array} data Data to create table\n         * @return {Objcet} Datatable object\n         */\n        function generateDataTable(tableId, table, data) {\n            var emptyStr = M.util.get_string('nousersincourse', 'local_edwiserreports');\n\n            if (tableId == RecentCompletion) {\n                emptyStr = M.util.get_string('nouserscompleted', 'local_edwiserreports');\n            } else if (tableId == RecentVisits) {\n                emptyStr = M.util.get_string('nousersvisited', 'local_edwiserreports');\n            }\n\n            if (table !== null) {\n                table.destroy();\n            }\n\n            loader.hide();\n            tableId.fadeIn(\"slow\");\n            PageId.fadeIn(\"slow\");\n\n            table = tableId.DataTable({\n                data: data,\n                responsive: true,\n                language: {\n                    info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                    infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                    emptyTable: emptyStr,\n                    zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                    paginate: {\n                        previous: M.util.get_string('previous', 'moodle'),\n                        next: M.util.get_string('next', 'moodle')\n                    }\n                },\n                columnDefs: [{\n                    className: \"text-left\",\n                    targets: 0\n                }, {\n                    className: \"text-center\",\n                    targets: \"_all\"\n                }],\n                drawCallback: function() {\n                    $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\n                    $('.dataTables_filter').addClass('pagination-sm pull-right');\n                },\n                order: [\n                    [1, 'desc']\n                ],\n                bInfo: false,\n                lengthChange: false,\n            });\n\n            // Return table\n            return table;\n        }\n    }\n\n    return {\n        init: init\n    };\n\n});"],"file":"courseanalytics.min.js"}