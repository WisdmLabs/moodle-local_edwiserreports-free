{"version":3,"sources":["courseanalytics.js"],"names":["define","$","V","init","CONTEXTID","PageId","RecentVisits","find","RecentEnroled","RecentCompletion","loader","RecentVisitsTable","RecentEnroledTable","RecentCompletionTable","cohortId","getCourseAnalyticsData","courseId","sesskey","data","ajax","url","requestUrl","type","requestType","dataType","requestDataType","action","JSON","stringify","courseid","cohortid","done","response","generateDataTable","recentvisits","recentenrolments","recentcompletions","fail","error","console","log","always","window","resize","fadeIn","tableId","table","emptyStr","destroy","hide","DataTable","responsive","oLanguage","sEmptyTable","sSearchPlaceholder","columnDefs","className","targets","drawCallback","addClass","order","bInfo","lengthChange","document","ready","getUrlParameter","cohortFilterBtn","on","this","html","text"],"mappings":"AAAA,aA0BAA,OAAO,CAAC,SAAU,iCAAkC,yCAA0C,6CAA8C,+BAAgC,SAAUC,EAAGC,GA0HvL,MAAO,CACLC,KApHF,SAAcC,GAEZ,IAAIC,EAASJ,EAAE,mCACXK,EAAeD,EAAOE,KAAK,yBAC3BC,EAAgBH,EAAOE,KAAK,4BAC5BE,EAAmBJ,EAAOE,KAAK,6BAC/BG,EAAST,EAAE,WACXU,EAAoB,KACpBC,EAAqB,KACrBC,EAAwB,KAExBC,EAAW,EAqBf,SAASC,EAAuBC,EAAUF,GACxC,IAAIG,EAAUZ,EAAOa,KAAK,WAC1BjB,EAAEkB,KAAK,CACLC,IAAKlB,EAAEmB,WACPC,KAAMpB,EAAEqB,YACRC,SAAUtB,EAAEuB,gBACZP,KAAM,CACJQ,OAAQ,gCACRT,QAASA,EACTC,KAAMS,KAAKC,UAAU,CACnBC,SAAUb,EACVc,SAAUhB,OAGbiB,KAAK,SAAUC,GAEhBrB,EAAoBsB,EAAkB3B,EAAcK,EAAmBqB,EAASd,KAAKgB,cAGrFtB,EAAqBqB,EAAkBzB,EAAeI,EAAoBoB,EAASd,KAAKiB,kBAGxFtB,EAAwBoB,EAAkBxB,EAAkBI,EAAuBmB,EAASd,KAAKkB,qBAChGC,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WACRxC,EAAEyC,QAAQC,SACVtC,EAAOuC,OAAO,UAYlB,SAASX,EAAkBY,EAASC,EAAO5B,GACzC,IAAI6B,EAAW,uCAuCf,OApCIF,GAAWpC,EACbsC,EAAW,qCACFF,GAAWvC,IACpByC,EAAW,oCAGC,OAAVD,GACFA,EAAME,UAGRtC,EAAOuC,OACPJ,EAAQD,OAAO,QACfvC,EAAOuC,OAAO,QACdE,EAAQD,EAAQK,UAAU,CACxBhC,KAAMA,EACNiC,YAAY,EACZC,UAAW,CACTC,YAAaN,EACbO,mBApBoB,oBAsBtBC,WAAY,CAAC,CACXC,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,cACXC,QAAS,SAEXC,aAAc,WACZzD,EAAE,sCAAsC0D,SAAS,4BACjD1D,EAAE,sBAAsB0D,SAAS,6BAEnCC,MAAO,CAAC,CAAC,EAAG,SACZC,OAAO,EACPC,cAAc,IA9FlB7D,EAAE8D,UAAUC,MAAM,WAChB,IAAIhD,EAAWd,EAAE+D,gBAAgB,YAGjChE,EALqBiE,iDAKDC,GAAG,QAAS,WAC9BrD,EAAWb,EAAEmE,MAAMlD,KAAK,YACxBjB,EARkB,iBAQCoE,KAAKpE,EAAEmE,MAAME,QAChCvD,EAAuBC,EAAUF,KAGnCC,EAAuBC,EAAUF","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'local_edwiserreports/variables',\n    'local_edwiserreports/jquery.dataTables',\n    'local_edwiserreports/dataTables.bootstrap4',\n    'local_edwiserreports/common'\n], function($, V) {\n    /* eslint-disable no-unused-vars */\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        /* eslint-enable no-unused-vars */\n        var PageId = $(\"#wdm-courseanalytics-individual\");\n        var RecentVisits = PageId.find(\".recent-visits .table\");\n        var RecentEnroled = PageId.find(\".recent-enrolment .table\");\n        var RecentCompletion = PageId.find(\".recent-completion .table\");\n        var loader = $(\".loader\");\n        var RecentVisitsTable = null;\n        var RecentEnroledTable = null;\n        var RecentCompletionTable = null;\n\n        // Varibales for cohort filter\n        var cohortId = 0;\n        var cohortFilterBtn = \"#cohortfilter\";\n        var cohortFilterItem = cohortFilterBtn + \" ~ .dropdown-menu .dropdown-item\";\n\n        $(document).ready(function() {\n            var courseId = V.getUrlParameter(\"courseid\");\n\n            /* Select cohort filter for active users block */\n            $(cohortFilterItem).on('click', function() {\n                cohortId = $(this).data('cohortid');\n                $(cohortFilterBtn).html($(this).text());\n                getCourseAnalyticsData(courseId, cohortId);\n            });\n\n            // Get Course Analytics Data\n            getCourseAnalyticsData(courseId, cohortId);\n        });\n\n        /**\n         * Get Course Analytics Data\n         * @param  {int} courseId Course Id\n         * @param  {int} cohortId Cohort Id\n         */\n        function getCourseAnalyticsData(courseId, cohortId) {\n            var sesskey = PageId.data(\"sesskey\");\n            $.ajax({\n                url: V.requestUrl,\n                type: V.requestType,\n                dataType: V.requestDataType,\n                data: {\n                    action: 'get_courseanalytics_data_ajax',\n                    sesskey: sesskey,\n                    data: JSON.stringify({\n                        courseid: courseId,\n                        cohortid: cohortId\n                    })\n                },\n            })\n                .done(function(response) {\n                    /* Generate Recent Visit Table */\n                    RecentVisitsTable = generateDataTable(RecentVisits, RecentVisitsTable, response.data.recentvisits);\n\n                    /* Generate Recent Enrolment Table */\n                    RecentEnroledTable = generateDataTable(RecentEnroled, RecentEnroledTable, response.data.recentenrolments);\n\n                    /* Generate Recent Completion Table */\n                    RecentCompletionTable = generateDataTable(\n                        RecentCompletion,\n                        RecentCompletionTable,\n                        response.data.recentcompletions\n                    );\n                })\n                .fail(function(error) {\n                    console.log(error);\n                }).always(function() {\n                    $(window).resize();\n                    PageId.fadeIn(\"slow\");\n                });\n        }\n\n        /**\n         * Generate Data Table for specific blocks\n         * @param  {string} tableId Table Id\n         * @param  {object} table Table Object\n         * @param  {array} data Data to create table\n         * @return {Objcet} Datatable object\n         */\n        function generateDataTable(tableId, table, data) {\n            var emptyStr = \"No users has Enrolled in this course\";\n            var searchPlaceholder = \"Search Analytics\";\n\n            if (tableId == RecentCompletion) {\n                emptyStr = \"No users has completed this course\";\n            } else if (tableId == RecentVisits) {\n                emptyStr = \"No users has visited this course\";\n            }\n\n            if (table !== null) {\n                table.destroy();\n            }\n\n            loader.hide();\n            tableId.fadeIn(\"slow\");\n            PageId.fadeIn(\"slow\");\n\n             table = tableId.DataTable({\n                data: data,\n                responsive: true,\n                oLanguage: {\n                    sEmptyTable: emptyStr,\n                    sSearchPlaceholder: searchPlaceholder\n                },\n                columnDefs: [\n                    {className: \"text-left\", targets: 0},\n                    {className: \"text-center\", targets: \"_all\"}\n                ],\n                drawCallback: function() {\n                    $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\n                    $('.dataTables_filter').addClass('pagination-sm pull-right');\n                },\n                order: [[1, 'desc']],\n                bInfo: false,\n                lengthChange: false,\n            });\n\n            // Return table\n            return table;\n        }\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"file":"courseanalytics.min.js"}