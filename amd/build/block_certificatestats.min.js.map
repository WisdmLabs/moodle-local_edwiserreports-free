{"version":3,"sources":["block_certificatestats.js"],"names":["define","$","Notification","CFG","common","SELECTOR","PANEL","TABLE","SEARCH","dataTable","PROMISE","GET_CERTIFICATES","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","attr","init","invalidUser","length","find","select2","loader","show","done","response","destroy","DataTable","responsive","dom","columns","columnDefs","targets","className","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","lengthChange","bInfo","fail","exception","always","hide","on","concat","search","val","draw"],"mappings":"AAAA,aA4BAA,OAAO,CAAC,SAAU,oBAAqB,kBAAmB,YAAa,SAAUC,EAAGC,EAAcC,EAAKC,GAIrG,IAAIC,EAAW,CACbC,MAAO,qBACPC,MAAO,2BACPC,OAAQ,6BAMNC,EAAY,KAKZC,EAAU,CAKZC,iBAAkB,WAChB,OAAOV,EAAEW,KAAK,CACZC,IAAKV,EAAIW,WACTC,KAAMZ,EAAIa,YACVC,SAAUd,EAAIe,gBACdC,KAAM,CACJC,OAAQ,6BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAMvB,EAAE,QAAQwB,KAAK,aAgF7B,MAAO,CACLC,KAjBF,SAAcC,GAEqB,IAA7B1B,EAAEI,EAASC,OAAOsB,SAKtB3B,EAAEI,EAASC,OAAOuB,KAAK,iBAAiBC,UA5DxC1B,EAAO2B,OAAOC,KAAK3B,EAASC,OAC5BI,EAAQC,mBAAmBsB,KAAK,SAAUC,GACtB,OAAdzB,GACFA,EAAU0B,UAGZ1B,EAAYR,EAAEI,EAASE,OAAO6B,UAAU,CACtCC,YAAY,EACZlB,KAAMe,EAASf,KACfmB,IAAK,mDACLC,QAAS,CAAC,CACRpB,KAAQ,QACP,CACDA,KAAQ,cACP,CACDA,KAAQ,UACP,CACDA,KAAQ,cAEVqB,WAAY,CAAC,CACXC,QAAW,CAAC,EAAG,GACfC,UAAa,aACZ,CACDD,QAAW,OACXC,UAAa,gBAEfC,SAAU,CACRC,KAAMtB,EAAEuB,KAAKC,WAAW,YAAa,wBACrCC,UAAWzB,EAAEuB,KAAKC,WAAW,YAAa,wBAC1CE,WAAY1B,EAAEuB,KAAKC,WAAW,iBAAkB,wBAChDG,YAAa3B,EAAEuB,KAAKC,WAAW,cAAe,wBAC9CI,SAAU,CACRC,SAAU7B,EAAEuB,KAAKC,WAAW,WAAY,UACxCM,KAAM9B,EAAEuB,KAAKC,WAAW,OAAQ,YAGpCO,aAAc,WACZjD,EAAOkD,sBAAsBC,OAE/BC,cAAc,EACdC,OAAO,MAERC,KAAKxD,EAAayD,WAAWC,OAAO,WAErCxD,EAAO2B,OAAO8B,KAAKxD,EAASC,SAmB9BL,EAAE,QAAQ6D,GAAG,QAAS,GAAGC,OAAO1D,EAASC,MAAO,KAAKyD,OAAO1D,EAASG,QAAS,WAC5EC,EAAU8B,QAAQ,GAAGyB,OAAO/D,EAAEsD,MAAMU,OAAOC","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Certificate block.\n *\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/notification',\n    './defaultconfig',\n    './common',\n], function(\n    $,\n    Notification,\n    CFG,\n    common\n) {\n\n    /**\n     * Selectors.\n     */\n    var SELECTOR = {\n        PANEL: '#certificatesblock',\n        TABLE: '#certificatesblock table',\n        SEARCH: '.table-search-input input'\n    };\n\n    /**\n     * Data table object.\n     */\n    var dataTable = null;\n\n    /**\n     * Promises list.\n     */\n    let PROMISE = {\n        /**\n         * Get certificates.\n         * @returns {PROMISE}\n         */\n        GET_CERTIFICATES: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_certificates_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang')\n                },\n            });\n        }\n    };\n\n    /**\n     * Load data to dataTable using ajax.\n     */\n    function loadData() {\n        // Show loader.\n        common.loader.show(SELECTOR.PANEL);\n\n        PROMISE.GET_CERTIFICATES().done(function(response) {\n                if (dataTable !== null) {\n                    dataTable.destroy();\n                }\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    responsive: true,\n                    data: response.data,\n                    dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                    columns: [{\n                        \"data\": \"name\"\n                    }, {\n                        \"data\": \"coursename\"\n                    }, {\n                        \"data\": \"issued\"\n                    }, {\n                        \"data\": \"notissued\"\n                    }],\n                    columnDefs: [{\n                        \"targets\": [0, 1],\n                        \"className\": \"text-left\"\n                    }, {\n                        \"targets\": \"_all\",\n                        \"className\": \"text-center\",\n                    }],\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('nocertificates', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: M.util.get_string('previous', 'moodle'),\n                            next: M.util.get_string('next', 'moodle')\n                        }\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                    },\n                    lengthChange: false,\n                    bInfo: false\n                });\n            })\n            .fail(Notification.exception)\n            .always(function() {\n                // Hide loader.\n                common.loader.hide(SELECTOR.PANEL);\n            });\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n\n        // Block not present on page.\n        if ($(SELECTOR.PANEL).length === 0) {\n            return;\n        }\n\n        // Enable select2 on cohort filter.\n        $(SELECTOR.PANEL).find('.singleselect').select2();\n\n        loadData();\n\n        // Search in table.\n        $('body').on('input', `${SELECTOR.PANEL} ${SELECTOR.SEARCH}`, function() {\n            dataTable.columns(0).search($(this).val()).draw();\n        });\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"block_certificatestats.min.js"}