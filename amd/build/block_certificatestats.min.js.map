{"version":3,"sources":["block_certificatestats.js"],"names":["define","$","templates","cfg","common","certificateTable","panel","getPanel","table","dropdownBody","searchTable","init","hideLoader","loader","hide","length","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","done","response","error","exception","errorcode","invalidUser","render","then","html","js","replaceNode","DataTable","dom","oLanguage","sEmptyTable","sSearchPlaceholder","initComplete","drawCallback","stylePaginationButton","this","lengthChange","bInfo","fail","ex","console","log","on","search","value","draw"],"mappings":"AAAA,aA0BAA,OAAO,CAAC,SAAU,iBAAkB,qCAAsC,YAAa,SAAUC,EAAGC,EAAWC,EAAKC,GAClH,IAKIC,EALAC,EAAQH,EAAII,SAAS,sBAErBC,GADYL,EAAII,SAAS,qBAAsB,QACvCD,EAAQ,WAChBG,EAAeH,EAAQ,mBACvBI,EAAcJ,EAAQ,6BA4E1B,MAAO,CACLK,KAvEF,WAIE,SAASC,IACPR,EAAOS,OAAOC,KAAK,sBAGjBb,EAAEK,GAAOS,SAEXX,EAAOS,OAAOG,KAAK,sBACnBf,EAAEgB,KAAK,CACLC,IAAKf,EAAIgB,WACTC,KAAMjB,EAAIkB,YACVC,SAAUnB,EAAIoB,gBACdC,KAAM,CACJC,OAAQ,6BACRC,OAAQC,EAAEC,qBAAqBF,UAEhCG,KAAK,SAAUC,IACO,IAAnBA,EAASC,OAAmD,qBAAjCD,EAASE,UAAUC,WAChDC,YAAY,wBAAyBJ,GAGvC5B,EAAUiC,OAAO,yCAA0CL,EAASN,MAAMY,KAAK,SAAUC,EAAMC,GAC7FpC,EAAUqC,YAAY/B,EAAO6B,EAAMC,GA2BzCjC,EAAmBJ,EAAEO,GAAOgC,UAAU,CACpCC,IAAK,mDACLC,UAAW,CACTC,YAAa,kCACbC,mBAAoB,uBAEtBC,aAAc,WACZ5C,EAAEQ,GAAcO,QAElB8B,aAAc,WACZ1C,EAAO2C,sBAAsBC,OAE/BC,cAAc,EACdC,OAAO,IArCHtC,MAECuC,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,GAEZxC,QAEDuC,KAAK,SAAUpB,GAGhBnB,MAGFX,EAAE,QAAQsD,GAAG,QAAS7C,EAAa,WACjCL,EAAiBmD,OAAOR,KAAKS,OAAOC","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    \"jquery\",\n    \"core/templates\",\n    \"local_edwiserreports/defaultconfig\",\n    './common',\n], function($, templates, cfg, common) {\n    var panel = cfg.getPanel(\"#certificatesblock\");\n    var panelBody = cfg.getPanel(\"#certificatesblock\", \"body\");\n    var table = panel + \" .table\";\n    var dropdownBody = panel + \" .table-dropdown\";\n    var searchTable = panel + \" .table-search-input input\";\n    var certificateTable;\n\n    /**\n     * Initialize\n     */\n    function init() {\n        /**\n         * Hide loader/\n         */\n        function hideLoader() {\n            common.loader.hide('#certificatesblock');\n        }\n\n        if ($(panel).length) {\n            // Show loader.\n            common.loader.show('#certificatesblock');\n\n            $.ajax({\n                    url: cfg.requestUrl,\n                    type: cfg.requestType,\n                    dataType: cfg.requestDataType,\n                    data: {\n                        action: 'get_certificates_data_ajax',\n                        secret: M.local_edwiserreports.secret\n                    },\n                }).done(function(response) {\n                    if (response.error === true && response.exception.errorcode === 'invalidsecretkey') {\n                        invalidUser('certificatestatsblock', response);\n                    }\n                    templates.render('local_edwiserreports/certificatestable', response.data)\n                        .then(function(html, js) {\n                            templates.replaceNode(table, html, js);\n                            createCertificatesTable();\n\n                            // Hide loader.\n                            hideLoader();\n                            return;\n                        }).fail(function(ex) {\n                            console.log(ex);\n\n                            // Hide loader.\n                            hideLoader();\n                        });\n                })\n                .fail(function(error) {\n                    // console.log(error);\n\n                    // Hide loader.\n                    hideLoader();\n                });\n\n            // Search in table.\n            $('body').on('input', searchTable, function() {\n                certificateTable.search(this.value).draw();\n            });\n        }\n    }\n\n    /**\n     * Create certificate table.\n     */\n    function createCertificatesTable() {\n        certificateTable = $(table).DataTable({\n            dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n            oLanguage: {\n                sEmptyTable: \"There is no certificate created\",\n                sSearchPlaceholder: \"Search Certificates\"\n            },\n            initComplete: function() {\n                $(dropdownBody).show();\n            },\n            drawCallback: function() {\n                common.stylePaginationButton(this);\n            },\n            lengthChange: false,\n            bInfo: false\n        });\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"block_certificatestats.min.js"}