{"version":3,"sources":["modal-migration.js"],"names":["define","Ajax","Modal","ModalEvents","ModalRegistry","CustomEvents","registered","SELECTORS","PROMISES","call","methodname","args","pluginname","configname","value","Math","ceil","Date","getTime","MIGRATION","root","this","show","TYPE","prototype","Object","create","constructor","registerEventListeners","getModal","on","events","activate","e","data","hide","window","location","href","M","cfg","wwwroot","bind","register"],"mappings":"AAAA,aAEAA,OAAO,CAAC,YAAa,aAAc,oBAAqB,sBAAuB,kCAAmC,SAAUC,EAAMC,EAAOC,EAAaC,EAAeC,GACnK,IAAIC,GAAa,EAKbC,EACe,2BADfA,EAEY,wBAFZA,EAGY,wBAMZC,EAIK,WACLP,EAAKQ,KAAK,CAAC,CACTC,WAAY,yCACZC,KAAM,CACJC,WAAc,uBACdC,WAAc,aACdC,MAASC,KAAKC,MAAK,IAAIC,MAAOC,UAAY,KAAQ,YAVtDV,EAkBK,WACLP,EAAKQ,KAAK,CAAC,CACTC,WAAY,yCACZC,KAAM,CACJC,WAAc,uBACdC,WAAc,QACdC,MAAS,aAWbK,EAAY,SAAmBC,GACjClB,EAAMO,KAAKY,KAAMD,GACjBC,KAAKC,QAuCP,OApCAH,EAAUI,KAAO,kCACjBJ,EAAUK,UAAYC,OAAOC,OAAOxB,EAAMsB,YACtBG,YAAcR,EAOlCA,EAAUK,UAAUI,uBAAyB,WAE3C1B,EAAMsB,UAAUI,uBAAuBnB,KAAKY,MAE5CA,KAAKQ,WAAWC,GAAGzB,EAAa0B,OAAOC,SAAUzB,EAA2B,SAAU0B,EAAGC,GACvFb,KAAKc,OACLC,OAAOC,SAASC,KAAOC,EAAEC,IAAIC,QAAU,sCACvCC,KAAKrB,OAEPA,KAAKQ,WAAWC,GAAGzB,EAAa0B,OAAOC,SAAUzB,EAAwB,SAAU0B,EAAGC,GACpFb,KAAKc,OACL3B,KACAkC,KAAKrB,OAEPA,KAAKQ,WAAWC,GAAGzB,EAAa0B,OAAOC,SAAUzB,EAAwB,SAAU0B,EAAGC,GACpFb,KAAKc,OACL3B,KACAkC,KAAKrB,QAKJf,IACHF,EAAcuC,SAASxB,EAAUI,KAAMJ,EAAW,wCAClDb,GAAa,GAGRa","sourcesContent":["define([\n    'core/ajax',\n    'core/modal',\n    'core/modal_events',\n    'core/modal_registry',\n    'core/custom_interaction_events',\n], function(\n    Ajax,\n    Modal,\n    ModalEvents,\n    ModalRegistry,\n    CustomEvents\n) {\n    var registered = false;\n\n    /**\n     * Selectors\n     */\n    var SELECTORS = {\n        CONTINUE_BUTTON: '[data-action=\"continue\"]',\n        LATER_BUTTON: '[data-action=\"later\"]',\n        NEVER_BUTTON: '[data-action=\"never\"]'\n    };\n\n    /**\n     * Promises\n     */\n    var PROMISES = {\n        /**\n         * Show migration modal after 7 days.\n         */\n        LATER: function() {\n            Ajax.call([{\n                methodname: 'local_edwiserreports_set_plugin_config',\n                args: {\n                    'pluginname': 'local_edwiserreports',\n                    'configname': 'fetchlater',\n                    'value': Math.ceil((new Date()).getTime() / 1000) + (86400 * 7)\n                }\n            }]);\n        },\n        /**\n         * Never show migration modal.\n         */\n        NEVER: function() {\n            Ajax.call([{\n                methodname: 'local_edwiserreports_set_plugin_config',\n                args: {\n                    'pluginname': 'local_edwiserreports',\n                    'configname': 'fetch',\n                    'value': 'never'\n                }\n            }]);\n        }\n    };\n\n    /**\n     * Constructor for the Modal.\n     *\n     * @param {object} root The root jQuery element for the modal\n     */\n    var MIGRATION = function(root) {\n        Modal.call(this, root);\n        this.show();\n    };\n\n    MIGRATION.TYPE = 'local_edwiserreports-migration';\n    MIGRATION.prototype = Object.create(Modal.prototype);\n    MIGRATION.prototype.constructor = MIGRATION;\n\n    /**\n     * Set up all of the event handling for the modal.\n     *\n     * @method registerEventListeners\n     */\n    MIGRATION.prototype.registerEventListeners = function() {\n        // Apply parent event listeners.\n        Modal.prototype.registerEventListeners.call(this);\n\n        // Continue button clicked.\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CONTINUE_BUTTON, function(e, data) {\n            this.hide();\n            window.location.href = M.cfg.wwwroot + '/local/edwiserreports/old_logs.php';\n        }.bind(this));\n\n        // Later button clicked.\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.LATER_BUTTON, function(e, data) {\n            this.hide();\n            PROMISES.LATER();\n        }.bind(this));\n\n        // Never button clicked.\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.NEVER_BUTTON, function(e, data) {\n            this.hide();\n            PROMISES.NEVER();\n        }.bind(this));\n    };\n\n    // Automatically register with the modal registry the first time this module is imported so that you can create modals\n    // of this type using the modal factory.\n    if (!registered) {\n        ModalRegistry.register(MIGRATION.TYPE, MIGRATION, 'local_edwiserreports/modal-migration');\n        registered = true;\n    }\n\n    return MIGRATION;\n});"],"file":"modal-migration.min.js"}