"use strict";define(["jquery","core/templates","./common","./defaultconfig"],function(t,e,i,n){var a={CONTAINER:".top-insights",INSIGHT:".top-insights .insight",ONLYINSIGHT:".top-insights .insight:not(.add-insight)",INSIGHT_WRAP:".insight-wrap",MOVELEFT:".top-insights .card-editing .move-left",MOVERIGHT:".top-insights .card-editing .move-right",HIDE:".top-insights .card-editing .edit-hide",INSIGHT_ADD_CARD:".top-insights .insight.add-insight",INSIGHT_DROPDOWNMENU:".top-insights .add-new-insight .dropdown-menu",INSIGHT_ITEM:".top-insights .add-new-insight .dropdown-item"},s="weekly",o={GET_INSIGHT_CARD_CONTEXT:function(e){return t.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_insight_card_context_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({id:e})}})},GET_INSIGHT_CARD_DATA:function(e){return t.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_insight_card_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({id:e,filter:s})}})}};function r(){var e=[];i.loader.show(a.CONTAINER),t(a.ONLYINSIGHT).each(function(i,n){e.push(t(n).data("id"))}),M.util.set_user_preference("local_edwiserreports_insights_order",JSON.stringify(e)),i.loader.hide(a.CONTAINER)}function d(n){i.loader.show(a.CONTAINER+' [data-id="'+n+'"] .insight-wrapper'),o.GET_INSIGHT_CARD_DATA(n,s).done(function(s){switch(n){case"timespentoncourses":case"timespentonsite":s.value=i.timeFormatter(s.value,{dataPointIndex:0,short:!0}).replaceAll(", "," ")}e.render("local_edwiserreports/insights/content",s).done(function(s,o){e.replaceNode(t(a.INSIGHT+'[data-id="'+n+'"]').find(a.INSIGHT_WRAP),s,o),i.loader.hide(a.CONTAINER+' [data-id="'+n+'"] .insight-wrapper')})})}return{init:function(){t(document).ready(function(){i.dateChange(function(e){s=e,t(a.ONLYINSIGHT).each(function(e,i){d(t(i).data("id"))})}),t("body").on("click",a.MOVELEFT,function(){var e=t(this).closest(a.INSIGHT).prev();t(this).closest(a.INSIGHT).detach().insertBefore(e),r()}),t("body").on("click",a.MOVERIGHT,function(){var e=t(this).closest(a.INSIGHT).next();t(this).closest(a.INSIGHT).detach().insertAfter(e),r()}),t("body").on("click",a.HIDE,function(){var e=t(this).closest(a.INSIGHT);t(a.INSIGHT_DROPDOWNMENU).prepend('<a class="dropdown-item" href="#" data-id="'.concat(e.data("id"),'">').concat(e.find(".insight-title").text(),"</a>")),e.remove(),r()}),t("body").on("click",a.INSIGHT_ITEM,function(){var n=t(this).data("id");i.loader.hide(a.CONTAINER),o.GET_INSIGHT_CARD_CONTEXT(n).then(function(i){1==i.present&&(i.editing=!0,e.render("local_edwiserreports/insights/insight",i).done(function(i,s){t(a.INSIGHT_ADD_CARD).before(i),e.runTemplateJS(s),t(a.INSIGHT_ITEM+'[data-id="'+n+'"]').remove(),r(),d(n)}))})}),t(a.ONLYINSIGHT).each(function(e,i){d(t(i).data("id"))}),t(a.CONTAINER).find(".overflow-hidden").removeClass("overflow-hidden")})}}});
//# sourceMappingURL=insights.min.js.map
