"use strict";define(["jquery","core/notification","core/templates","./common","./defaultconfig"],function(t,e,i,n,a){var o={CONTAINER:".top-insights",INSIGHT:".top-insights .insight",ONLYINSIGHT:".top-insights .insight:not(.add-insight)",INSIGHT_WRAP:".insight-wrap",MOVELEFT:".top-insights .card-editing .move-left",MOVERIGHT:".top-insights .card-editing .move-right",HIDE:".top-insights .card-editing .edit-hide",INSIGHT_ADD_CARD:".top-insights .insight.add-insight",INSIGHT_DROPDOWNMENU:".top-insights .add-new-insight .dropdown-menu",INSIGHT_ITEM:".top-insights .add-new-insight .dropdown-item"},r="weekly",s={GET_INSIGHT_CARD_CONTEXT:function(e){return t.ajax({url:a.requestUrl,type:a.requestType,dataType:a.requestDataType,data:{action:"get_insight_card_context_ajax",secret:M.local_edwiserreports.secret,lang:t("html").attr("lang"),data:JSON.stringify({id:e})}})},GET_INSIGHT_CARD_DATA:function(e){return t.ajax({url:a.requestUrl,type:a.requestType,dataType:a.requestDataType,data:{action:"get_insight_card_data_ajax",secret:M.local_edwiserreports.secret,lang:t("html").attr("lang"),data:JSON.stringify({id:e,filter:r})}})}};function d(){var e=[];n.loader.show(o.CONTAINER),t(o.ONLYINSIGHT).each(function(i,n){e.push(t(n).data("id"))}),M.util.set_user_preference("local_edwiserreports_insights_order",JSON.stringify(e)),n.loader.hide(o.CONTAINER)}function c(e){n.loader.show(o.CONTAINER+' [data-id="'+e+'"] .insight-wrapper'),s.GET_INSIGHT_CARD_DATA(e,r).done(function(a){switch(e){case"timespentoncourses":case"timespentonsite":a.value=n.timeFormatter(a.value,{dataPointIndex:0,short:!0}).replaceAll(", "," ")}i.render("local_edwiserreports/insights/content",a).done(function(a,r){i.replaceNode(t(o.INSIGHT+'[data-id="'+e+'"]').find(o.INSIGHT_WRAP),a,r),n.loader.hide(o.CONTAINER+' [data-id="'+e+'"] .insight-wrapper')})})}return{init:function(){t(document).ready(function(){n.dateChange(function(e){r=e,t(o.ONLYINSIGHT).each(function(e,i){c(t(i).data("id"))})}),t("body").on("click",o.MOVELEFT,function(){var e=t(this).closest(o.INSIGHT).prev();t(this).closest(o.INSIGHT).detach().insertBefore(e),d()}),t("body").on("click",o.MOVERIGHT,function(){var e=t(this).closest(o.INSIGHT).next();t(this).closest(o.INSIGHT).detach().insertAfter(e),d()}),t("body").on("click",o.HIDE,function(){var e=t(this).closest(o.INSIGHT);t(o.INSIGHT_DROPDOWNMENU).prepend('<a class="dropdown-item" href="#" data-id="'.concat(e.data("id"),'">').concat(e.find(".insight-title").text(),"</a>")),e.remove(),d()}),t("body").on("click",o.INSIGHT_ITEM,function(){var a=t(this).data("id");n.loader.hide(o.CONTAINER),s.GET_INSIGHT_CARD_CONTEXT(a).done(function(e){1==e.present&&(e.editing=!0,i.render("local_edwiserreports/insights/insight",e).done(function(e,n){t(o.INSIGHT_ADD_CARD).before(e),i.runTemplateJS(n),t(o.INSIGHT_ITEM+'[data-id="'+a+'"]').remove(),d(),c(a)}))}).fail(e.exception)}),t(o.ONLYINSIGHT).each(function(e,i){c(t(i).data("id"))}),t(o.CONTAINER).find(".overflow-hidden").removeClass("overflow-hidden")})}}});
//# sourceMappingURL=insights.min.js.map
