"use strict";define(["jquery","core/notification","core/templates","./common","./defaultconfig"],function(e,t,i,n,r){let s={CONTAINER:".top-insights",INSIGHT:".top-insights .insight",ONLYINSIGHT:".top-insights .insight:not(.add-insight)",INSIGHT_WRAP:".insight-wrap",MOVELEFT:".top-insights .card-editing .move-left",MOVERIGHT:".top-insights .card-editing .move-right",HIDE:".top-insights .card-editing .edit-hide",INSIGHT_ADD_CARD:".top-insights .insight.add-insight",INSIGHT_DROPDOWNMENU:".top-insights .add-new-insight .dropdown-menu",INSIGHT_ITEM:".top-insights .add-new-insight .dropdown-item"},o="weekly",a={GET_INSIGHT_CARD_CONTEXT:function(t){return e.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_insight_card_context_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({id:t})}})},GET_INSIGHT_CARD_DATA:function(t){return e.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_insight_card_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({id:t,filter:o})}})}};function d(){let t=[];n.loader.show(s.CONTAINER),e(s.ONLYINSIGHT).each(function(i,n){t.push(e(n).data("id"))}),edwrnewpreferenceapply?require(["core_user/repository"],function(e){e.setUserPreference("local_edwiserreports_insights_order",JSON.stringify(t))}):M.util.set_user_preference("local_edwiserreports_insights_order",JSON.stringify(t)),n.loader.hide(s.CONTAINER)}function c(t){n.loader.show(s.CONTAINER+' [data-id="'+t+'"] .insight-wrapper'),a.GET_INSIGHT_CARD_DATA(t,o).done(function(r){var o="rtl"==e("html").attr("dir")?1:0;switch(t){case"timespentoncourses":r.value=o?"4 h &#x202B; 48 min&#x202C; 20 s":"4 h 48 min 20 s";case"timespentonsite":r.value=o?"3 h &#x202B; 38 min&#x202C; 20 s":"3 h 38 min 20 s"}i.render("local_edwiserreports/insights/content",r).done(function(r,o){i.replaceNode(e(s.INSIGHT+'[data-id="'+t+'"]').find(s.INSIGHT_WRAP),r,o),n.loader.hide(s.CONTAINER+' [data-id="'+t+'"] .insight-wrapper')})})}return{init:function(){e(document).ready(function(){n.dateChange(function(t){o=t,e(s.ONLYINSIGHT).each(function(t,i){c(e(i).data("id"))})}),e("body").on("click",s.MOVELEFT,function(){let t=e(this).closest(s.INSIGHT).prev();e(this).closest(s.INSIGHT).detach().insertBefore(t),d()}),e("body").on("click",s.MOVERIGHT,function(){let t=e(this).closest(s.INSIGHT).next();e(this).closest(s.INSIGHT).detach().insertAfter(t),d()}),e("body").on("click",s.HIDE,function(){let t=e(this).closest(s.INSIGHT);e(s.INSIGHT_DROPDOWNMENU).prepend(`<a class="dropdown-item" href="#" data-id="${t.data("id")}">${t.find(".insight-title").text()}</a>`),t.remove(),d()}),e("body").on("click",s.INSIGHT_ITEM,function(){let r=e(this).data("id");n.loader.hide(s.CONTAINER),a.GET_INSIGHT_CARD_CONTEXT(r).done(function(t){1==t.present&&(t.editing=!0,i.render("local_edwiserreports/insights/insight",t).done(function(t,n){e(s.INSIGHT_ADD_CARD).before(t),i.runTemplateJS(n),e(s.INSIGHT_ITEM+'[data-id="'+r+'"]').remove(),d(),c(r)}))}).fail(t.exception)}),e(s.ONLYINSIGHT).each(function(t,i){c(e(i).data("id"))}),e(s.CONTAINER).find(".overflow-hidden").removeClass("overflow-hidden")})}}});
//# sourceMappingURL=insights.min.js.map
