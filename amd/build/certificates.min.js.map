{"version":3,"sources":["certificates.js"],"names":["define","$","common","V","init","CONTEXTID","dataTable","PageId","CertTable","find","certificateid","searchTable","lengthSelect","cohortId","getCertificateDetail","params","action","sesskey","data","JSON","stringify","cohortid","ajax","url","generateUrl","requestUrl","load","document","ready","DataTable","dom","columnDefs","targets","className","columns","language","searchPlaceholder","emptyTable","initComplete","settings","json","asPieProgress","show","drawCallback","target","element","stylePaginationButton","this","namespace","speed","classes","svg","number","content","responsive","select2","val","cohortFilterBtn","on","changeExportUrl","cohortReplaceFlag","html","text","page","len","value","draw","search","handleSearchInput"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,8BAA+B,iCAAkC,+BAAgC,yCAA0C,6CAA8C,6CAA8C,SAAUC,EAAGC,EAAQC,GAuI5Q,MAAO,CACLC,KAjIF,SAAcC,GAEZ,IAIIC,EAJAC,EAASN,EAAE,gCACXO,EAAYD,EAAOE,KAAK,UAIxBC,EAAgB,KAChBC,EAAcJ,EAAOE,KAAK,6BAC1BG,EAAeL,EAAOE,KAAK,8BAE3BI,EAAW,EASf,SAASC,EAAqBJ,EAAeG,GAC3C,IAAIE,EAAS,CACXC,OAAQ,6BACRC,QAAShB,EAAEM,GAAQW,KAAK,WACxBA,KAAMC,KAAKC,UAAU,CACnBV,cAAeA,EACfW,SAAUR,KAGdP,EAAUgB,KAAKC,IAAIpB,EAAEqB,YAAYrB,EAAEsB,WAAYV,IAASW,OA2B1DzB,EAAE0B,UAAUC,MAAM,WAEhBtB,EAAYE,EAAUqB,UAAU,CAC9BC,IAAK,oDACLC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,gBACZ,CACDD,QAAW,EACXC,UAAa,gBACZ,CACDD,QAAW,OACXC,UAAa,6BAEfC,QAAS,CAAC,CACRhB,KAAQ,YACP,CACDA,KAAQ,SACP,CACDA,KAAQ,aACP,CACDA,KAAQ,gBACP,CACDA,KAAQ,SACP,CACDA,KAAQ,mBAEViB,SAAU,CACRC,kBAAmB,cACnBC,WAAY,+BAGdC,aAAc,SAAsBC,EAAUC,GAC5CvC,EAAE,iBAAiBwC,gBACnBjC,EAAUkC,QAEZC,aAAc,WAvDlB,IAA2BC,EACrBC,EAuDA3C,EAAO4C,sBAAsBC,MAvD7BF,EAAUtC,EAEA,KAHWqC,EAyDH,MArDpBC,EAAUA,EAAQpC,KAAKmC,IAGzBC,EAAQpC,KAAK,iBAAiBgC,cAAc,CAC1CO,UAAW,eACXC,MAAO,GACPC,QAAS,CACPC,IAAK,mBACLN,QAAS,eACTO,OAAQ,sBACRC,QAAS,2BA6CXC,YAAY,IAGdrD,EAAE0B,UAAUlB,KAAK,iBAAiB8C,UAElCzC,EADAJ,EAAgBT,EAhGD,4BAgGeuD,OAI9BvD,EA3FqBwD,iDA2FDC,GAAG,QAAS,WAC9B7C,EAAWZ,EAAE8C,MAAM7B,KAAK,YACxBf,EAAEwD,gBAAgB9C,EArGF,mEAqG2BV,EAAEyD,mBAC7C3D,EA/FkB,iBA+FC4D,KAAK5D,EAAE8C,MAAMe,QAChChD,EAAqBJ,EAAeG,KAGtCZ,EAAE0B,UAAU+B,GAAG,SA3GA,2BA2GsB,WAEnC5C,EADAJ,EAAgBT,EAAE8C,MAAMS,MACY3C,GACpCZ,EAAE,wCAAwCuD,IAAI9C,KAGhDT,EAAEW,GAAc8C,GAAG,SAAU,WAC3BpD,EAAUyD,KAAKC,IAAIjB,KAAKkB,OAAOC,SAGjCjE,EAAEU,GAAa+C,GAAG,QAAS,WACzBpD,EAAU6D,OAAOpB,KAAKkB,OAAOC,SAE/BhE,EAAOkE","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'local_edwiserreports/common',\n    'local_edwiserreports/variables',\n    'local_edwiserreports/select2',\n    'local_edwiserreports/jquery.dataTables',\n    'local_edwiserreports/dataTables.bootstrap4',\n    'local_edwiserreports/jquery-asPieProgress'\n], function($, common, V) {\n    /* eslint-disable no-unused-vars */\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        /* eslint-enable no-unused-vars */\n        var PageId = $(\"#wdm-certificates-individual\");\n        var CertTable = PageId.find(\".table\");\n        var CertSelect = \"#wdm-certificates-select\";\n        var exportUrlLink = \".dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item\";\n        var dataTable;\n        var certificateid = null;\n        var searchTable = PageId.find(\".table-search-input input\");\n        var lengthSelect = PageId.find(\".table-length-input select\");\n\n        // Varibales for cohort filter\n        var cohortId = 0;\n        var cohortFilterBtn = \"#cohortfilter\";\n        var cohortFilterItem = cohortFilterBtn + \" ~ .dropdown-menu .dropdown-item\";\n\n        /**\n         * Get certificate detail using certificate id and cohort id\n         * @param {Integer} certificateid Certificate id\n         * @param {Integer} cohortId Cohort id\n         */\n        function getCertificateDetail(certificateid, cohortId) {\n            var params = {\n                action: 'get_certificates_data_ajax',\n                sesskey: $(PageId).data(\"sesskey\"),\n                data: JSON.stringify({\n                    certificateid: certificateid,\n                    cohortid: cohortId\n                })\n            };\n\n            dataTable.ajax.url(V.generateUrl(V.requestUrl, params)).load();\n        }\n\n        /**\n         * Create pie progress where div with .pie-progress class is present\n         * @param {String} target Target selector.\n         */\n        function createPieProgress(target) {\n            var element = PageId;\n            if (target != '') {\n                element = element.find(target);\n            }\n            element.find('.pie-progress').asPieProgress({\n                namespace: 'pie-progress',\n                speed: 30,\n                classes: {\n                    svg: 'pie-progress-svg',\n                    element: 'pie-progress',\n                    number: 'pie-progress-number',\n                    content: 'pie-progress-content'\n                }\n            });\n        }\n\n        $(document).ready(function() {\n            // Initialize datatable.\n            dataTable = CertTable.DataTable({\n                dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n                columnDefs: [{\n                        \"targets\": 0,\n                        \"className\": \"align-middle\"\n                    },\n                    {\n                        \"targets\": 1,\n                        \"className\": \"align-middle\"\n                    },\n                    {\n                        \"targets\": \"_all\",\n                        \"className\": \"align-middle text-center\"\n                    }\n                ],\n                columns: [\n                    { \"data\": \"username\" },\n                    { \"data\": \"email\" },\n                    { \"data\": \"issuedate\" },\n                    { \"data\": \"dateenrolled\" },\n                    { \"data\": \"grade\" },\n                    { \"data\": \"courseprogress\" }\n                ],\n                language: {\n                    searchPlaceholder: \"Search User\",\n                    emptyTable: \"No certificates are awarded\"\n                },\n                // eslint-disable-next-line no-unused-vars\n                initComplete: function(settings, json) {\n                    $('.pie-progress').asPieProgress();\n                    CertTable.show();\n                },\n                drawCallback: function() {\n                    common.stylePaginationButton(this);\n                    createPieProgress('');\n                },\n                responsive: true\n            });\n\n            // Initialize select2.\n            $(document).find('.singleselect').select2();\n\n            certificateid = $(CertSelect).val();\n            getCertificateDetail(certificateid);\n\n            /* Select cohort filter for active users block */\n            $(cohortFilterItem).on('click', function() {\n                cohortId = $(this).data('cohortid');\n                V.changeExportUrl(cohortId, exportUrlLink, V.cohortReplaceFlag);\n                $(cohortFilterBtn).html($(this).text());\n                getCertificateDetail(certificateid, cohortId);\n            });\n\n            // Certificate change.\n            $(document).on(\"change\", CertSelect, function() {\n                certificateid = $(this).val();\n                getCertificateDetail(certificateid, cohortId);\n                $('.download-links input[name=\"filter\"]').val(certificateid);\n            });\n\n            // Observer length change.\n            $(lengthSelect).on('change', function() {\n                dataTable.page.len(this.value).draw();\n            });\n\n            // Search in table.\n            $(searchTable).on('input', function() {\n                dataTable.search(this.value).draw();\n            });\n\n            common.handleSearchInput();\n        });\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"file":"certificates.min.js"}