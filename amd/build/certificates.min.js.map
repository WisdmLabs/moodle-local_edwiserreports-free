{"version":3,"sources":["certificates.js"],"names":["define","$","common","CFG","Notification","SELECTOR","PAGE","TABLE","COHORT","CERTIFICATE","SEARCH","LENGTH","dataTable","filter","cohort","certificateid","PROMISES","GET_CERTIFICATES","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","attr","JSON","stringify","loadData","destroy","loader","show","done","response","DataTable","dom","columnDefs","targets","className","columns","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","initComplete","settings","json","asPieProgress","drawCallback","stylePaginationButton","this","find","namespace","speed","classes","svg","element","number","content","responsive","fail","exception","always","hide","init","CONTEXTID","document","ready","select2","val","on","page","len","value","draw","search","handleSearchInput"],"mappings":"AAAA,aAuBAA,OAAO,CAAC,SAAU,WAAY,kBAAmB,oBAAqB,YAAa,sBAAuB,0BAA2B,0BAA2B,SAAUC,EAAGC,EAAQC,EAAKC,GAIxL,IAAIC,EAAW,CACbC,KAAM,+BACNC,MAAO,sCACPC,OAAQ,8CACRC,YAAa,mDACbC,OAAQ,yDACRC,OAAQ,4DAMNC,EAAY,KAKZC,EAAS,CACXC,OAAQ,EACRC,cAAe,GAMbC,EAAW,CAKbC,iBAAkB,WAChB,OAAOhB,EAAEiB,KAAK,CACZC,IAAKhB,EAAIiB,WACTC,KAAMlB,EAAImB,YACVC,SAAUpB,EAAIqB,gBACdC,KAAM,CACJC,OAAQ,6BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAM7B,EAAE,QAAQ8B,KAAK,QACrBN,KAAMO,KAAKC,UAAUpB,QAS7B,SAASqB,IACHtB,GACFA,EAAUuB,UAIZjC,EAAOkC,OAAOC,KAAKhC,EAASC,MAE5BU,EAASC,mBAAmBqB,KAAK,SAAUC,GAEzC3B,EAAYX,EAAEI,EAASE,OAAOiC,UAAU,CACtCf,KAAMc,EAASd,KACfgB,IAAK,oDACLC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,gBACZ,CACDD,QAAW,EACXC,UAAa,gBACZ,CACDD,QAAW,OACXC,UAAa,6BAEfC,QAAS,CAAC,CACRpB,KAAQ,YACP,CACDA,KAAQ,SACP,CACDA,KAAQ,aACP,CACDA,KAAQ,gBACP,CACDA,KAAQ,SACP,CACDA,KAAQ,mBAEVqB,SAAU,CACRC,KAAMnB,EAAEoB,KAAKC,WAAW,YAAa,wBACrCC,UAAWtB,EAAEoB,KAAKC,WAAW,YAAa,wBAC1CE,WAAYvB,EAAEoB,KAAKC,WAAW,wBAAyB,wBACvDG,YAAaxB,EAAEoB,KAAKC,WAAW,cAAe,wBAC9CI,SAAU,CACRC,SAAU1B,EAAEoB,KAAKC,WAAW,WAAY,UACxCM,KAAM3B,EAAEoB,KAAKC,WAAW,OAAQ,YAIpCO,aAAc,SAAsBC,EAAUC,GAC5CzD,EAAE,iBAAiB0D,iBAErBC,aAAc,WACZ1D,EAAO2D,sBAAsBC,MAenC7D,EAAEI,EAASC,MAAMyD,KAAK,iBAAiBJ,cAAc,CACnDK,UAAW,eACXC,MAAO,GACPC,QAAS,CACPC,IAAK,mBACLC,QAAS,eACTC,OAAQ,sBACRC,QAAS,2BAnBTC,YAAY,MAEbC,KAAKpE,EAAaqE,WAAWC,OAAO,WACrCxE,EAAOkC,OAAOuC,KAAKtE,EAASC,QA0DhC,MAAO,CACLsE,KA/BF,SAAcC,GAEZ5E,EAAE6E,UAAUC,MAAM,WAEhB9E,EAAE6E,UAAUf,KAAK,iBAAiBiB,UAClCnE,EAAOE,cAAgBd,EAAEI,EAASI,aAAawE,MAC/C/C,IAEAjC,EAAE6E,UAAUI,GAAG,SAAU7E,EAASI,YAAa,WAC7CI,EAAOE,cAAgBd,EAAE6D,MAAMmB,MAC/B/C,IACAjC,EAAE,wCAAwCgF,IAAIpE,EAAOE,iBAEvDd,EAAE6E,UAAUI,GAAG,SAAU7E,EAASG,OAAQ,WACxCK,EAAOC,OAASb,EAAE6D,MAAMmB,MACxB/C,IACAjC,EAAE,0CAA0CgF,IAAIpE,EAAOC,UAGzDb,EAAEI,EAASM,QAAQuE,GAAG,SAAU,WAC9BtE,EAAUuE,KAAKC,IAAItB,KAAKuB,OAAOC,SAGjCrF,EAAEI,EAASK,QAAQwE,GAAG,QAAS,WAC7BtE,EAAU2E,OAAOzB,KAAKuB,OAAOC,SAE/BpF,EAAOsF","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    './common',\n    './defaultconfig',\n    'core/notification',\n    './select2',\n    './jquery.dataTables',\n    './dataTables.bootstrap4',\n    './jquery-asPieProgress'\n], function($, common, CFG, Notification) {\n\n    /**\n     * Selectors\n     */\n    var SELECTOR = {\n        PAGE: \"#wdm-certificates-individual\",\n        TABLE: \"#wdm-certificates-individual .table\",\n        COHORT: \"#wdm-certificates-individual .cohort-select\",\n        CERTIFICATE: \"#wdm-certificates-individual .certificate-select\",\n        SEARCH: \"#wdm-certificates-individual .table-search-input input\",\n        LENGTH: \"#wdm-certificates-individual .table-length-select select\",\n    };\n\n    /**\n     * DataTable object.\n     */\n    var dataTable = null;\n\n    /**\n     * Filters\n     */\n    var filter = {\n        cohort: 0,\n        certificateid: 0\n    };\n\n    /**\n     * Ajax Promises\n     */\n    var PROMISES = {\n        /**\n         * Get certificates using ajax.\n         * @returns {Promise}\n         */\n        GET_CERTIFICATES: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_certificates_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify(filter)\n                },\n            });\n        }\n    };\n\n    /**\n     * Get certificate detail using certificate id and cohort id\n     */\n    function loadData() {\n        if (dataTable) {\n            dataTable.destroy();\n        }\n\n        // Show loader when data is being loaded.\n        common.loader.show(SELECTOR.PAGE);\n\n        // Fetch certificates list.\n        PROMISES.GET_CERTIFICATES().done(function(response) {\n                // Render data table.\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    data: response.data,\n                    dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n                    columnDefs: [{\n                        \"targets\": 0,\n                        \"className\": \"align-middle\"\n                    }, {\n                        \"targets\": 1,\n                        \"className\": \"align-middle\"\n                    }, {\n                        \"targets\": \"_all\",\n                        \"className\": \"align-middle text-center\"\n                    }],\n                    columns: [{\n                        \"data\": \"username\"\n                    }, {\n                        \"data\": \"email\"\n                    }, {\n                        \"data\": \"issuedate\"\n                    }, {\n                        \"data\": \"dateenrolled\"\n                    }, {\n                        \"data\": \"grade\"\n                    }, {\n                        \"data\": \"courseprogress\"\n                    }],\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('nocertificatesawarded', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: M.util.get_string('previous', 'moodle'),\n                            next: M.util.get_string('next', 'moodle')\n                        }\n                    },\n                    // eslint-disable-next-line no-unused-vars\n                    initComplete: function(settings, json) {\n                        $('.pie-progress').asPieProgress();\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                        createPieProgress('');\n                    },\n                    responsive: true\n                });\n            }).fail(Notification.exception)\n            .always(function() {\n                common.loader.hide(SELECTOR.PAGE);\n            });\n    }\n\n    /**\n     * Create pie progress where div with .pie-progress class is present\n     */\n    function createPieProgress() {\n        $(SELECTOR.PAGE).find('.pie-progress').asPieProgress({\n            namespace: 'pie-progress',\n            speed: 30,\n            classes: {\n                svg: 'pie-progress-svg',\n                element: 'pie-progress',\n                number: 'pie-progress-number',\n                content: 'pie-progress-content'\n            }\n        });\n    }\n\n    /* eslint-disable no-unused-vars */\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n        /* eslint-enable no-unused-vars */\n        $(document).ready(function() {\n            // Initialize select2.\n            $(document).find('.singleselect').select2();\n\n            filter.certificateid = $(SELECTOR.CERTIFICATE).val();\n            loadData();\n\n            // Certificate change.\n            $(document).on(\"change\", SELECTOR.CERTIFICATE, function() {\n                filter.certificateid = $(this).val();\n                loadData();\n                $('.download-links input[name=\"filter\"]').val(filter.certificateid);\n            });\n\n            $(document).on(\"change\", SELECTOR.COHORT, function() {\n                filter.cohort = $(this).val();\n                loadData();\n                $('.download-links input[name=\"cohortid\"]').val(filter.cohort);\n            });\n\n            // Observer length change.\n            $(SELECTOR.LENGTH).on('change', function() {\n                dataTable.page.len(this.value).draw();\n            });\n\n            // Search in table.\n            $(SELECTOR.SEARCH).on('input', function() {\n                dataTable.search(this.value).draw();\n            });\n\n            common.handleSearchInput();\n        });\n    }\n\n    return {\n        init: init\n    };\n\n});"],"file":"certificates.min.js"}